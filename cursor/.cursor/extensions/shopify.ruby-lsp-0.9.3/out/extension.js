"use strict";var Ib=Object.create;var Ps=Object.defineProperty;var qb=Object.getOwnPropertyDescriptor;var Fb=Object.getOwnPropertyNames;var Ob=Object.getPrototypeOf,Lb=Object.prototype.hasOwnProperty;var x=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),Mb=(r,e)=>{for(var t in e)Ps(r,t,{get:e[t],enumerable:!0})},Lf=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Fb(e))!Lb.call(r,i)&&i!==t&&Ps(r,i,{get:()=>e[i],enumerable:!(n=qb(e,i))||n.enumerable});return r};var te=(r,e,t)=>(t=r!=null?Ib(Ob(r)):{},Lf(e||!r||!r.__esModule?Ps(t,"default",{value:r,enumerable:!0}):t,r)),Nb=r=>Lf(Ps({},"__esModule",{value:!0}),r);var hn=x(tt=>{"use strict";Object.defineProperty(tt,"__esModule",{value:!0});tt.asPromise=tt.thenable=tt.typedArray=tt.stringArray=tt.array=tt.func=tt.error=tt.number=tt.string=tt.boolean=void 0;function Ab(r){return r===!0||r===!1}tt.boolean=Ab;function Mf(r){return typeof r=="string"||r instanceof String}tt.string=Mf;function $b(r){return typeof r=="number"||r instanceof Number}tt.number=$b;function jb(r){return r instanceof Error}tt.error=jb;function Nf(r){return typeof r=="function"}tt.func=Nf;function Af(r){return Array.isArray(r)}tt.array=Af;function Ub(r){return Af(r)&&r.every(e=>Mf(e))}tt.stringArray=Ub;function Wb(r,e){return Array.isArray(r)&&r.every(e)}tt.typedArray=Wb;function $f(r){return r&&Nf(r.then)}tt.thenable=$f;function Hb(r){return r instanceof Promise?r:$f(r)?new Promise((e,t)=>{r.then(n=>e(n),n=>t(n))}):Promise.resolve(r)}tt.asPromise=Hb});var Yr=x(_t=>{"use strict";Object.defineProperty(_t,"__esModule",{value:!0});_t.stringArray=_t.array=_t.func=_t.error=_t.number=_t.string=_t.boolean=void 0;function Kb(r){return r===!0||r===!1}_t.boolean=Kb;function jf(r){return typeof r=="string"||r instanceof String}_t.string=jf;function Vb(r){return typeof r=="number"||r instanceof Number}_t.number=Vb;function zb(r){return r instanceof Error}_t.error=zb;function Bb(r){return typeof r=="function"}_t.func=Bb;function Uf(r){return Array.isArray(r)}_t.array=Uf;function Gb(r){return Uf(r)&&r.every(e=>jf(e))}_t.stringArray=Gb});var fc=x(Y=>{"use strict";Object.defineProperty(Y,"__esModule",{value:!0});Y.Message=Y.NotificationType9=Y.NotificationType8=Y.NotificationType7=Y.NotificationType6=Y.NotificationType5=Y.NotificationType4=Y.NotificationType3=Y.NotificationType2=Y.NotificationType1=Y.NotificationType0=Y.NotificationType=Y.RequestType9=Y.RequestType8=Y.RequestType7=Y.RequestType6=Y.RequestType5=Y.RequestType4=Y.RequestType3=Y.RequestType2=Y.RequestType1=Y.RequestType=Y.RequestType0=Y.AbstractMessageSignature=Y.ParameterStructures=Y.ResponseError=Y.ErrorCodes=void 0;var Or=Yr(),Wa;(function(r){r.ParseError=-32700,r.InvalidRequest=-32600,r.MethodNotFound=-32601,r.InvalidParams=-32602,r.InternalError=-32603,r.jsonrpcReservedErrorRangeStart=-32099,r.serverErrorStart=-32099,r.MessageWriteError=-32099,r.MessageReadError=-32098,r.PendingResponseRejected=-32097,r.ConnectionInactive=-32096,r.ServerNotInitialized=-32002,r.UnknownErrorCode=-32001,r.jsonrpcReservedErrorRangeEnd=-32e3,r.serverErrorEnd=-32e3})(Wa||(Y.ErrorCodes=Wa={}));var Ha=class r extends Error{constructor(e,t,n){super(t),this.code=Or.number(e)?e:Wa.UnknownErrorCode,this.data=n,Object.setPrototypeOf(this,r.prototype)}toJson(){let e={code:this.code,message:this.message};return this.data!==void 0&&(e.data=this.data),e}};Y.ResponseError=Ha;var Wt=class r{constructor(e){this.kind=e}static is(e){return e===r.auto||e===r.byName||e===r.byPosition}toString(){return this.kind}};Y.ParameterStructures=Wt;Wt.auto=new Wt("auto");Wt.byPosition=new Wt("byPosition");Wt.byName=new Wt("byName");var Ue=class{constructor(e,t){this.method=e,this.numberOfParams=t}get parameterStructures(){return Wt.auto}};Y.AbstractMessageSignature=Ue;var Ka=class extends Ue{constructor(e){super(e,0)}};Y.RequestType0=Ka;var Va=class extends Ue{constructor(e,t=Wt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.RequestType=Va;var za=class extends Ue{constructor(e,t=Wt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.RequestType1=za;var Ba=class extends Ue{constructor(e){super(e,2)}};Y.RequestType2=Ba;var Ga=class extends Ue{constructor(e){super(e,3)}};Y.RequestType3=Ga;var Xa=class extends Ue{constructor(e){super(e,4)}};Y.RequestType4=Xa;var Qa=class extends Ue{constructor(e){super(e,5)}};Y.RequestType5=Qa;var Ja=class extends Ue{constructor(e){super(e,6)}};Y.RequestType6=Ja;var Ya=class extends Ue{constructor(e){super(e,7)}};Y.RequestType7=Ya;var Za=class extends Ue{constructor(e){super(e,8)}};Y.RequestType8=Za;var ec=class extends Ue{constructor(e){super(e,9)}};Y.RequestType9=ec;var tc=class extends Ue{constructor(e,t=Wt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.NotificationType=tc;var nc=class extends Ue{constructor(e){super(e,0)}};Y.NotificationType0=nc;var rc=class extends Ue{constructor(e,t=Wt.auto){super(e,1),this._parameterStructures=t}get parameterStructures(){return this._parameterStructures}};Y.NotificationType1=rc;var ic=class extends Ue{constructor(e){super(e,2)}};Y.NotificationType2=ic;var sc=class extends Ue{constructor(e){super(e,3)}};Y.NotificationType3=sc;var oc=class extends Ue{constructor(e){super(e,4)}};Y.NotificationType4=oc;var ac=class extends Ue{constructor(e){super(e,5)}};Y.NotificationType5=ac;var cc=class extends Ue{constructor(e){super(e,6)}};Y.NotificationType6=cc;var uc=class extends Ue{constructor(e){super(e,7)}};Y.NotificationType7=uc;var dc=class extends Ue{constructor(e){super(e,8)}};Y.NotificationType8=dc;var lc=class extends Ue{constructor(e){super(e,9)}};Y.NotificationType9=lc;var Wf;(function(r){function e(i){let s=i;return s&&Or.string(s.method)&&(Or.string(s.id)||Or.number(s.id))}r.isRequest=e;function t(i){let s=i;return s&&Or.string(s.method)&&i.id===void 0}r.isNotification=t;function n(i){let s=i;return s&&(s.result!==void 0||!!s.error)&&(Or.string(s.id)||Or.number(s.id)||s.id===null)}r.isResponse=n})(Wf||(Y.Message=Wf={}))});var pc=x(pr=>{"use strict";var Hf;Object.defineProperty(pr,"__esModule",{value:!0});pr.LRUCache=pr.LinkedMap=pr.Touch=void 0;var Tt;(function(r){r.None=0,r.First=1,r.AsOld=r.First,r.Last=2,r.AsNew=r.Last})(Tt||(pr.Touch=Tt={}));var ks=class{constructor(){this[Hf]="LinkedMap",this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(e){return this._map.has(e)}get(e,t=Tt.None){let n=this._map.get(e);if(n)return t!==Tt.None&&this.touch(n,t),n.value}set(e,t,n=Tt.None){let i=this._map.get(e);if(i)i.value=t,n!==Tt.None&&this.touch(i,n);else{switch(i={key:e,value:t,next:void 0,previous:void 0},n){case Tt.None:this.addItemLast(i);break;case Tt.First:this.addItemFirst(i);break;case Tt.Last:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(e,i),this._size++}return this}delete(e){return!!this.remove(e)}remove(e){let t=this._map.get(e);if(t)return this._map.delete(e),this.removeItem(t),this._size--,t.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let e=this._head;return this._map.delete(e.key),this.removeItem(e),this._size--,e.value}forEach(e,t){let n=this._state,i=this._head;for(;i;){if(t?e.bind(t)(i.value,i.key,this):e(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.key,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}values(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:t.value,done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}entries(){let e=this._state,t=this._head,n={[Symbol.iterator]:()=>n,next:()=>{if(this._state!==e)throw new Error("LinkedMap got modified during iteration.");if(t){let i={value:[t.key,t.value],done:!1};return t=t.next,i}else return{value:void 0,done:!0}}};return n}[(Hf=Symbol.toStringTag,Symbol.iterator)](){return this.entries()}trimOld(e){if(e>=this.size)return;if(e===0){this.clear();return}let t=this._head,n=this.size;for(;t&&n>e;)this._map.delete(t.key),t=t.next,n--;this._head=t,this._size=n,t&&(t.previous=void 0),this._state++}addItemFirst(e){if(!this._head&&!this._tail)this._tail=e;else if(this._head)e.next=this._head,this._head.previous=e;else throw new Error("Invalid list");this._head=e,this._state++}addItemLast(e){if(!this._head&&!this._tail)this._head=e;else if(this._tail)e.previous=this._tail,this._tail.next=e;else throw new Error("Invalid list");this._tail=e,this._state++}removeItem(e){if(e===this._head&&e===this._tail)this._head=void 0,this._tail=void 0;else if(e===this._head){if(!e.next)throw new Error("Invalid list");e.next.previous=void 0,this._head=e.next}else if(e===this._tail){if(!e.previous)throw new Error("Invalid list");e.previous.next=void 0,this._tail=e.previous}else{let t=e.next,n=e.previous;if(!t||!n)throw new Error("Invalid list");t.previous=n,n.next=t}e.next=void 0,e.previous=void 0,this._state++}touch(e,t){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(t!==Tt.First&&t!==Tt.Last)){if(t===Tt.First){if(e===this._head)return;let n=e.next,i=e.previous;e===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),e.previous=void 0,e.next=this._head,this._head.previous=e,this._head=e,this._state++}else if(t===Tt.Last){if(e===this._tail)return;let n=e.next,i=e.previous;e===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),e.next=void 0,e.previous=this._tail,this._tail.next=e,this._tail=e,this._state++}}}toJSON(){let e=[];return this.forEach((t,n)=>{e.push([n,t])}),e}fromJSON(e){this.clear();for(let[t,n]of e)this.set(t,n)}};pr.LinkedMap=ks;var hc=class extends ks{constructor(e,t=1){super(),this._limit=e,this._ratio=Math.min(Math.max(0,t),1)}get limit(){return this._limit}set limit(e){this._limit=e,this.checkTrim()}get ratio(){return this._ratio}set ratio(e){this._ratio=Math.min(Math.max(0,e),1),this.checkTrim()}get(e,t=Tt.AsNew){return super.get(e,t)}peek(e){return super.get(e,Tt.None)}set(e,t){return super.set(e,t,Tt.Last),this.checkTrim(),this}checkTrim(){this.size>this._limit&&this.trimOld(Math.round(this._limit*this._ratio))}};pr.LRUCache=hc});var Vf=x(Es=>{"use strict";Object.defineProperty(Es,"__esModule",{value:!0});Es.Disposable=void 0;var Kf;(function(r){function e(t){return{dispose:t}}r.create=e})(Kf||(Es.Disposable=Kf={}))});var gr=x(vc=>{"use strict";Object.defineProperty(vc,"__esModule",{value:!0});var gc;function mc(){if(gc===void 0)throw new Error("No runtime abstraction layer installed");return gc}(function(r){function e(t){if(t===void 0)throw new Error("No runtime abstraction layer provided");gc=t}r.install=e})(mc||(mc={}));vc.default=mc});var ei=x(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.Emitter=Zr.Event=void 0;var Xb=gr(),zf;(function(r){let e={dispose(){}};r.None=function(){return e}})(zf||(Zr.Event=zf={}));var yc=class{add(e,t=null,n){this._callbacks||(this._callbacks=[],this._contexts=[]),this._callbacks.push(e),this._contexts.push(t),Array.isArray(n)&&n.push({dispose:()=>this.remove(e,t)})}remove(e,t=null){if(!this._callbacks)return;let n=!1;for(let i=0,s=this._callbacks.length;i<s;i++)if(this._callbacks[i]===e)if(this._contexts[i]===t){this._callbacks.splice(i,1),this._contexts.splice(i,1);return}else n=!0;if(n)throw new Error("When adding a listener with a context, you should remove it with the same context")}invoke(...e){if(!this._callbacks)return[];let t=[],n=this._callbacks.slice(0),i=this._contexts.slice(0);for(let s=0,o=n.length;s<o;s++)try{t.push(n[s].apply(i[s],e))}catch(a){(0,Xb.default)().console.error(a)}return t}isEmpty(){return!this._callbacks||this._callbacks.length===0}dispose(){this._callbacks=void 0,this._contexts=void 0}},xs=class r{constructor(e){this._options=e}get event(){return this._event||(this._event=(e,t,n)=>{this._callbacks||(this._callbacks=new yc),this._options&&this._options.onFirstListenerAdd&&this._callbacks.isEmpty()&&this._options.onFirstListenerAdd(this),this._callbacks.add(e,t);let i={dispose:()=>{this._callbacks&&(this._callbacks.remove(e,t),i.dispose=r._noop,this._options&&this._options.onLastListenerRemove&&this._callbacks.isEmpty()&&this._options.onLastListenerRemove(this))}};return Array.isArray(n)&&n.push(i),i}),this._event}fire(e){this._callbacks&&this._callbacks.invoke.call(this._callbacks,e)}dispose(){this._callbacks&&(this._callbacks.dispose(),this._callbacks=void 0)}};Zr.Emitter=xs;xs._noop=function(){}});var Fs=x(ti=>{"use strict";Object.defineProperty(ti,"__esModule",{value:!0});ti.CancellationTokenSource=ti.CancellationToken=void 0;var Qb=gr(),Jb=Yr(),bc=ei(),Is;(function(r){r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:bc.Event.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:bc.Event.None});function e(t){let n=t;return n&&(n===r.None||n===r.Cancelled||Jb.boolean(n.isCancellationRequested)&&!!n.onCancellationRequested)}r.is=e})(Is||(ti.CancellationToken=Is={}));var Yb=Object.freeze(function(r,e){let t=(0,Qb.default)().timer.setTimeout(r.bind(e),0);return{dispose(){t.dispose()}}}),qs=class{constructor(){this._isCancelled=!1}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?Yb:(this._emitter||(this._emitter=new bc.Emitter),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=void 0)}},wc=class{get token(){return this._token||(this._token=new qs),this._token}cancel(){this._token?this._token.cancel():this._token=Is.Cancelled}dispose(){this._token?this._token instanceof qs&&this._token.dispose():this._token=Is.None}};ti.CancellationTokenSource=wc});var Bf=x(ni=>{"use strict";Object.defineProperty(ni,"__esModule",{value:!0});ni.SharedArrayReceiverStrategy=ni.SharedArraySenderStrategy=void 0;var Zb=Fs(),Mi;(function(r){r.Continue=0,r.Cancelled=1})(Mi||(Mi={}));var Cc=class{constructor(){this.buffers=new Map}enableCancellation(e){if(e.id===null)return;let t=new SharedArrayBuffer(4),n=new Int32Array(t,0,1);n[0]=Mi.Continue,this.buffers.set(e.id,t),e.$cancellationData=t}async sendCancellation(e,t){let n=this.buffers.get(t);if(n===void 0)return;let i=new Int32Array(n,0,1);Atomics.store(i,0,Mi.Cancelled)}cleanup(e){this.buffers.delete(e)}dispose(){this.buffers.clear()}};ni.SharedArraySenderStrategy=Cc;var Rc=class{constructor(e){this.data=new Int32Array(e,0,1)}get isCancellationRequested(){return Atomics.load(this.data,0)===Mi.Cancelled}get onCancellationRequested(){throw new Error("Cancellation over SharedArrayBuffer doesn't support cancellation events")}},Sc=class{constructor(e){this.token=new Rc(e)}cancel(){}dispose(){}},Dc=class{constructor(){this.kind="request"}createCancellationTokenSource(e){let t=e.$cancellationData;return t===void 0?new Zb.CancellationTokenSource:new Sc(t)}};ni.SharedArrayReceiverStrategy=Dc});var Tc=x(Os=>{"use strict";Object.defineProperty(Os,"__esModule",{value:!0});Os.Semaphore=void 0;var ew=gr(),_c=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,ew.default)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};Os.Semaphore=_c});var Xf=x(mr=>{"use strict";Object.defineProperty(mr,"__esModule",{value:!0});mr.ReadableStreamMessageReader=mr.AbstractMessageReader=mr.MessageReader=void 0;var kc=gr(),ri=Yr(),Pc=ei(),tw=Tc(),Gf;(function(r){function e(t){let n=t;return n&&ri.func(n.listen)&&ri.func(n.dispose)&&ri.func(n.onError)&&ri.func(n.onClose)&&ri.func(n.onPartialMessage)}r.is=e})(Gf||(mr.MessageReader=Gf={}));var Ls=class{constructor(){this.errorEmitter=new Pc.Emitter,this.closeEmitter=new Pc.Emitter,this.partialMessageEmitter=new Pc.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e){this.errorEmitter.fire(this.asError(e))}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}get onPartialMessage(){return this.partialMessageEmitter.event}firePartialMessage(e){this.partialMessageEmitter.fire(e)}asError(e){return e instanceof Error?e:new Error(`Reader received error. Reason: ${ri.string(e.message)?e.message:"unknown"}`)}};mr.AbstractMessageReader=Ls;var Ec;(function(r){function e(t){let n,i,s,o=new Map,a,c=new Map;if(t===void 0||typeof t=="string")n=t??"utf-8";else{if(n=t.charset??"utf-8",t.contentDecoder!==void 0&&(s=t.contentDecoder,o.set(s.name,s)),t.contentDecoders!==void 0)for(let d of t.contentDecoders)o.set(d.name,d);if(t.contentTypeDecoder!==void 0&&(a=t.contentTypeDecoder,c.set(a.name,a)),t.contentTypeDecoders!==void 0)for(let d of t.contentTypeDecoders)c.set(d.name,d)}return a===void 0&&(a=(0,kc.default)().applicationJson.decoder,c.set(a.name,a)),{charset:n,contentDecoder:s,contentDecoders:o,contentTypeDecoder:a,contentTypeDecoders:c}}r.fromOptions=e})(Ec||(Ec={}));var xc=class extends Ls{constructor(e,t){super(),this.readable=e,this.options=Ec.fromOptions(t),this.buffer=(0,kc.default)().messageBuffer.create(this.options.charset),this._partialMessageTimeout=1e4,this.nextMessageLength=-1,this.messageToken=0,this.readSemaphore=new tw.Semaphore(1)}set partialMessageTimeout(e){this._partialMessageTimeout=e}get partialMessageTimeout(){return this._partialMessageTimeout}listen(e){this.nextMessageLength=-1,this.messageToken=0,this.partialMessageTimer=void 0,this.callback=e;let t=this.readable.onData(n=>{this.onData(n)});return this.readable.onError(n=>this.fireError(n)),this.readable.onClose(()=>this.fireClose()),t}onData(e){try{for(this.buffer.append(e);;){if(this.nextMessageLength===-1){let n=this.buffer.tryReadHeaders(!0);if(!n)return;let i=n.get("content-length");if(!i){this.fireError(new Error(`Header must provide a Content-Length property.
${JSON.stringify(Object.fromEntries(n))}`));return}let s=parseInt(i);if(isNaN(s)){this.fireError(new Error(`Content-Length value must be a number. Got ${i}`));return}this.nextMessageLength=s}let t=this.buffer.tryReadBody(this.nextMessageLength);if(t===void 0){this.setPartialMessageTimer();return}this.clearPartialMessageTimer(),this.nextMessageLength=-1,this.readSemaphore.lock(async()=>{let n=this.options.contentDecoder!==void 0?await this.options.contentDecoder.decode(t):t,i=await this.options.contentTypeDecoder.decode(n,this.options);this.callback(i)}).catch(n=>{this.fireError(n)})}}catch(t){this.fireError(t)}}clearPartialMessageTimer(){this.partialMessageTimer&&(this.partialMessageTimer.dispose(),this.partialMessageTimer=void 0)}setPartialMessageTimer(){this.clearPartialMessageTimer(),!(this._partialMessageTimeout<=0)&&(this.partialMessageTimer=(0,kc.default)().timer.setTimeout((e,t)=>{this.partialMessageTimer=void 0,e===this.messageToken&&(this.firePartialMessage({messageToken:e,waitingTime:t}),this.setPartialMessageTimer())},this._partialMessageTimeout,this.messageToken,this._partialMessageTimeout))}};mr.ReadableStreamMessageReader=xc});var eh=x(vr=>{"use strict";Object.defineProperty(vr,"__esModule",{value:!0});vr.WriteableStreamMessageWriter=vr.AbstractMessageWriter=vr.MessageWriter=void 0;var Qf=gr(),Ni=Yr(),nw=Tc(),Jf=ei(),rw="Content-Length: ",Yf=`\r
`,Zf;(function(r){function e(t){let n=t;return n&&Ni.func(n.dispose)&&Ni.func(n.onClose)&&Ni.func(n.onError)&&Ni.func(n.write)}r.is=e})(Zf||(vr.MessageWriter=Zf={}));var Ms=class{constructor(){this.errorEmitter=new Jf.Emitter,this.closeEmitter=new Jf.Emitter}dispose(){this.errorEmitter.dispose(),this.closeEmitter.dispose()}get onError(){return this.errorEmitter.event}fireError(e,t,n){this.errorEmitter.fire([this.asError(e),t,n])}get onClose(){return this.closeEmitter.event}fireClose(){this.closeEmitter.fire(void 0)}asError(e){return e instanceof Error?e:new Error(`Writer received error. Reason: ${Ni.string(e.message)?e.message:"unknown"}`)}};vr.AbstractMessageWriter=Ms;var Ic;(function(r){function e(t){return t===void 0||typeof t=="string"?{charset:t??"utf-8",contentTypeEncoder:(0,Qf.default)().applicationJson.encoder}:{charset:t.charset??"utf-8",contentEncoder:t.contentEncoder,contentTypeEncoder:t.contentTypeEncoder??(0,Qf.default)().applicationJson.encoder}}r.fromOptions=e})(Ic||(Ic={}));var qc=class extends Ms{constructor(e,t){super(),this.writable=e,this.options=Ic.fromOptions(t),this.errorCount=0,this.writeSemaphore=new nw.Semaphore(1),this.writable.onError(n=>this.fireError(n)),this.writable.onClose(()=>this.fireClose())}async write(e){return this.writeSemaphore.lock(async()=>this.options.contentTypeEncoder.encode(e,this.options).then(n=>this.options.contentEncoder!==void 0?this.options.contentEncoder.encode(n):n).then(n=>{let i=[];return i.push(rw,n.byteLength.toString(),Yf),i.push(Yf),this.doWrite(e,i,n)},n=>{throw this.fireError(n),n}))}async doWrite(e,t,n){try{return await this.writable.write(t.join(""),"ascii"),this.writable.write(n)}catch(i){return this.handleError(i,e),Promise.reject(i)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){this.writable.end()}};vr.WriteableStreamMessageWriter=qc});var th=x(Ns=>{"use strict";Object.defineProperty(Ns,"__esModule",{value:!0});Ns.AbstractMessageBuffer=void 0;var iw=13,sw=10,ow=`\r
`,Fc=class{constructor(e="utf-8"){this._encoding=e,this._chunks=[],this._totalLength=0}get encoding(){return this._encoding}append(e){let t=typeof e=="string"?this.fromString(e,this._encoding):e;this._chunks.push(t),this._totalLength+=t.byteLength}tryReadHeaders(e=!1){if(this._chunks.length===0)return;let t=0,n=0,i=0,s=0;e:for(;n<this._chunks.length;){let d=this._chunks[n];for(i=0;i<d.length;){switch(d[i]){case iw:switch(t){case 0:t=1;break;case 2:t=3;break;default:t=0}break;case sw:switch(t){case 1:t=2;break;case 3:t=4,i++;break e;default:t=0}break;default:t=0}i++}s+=d.byteLength,n++}if(t!==4)return;let o=this._read(s+i),a=new Map,c=this.toString(o,"ascii").split(ow);if(c.length<2)return a;for(let d=0;d<c.length-2;d++){let p=c[d],m=p.indexOf(":");if(m===-1)throw new Error(`Message header must separate key and value using ':'
${p}`);let g=p.substr(0,m),S=p.substr(m+1).trim();a.set(e?g.toLowerCase():g,S)}return a}tryReadBody(e){if(!(this._totalLength<e))return this._read(e)}get numberOfBytes(){return this._totalLength}_read(e){if(e===0)return this.emptyBuffer();if(e>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===e){let s=this._chunks[0];return this._chunks.shift(),this._totalLength-=e,this.asNative(s)}if(this._chunks[0].byteLength>e){let s=this._chunks[0],o=this.asNative(s,e);return this._chunks[0]=s.slice(e),this._totalLength-=e,o}let t=this.allocNative(e),n=0,i=0;for(;e>0;){let s=this._chunks[i];if(s.byteLength>e){let o=s.slice(0,e);t.set(o,n),n+=e,this._chunks[i]=s.slice(e),this._totalLength-=e,e-=e}else t.set(s,n),n+=s.byteLength,this._chunks.shift(),this._totalLength-=s.byteLength,e-=s.byteLength}return t}};Ns.AbstractMessageBuffer=Fc});var oh=x(oe=>{"use strict";Object.defineProperty(oe,"__esModule",{value:!0});oe.createMessageConnection=oe.ConnectionOptions=oe.MessageStrategy=oe.CancellationStrategy=oe.CancellationSenderStrategy=oe.CancellationReceiverStrategy=oe.RequestCancellationReceiverStrategy=oe.IdCancellationReceiverStrategy=oe.ConnectionStrategy=oe.ConnectionError=oe.ConnectionErrors=oe.LogTraceNotification=oe.SetTraceNotification=oe.TraceFormat=oe.TraceValues=oe.Trace=oe.NullLogger=oe.ProgressType=oe.ProgressToken=void 0;var nh=gr(),Ge=Yr(),Z=fc(),rh=pc(),Ai=ei(),Oc=Fs(),Ui;(function(r){r.type=new Z.NotificationType("$/cancelRequest")})(Ui||(Ui={}));var Lc;(function(r){function e(t){return typeof t=="string"||typeof t=="number"}r.is=e})(Lc||(oe.ProgressToken=Lc={}));var $i;(function(r){r.type=new Z.NotificationType("$/progress")})($i||($i={}));var Mc=class{constructor(){}};oe.ProgressType=Mc;var Nc;(function(r){function e(t){return Ge.func(t)}r.is=e})(Nc||(Nc={}));oe.NullLogger=Object.freeze({error:()=>{},warn:()=>{},info:()=>{},log:()=>{}});var _e;(function(r){r[r.Off=0]="Off",r[r.Messages=1]="Messages",r[r.Compact=2]="Compact",r[r.Verbose=3]="Verbose"})(_e||(oe.Trace=_e={}));var ih;(function(r){r.Off="off",r.Messages="messages",r.Compact="compact",r.Verbose="verbose"})(ih||(oe.TraceValues=ih={}));(function(r){function e(n){if(!Ge.string(n))return r.Off;switch(n=n.toLowerCase(),n){case"off":return r.Off;case"messages":return r.Messages;case"compact":return r.Compact;case"verbose":return r.Verbose;default:return r.Off}}r.fromString=e;function t(n){switch(n){case r.Off:return"off";case r.Messages:return"messages";case r.Compact:return"compact";case r.Verbose:return"verbose";default:return"off"}}r.toString=t})(_e||(oe.Trace=_e={}));var tn;(function(r){r.Text="text",r.JSON="json"})(tn||(oe.TraceFormat=tn={}));(function(r){function e(t){return Ge.string(t)?(t=t.toLowerCase(),t==="json"?r.JSON:r.Text):r.Text}r.fromString=e})(tn||(oe.TraceFormat=tn={}));var Ac;(function(r){r.type=new Z.NotificationType("$/setTrace")})(Ac||(oe.SetTraceNotification=Ac={}));var As;(function(r){r.type=new Z.NotificationType("$/logTrace")})(As||(oe.LogTraceNotification=As={}));var ji;(function(r){r[r.Closed=1]="Closed",r[r.Disposed=2]="Disposed",r[r.AlreadyListening=3]="AlreadyListening"})(ji||(oe.ConnectionErrors=ji={}));var ii=class r extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,r.prototype)}};oe.ConnectionError=ii;var $c;(function(r){function e(t){let n=t;return n&&Ge.func(n.cancelUndispatched)}r.is=e})($c||(oe.ConnectionStrategy=$c={}));var $s;(function(r){function e(t){let n=t;return n&&(n.kind===void 0||n.kind==="id")&&Ge.func(n.createCancellationTokenSource)&&(n.dispose===void 0||Ge.func(n.dispose))}r.is=e})($s||(oe.IdCancellationReceiverStrategy=$s={}));var jc;(function(r){function e(t){let n=t;return n&&n.kind==="request"&&Ge.func(n.createCancellationTokenSource)&&(n.dispose===void 0||Ge.func(n.dispose))}r.is=e})(jc||(oe.RequestCancellationReceiverStrategy=jc={}));var js;(function(r){r.Message=Object.freeze({createCancellationTokenSource(t){return new Oc.CancellationTokenSource}});function e(t){return $s.is(t)||jc.is(t)}r.is=e})(js||(oe.CancellationReceiverStrategy=js={}));var Us;(function(r){r.Message=Object.freeze({sendCancellation(t,n){return t.sendNotification(Ui.type,{id:n})},cleanup(t){}});function e(t){let n=t;return n&&Ge.func(n.sendCancellation)&&Ge.func(n.cleanup)}r.is=e})(Us||(oe.CancellationSenderStrategy=Us={}));var Ws;(function(r){r.Message=Object.freeze({receiver:js.Message,sender:Us.Message});function e(t){let n=t;return n&&js.is(n.receiver)&&Us.is(n.sender)}r.is=e})(Ws||(oe.CancellationStrategy=Ws={}));var Hs;(function(r){function e(t){let n=t;return n&&Ge.func(n.handleMessage)}r.is=e})(Hs||(oe.MessageStrategy=Hs={}));var sh;(function(r){function e(t){let n=t;return n&&(Ws.is(n.cancellationStrategy)||$c.is(n.connectionStrategy)||Hs.is(n.messageStrategy))}r.is=e})(sh||(oe.ConnectionOptions=sh={}));var Pn;(function(r){r[r.New=1]="New",r[r.Listening=2]="Listening",r[r.Closed=3]="Closed",r[r.Disposed=4]="Disposed"})(Pn||(Pn={}));function aw(r,e,t,n){let i=t!==void 0?t:oe.NullLogger,s=0,o=0,a=0,c="2.0",d,p=new Map,m,g=new Map,S=new Map,y,P=new rh.LinkedMap,k=new Map,L=new Set,M=new Map,A=_e.Off,W=tn.Text,J,pe=Pn.New,G=new Ai.Emitter,ne=new Ai.Emitter,le=new Ai.Emitter,it=new Ai.Emitter,Ze=new Ai.Emitter,at=n&&n.cancellationStrategy?n.cancellationStrategy:Ws.Message;function dn(w){if(w===null)throw new Error("Can't send requests with id null since the response can't be correlated.");return"req-"+w.toString()}function Ft(w){return w===null?"res-unknown-"+(++a).toString():"res-"+w.toString()}function yt(){return"not-"+(++o).toString()}function bt(w,q){Z.Message.isRequest(q)?w.set(dn(q.id),q):Z.Message.isResponse(q)?w.set(Ft(q.id),q):w.set(yt(),q)}function Cn(w){}function Fn(){return pe===Pn.Listening}function Ae(){return pe===Pn.Closed}function $t(){return pe===Pn.Disposed}function Ot(){(pe===Pn.New||pe===Pn.Listening)&&(pe=Pn.Closed,ne.fire(void 0))}function wt(w){G.fire([w,void 0,void 0])}function ur(w){G.fire(w)}r.onClose(Ot),r.onError(wt),e.onClose(Ot),e.onError(ur);function On(){y||P.size===0||(y=(0,nh.default)().timer.setImmediate(()=>{y=void 0,Qn()}))}function Ln(w){Z.Message.isRequest(w)?Mn(w):Z.Message.isNotification(w)?Sn(w):Z.Message.isResponse(w)?Rn(w):Nn(w)}function Qn(){if(P.size===0)return;let w=P.shift();try{let q=n?.messageStrategy;Hs.is(q)?q.handleMessage(w,Ln):Ln(w)}finally{On()}}let dr=w=>{try{if(Z.Message.isNotification(w)&&w.method===Ui.type.method){let q=w.params.id,U=dn(q),K=P.get(U);if(Z.Message.isRequest(K)){let be=n?.connectionStrategy,Pe=be&&be.cancelUndispatched?be.cancelUndispatched(K,Cn):void 0;if(Pe&&(Pe.error!==void 0||Pe.result!==void 0)){P.delete(U),M.delete(q),Pe.id=K.id,ln(Pe,w.method,Date.now()),e.write(Pe).catch(()=>i.error("Sending response for canceled message failed."));return}}let Ce=M.get(q);if(Ce!==void 0){Ce.cancel(),fn(w);return}else L.add(q)}bt(P,w)}finally{On()}};function Mn(w){if($t())return;function q(ue,Se,ge){let Fe={jsonrpc:c,id:w.id};ue instanceof Z.ResponseError?Fe.error=ue.toJson():Fe.result=ue===void 0?null:ue,ln(Fe,Se,ge),e.write(Fe).catch(()=>i.error("Sending response failed."))}function U(ue,Se,ge){let Fe={jsonrpc:c,id:w.id,error:ue.toJson()};ln(Fe,Se,ge),e.write(Fe).catch(()=>i.error("Sending response failed."))}function K(ue,Se,ge){ue===void 0&&(ue=null);let Fe={jsonrpc:c,id:w.id,result:ue};ln(Fe,Se,ge),e.write(Fe).catch(()=>i.error("Sending response failed."))}lr(w);let Ce=p.get(w.method),be,Pe;Ce&&(be=Ce.type,Pe=Ce.handler);let qe=Date.now();if(Pe||d){let ue=w.id??String(Date.now()),Se=$s.is(at.receiver)?at.receiver.createCancellationTokenSource(ue):at.receiver.createCancellationTokenSource(w);w.id!==null&&L.has(w.id)&&Se.cancel(),w.id!==null&&M.set(ue,Se);try{let ge;if(Pe)if(w.params===void 0){if(be!==void 0&&be.numberOfParams!==0){U(new Z.ResponseError(Z.ErrorCodes.InvalidParams,`Request ${w.method} defines ${be.numberOfParams} params but received none.`),w.method,qe);return}ge=Pe(Se.token)}else if(Array.isArray(w.params)){if(be!==void 0&&be.parameterStructures===Z.ParameterStructures.byName){U(new Z.ResponseError(Z.ErrorCodes.InvalidParams,`Request ${w.method} defines parameters by name but received parameters by position`),w.method,qe);return}ge=Pe(...w.params,Se.token)}else{if(be!==void 0&&be.parameterStructures===Z.ParameterStructures.byPosition){U(new Z.ResponseError(Z.ErrorCodes.InvalidParams,`Request ${w.method} defines parameters by position but received parameters by name`),w.method,qe);return}ge=Pe(w.params,Se.token)}else d&&(ge=d(w.method,w.params,Se.token));let Fe=ge;ge?Fe.then?Fe.then(et=>{M.delete(ue),q(et,w.method,qe)},et=>{M.delete(ue),et instanceof Z.ResponseError?U(et,w.method,qe):et&&Ge.string(et.message)?U(new Z.ResponseError(Z.ErrorCodes.InternalError,`Request ${w.method} failed with message: ${et.message}`),w.method,qe):U(new Z.ResponseError(Z.ErrorCodes.InternalError,`Request ${w.method} failed unexpectedly without providing any details.`),w.method,qe)}):(M.delete(ue),q(ge,w.method,qe)):(M.delete(ue),K(ge,w.method,qe))}catch(ge){M.delete(ue),ge instanceof Z.ResponseError?q(ge,w.method,qe):ge&&Ge.string(ge.message)?U(new Z.ResponseError(Z.ErrorCodes.InternalError,`Request ${w.method} failed with message: ${ge.message}`),w.method,qe):U(new Z.ResponseError(Z.ErrorCodes.InternalError,`Request ${w.method} failed unexpectedly without providing any details.`),w.method,qe)}}else U(new Z.ResponseError(Z.ErrorCodes.MethodNotFound,`Unhandled method ${w.method}`),w.method,qe)}function Rn(w){if(!$t())if(w.id===null)w.error?i.error(`Received response message without id: Error is: 
${JSON.stringify(w.error,void 0,4)}`):i.error("Received response message without id. No further error information provided.");else{let q=w.id,U=k.get(q);if(An(w,U),U!==void 0){k.delete(q);try{if(w.error){let K=w.error;U.reject(new Z.ResponseError(K.code,K.message,K.data))}else if(w.result!==void 0)U.resolve(w.result);else throw new Error("Should never happen.")}catch(K){K.message?i.error(`Response handler '${U.method}' failed with message: ${K.message}`):i.error(`Response handler '${U.method}' failed unexpectedly.`)}}}}function Sn(w){if($t())return;let q,U;if(w.method===Ui.type.method){let K=w.params.id;L.delete(K),fn(w);return}else{let K=g.get(w.method);K&&(U=K.handler,q=K.type)}if(U||m)try{if(fn(w),U)if(w.params===void 0)q!==void 0&&q.numberOfParams!==0&&q.parameterStructures!==Z.ParameterStructures.byName&&i.error(`Notification ${w.method} defines ${q.numberOfParams} params but received none.`),U();else if(Array.isArray(w.params)){let K=w.params;w.method===$i.type.method&&K.length===2&&Lc.is(K[0])?U({token:K[0],value:K[1]}):(q!==void 0&&(q.parameterStructures===Z.ParameterStructures.byName&&i.error(`Notification ${w.method} defines parameters by name but received parameters by position`),q.numberOfParams!==w.params.length&&i.error(`Notification ${w.method} defines ${q.numberOfParams} params but received ${K.length} arguments`)),U(...K))}else q!==void 0&&q.parameterStructures===Z.ParameterStructures.byPosition&&i.error(`Notification ${w.method} defines parameters by position but received parameters by name`),U(w.params);else m&&m(w.method,w.params)}catch(K){K.message?i.error(`Notification handler '${w.method}' failed with message: ${K.message}`):i.error(`Notification handler '${w.method}' failed unexpectedly.`)}else le.fire(w)}function Nn(w){if(!w){i.error("Received empty message.");return}i.error(`Received message which is neither a response nor a notification message:
${JSON.stringify(w,null,4)}`);let q=w;if(Ge.string(q.id)||Ge.number(q.id)){let U=q.id,K=k.get(U);K&&K.reject(new Error("The received response has neither a result nor an error property."))}}function ct(w){if(w!=null)switch(A){case _e.Verbose:return JSON.stringify(w,null,4);case _e.Compact:return JSON.stringify(w);default:return}}function Jn(w){if(!(A===_e.Off||!J))if(W===tn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&w.params&&(q=`Params: ${ct(w.params)}

`),J.log(`Sending request '${w.method} - (${w.id})'.`,q)}else st("send-request",w)}function Dn(w){if(!(A===_e.Off||!J))if(W===tn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&(w.params?q=`Params: ${ct(w.params)}

`:q=`No parameters provided.

`),J.log(`Sending notification '${w.method}'.`,q)}else st("send-notification",w)}function ln(w,q,U){if(!(A===_e.Off||!J))if(W===tn.Text){let K;(A===_e.Verbose||A===_e.Compact)&&(w.error&&w.error.data?K=`Error data: ${ct(w.error.data)}

`:w.result?K=`Result: ${ct(w.result)}

`:w.error===void 0&&(K=`No result returned.

`)),J.log(`Sending response '${q} - (${w.id})'. Processing request took ${Date.now()-U}ms`,K)}else st("send-response",w)}function lr(w){if(!(A===_e.Off||!J))if(W===tn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&w.params&&(q=`Params: ${ct(w.params)}

`),J.log(`Received request '${w.method} - (${w.id})'.`,q)}else st("receive-request",w)}function fn(w){if(!(A===_e.Off||!J||w.method===As.type.method))if(W===tn.Text){let q;(A===_e.Verbose||A===_e.Compact)&&(w.params?q=`Params: ${ct(w.params)}

`:q=`No parameters provided.

`),J.log(`Received notification '${w.method}'.`,q)}else st("receive-notification",w)}function An(w,q){if(!(A===_e.Off||!J))if(W===tn.Text){let U;if((A===_e.Verbose||A===_e.Compact)&&(w.error&&w.error.data?U=`Error data: ${ct(w.error.data)}

`:w.result?U=`Result: ${ct(w.result)}

`:w.error===void 0&&(U=`No result returned.

`)),q){let K=w.error?` Request failed: ${w.error.message} (${w.error.code}).`:"";J.log(`Received response '${q.method} - (${w.id})' in ${Date.now()-q.timerStart}ms.${K}`,U)}else J.log(`Received response ${w.id} without active response promise.`,U)}else st("receive-response",w)}function st(w,q){if(!J||A===_e.Off)return;let U={isLSPMessage:!0,type:w,message:q,timestamp:Date.now()};J.log(U)}function Dt(){if(Ae())throw new ii(ji.Closed,"Connection is closed.");if($t())throw new ii(ji.Disposed,"Connection is disposed.")}function Ct(){if(Fn())throw new ii(ji.AlreadyListening,"Connection is already listening")}function Zt(){if(!Fn())throw new Error("Call listen() first.")}function jt(w){return w===void 0?null:w}function $n(w){if(w!==null)return w}function Yn(w){return w!=null&&!Array.isArray(w)&&typeof w=="object"}function _n(w,q){switch(w){case Z.ParameterStructures.auto:return Yn(q)?$n(q):[jt(q)];case Z.ParameterStructures.byName:if(!Yn(q))throw new Error("Received parameters by name but param is not an object literal.");return $n(q);case Z.ParameterStructures.byPosition:return[jt(q)];default:throw new Error(`Unknown parameter structure ${w.toString()}`)}}function Zn(w,q){let U,K=w.numberOfParams;switch(K){case 0:U=void 0;break;case 1:U=_n(w.parameterStructures,q[0]);break;default:U=[];for(let Ce=0;Ce<q.length&&Ce<K;Ce++)U.push(jt(q[Ce]));if(q.length<K)for(let Ce=q.length;Ce<K;Ce++)U.push(null);break}return U}let Lt={sendNotification:(w,...q)=>{Dt();let U,K;if(Ge.string(w)){U=w;let be=q[0],Pe=0,qe=Z.ParameterStructures.auto;Z.ParameterStructures.is(be)&&(Pe=1,qe=be);let ue=q.length,Se=ue-Pe;switch(Se){case 0:K=void 0;break;case 1:K=_n(qe,q[Pe]);break;default:if(qe===Z.ParameterStructures.byName)throw new Error(`Received ${Se} parameters for 'by Name' notification parameter structure.`);K=q.slice(Pe,ue).map(ge=>jt(ge));break}}else{let be=q;U=w.method,K=Zn(w,be)}let Ce={jsonrpc:c,method:U,params:K};return Dn(Ce),e.write(Ce).catch(be=>{throw i.error("Sending notification failed."),be})},onNotification:(w,q)=>{Dt();let U;return Ge.func(w)?m=w:q&&(Ge.string(w)?(U=w,g.set(w,{type:void 0,handler:q})):(U=w.method,g.set(w.method,{type:w,handler:q}))),{dispose:()=>{U!==void 0?g.delete(U):m=void 0}}},onProgress:(w,q,U)=>{if(S.has(q))throw new Error(`Progress handler for token ${q} already registered`);return S.set(q,U),{dispose:()=>{S.delete(q)}}},sendProgress:(w,q,U)=>Lt.sendNotification($i.type,{token:q,value:U}),onUnhandledProgress:it.event,sendRequest:(w,...q)=>{Dt(),Zt();let U,K,Ce;if(Ge.string(w)){U=w;let ue=q[0],Se=q[q.length-1],ge=0,Fe=Z.ParameterStructures.auto;Z.ParameterStructures.is(ue)&&(ge=1,Fe=ue);let et=q.length;Oc.CancellationToken.is(Se)&&(et=et-1,Ce=Se);let ft=et-ge;switch(ft){case 0:K=void 0;break;case 1:K=_n(Fe,q[ge]);break;default:if(Fe===Z.ParameterStructures.byName)throw new Error(`Received ${ft} parameters for 'by Name' request parameter structure.`);K=q.slice(ge,et).map(fr=>jt(fr));break}}else{let ue=q;U=w.method,K=Zn(w,ue);let Se=w.numberOfParams;Ce=Oc.CancellationToken.is(ue[Se])?ue[Se]:void 0}let be=s++,Pe;Ce&&(Pe=Ce.onCancellationRequested(()=>{let ue=at.sender.sendCancellation(Lt,be);return ue===void 0?(i.log(`Received no promise from cancellation strategy when cancelling id ${be}`),Promise.resolve()):ue.catch(()=>{i.log(`Sending cancellation messages for id ${be} failed`)})}));let qe={jsonrpc:c,id:be,method:U,params:K};return Jn(qe),typeof at.sender.enableCancellation=="function"&&at.sender.enableCancellation(qe),new Promise(async(ue,Se)=>{let ge=ft=>{ue(ft),at.sender.cleanup(be),Pe?.dispose()},Fe=ft=>{Se(ft),at.sender.cleanup(be),Pe?.dispose()},et={method:U,timerStart:Date.now(),resolve:ge,reject:Fe};try{await e.write(qe),k.set(be,et)}catch(ft){throw i.error("Sending request failed."),et.reject(new Z.ResponseError(Z.ErrorCodes.MessageWriteError,ft.message?ft.message:"Unknown reason")),ft}})},onRequest:(w,q)=>{Dt();let U=null;return Nc.is(w)?(U=void 0,d=w):Ge.string(w)?(U=null,q!==void 0&&(U=w,p.set(w,{handler:q,type:void 0}))):q!==void 0&&(U=w.method,p.set(w.method,{type:w,handler:q})),{dispose:()=>{U!==null&&(U!==void 0?p.delete(U):d=void 0)}}},hasPendingResponse:()=>k.size>0,trace:async(w,q,U)=>{let K=!1,Ce=tn.Text;U!==void 0&&(Ge.boolean(U)?K=U:(K=U.sendNotification||!1,Ce=U.traceFormat||tn.Text)),A=w,W=Ce,A===_e.Off?J=void 0:J=q,K&&!Ae()&&!$t()&&await Lt.sendNotification(Ac.type,{value:_e.toString(w)})},onError:G.event,onClose:ne.event,onUnhandledNotification:le.event,onDispose:Ze.event,end:()=>{e.end()},dispose:()=>{if($t())return;pe=Pn.Disposed,Ze.fire(void 0);let w=new Z.ResponseError(Z.ErrorCodes.PendingResponseRejected,"Pending response rejected since connection got disposed");for(let q of k.values())q.reject(w);k=new Map,M=new Map,L=new Set,P=new rh.LinkedMap,Ge.func(e.dispose)&&e.dispose(),Ge.func(r.dispose)&&r.dispose()},listen:()=>{Dt(),Ct(),pe=Pn.Listening,r.listen(dr)},inspect:()=>{(0,nh.default)().console.log("inspect")}};return Lt.onNotification(As.type,w=>{if(A===_e.Off||!J)return;let q=A===_e.Verbose||A===_e.Compact;J.log(w.message,q?w.verbose:void 0)}),Lt.onNotification($i.type,w=>{let q=S.get(w.token);q?q(w.value):it.fire(w)}),Lt}oe.createMessageConnection=aw});var Ks=x(I=>{"use strict";Object.defineProperty(I,"__esModule",{value:!0});I.ProgressType=I.ProgressToken=I.createMessageConnection=I.NullLogger=I.ConnectionOptions=I.ConnectionStrategy=I.AbstractMessageBuffer=I.WriteableStreamMessageWriter=I.AbstractMessageWriter=I.MessageWriter=I.ReadableStreamMessageReader=I.AbstractMessageReader=I.MessageReader=I.SharedArrayReceiverStrategy=I.SharedArraySenderStrategy=I.CancellationToken=I.CancellationTokenSource=I.Emitter=I.Event=I.Disposable=I.LRUCache=I.Touch=I.LinkedMap=I.ParameterStructures=I.NotificationType9=I.NotificationType8=I.NotificationType7=I.NotificationType6=I.NotificationType5=I.NotificationType4=I.NotificationType3=I.NotificationType2=I.NotificationType1=I.NotificationType0=I.NotificationType=I.ErrorCodes=I.ResponseError=I.RequestType9=I.RequestType8=I.RequestType7=I.RequestType6=I.RequestType5=I.RequestType4=I.RequestType3=I.RequestType2=I.RequestType1=I.RequestType0=I.RequestType=I.Message=I.RAL=void 0;I.MessageStrategy=I.CancellationStrategy=I.CancellationSenderStrategy=I.CancellationReceiverStrategy=I.ConnectionError=I.ConnectionErrors=I.LogTraceNotification=I.SetTraceNotification=I.TraceFormat=I.TraceValues=I.Trace=void 0;var $e=fc();Object.defineProperty(I,"Message",{enumerable:!0,get:function(){return $e.Message}});Object.defineProperty(I,"RequestType",{enumerable:!0,get:function(){return $e.RequestType}});Object.defineProperty(I,"RequestType0",{enumerable:!0,get:function(){return $e.RequestType0}});Object.defineProperty(I,"RequestType1",{enumerable:!0,get:function(){return $e.RequestType1}});Object.defineProperty(I,"RequestType2",{enumerable:!0,get:function(){return $e.RequestType2}});Object.defineProperty(I,"RequestType3",{enumerable:!0,get:function(){return $e.RequestType3}});Object.defineProperty(I,"RequestType4",{enumerable:!0,get:function(){return $e.RequestType4}});Object.defineProperty(I,"RequestType5",{enumerable:!0,get:function(){return $e.RequestType5}});Object.defineProperty(I,"RequestType6",{enumerable:!0,get:function(){return $e.RequestType6}});Object.defineProperty(I,"RequestType7",{enumerable:!0,get:function(){return $e.RequestType7}});Object.defineProperty(I,"RequestType8",{enumerable:!0,get:function(){return $e.RequestType8}});Object.defineProperty(I,"RequestType9",{enumerable:!0,get:function(){return $e.RequestType9}});Object.defineProperty(I,"ResponseError",{enumerable:!0,get:function(){return $e.ResponseError}});Object.defineProperty(I,"ErrorCodes",{enumerable:!0,get:function(){return $e.ErrorCodes}});Object.defineProperty(I,"NotificationType",{enumerable:!0,get:function(){return $e.NotificationType}});Object.defineProperty(I,"NotificationType0",{enumerable:!0,get:function(){return $e.NotificationType0}});Object.defineProperty(I,"NotificationType1",{enumerable:!0,get:function(){return $e.NotificationType1}});Object.defineProperty(I,"NotificationType2",{enumerable:!0,get:function(){return $e.NotificationType2}});Object.defineProperty(I,"NotificationType3",{enumerable:!0,get:function(){return $e.NotificationType3}});Object.defineProperty(I,"NotificationType4",{enumerable:!0,get:function(){return $e.NotificationType4}});Object.defineProperty(I,"NotificationType5",{enumerable:!0,get:function(){return $e.NotificationType5}});Object.defineProperty(I,"NotificationType6",{enumerable:!0,get:function(){return $e.NotificationType6}});Object.defineProperty(I,"NotificationType7",{enumerable:!0,get:function(){return $e.NotificationType7}});Object.defineProperty(I,"NotificationType8",{enumerable:!0,get:function(){return $e.NotificationType8}});Object.defineProperty(I,"NotificationType9",{enumerable:!0,get:function(){return $e.NotificationType9}});Object.defineProperty(I,"ParameterStructures",{enumerable:!0,get:function(){return $e.ParameterStructures}});var Uc=pc();Object.defineProperty(I,"LinkedMap",{enumerable:!0,get:function(){return Uc.LinkedMap}});Object.defineProperty(I,"LRUCache",{enumerable:!0,get:function(){return Uc.LRUCache}});Object.defineProperty(I,"Touch",{enumerable:!0,get:function(){return Uc.Touch}});var cw=Vf();Object.defineProperty(I,"Disposable",{enumerable:!0,get:function(){return cw.Disposable}});var ah=ei();Object.defineProperty(I,"Event",{enumerable:!0,get:function(){return ah.Event}});Object.defineProperty(I,"Emitter",{enumerable:!0,get:function(){return ah.Emitter}});var ch=Fs();Object.defineProperty(I,"CancellationTokenSource",{enumerable:!0,get:function(){return ch.CancellationTokenSource}});Object.defineProperty(I,"CancellationToken",{enumerable:!0,get:function(){return ch.CancellationToken}});var uh=Bf();Object.defineProperty(I,"SharedArraySenderStrategy",{enumerable:!0,get:function(){return uh.SharedArraySenderStrategy}});Object.defineProperty(I,"SharedArrayReceiverStrategy",{enumerable:!0,get:function(){return uh.SharedArrayReceiverStrategy}});var Wc=Xf();Object.defineProperty(I,"MessageReader",{enumerable:!0,get:function(){return Wc.MessageReader}});Object.defineProperty(I,"AbstractMessageReader",{enumerable:!0,get:function(){return Wc.AbstractMessageReader}});Object.defineProperty(I,"ReadableStreamMessageReader",{enumerable:!0,get:function(){return Wc.ReadableStreamMessageReader}});var Hc=eh();Object.defineProperty(I,"MessageWriter",{enumerable:!0,get:function(){return Hc.MessageWriter}});Object.defineProperty(I,"AbstractMessageWriter",{enumerable:!0,get:function(){return Hc.AbstractMessageWriter}});Object.defineProperty(I,"WriteableStreamMessageWriter",{enumerable:!0,get:function(){return Hc.WriteableStreamMessageWriter}});var uw=th();Object.defineProperty(I,"AbstractMessageBuffer",{enumerable:!0,get:function(){return uw.AbstractMessageBuffer}});var St=oh();Object.defineProperty(I,"ConnectionStrategy",{enumerable:!0,get:function(){return St.ConnectionStrategy}});Object.defineProperty(I,"ConnectionOptions",{enumerable:!0,get:function(){return St.ConnectionOptions}});Object.defineProperty(I,"NullLogger",{enumerable:!0,get:function(){return St.NullLogger}});Object.defineProperty(I,"createMessageConnection",{enumerable:!0,get:function(){return St.createMessageConnection}});Object.defineProperty(I,"ProgressToken",{enumerable:!0,get:function(){return St.ProgressToken}});Object.defineProperty(I,"ProgressType",{enumerable:!0,get:function(){return St.ProgressType}});Object.defineProperty(I,"Trace",{enumerable:!0,get:function(){return St.Trace}});Object.defineProperty(I,"TraceValues",{enumerable:!0,get:function(){return St.TraceValues}});Object.defineProperty(I,"TraceFormat",{enumerable:!0,get:function(){return St.TraceFormat}});Object.defineProperty(I,"SetTraceNotification",{enumerable:!0,get:function(){return St.SetTraceNotification}});Object.defineProperty(I,"LogTraceNotification",{enumerable:!0,get:function(){return St.LogTraceNotification}});Object.defineProperty(I,"ConnectionErrors",{enumerable:!0,get:function(){return St.ConnectionErrors}});Object.defineProperty(I,"ConnectionError",{enumerable:!0,get:function(){return St.ConnectionError}});Object.defineProperty(I,"CancellationReceiverStrategy",{enumerable:!0,get:function(){return St.CancellationReceiverStrategy}});Object.defineProperty(I,"CancellationSenderStrategy",{enumerable:!0,get:function(){return St.CancellationSenderStrategy}});Object.defineProperty(I,"CancellationStrategy",{enumerable:!0,get:function(){return St.CancellationStrategy}});Object.defineProperty(I,"MessageStrategy",{enumerable:!0,get:function(){return St.MessageStrategy}});var dw=gr();I.RAL=dw.default});var fh=x(Bc=>{"use strict";Object.defineProperty(Bc,"__esModule",{value:!0});var dh=require("util"),er=Ks(),Vs=class r extends er.AbstractMessageBuffer{constructor(e="utf-8"){super(e)}emptyBuffer(){return r.emptyBuffer}fromString(e,t){return Buffer.from(e,t)}toString(e,t){return e instanceof Buffer?e.toString(t):new dh.TextDecoder(t).decode(e)}asNative(e,t){return t===void 0?e instanceof Buffer?e:Buffer.from(e):e instanceof Buffer?e.slice(0,t):Buffer.from(e,0,t)}allocNative(e){return Buffer.allocUnsafe(e)}};Vs.emptyBuffer=Buffer.allocUnsafe(0);var Kc=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),er.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),er.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),er.Disposable.create(()=>this.stream.off("end",e))}onData(e){return this.stream.on("data",e),er.Disposable.create(()=>this.stream.off("data",e))}},Vc=class{constructor(e){this.stream=e}onClose(e){return this.stream.on("close",e),er.Disposable.create(()=>this.stream.off("close",e))}onError(e){return this.stream.on("error",e),er.Disposable.create(()=>this.stream.off("error",e))}onEnd(e){return this.stream.on("end",e),er.Disposable.create(()=>this.stream.off("end",e))}write(e,t){return new Promise((n,i)=>{let s=o=>{o==null?n():i(o)};typeof e=="string"?this.stream.write(e,t,s):this.stream.write(e,s)})}end(){this.stream.end()}},lh=Object.freeze({messageBuffer:Object.freeze({create:r=>new Vs(r)}),applicationJson:Object.freeze({encoder:Object.freeze({name:"application/json",encode:(r,e)=>{try{return Promise.resolve(Buffer.from(JSON.stringify(r,void 0,0),e.charset))}catch(t){return Promise.reject(t)}}}),decoder:Object.freeze({name:"application/json",decode:(r,e)=>{try{return r instanceof Buffer?Promise.resolve(JSON.parse(r.toString(e.charset))):Promise.resolve(JSON.parse(new dh.TextDecoder(e.charset).decode(r)))}catch(t){return Promise.reject(t)}}})}),stream:Object.freeze({asReadableStream:r=>new Kc(r),asWritableStream:r=>new Vc(r)}),console,timer:Object.freeze({setTimeout(r,e,...t){let n=setTimeout(r,e,...t);return{dispose:()=>clearTimeout(n)}},setImmediate(r,...e){let t=setImmediate(r,...e);return{dispose:()=>clearImmediate(t)}},setInterval(r,e,...t){let n=setInterval(r,e,...t);return{dispose:()=>clearInterval(n)}}})});function zc(){return lh}(function(r){function e(){er.RAL.install(lh)}r.install=e})(zc||(zc={}));Bc.default=zc});var Nr=x(ye=>{"use strict";var lw=ye&&ye.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),fw=ye&&ye.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&lw(e,r,t)};Object.defineProperty(ye,"__esModule",{value:!0});ye.createMessageConnection=ye.createServerSocketTransport=ye.createClientSocketTransport=ye.createServerPipeTransport=ye.createClientPipeTransport=ye.generateRandomPipeName=ye.StreamMessageWriter=ye.StreamMessageReader=ye.SocketMessageWriter=ye.SocketMessageReader=ye.PortMessageWriter=ye.PortMessageReader=ye.IPCMessageWriter=ye.IPCMessageReader=void 0;var si=fh();si.default.install();var hh=require("path"),hw=require("os"),pw=require("crypto"),Gs=require("net"),nn=Ks();fw(Ks(),ye);var Gc=class extends nn.AbstractMessageReader{constructor(e){super(),this.process=e;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose())}listen(e){return this.process.on("message",e),nn.Disposable.create(()=>this.process.off("message",e))}};ye.IPCMessageReader=Gc;var Xc=class extends nn.AbstractMessageWriter{constructor(e){super(),this.process=e,this.errorCount=0;let t=this.process;t.on("error",n=>this.fireError(n)),t.on("close",()=>this.fireClose)}write(e){try{return typeof this.process.send=="function"&&this.process.send(e,void 0,void 0,t=>{t?(this.errorCount++,this.handleError(t,e)):this.errorCount=0}),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};ye.IPCMessageWriter=Xc;var Qc=class extends nn.AbstractMessageReader{constructor(e){super(),this.onData=new nn.Emitter,e.on("close",()=>this.fireClose),e.on("error",t=>this.fireError(t)),e.on("message",t=>{this.onData.fire(t)})}listen(e){return this.onData.event(e)}};ye.PortMessageReader=Qc;var Jc=class extends nn.AbstractMessageWriter{constructor(e){super(),this.port=e,this.errorCount=0,e.on("close",()=>this.fireClose()),e.on("error",t=>this.fireError(t))}write(e){try{return this.port.postMessage(e),Promise.resolve()}catch(t){return this.handleError(t,e),Promise.reject(t)}}handleError(e,t){this.errorCount++,this.fireError(e,t,this.errorCount)}end(){}};ye.PortMessageWriter=Jc;var Lr=class extends nn.ReadableStreamMessageReader{constructor(e,t="utf-8"){super((0,si.default)().stream.asReadableStream(e),t)}};ye.SocketMessageReader=Lr;var Mr=class extends nn.WriteableStreamMessageWriter{constructor(e,t){super((0,si.default)().stream.asWritableStream(e),t),this.socket=e}dispose(){super.dispose(),this.socket.destroy()}};ye.SocketMessageWriter=Mr;var zs=class extends nn.ReadableStreamMessageReader{constructor(e,t){super((0,si.default)().stream.asReadableStream(e),t)}};ye.StreamMessageReader=zs;var Bs=class extends nn.WriteableStreamMessageWriter{constructor(e,t){super((0,si.default)().stream.asWritableStream(e),t)}};ye.StreamMessageWriter=Bs;var ph=process.env.XDG_RUNTIME_DIR,gw=new Map([["linux",107],["darwin",103]]);function mw(){let r=(0,pw.randomBytes)(21).toString("hex");if(process.platform==="win32")return`\\\\.\\pipe\\vscode-jsonrpc-${r}-sock`;let e;ph?e=hh.join(ph,`vscode-ipc-${r}.sock`):e=hh.join(hw.tmpdir(),`vscode-${r}.sock`);let t=gw.get(process.platform);return t!==void 0&&e.length>t&&(0,si.default)().console.warn(`WARNING: IPC handle "${e}" is longer than ${t} characters.`),e}ye.generateRandomPipeName=mw;function vw(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Gs.createServer)(a=>{o.close(),t([new Lr(a,e),new Mr(a,e)])});o.on("error",s),o.listen(r,()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}ye.createClientPipeTransport=vw;function yw(r,e="utf-8"){let t=(0,Gs.createConnection)(r);return[new Lr(t,e),new Mr(t,e)]}ye.createServerPipeTransport=yw;function bw(r,e="utf-8"){let t,n=new Promise((i,s)=>{t=i});return new Promise((i,s)=>{let o=(0,Gs.createServer)(a=>{o.close(),t([new Lr(a,e),new Mr(a,e)])});o.on("error",s),o.listen(r,"127.0.0.1",()=>{o.removeListener("error",s),i({onConnected:()=>n})})})}ye.createClientSocketTransport=bw;function ww(r,e="utf-8"){let t=(0,Gs.createConnection)(r,"127.0.0.1");return[new Lr(t,e),new Mr(t,e)]}ye.createServerSocketTransport=ww;function Cw(r){let e=r;return e.read!==void 0&&e.addListener!==void 0}function Rw(r){let e=r;return e.write!==void 0&&e.addListener!==void 0}function Sw(r,e,t,n){t||(t=nn.NullLogger);let i=Cw(r)?new zs(r):r,s=Rw(e)?new Bs(e):e;return nn.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,nn.createMessageConnection)(i,s,t,n)}ye.createMessageConnection=Sw});var Yc=x((y_,gh)=>{"use strict";gh.exports=Nr()});var Qs=x((mh,Xs)=>{(function(r){if(typeof Xs=="object"&&typeof Xs.exports=="object"){var e=r(require,mh);e!==void 0&&(Xs.exports=e)}else typeof define=="function"&&define.amd&&define(["require","exports"],r)})(function(r,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TextDocument=e.EOL=e.WorkspaceFolder=e.InlineCompletionContext=e.SelectedCompletionInfo=e.InlineCompletionTriggerKind=e.InlineCompletionList=e.InlineCompletionItem=e.StringValue=e.InlayHint=e.InlayHintLabelPart=e.InlayHintKind=e.InlineValueContext=e.InlineValueEvaluatableExpression=e.InlineValueVariableLookup=e.InlineValueText=e.SemanticTokens=e.SemanticTokenModifiers=e.SemanticTokenTypes=e.SelectionRange=e.DocumentLink=e.FormattingOptions=e.CodeLens=e.CodeAction=e.CodeActionContext=e.CodeActionTriggerKind=e.CodeActionKind=e.DocumentSymbol=e.WorkspaceSymbol=e.SymbolInformation=e.SymbolTag=e.SymbolKind=e.DocumentHighlight=e.DocumentHighlightKind=e.SignatureInformation=e.ParameterInformation=e.Hover=e.MarkedString=e.CompletionList=e.CompletionItem=e.CompletionItemLabelDetails=e.InsertTextMode=e.InsertReplaceEdit=e.CompletionItemTag=e.InsertTextFormat=e.CompletionItemKind=e.MarkupContent=e.MarkupKind=e.TextDocumentItem=e.OptionalVersionedTextDocumentIdentifier=e.VersionedTextDocumentIdentifier=e.TextDocumentIdentifier=e.WorkspaceChange=e.WorkspaceEdit=e.DeleteFile=e.RenameFile=e.CreateFile=e.TextDocumentEdit=e.AnnotatedTextEdit=e.ChangeAnnotationIdentifier=e.ChangeAnnotation=e.TextEdit=e.Command=e.Diagnostic=e.CodeDescription=e.DiagnosticTag=e.DiagnosticSeverity=e.DiagnosticRelatedInformation=e.FoldingRange=e.FoldingRangeKind=e.ColorPresentation=e.ColorInformation=e.Color=e.LocationLink=e.Location=e.Range=e.Position=e.uinteger=e.integer=e.URI=e.DocumentUri=void 0;var t;(function(h){function C(R){return typeof R=="string"}h.is=C})(t||(e.DocumentUri=t={}));var n;(function(h){function C(R){return typeof R=="string"}h.is=C})(n||(e.URI=n={}));var i;(function(h){h.MIN_VALUE=-2147483648,h.MAX_VALUE=2147483647;function C(R){return typeof R=="number"&&h.MIN_VALUE<=R&&R<=h.MAX_VALUE}h.is=C})(i||(e.integer=i={}));var s;(function(h){h.MIN_VALUE=0,h.MAX_VALUE=2147483647;function C(R){return typeof R=="number"&&h.MIN_VALUE<=R&&R<=h.MAX_VALUE}h.is=C})(s||(e.uinteger=s={}));var o;(function(h){function C(v,l){return v===Number.MAX_VALUE&&(v=s.MAX_VALUE),l===Number.MAX_VALUE&&(l=s.MAX_VALUE),{line:v,character:l}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&_.uinteger(l.line)&&_.uinteger(l.character)}h.is=R})(o||(e.Position=o={}));var a;(function(h){function C(v,l,T,F){if(_.uinteger(v)&&_.uinteger(l)&&_.uinteger(T)&&_.uinteger(F))return{start:o.create(v,l),end:o.create(T,F)};if(o.is(v)&&o.is(l))return{start:v,end:l};throw new Error("Range#create called with invalid arguments[".concat(v,", ").concat(l,", ").concat(T,", ").concat(F,"]"))}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&o.is(l.start)&&o.is(l.end)}h.is=R})(a||(e.Range=a={}));var c;(function(h){function C(v,l){return{uri:v,range:l}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&a.is(l.range)&&(_.string(l.uri)||_.undefined(l.uri))}h.is=R})(c||(e.Location=c={}));var d;(function(h){function C(v,l,T,F){return{targetUri:v,targetRange:l,targetSelectionRange:T,originSelectionRange:F}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&a.is(l.targetRange)&&_.string(l.targetUri)&&a.is(l.targetSelectionRange)&&(a.is(l.originSelectionRange)||_.undefined(l.originSelectionRange))}h.is=R})(d||(e.LocationLink=d={}));var p;(function(h){function C(v,l,T,F){return{red:v,green:l,blue:T,alpha:F}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&_.numberRange(l.red,0,1)&&_.numberRange(l.green,0,1)&&_.numberRange(l.blue,0,1)&&_.numberRange(l.alpha,0,1)}h.is=R})(p||(e.Color=p={}));var m;(function(h){function C(v,l){return{range:v,color:l}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&a.is(l.range)&&p.is(l.color)}h.is=R})(m||(e.ColorInformation=m={}));var g;(function(h){function C(v,l,T){return{label:v,textEdit:l,additionalTextEdits:T}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&_.string(l.label)&&(_.undefined(l.textEdit)||J.is(l))&&(_.undefined(l.additionalTextEdits)||_.typedArray(l.additionalTextEdits,J.is))}h.is=R})(g||(e.ColorPresentation=g={}));var S;(function(h){h.Comment="comment",h.Imports="imports",h.Region="region"})(S||(e.FoldingRangeKind=S={}));var y;(function(h){function C(v,l,T,F,re,He){var Oe={startLine:v,endLine:l};return _.defined(T)&&(Oe.startCharacter=T),_.defined(F)&&(Oe.endCharacter=F),_.defined(re)&&(Oe.kind=re),_.defined(He)&&(Oe.collapsedText=He),Oe}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&_.uinteger(l.startLine)&&_.uinteger(l.startLine)&&(_.undefined(l.startCharacter)||_.uinteger(l.startCharacter))&&(_.undefined(l.endCharacter)||_.uinteger(l.endCharacter))&&(_.undefined(l.kind)||_.string(l.kind))}h.is=R})(y||(e.FoldingRange=y={}));var P;(function(h){function C(v,l){return{location:v,message:l}}h.create=C;function R(v){var l=v;return _.defined(l)&&c.is(l.location)&&_.string(l.message)}h.is=R})(P||(e.DiagnosticRelatedInformation=P={}));var k;(function(h){h.Error=1,h.Warning=2,h.Information=3,h.Hint=4})(k||(e.DiagnosticSeverity=k={}));var L;(function(h){h.Unnecessary=1,h.Deprecated=2})(L||(e.DiagnosticTag=L={}));var M;(function(h){function C(R){var v=R;return _.objectLiteral(v)&&_.string(v.href)}h.is=C})(M||(e.CodeDescription=M={}));var A;(function(h){function C(v,l,T,F,re,He){var Oe={range:v,message:l};return _.defined(T)&&(Oe.severity=T),_.defined(F)&&(Oe.code=F),_.defined(re)&&(Oe.source=re),_.defined(He)&&(Oe.relatedInformation=He),Oe}h.create=C;function R(v){var l,T=v;return _.defined(T)&&a.is(T.range)&&_.string(T.message)&&(_.number(T.severity)||_.undefined(T.severity))&&(_.integer(T.code)||_.string(T.code)||_.undefined(T.code))&&(_.undefined(T.codeDescription)||_.string((l=T.codeDescription)===null||l===void 0?void 0:l.href))&&(_.string(T.source)||_.undefined(T.source))&&(_.undefined(T.relatedInformation)||_.typedArray(T.relatedInformation,P.is))}h.is=R})(A||(e.Diagnostic=A={}));var W;(function(h){function C(v,l){for(var T=[],F=2;F<arguments.length;F++)T[F-2]=arguments[F];var re={title:v,command:l};return _.defined(T)&&T.length>0&&(re.arguments=T),re}h.create=C;function R(v){var l=v;return _.defined(l)&&_.string(l.title)&&_.string(l.command)}h.is=R})(W||(e.Command=W={}));var J;(function(h){function C(T,F){return{range:T,newText:F}}h.replace=C;function R(T,F){return{range:{start:T,end:T},newText:F}}h.insert=R;function v(T){return{range:T,newText:""}}h.del=v;function l(T){var F=T;return _.objectLiteral(F)&&_.string(F.newText)&&a.is(F.range)}h.is=l})(J||(e.TextEdit=J={}));var pe;(function(h){function C(v,l,T){var F={label:v};return l!==void 0&&(F.needsConfirmation=l),T!==void 0&&(F.description=T),F}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&_.string(l.label)&&(_.boolean(l.needsConfirmation)||l.needsConfirmation===void 0)&&(_.string(l.description)||l.description===void 0)}h.is=R})(pe||(e.ChangeAnnotation=pe={}));var G;(function(h){function C(R){var v=R;return _.string(v)}h.is=C})(G||(e.ChangeAnnotationIdentifier=G={}));var ne;(function(h){function C(T,F,re){return{range:T,newText:F,annotationId:re}}h.replace=C;function R(T,F,re){return{range:{start:T,end:T},newText:F,annotationId:re}}h.insert=R;function v(T,F){return{range:T,newText:"",annotationId:F}}h.del=v;function l(T){var F=T;return J.is(F)&&(pe.is(F.annotationId)||G.is(F.annotationId))}h.is=l})(ne||(e.AnnotatedTextEdit=ne={}));var le;(function(h){function C(v,l){return{textDocument:v,edits:l}}h.create=C;function R(v){var l=v;return _.defined(l)&&Ae.is(l.textDocument)&&Array.isArray(l.edits)}h.is=R})(le||(e.TextDocumentEdit=le={}));var it;(function(h){function C(v,l,T){var F={kind:"create",uri:v};return l!==void 0&&(l.overwrite!==void 0||l.ignoreIfExists!==void 0)&&(F.options=l),T!==void 0&&(F.annotationId=T),F}h.create=C;function R(v){var l=v;return l&&l.kind==="create"&&_.string(l.uri)&&(l.options===void 0||(l.options.overwrite===void 0||_.boolean(l.options.overwrite))&&(l.options.ignoreIfExists===void 0||_.boolean(l.options.ignoreIfExists)))&&(l.annotationId===void 0||G.is(l.annotationId))}h.is=R})(it||(e.CreateFile=it={}));var Ze;(function(h){function C(v,l,T,F){var re={kind:"rename",oldUri:v,newUri:l};return T!==void 0&&(T.overwrite!==void 0||T.ignoreIfExists!==void 0)&&(re.options=T),F!==void 0&&(re.annotationId=F),re}h.create=C;function R(v){var l=v;return l&&l.kind==="rename"&&_.string(l.oldUri)&&_.string(l.newUri)&&(l.options===void 0||(l.options.overwrite===void 0||_.boolean(l.options.overwrite))&&(l.options.ignoreIfExists===void 0||_.boolean(l.options.ignoreIfExists)))&&(l.annotationId===void 0||G.is(l.annotationId))}h.is=R})(Ze||(e.RenameFile=Ze={}));var at;(function(h){function C(v,l,T){var F={kind:"delete",uri:v};return l!==void 0&&(l.recursive!==void 0||l.ignoreIfNotExists!==void 0)&&(F.options=l),T!==void 0&&(F.annotationId=T),F}h.create=C;function R(v){var l=v;return l&&l.kind==="delete"&&_.string(l.uri)&&(l.options===void 0||(l.options.recursive===void 0||_.boolean(l.options.recursive))&&(l.options.ignoreIfNotExists===void 0||_.boolean(l.options.ignoreIfNotExists)))&&(l.annotationId===void 0||G.is(l.annotationId))}h.is=R})(at||(e.DeleteFile=at={}));var dn;(function(h){function C(R){var v=R;return v&&(v.changes!==void 0||v.documentChanges!==void 0)&&(v.documentChanges===void 0||v.documentChanges.every(function(l){return _.string(l.kind)?it.is(l)||Ze.is(l)||at.is(l):le.is(l)}))}h.is=C})(dn||(e.WorkspaceEdit=dn={}));var Ft=function(){function h(C,R){this.edits=C,this.changeAnnotations=R}return h.prototype.insert=function(C,R,v){var l,T;if(v===void 0?l=J.insert(C,R):G.is(v)?(T=v,l=ne.insert(C,R,v)):(this.assertChangeAnnotations(this.changeAnnotations),T=this.changeAnnotations.manage(v),l=ne.insert(C,R,T)),this.edits.push(l),T!==void 0)return T},h.prototype.replace=function(C,R,v){var l,T;if(v===void 0?l=J.replace(C,R):G.is(v)?(T=v,l=ne.replace(C,R,v)):(this.assertChangeAnnotations(this.changeAnnotations),T=this.changeAnnotations.manage(v),l=ne.replace(C,R,T)),this.edits.push(l),T!==void 0)return T},h.prototype.delete=function(C,R){var v,l;if(R===void 0?v=J.del(C):G.is(R)?(l=R,v=ne.del(C,R)):(this.assertChangeAnnotations(this.changeAnnotations),l=this.changeAnnotations.manage(R),v=ne.del(C,l)),this.edits.push(v),l!==void 0)return l},h.prototype.add=function(C){this.edits.push(C)},h.prototype.all=function(){return this.edits},h.prototype.clear=function(){this.edits.splice(0,this.edits.length)},h.prototype.assertChangeAnnotations=function(C){if(C===void 0)throw new Error("Text edit change is not configured to manage change annotations.")},h}(),yt=function(){function h(C){this._annotations=C===void 0?Object.create(null):C,this._counter=0,this._size=0}return h.prototype.all=function(){return this._annotations},Object.defineProperty(h.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),h.prototype.manage=function(C,R){var v;if(G.is(C)?v=C:(v=this.nextId(),R=C),this._annotations[v]!==void 0)throw new Error("Id ".concat(v," is already in use."));if(R===void 0)throw new Error("No annotation provided for id ".concat(v));return this._annotations[v]=R,this._size++,v},h.prototype.nextId=function(){return this._counter++,this._counter.toString()},h}(),bt=function(){function h(C){var R=this;this._textEditChanges=Object.create(null),C!==void 0?(this._workspaceEdit=C,C.documentChanges?(this._changeAnnotations=new yt(C.changeAnnotations),C.changeAnnotations=this._changeAnnotations.all(),C.documentChanges.forEach(function(v){if(le.is(v)){var l=new Ft(v.edits,R._changeAnnotations);R._textEditChanges[v.textDocument.uri]=l}})):C.changes&&Object.keys(C.changes).forEach(function(v){var l=new Ft(C.changes[v]);R._textEditChanges[v]=l})):this._workspaceEdit={}}return Object.defineProperty(h.prototype,"edit",{get:function(){return this.initDocumentChanges(),this._changeAnnotations!==void 0&&(this._changeAnnotations.size===0?this._workspaceEdit.changeAnnotations=void 0:this._workspaceEdit.changeAnnotations=this._changeAnnotations.all()),this._workspaceEdit},enumerable:!1,configurable:!0}),h.prototype.getTextEditChange=function(C){if(Ae.is(C)){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var R={uri:C.uri,version:C.version},v=this._textEditChanges[R.uri];if(!v){var l=[],T={textDocument:R,edits:l};this._workspaceEdit.documentChanges.push(T),v=new Ft(l,this._changeAnnotations),this._textEditChanges[R.uri]=v}return v}else{if(this.initChanges(),this._workspaceEdit.changes===void 0)throw new Error("Workspace edit is not configured for normal text edit changes.");var v=this._textEditChanges[C];if(!v){var l=[];this._workspaceEdit.changes[C]=l,v=new Ft(l),this._textEditChanges[C]=v}return v}},h.prototype.initDocumentChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._changeAnnotations=new yt,this._workspaceEdit.documentChanges=[],this._workspaceEdit.changeAnnotations=this._changeAnnotations.all())},h.prototype.initChanges=function(){this._workspaceEdit.documentChanges===void 0&&this._workspaceEdit.changes===void 0&&(this._workspaceEdit.changes=Object.create(null))},h.prototype.createFile=function(C,R,v){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var l;pe.is(R)||G.is(R)?l=R:v=R;var T,F;if(l===void 0?T=it.create(C,v):(F=G.is(l)?l:this._changeAnnotations.manage(l),T=it.create(C,v,F)),this._workspaceEdit.documentChanges.push(T),F!==void 0)return F},h.prototype.renameFile=function(C,R,v,l){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var T;pe.is(v)||G.is(v)?T=v:l=v;var F,re;if(T===void 0?F=Ze.create(C,R,l):(re=G.is(T)?T:this._changeAnnotations.manage(T),F=Ze.create(C,R,l,re)),this._workspaceEdit.documentChanges.push(F),re!==void 0)return re},h.prototype.deleteFile=function(C,R,v){if(this.initDocumentChanges(),this._workspaceEdit.documentChanges===void 0)throw new Error("Workspace edit is not configured for document changes.");var l;pe.is(R)||G.is(R)?l=R:v=R;var T,F;if(l===void 0?T=at.create(C,v):(F=G.is(l)?l:this._changeAnnotations.manage(l),T=at.create(C,v,F)),this._workspaceEdit.documentChanges.push(T),F!==void 0)return F},h}();e.WorkspaceChange=bt;var Cn;(function(h){function C(v){return{uri:v}}h.create=C;function R(v){var l=v;return _.defined(l)&&_.string(l.uri)}h.is=R})(Cn||(e.TextDocumentIdentifier=Cn={}));var Fn;(function(h){function C(v,l){return{uri:v,version:l}}h.create=C;function R(v){var l=v;return _.defined(l)&&_.string(l.uri)&&_.integer(l.version)}h.is=R})(Fn||(e.VersionedTextDocumentIdentifier=Fn={}));var Ae;(function(h){function C(v,l){return{uri:v,version:l}}h.create=C;function R(v){var l=v;return _.defined(l)&&_.string(l.uri)&&(l.version===null||_.integer(l.version))}h.is=R})(Ae||(e.OptionalVersionedTextDocumentIdentifier=Ae={}));var $t;(function(h){function C(v,l,T,F){return{uri:v,languageId:l,version:T,text:F}}h.create=C;function R(v){var l=v;return _.defined(l)&&_.string(l.uri)&&_.string(l.languageId)&&_.integer(l.version)&&_.string(l.text)}h.is=R})($t||(e.TextDocumentItem=$t={}));var Ot;(function(h){h.PlainText="plaintext",h.Markdown="markdown";function C(R){var v=R;return v===h.PlainText||v===h.Markdown}h.is=C})(Ot||(e.MarkupKind=Ot={}));var wt;(function(h){function C(R){var v=R;return _.objectLiteral(R)&&Ot.is(v.kind)&&_.string(v.value)}h.is=C})(wt||(e.MarkupContent=wt={}));var ur;(function(h){h.Text=1,h.Method=2,h.Function=3,h.Constructor=4,h.Field=5,h.Variable=6,h.Class=7,h.Interface=8,h.Module=9,h.Property=10,h.Unit=11,h.Value=12,h.Enum=13,h.Keyword=14,h.Snippet=15,h.Color=16,h.File=17,h.Reference=18,h.Folder=19,h.EnumMember=20,h.Constant=21,h.Struct=22,h.Event=23,h.Operator=24,h.TypeParameter=25})(ur||(e.CompletionItemKind=ur={}));var On;(function(h){h.PlainText=1,h.Snippet=2})(On||(e.InsertTextFormat=On={}));var Ln;(function(h){h.Deprecated=1})(Ln||(e.CompletionItemTag=Ln={}));var Qn;(function(h){function C(v,l,T){return{newText:v,insert:l,replace:T}}h.create=C;function R(v){var l=v;return l&&_.string(l.newText)&&a.is(l.insert)&&a.is(l.replace)}h.is=R})(Qn||(e.InsertReplaceEdit=Qn={}));var dr;(function(h){h.asIs=1,h.adjustIndentation=2})(dr||(e.InsertTextMode=dr={}));var Mn;(function(h){function C(R){var v=R;return v&&(_.string(v.detail)||v.detail===void 0)&&(_.string(v.description)||v.description===void 0)}h.is=C})(Mn||(e.CompletionItemLabelDetails=Mn={}));var Rn;(function(h){function C(R){return{label:R}}h.create=C})(Rn||(e.CompletionItem=Rn={}));var Sn;(function(h){function C(R,v){return{items:R||[],isIncomplete:!!v}}h.create=C})(Sn||(e.CompletionList=Sn={}));var Nn;(function(h){function C(v){return v.replace(/[\\`*_{}[\]()#+\-.!]/g,"\\$&")}h.fromPlainText=C;function R(v){var l=v;return _.string(l)||_.objectLiteral(l)&&_.string(l.language)&&_.string(l.value)}h.is=R})(Nn||(e.MarkedString=Nn={}));var ct;(function(h){function C(R){var v=R;return!!v&&_.objectLiteral(v)&&(wt.is(v.contents)||Nn.is(v.contents)||_.typedArray(v.contents,Nn.is))&&(R.range===void 0||a.is(R.range))}h.is=C})(ct||(e.Hover=ct={}));var Jn;(function(h){function C(R,v){return v?{label:R,documentation:v}:{label:R}}h.create=C})(Jn||(e.ParameterInformation=Jn={}));var Dn;(function(h){function C(R,v){for(var l=[],T=2;T<arguments.length;T++)l[T-2]=arguments[T];var F={label:R};return _.defined(v)&&(F.documentation=v),_.defined(l)?F.parameters=l:F.parameters=[],F}h.create=C})(Dn||(e.SignatureInformation=Dn={}));var ln;(function(h){h.Text=1,h.Read=2,h.Write=3})(ln||(e.DocumentHighlightKind=ln={}));var lr;(function(h){function C(R,v){var l={range:R};return _.number(v)&&(l.kind=v),l}h.create=C})(lr||(e.DocumentHighlight=lr={}));var fn;(function(h){h.File=1,h.Module=2,h.Namespace=3,h.Package=4,h.Class=5,h.Method=6,h.Property=7,h.Field=8,h.Constructor=9,h.Enum=10,h.Interface=11,h.Function=12,h.Variable=13,h.Constant=14,h.String=15,h.Number=16,h.Boolean=17,h.Array=18,h.Object=19,h.Key=20,h.Null=21,h.EnumMember=22,h.Struct=23,h.Event=24,h.Operator=25,h.TypeParameter=26})(fn||(e.SymbolKind=fn={}));var An;(function(h){h.Deprecated=1})(An||(e.SymbolTag=An={}));var st;(function(h){function C(R,v,l,T,F){var re={name:R,kind:v,location:{uri:T,range:l}};return F&&(re.containerName=F),re}h.create=C})(st||(e.SymbolInformation=st={}));var Dt;(function(h){function C(R,v,l,T){return T!==void 0?{name:R,kind:v,location:{uri:l,range:T}}:{name:R,kind:v,location:{uri:l}}}h.create=C})(Dt||(e.WorkspaceSymbol=Dt={}));var Ct;(function(h){function C(v,l,T,F,re,He){var Oe={name:v,detail:l,kind:T,range:F,selectionRange:re};return He!==void 0&&(Oe.children=He),Oe}h.create=C;function R(v){var l=v;return l&&_.string(l.name)&&_.number(l.kind)&&a.is(l.range)&&a.is(l.selectionRange)&&(l.detail===void 0||_.string(l.detail))&&(l.deprecated===void 0||_.boolean(l.deprecated))&&(l.children===void 0||Array.isArray(l.children))&&(l.tags===void 0||Array.isArray(l.tags))}h.is=R})(Ct||(e.DocumentSymbol=Ct={}));var Zt;(function(h){h.Empty="",h.QuickFix="quickfix",h.Refactor="refactor",h.RefactorExtract="refactor.extract",h.RefactorInline="refactor.inline",h.RefactorRewrite="refactor.rewrite",h.Source="source",h.SourceOrganizeImports="source.organizeImports",h.SourceFixAll="source.fixAll"})(Zt||(e.CodeActionKind=Zt={}));var jt;(function(h){h.Invoked=1,h.Automatic=2})(jt||(e.CodeActionTriggerKind=jt={}));var $n;(function(h){function C(v,l,T){var F={diagnostics:v};return l!=null&&(F.only=l),T!=null&&(F.triggerKind=T),F}h.create=C;function R(v){var l=v;return _.defined(l)&&_.typedArray(l.diagnostics,A.is)&&(l.only===void 0||_.typedArray(l.only,_.string))&&(l.triggerKind===void 0||l.triggerKind===jt.Invoked||l.triggerKind===jt.Automatic)}h.is=R})($n||(e.CodeActionContext=$n={}));var Yn;(function(h){function C(v,l,T){var F={title:v},re=!0;return typeof l=="string"?(re=!1,F.kind=l):W.is(l)?F.command=l:F.edit=l,re&&T!==void 0&&(F.kind=T),F}h.create=C;function R(v){var l=v;return l&&_.string(l.title)&&(l.diagnostics===void 0||_.typedArray(l.diagnostics,A.is))&&(l.kind===void 0||_.string(l.kind))&&(l.edit!==void 0||l.command!==void 0)&&(l.command===void 0||W.is(l.command))&&(l.isPreferred===void 0||_.boolean(l.isPreferred))&&(l.edit===void 0||dn.is(l.edit))}h.is=R})(Yn||(e.CodeAction=Yn={}));var _n;(function(h){function C(v,l){var T={range:v};return _.defined(l)&&(T.data=l),T}h.create=C;function R(v){var l=v;return _.defined(l)&&a.is(l.range)&&(_.undefined(l.command)||W.is(l.command))}h.is=R})(_n||(e.CodeLens=_n={}));var Zn;(function(h){function C(v,l){return{tabSize:v,insertSpaces:l}}h.create=C;function R(v){var l=v;return _.defined(l)&&_.uinteger(l.tabSize)&&_.boolean(l.insertSpaces)}h.is=R})(Zn||(e.FormattingOptions=Zn={}));var Lt;(function(h){function C(v,l,T){return{range:v,target:l,data:T}}h.create=C;function R(v){var l=v;return _.defined(l)&&a.is(l.range)&&(_.undefined(l.target)||_.string(l.target))}h.is=R})(Lt||(e.DocumentLink=Lt={}));var w;(function(h){function C(v,l){return{range:v,parent:l}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&a.is(l.range)&&(l.parent===void 0||h.is(l.parent))}h.is=R})(w||(e.SelectionRange=w={}));var q;(function(h){h.namespace="namespace",h.type="type",h.class="class",h.enum="enum",h.interface="interface",h.struct="struct",h.typeParameter="typeParameter",h.parameter="parameter",h.variable="variable",h.property="property",h.enumMember="enumMember",h.event="event",h.function="function",h.method="method",h.macro="macro",h.keyword="keyword",h.modifier="modifier",h.comment="comment",h.string="string",h.number="number",h.regexp="regexp",h.operator="operator",h.decorator="decorator"})(q||(e.SemanticTokenTypes=q={}));var U;(function(h){h.declaration="declaration",h.definition="definition",h.readonly="readonly",h.static="static",h.deprecated="deprecated",h.abstract="abstract",h.async="async",h.modification="modification",h.documentation="documentation",h.defaultLibrary="defaultLibrary"})(U||(e.SemanticTokenModifiers=U={}));var K;(function(h){function C(R){var v=R;return _.objectLiteral(v)&&(v.resultId===void 0||typeof v.resultId=="string")&&Array.isArray(v.data)&&(v.data.length===0||typeof v.data[0]=="number")}h.is=C})(K||(e.SemanticTokens=K={}));var Ce;(function(h){function C(v,l){return{range:v,text:l}}h.create=C;function R(v){var l=v;return l!=null&&a.is(l.range)&&_.string(l.text)}h.is=R})(Ce||(e.InlineValueText=Ce={}));var be;(function(h){function C(v,l,T){return{range:v,variableName:l,caseSensitiveLookup:T}}h.create=C;function R(v){var l=v;return l!=null&&a.is(l.range)&&_.boolean(l.caseSensitiveLookup)&&(_.string(l.variableName)||l.variableName===void 0)}h.is=R})(be||(e.InlineValueVariableLookup=be={}));var Pe;(function(h){function C(v,l){return{range:v,expression:l}}h.create=C;function R(v){var l=v;return l!=null&&a.is(l.range)&&(_.string(l.expression)||l.expression===void 0)}h.is=R})(Pe||(e.InlineValueEvaluatableExpression=Pe={}));var qe;(function(h){function C(v,l){return{frameId:v,stoppedLocation:l}}h.create=C;function R(v){var l=v;return _.defined(l)&&a.is(v.stoppedLocation)}h.is=R})(qe||(e.InlineValueContext=qe={}));var ue;(function(h){h.Type=1,h.Parameter=2;function C(R){return R===1||R===2}h.is=C})(ue||(e.InlayHintKind=ue={}));var Se;(function(h){function C(v){return{value:v}}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&(l.tooltip===void 0||_.string(l.tooltip)||wt.is(l.tooltip))&&(l.location===void 0||c.is(l.location))&&(l.command===void 0||W.is(l.command))}h.is=R})(Se||(e.InlayHintLabelPart=Se={}));var ge;(function(h){function C(v,l,T){var F={position:v,label:l};return T!==void 0&&(F.kind=T),F}h.create=C;function R(v){var l=v;return _.objectLiteral(l)&&o.is(l.position)&&(_.string(l.label)||_.typedArray(l.label,Se.is))&&(l.kind===void 0||ue.is(l.kind))&&l.textEdits===void 0||_.typedArray(l.textEdits,J.is)&&(l.tooltip===void 0||_.string(l.tooltip)||wt.is(l.tooltip))&&(l.paddingLeft===void 0||_.boolean(l.paddingLeft))&&(l.paddingRight===void 0||_.boolean(l.paddingRight))}h.is=R})(ge||(e.InlayHint=ge={}));var Fe;(function(h){function C(R){return{kind:"snippet",value:R}}h.createSnippet=C})(Fe||(e.StringValue=Fe={}));var et;(function(h){function C(R,v,l,T){return{insertText:R,filterText:v,range:l,command:T}}h.create=C})(et||(e.InlineCompletionItem=et={}));var ft;(function(h){function C(R){return{items:R}}h.create=C})(ft||(e.InlineCompletionList=ft={}));var fr;(function(h){h.Invoked=0,h.Automatic=1})(fr||(e.InlineCompletionTriggerKind=fr={}));var hr;(function(h){function C(R,v){return{range:R,text:v}}h.create=C})(hr||(e.SelectedCompletionInfo=hr={}));var f;(function(h){function C(R,v){return{triggerKind:R,selectedCompletionInfo:v}}h.create=C})(f||(e.InlineCompletionContext=f={}));var E;(function(h){function C(R){var v=R;return _.objectLiteral(v)&&n.is(v.uri)&&_.string(v.name)}h.is=C})(E||(e.WorkspaceFolder=E={})),e.EOL=[`
`,`\r
`,"\r"];var B;(function(h){function C(T,F,re,He){return new De(T,F,re,He)}h.create=C;function R(T){var F=T;return!!(_.defined(F)&&_.string(F.uri)&&(_.undefined(F.languageId)||_.string(F.languageId))&&_.uinteger(F.lineCount)&&_.func(F.getText)&&_.func(F.positionAt)&&_.func(F.offsetAt))}h.is=R;function v(T,F){for(var re=T.getText(),He=l(F,function(jn,u){var D=jn.range.start.line-u.range.start.line;return D===0?jn.range.start.character-u.range.start.character:D}),Oe=re.length,Ut=He.length-1;Ut>=0;Ut--){var en=He[Ut],Tn=T.offsetAt(en.range.start),he=T.offsetAt(en.range.end);if(he<=Oe)re=re.substring(0,Tn)+en.newText+re.substring(he,re.length);else throw new Error("Overlapping edit");Oe=Tn}return re}h.applyEdits=v;function l(T,F){if(T.length<=1)return T;var re=T.length/2|0,He=T.slice(0,re),Oe=T.slice(re);l(He,F),l(Oe,F);for(var Ut=0,en=0,Tn=0;Ut<He.length&&en<Oe.length;){var he=F(He[Ut],Oe[en]);he<=0?T[Tn++]=He[Ut++]:T[Tn++]=Oe[en++]}for(;Ut<He.length;)T[Tn++]=He[Ut++];for(;en<Oe.length;)T[Tn++]=Oe[en++];return T}})(B||(e.TextDocument=B={}));var De=function(){function h(C,R,v,l){this._uri=C,this._languageId=R,this._version=v,this._content=l,this._lineOffsets=void 0}return Object.defineProperty(h.prototype,"uri",{get:function(){return this._uri},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"languageId",{get:function(){return this._languageId},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"version",{get:function(){return this._version},enumerable:!1,configurable:!0}),h.prototype.getText=function(C){if(C){var R=this.offsetAt(C.start),v=this.offsetAt(C.end);return this._content.substring(R,v)}return this._content},h.prototype.update=function(C,R){this._content=C.text,this._version=R,this._lineOffsets=void 0},h.prototype.getLineOffsets=function(){if(this._lineOffsets===void 0){for(var C=[],R=this._content,v=!0,l=0;l<R.length;l++){v&&(C.push(l),v=!1);var T=R.charAt(l);v=T==="\r"||T===`
`,T==="\r"&&l+1<R.length&&R.charAt(l+1)===`
`&&l++}v&&R.length>0&&C.push(R.length),this._lineOffsets=C}return this._lineOffsets},h.prototype.positionAt=function(C){C=Math.max(Math.min(C,this._content.length),0);var R=this.getLineOffsets(),v=0,l=R.length;if(l===0)return o.create(0,C);for(;v<l;){var T=Math.floor((v+l)/2);R[T]>C?l=T:v=T+1}var F=v-1;return o.create(F,C-R[F])},h.prototype.offsetAt=function(C){var R=this.getLineOffsets();if(C.line>=R.length)return this._content.length;if(C.line<0)return 0;var v=R[C.line],l=C.line+1<R.length?R[C.line+1]:this._content.length;return Math.max(Math.min(v+C.character,l),v)},Object.defineProperty(h.prototype,"lineCount",{get:function(){return this.getLineOffsets().length},enumerable:!1,configurable:!0}),h}(),_;(function(h){var C=Object.prototype.toString;function R(he){return typeof he<"u"}h.defined=R;function v(he){return typeof he>"u"}h.undefined=v;function l(he){return he===!0||he===!1}h.boolean=l;function T(he){return C.call(he)==="[object String]"}h.string=T;function F(he){return C.call(he)==="[object Number]"}h.number=F;function re(he,jn,u){return C.call(he)==="[object Number]"&&jn<=he&&he<=u}h.numberRange=re;function He(he){return C.call(he)==="[object Number]"&&-2147483648<=he&&he<=2147483647}h.integer=He;function Oe(he){return C.call(he)==="[object Number]"&&0<=he&&he<=2147483647}h.uinteger=Oe;function Ut(he){return C.call(he)==="[object Function]"}h.func=Ut;function en(he){return he!==null&&typeof he=="object"}h.objectLiteral=en;function Tn(he,jn){return Array.isArray(he)&&he.every(jn)}h.typedArray=Tn})(_||(_={}))})});var Ke=x(Ht=>{"use strict";Object.defineProperty(Ht,"__esModule",{value:!0});Ht.ProtocolNotificationType=Ht.ProtocolNotificationType0=Ht.ProtocolRequestType=Ht.ProtocolRequestType0=Ht.RegistrationType=Ht.MessageDirection=void 0;var oi=Nr(),vh;(function(r){r.clientToServer="clientToServer",r.serverToClient="serverToClient",r.both="both"})(vh||(Ht.MessageDirection=vh={}));var Zc=class{constructor(e){this.method=e}};Ht.RegistrationType=Zc;var eu=class extends oi.RequestType0{constructor(e){super(e)}};Ht.ProtocolRequestType0=eu;var tu=class extends oi.RequestType{constructor(e){super(e,oi.ParameterStructures.byName)}};Ht.ProtocolRequestType=tu;var nu=class extends oi.NotificationType0{constructor(e){super(e)}};Ht.ProtocolNotificationType0=nu;var ru=class extends oi.NotificationType{constructor(e){super(e,oi.ParameterStructures.byName)}};Ht.ProtocolNotificationType=ru});var Js=x(ut=>{"use strict";Object.defineProperty(ut,"__esModule",{value:!0});ut.objectLiteral=ut.typedArray=ut.stringArray=ut.array=ut.func=ut.error=ut.number=ut.string=ut.boolean=void 0;function Dw(r){return r===!0||r===!1}ut.boolean=Dw;function yh(r){return typeof r=="string"||r instanceof String}ut.string=yh;function _w(r){return typeof r=="number"||r instanceof Number}ut.number=_w;function Tw(r){return r instanceof Error}ut.error=Tw;function Pw(r){return typeof r=="function"}ut.func=Pw;function bh(r){return Array.isArray(r)}ut.array=bh;function kw(r){return bh(r)&&r.every(e=>yh(e))}ut.stringArray=kw;function Ew(r,e){return Array.isArray(r)&&r.every(e)}ut.typedArray=Ew;function xw(r){return r!==null&&typeof r=="object"}ut.objectLiteral=xw});var Rh=x(Ys=>{"use strict";Object.defineProperty(Ys,"__esModule",{value:!0});Ys.ImplementationRequest=void 0;var wh=Ke(),Ch;(function(r){r.method="textDocument/implementation",r.messageDirection=wh.MessageDirection.clientToServer,r.type=new wh.ProtocolRequestType(r.method)})(Ch||(Ys.ImplementationRequest=Ch={}))});var _h=x(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});Zs.TypeDefinitionRequest=void 0;var Sh=Ke(),Dh;(function(r){r.method="textDocument/typeDefinition",r.messageDirection=Sh.MessageDirection.clientToServer,r.type=new Sh.ProtocolRequestType(r.method)})(Dh||(Zs.TypeDefinitionRequest=Dh={}))});var kh=x(ai=>{"use strict";Object.defineProperty(ai,"__esModule",{value:!0});ai.DidChangeWorkspaceFoldersNotification=ai.WorkspaceFoldersRequest=void 0;var eo=Ke(),Th;(function(r){r.method="workspace/workspaceFolders",r.messageDirection=eo.MessageDirection.serverToClient,r.type=new eo.ProtocolRequestType0(r.method)})(Th||(ai.WorkspaceFoldersRequest=Th={}));var Ph;(function(r){r.method="workspace/didChangeWorkspaceFolders",r.messageDirection=eo.MessageDirection.clientToServer,r.type=new eo.ProtocolNotificationType(r.method)})(Ph||(ai.DidChangeWorkspaceFoldersNotification=Ph={}))});var Ih=x(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.ConfigurationRequest=void 0;var Eh=Ke(),xh;(function(r){r.method="workspace/configuration",r.messageDirection=Eh.MessageDirection.serverToClient,r.type=new Eh.ProtocolRequestType(r.method)})(xh||(to.ConfigurationRequest=xh={}))});var Oh=x(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.ColorPresentationRequest=ci.DocumentColorRequest=void 0;var no=Ke(),qh;(function(r){r.method="textDocument/documentColor",r.messageDirection=no.MessageDirection.clientToServer,r.type=new no.ProtocolRequestType(r.method)})(qh||(ci.DocumentColorRequest=qh={}));var Fh;(function(r){r.method="textDocument/colorPresentation",r.messageDirection=no.MessageDirection.clientToServer,r.type=new no.ProtocolRequestType(r.method)})(Fh||(ci.ColorPresentationRequest=Fh={}))});var Nh=x(ui=>{"use strict";Object.defineProperty(ui,"__esModule",{value:!0});ui.FoldingRangeRefreshRequest=ui.FoldingRangeRequest=void 0;var ro=Ke(),Lh;(function(r){r.method="textDocument/foldingRange",r.messageDirection=ro.MessageDirection.clientToServer,r.type=new ro.ProtocolRequestType(r.method)})(Lh||(ui.FoldingRangeRequest=Lh={}));var Mh;(function(r){r.method="workspace/foldingRange/refresh",r.messageDirection=ro.MessageDirection.serverToClient,r.type=new ro.ProtocolRequestType0(r.method)})(Mh||(ui.FoldingRangeRefreshRequest=Mh={}))});var jh=x(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.DeclarationRequest=void 0;var Ah=Ke(),$h;(function(r){r.method="textDocument/declaration",r.messageDirection=Ah.MessageDirection.clientToServer,r.type=new Ah.ProtocolRequestType(r.method)})($h||(io.DeclarationRequest=$h={}))});var Hh=x(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.SelectionRangeRequest=void 0;var Uh=Ke(),Wh;(function(r){r.method="textDocument/selectionRange",r.messageDirection=Uh.MessageDirection.clientToServer,r.type=new Uh.ProtocolRequestType(r.method)})(Wh||(so.SelectionRangeRequest=Wh={}))});var Bh=x(yr=>{"use strict";Object.defineProperty(yr,"__esModule",{value:!0});yr.WorkDoneProgressCancelNotification=yr.WorkDoneProgressCreateRequest=yr.WorkDoneProgress=void 0;var Iw=Nr(),oo=Ke(),Kh;(function(r){r.type=new Iw.ProgressType;function e(t){return t===r.type}r.is=e})(Kh||(yr.WorkDoneProgress=Kh={}));var Vh;(function(r){r.method="window/workDoneProgress/create",r.messageDirection=oo.MessageDirection.serverToClient,r.type=new oo.ProtocolRequestType(r.method)})(Vh||(yr.WorkDoneProgressCreateRequest=Vh={}));var zh;(function(r){r.method="window/workDoneProgress/cancel",r.messageDirection=oo.MessageDirection.clientToServer,r.type=new oo.ProtocolNotificationType(r.method)})(zh||(yr.WorkDoneProgressCancelNotification=zh={}))});var Jh=x(br=>{"use strict";Object.defineProperty(br,"__esModule",{value:!0});br.CallHierarchyOutgoingCallsRequest=br.CallHierarchyIncomingCallsRequest=br.CallHierarchyPrepareRequest=void 0;var di=Ke(),Gh;(function(r){r.method="textDocument/prepareCallHierarchy",r.messageDirection=di.MessageDirection.clientToServer,r.type=new di.ProtocolRequestType(r.method)})(Gh||(br.CallHierarchyPrepareRequest=Gh={}));var Xh;(function(r){r.method="callHierarchy/incomingCalls",r.messageDirection=di.MessageDirection.clientToServer,r.type=new di.ProtocolRequestType(r.method)})(Xh||(br.CallHierarchyIncomingCallsRequest=Xh={}));var Qh;(function(r){r.method="callHierarchy/outgoingCalls",r.messageDirection=di.MessageDirection.clientToServer,r.type=new di.ProtocolRequestType(r.method)})(Qh||(br.CallHierarchyOutgoingCallsRequest=Qh={}))});var rp=x(Kt=>{"use strict";Object.defineProperty(Kt,"__esModule",{value:!0});Kt.SemanticTokensRefreshRequest=Kt.SemanticTokensRangeRequest=Kt.SemanticTokensDeltaRequest=Kt.SemanticTokensRequest=Kt.SemanticTokensRegistrationType=Kt.TokenFormat=void 0;var tr=Ke(),Yh;(function(r){r.Relative="relative"})(Yh||(Kt.TokenFormat=Yh={}));var Wi;(function(r){r.method="textDocument/semanticTokens",r.type=new tr.RegistrationType(r.method)})(Wi||(Kt.SemanticTokensRegistrationType=Wi={}));var Zh;(function(r){r.method="textDocument/semanticTokens/full",r.messageDirection=tr.MessageDirection.clientToServer,r.type=new tr.ProtocolRequestType(r.method),r.registrationMethod=Wi.method})(Zh||(Kt.SemanticTokensRequest=Zh={}));var ep;(function(r){r.method="textDocument/semanticTokens/full/delta",r.messageDirection=tr.MessageDirection.clientToServer,r.type=new tr.ProtocolRequestType(r.method),r.registrationMethod=Wi.method})(ep||(Kt.SemanticTokensDeltaRequest=ep={}));var tp;(function(r){r.method="textDocument/semanticTokens/range",r.messageDirection=tr.MessageDirection.clientToServer,r.type=new tr.ProtocolRequestType(r.method),r.registrationMethod=Wi.method})(tp||(Kt.SemanticTokensRangeRequest=tp={}));var np;(function(r){r.method="workspace/semanticTokens/refresh",r.messageDirection=tr.MessageDirection.serverToClient,r.type=new tr.ProtocolRequestType0(r.method)})(np||(Kt.SemanticTokensRefreshRequest=np={}))});var op=x(ao=>{"use strict";Object.defineProperty(ao,"__esModule",{value:!0});ao.ShowDocumentRequest=void 0;var ip=Ke(),sp;(function(r){r.method="window/showDocument",r.messageDirection=ip.MessageDirection.serverToClient,r.type=new ip.ProtocolRequestType(r.method)})(sp||(ao.ShowDocumentRequest=sp={}))});var up=x(co=>{"use strict";Object.defineProperty(co,"__esModule",{value:!0});co.LinkedEditingRangeRequest=void 0;var ap=Ke(),cp;(function(r){r.method="textDocument/linkedEditingRange",r.messageDirection=ap.MessageDirection.clientToServer,r.type=new ap.ProtocolRequestType(r.method)})(cp||(co.LinkedEditingRangeRequest=cp={}))});var vp=x(Pt=>{"use strict";Object.defineProperty(Pt,"__esModule",{value:!0});Pt.WillDeleteFilesRequest=Pt.DidDeleteFilesNotification=Pt.DidRenameFilesNotification=Pt.WillRenameFilesRequest=Pt.DidCreateFilesNotification=Pt.WillCreateFilesRequest=Pt.FileOperationPatternKind=void 0;var pn=Ke(),dp;(function(r){r.file="file",r.folder="folder"})(dp||(Pt.FileOperationPatternKind=dp={}));var lp;(function(r){r.method="workspace/willCreateFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolRequestType(r.method)})(lp||(Pt.WillCreateFilesRequest=lp={}));var fp;(function(r){r.method="workspace/didCreateFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolNotificationType(r.method)})(fp||(Pt.DidCreateFilesNotification=fp={}));var hp;(function(r){r.method="workspace/willRenameFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolRequestType(r.method)})(hp||(Pt.WillRenameFilesRequest=hp={}));var pp;(function(r){r.method="workspace/didRenameFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolNotificationType(r.method)})(pp||(Pt.DidRenameFilesNotification=pp={}));var gp;(function(r){r.method="workspace/didDeleteFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolNotificationType(r.method)})(gp||(Pt.DidDeleteFilesNotification=gp={}));var mp;(function(r){r.method="workspace/willDeleteFiles",r.messageDirection=pn.MessageDirection.clientToServer,r.type=new pn.ProtocolRequestType(r.method)})(mp||(Pt.WillDeleteFilesRequest=mp={}))});var Rp=x(wr=>{"use strict";Object.defineProperty(wr,"__esModule",{value:!0});wr.MonikerRequest=wr.MonikerKind=wr.UniquenessLevel=void 0;var yp=Ke(),bp;(function(r){r.document="document",r.project="project",r.group="group",r.scheme="scheme",r.global="global"})(bp||(wr.UniquenessLevel=bp={}));var wp;(function(r){r.$import="import",r.$export="export",r.local="local"})(wp||(wr.MonikerKind=wp={}));var Cp;(function(r){r.method="textDocument/moniker",r.messageDirection=yp.MessageDirection.clientToServer,r.type=new yp.ProtocolRequestType(r.method)})(Cp||(wr.MonikerRequest=Cp={}))});var Tp=x(Cr=>{"use strict";Object.defineProperty(Cr,"__esModule",{value:!0});Cr.TypeHierarchySubtypesRequest=Cr.TypeHierarchySupertypesRequest=Cr.TypeHierarchyPrepareRequest=void 0;var li=Ke(),Sp;(function(r){r.method="textDocument/prepareTypeHierarchy",r.messageDirection=li.MessageDirection.clientToServer,r.type=new li.ProtocolRequestType(r.method)})(Sp||(Cr.TypeHierarchyPrepareRequest=Sp={}));var Dp;(function(r){r.method="typeHierarchy/supertypes",r.messageDirection=li.MessageDirection.clientToServer,r.type=new li.ProtocolRequestType(r.method)})(Dp||(Cr.TypeHierarchySupertypesRequest=Dp={}));var _p;(function(r){r.method="typeHierarchy/subtypes",r.messageDirection=li.MessageDirection.clientToServer,r.type=new li.ProtocolRequestType(r.method)})(_p||(Cr.TypeHierarchySubtypesRequest=_p={}))});var Ep=x(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.InlineValueRefreshRequest=fi.InlineValueRequest=void 0;var uo=Ke(),Pp;(function(r){r.method="textDocument/inlineValue",r.messageDirection=uo.MessageDirection.clientToServer,r.type=new uo.ProtocolRequestType(r.method)})(Pp||(fi.InlineValueRequest=Pp={}));var kp;(function(r){r.method="workspace/inlineValue/refresh",r.messageDirection=uo.MessageDirection.serverToClient,r.type=new uo.ProtocolRequestType0(r.method)})(kp||(fi.InlineValueRefreshRequest=kp={}))});var Fp=x(Rr=>{"use strict";Object.defineProperty(Rr,"__esModule",{value:!0});Rr.InlayHintRefreshRequest=Rr.InlayHintResolveRequest=Rr.InlayHintRequest=void 0;var hi=Ke(),xp;(function(r){r.method="textDocument/inlayHint",r.messageDirection=hi.MessageDirection.clientToServer,r.type=new hi.ProtocolRequestType(r.method)})(xp||(Rr.InlayHintRequest=xp={}));var Ip;(function(r){r.method="inlayHint/resolve",r.messageDirection=hi.MessageDirection.clientToServer,r.type=new hi.ProtocolRequestType(r.method)})(Ip||(Rr.InlayHintResolveRequest=Ip={}));var qp;(function(r){r.method="workspace/inlayHint/refresh",r.messageDirection=hi.MessageDirection.serverToClient,r.type=new hi.ProtocolRequestType0(r.method)})(qp||(Rr.InlayHintRefreshRequest=qp={}))});var jp=x(gn=>{"use strict";Object.defineProperty(gn,"__esModule",{value:!0});gn.DiagnosticRefreshRequest=gn.WorkspaceDiagnosticRequest=gn.DocumentDiagnosticRequest=gn.DocumentDiagnosticReportKind=gn.DiagnosticServerCancellationData=void 0;var $p=Nr(),qw=Js(),pi=Ke(),Op;(function(r){function e(t){let n=t;return n&&qw.boolean(n.retriggerRequest)}r.is=e})(Op||(gn.DiagnosticServerCancellationData=Op={}));var Lp;(function(r){r.Full="full",r.Unchanged="unchanged"})(Lp||(gn.DocumentDiagnosticReportKind=Lp={}));var Mp;(function(r){r.method="textDocument/diagnostic",r.messageDirection=pi.MessageDirection.clientToServer,r.type=new pi.ProtocolRequestType(r.method),r.partialResult=new $p.ProgressType})(Mp||(gn.DocumentDiagnosticRequest=Mp={}));var Np;(function(r){r.method="workspace/diagnostic",r.messageDirection=pi.MessageDirection.clientToServer,r.type=new pi.ProtocolRequestType(r.method),r.partialResult=new $p.ProgressType})(Np||(gn.WorkspaceDiagnosticRequest=Np={}));var Ap;(function(r){r.method="workspace/diagnostic/refresh",r.messageDirection=pi.MessageDirection.serverToClient,r.type=new pi.ProtocolRequestType0(r.method)})(Ap||(gn.DiagnosticRefreshRequest=Ap={}))});var Bp=x(nt=>{"use strict";Object.defineProperty(nt,"__esModule",{value:!0});nt.DidCloseNotebookDocumentNotification=nt.DidSaveNotebookDocumentNotification=nt.DidChangeNotebookDocumentNotification=nt.NotebookCellArrayChange=nt.DidOpenNotebookDocumentNotification=nt.NotebookDocumentSyncRegistrationType=nt.NotebookDocument=nt.NotebookCell=nt.ExecutionSummary=nt.NotebookCellKind=void 0;var Hi=Qs(),kn=Js(),Wn=Ke(),iu;(function(r){r.Markup=1,r.Code=2;function e(t){return t===1||t===2}r.is=e})(iu||(nt.NotebookCellKind=iu={}));var su;(function(r){function e(i,s){let o={executionOrder:i};return(s===!0||s===!1)&&(o.success=s),o}r.create=e;function t(i){let s=i;return kn.objectLiteral(s)&&Hi.uinteger.is(s.executionOrder)&&(s.success===void 0||kn.boolean(s.success))}r.is=t;function n(i,s){return i===s?!0:i==null||s===null||s===void 0?!1:i.executionOrder===s.executionOrder&&i.success===s.success}r.equals=n})(su||(nt.ExecutionSummary=su={}));var lo;(function(r){function e(s,o){return{kind:s,document:o}}r.create=e;function t(s){let o=s;return kn.objectLiteral(o)&&iu.is(o.kind)&&Hi.DocumentUri.is(o.document)&&(o.metadata===void 0||kn.objectLiteral(o.metadata))}r.is=t;function n(s,o){let a=new Set;return s.document!==o.document&&a.add("document"),s.kind!==o.kind&&a.add("kind"),s.executionSummary!==o.executionSummary&&a.add("executionSummary"),(s.metadata!==void 0||o.metadata!==void 0)&&!i(s.metadata,o.metadata)&&a.add("metadata"),(s.executionSummary!==void 0||o.executionSummary!==void 0)&&!su.equals(s.executionSummary,o.executionSummary)&&a.add("executionSummary"),a}r.diff=n;function i(s,o){if(s===o)return!0;if(s==null||o===null||o===void 0||typeof s!=typeof o||typeof s!="object")return!1;let a=Array.isArray(s),c=Array.isArray(o);if(a!==c)return!1;if(a&&c){if(s.length!==o.length)return!1;for(let d=0;d<s.length;d++)if(!i(s[d],o[d]))return!1}if(kn.objectLiteral(s)&&kn.objectLiteral(o)){let d=Object.keys(s),p=Object.keys(o);if(d.length!==p.length||(d.sort(),p.sort(),!i(d,p)))return!1;for(let m=0;m<d.length;m++){let g=d[m];if(!i(s[g],o[g]))return!1}}return!0}})(lo||(nt.NotebookCell=lo={}));var Up;(function(r){function e(n,i,s,o){return{uri:n,notebookType:i,version:s,cells:o}}r.create=e;function t(n){let i=n;return kn.objectLiteral(i)&&kn.string(i.uri)&&Hi.integer.is(i.version)&&kn.typedArray(i.cells,lo.is)}r.is=t})(Up||(nt.NotebookDocument=Up={}));var gi;(function(r){r.method="notebookDocument/sync",r.messageDirection=Wn.MessageDirection.clientToServer,r.type=new Wn.RegistrationType(r.method)})(gi||(nt.NotebookDocumentSyncRegistrationType=gi={}));var Wp;(function(r){r.method="notebookDocument/didOpen",r.messageDirection=Wn.MessageDirection.clientToServer,r.type=new Wn.ProtocolNotificationType(r.method),r.registrationMethod=gi.method})(Wp||(nt.DidOpenNotebookDocumentNotification=Wp={}));var Hp;(function(r){function e(n){let i=n;return kn.objectLiteral(i)&&Hi.uinteger.is(i.start)&&Hi.uinteger.is(i.deleteCount)&&(i.cells===void 0||kn.typedArray(i.cells,lo.is))}r.is=e;function t(n,i,s){let o={start:n,deleteCount:i};return s!==void 0&&(o.cells=s),o}r.create=t})(Hp||(nt.NotebookCellArrayChange=Hp={}));var Kp;(function(r){r.method="notebookDocument/didChange",r.messageDirection=Wn.MessageDirection.clientToServer,r.type=new Wn.ProtocolNotificationType(r.method),r.registrationMethod=gi.method})(Kp||(nt.DidChangeNotebookDocumentNotification=Kp={}));var Vp;(function(r){r.method="notebookDocument/didSave",r.messageDirection=Wn.MessageDirection.clientToServer,r.type=new Wn.ProtocolNotificationType(r.method),r.registrationMethod=gi.method})(Vp||(nt.DidSaveNotebookDocumentNotification=Vp={}));var zp;(function(r){r.method="notebookDocument/didClose",r.messageDirection=Wn.MessageDirection.clientToServer,r.type=new Wn.ProtocolNotificationType(r.method),r.registrationMethod=gi.method})(zp||(nt.DidCloseNotebookDocumentNotification=zp={}))});var Qp=x(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.InlineCompletionRequest=void 0;var Gp=Ke(),Xp;(function(r){r.method="textDocument/inlineCompletion",r.messageDirection=Gp.MessageDirection.clientToServer,r.type=new Gp.ProtocolRequestType(r.method)})(Xp||(fo.InlineCompletionRequest=Xp={}))});var um=x(b=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0});b.WorkspaceSymbolRequest=b.CodeActionResolveRequest=b.CodeActionRequest=b.DocumentSymbolRequest=b.DocumentHighlightRequest=b.ReferencesRequest=b.DefinitionRequest=b.SignatureHelpRequest=b.SignatureHelpTriggerKind=b.HoverRequest=b.CompletionResolveRequest=b.CompletionRequest=b.CompletionTriggerKind=b.PublishDiagnosticsNotification=b.WatchKind=b.RelativePattern=b.FileChangeType=b.DidChangeWatchedFilesNotification=b.WillSaveTextDocumentWaitUntilRequest=b.WillSaveTextDocumentNotification=b.TextDocumentSaveReason=b.DidSaveTextDocumentNotification=b.DidCloseTextDocumentNotification=b.DidChangeTextDocumentNotification=b.TextDocumentContentChangeEvent=b.DidOpenTextDocumentNotification=b.TextDocumentSyncKind=b.TelemetryEventNotification=b.LogMessageNotification=b.ShowMessageRequest=b.ShowMessageNotification=b.MessageType=b.DidChangeConfigurationNotification=b.ExitNotification=b.ShutdownRequest=b.InitializedNotification=b.InitializeErrorCodes=b.InitializeRequest=b.WorkDoneProgressOptions=b.TextDocumentRegistrationOptions=b.StaticRegistrationOptions=b.PositionEncodingKind=b.FailureHandlingKind=b.ResourceOperationKind=b.UnregistrationRequest=b.RegistrationRequest=b.DocumentSelector=b.NotebookCellTextDocumentFilter=b.NotebookDocumentFilter=b.TextDocumentFilter=void 0;b.MonikerRequest=b.MonikerKind=b.UniquenessLevel=b.WillDeleteFilesRequest=b.DidDeleteFilesNotification=b.WillRenameFilesRequest=b.DidRenameFilesNotification=b.WillCreateFilesRequest=b.DidCreateFilesNotification=b.FileOperationPatternKind=b.LinkedEditingRangeRequest=b.ShowDocumentRequest=b.SemanticTokensRegistrationType=b.SemanticTokensRefreshRequest=b.SemanticTokensRangeRequest=b.SemanticTokensDeltaRequest=b.SemanticTokensRequest=b.TokenFormat=b.CallHierarchyPrepareRequest=b.CallHierarchyOutgoingCallsRequest=b.CallHierarchyIncomingCallsRequest=b.WorkDoneProgressCancelNotification=b.WorkDoneProgressCreateRequest=b.WorkDoneProgress=b.SelectionRangeRequest=b.DeclarationRequest=b.FoldingRangeRefreshRequest=b.FoldingRangeRequest=b.ColorPresentationRequest=b.DocumentColorRequest=b.ConfigurationRequest=b.DidChangeWorkspaceFoldersNotification=b.WorkspaceFoldersRequest=b.TypeDefinitionRequest=b.ImplementationRequest=b.ApplyWorkspaceEditRequest=b.ExecuteCommandRequest=b.PrepareRenameRequest=b.RenameRequest=b.PrepareSupportDefaultBehavior=b.DocumentOnTypeFormattingRequest=b.DocumentRangesFormattingRequest=b.DocumentRangeFormattingRequest=b.DocumentFormattingRequest=b.DocumentLinkResolveRequest=b.DocumentLinkRequest=b.CodeLensRefreshRequest=b.CodeLensResolveRequest=b.CodeLensRequest=b.WorkspaceSymbolResolveRequest=void 0;b.InlineCompletionRequest=b.DidCloseNotebookDocumentNotification=b.DidSaveNotebookDocumentNotification=b.DidChangeNotebookDocumentNotification=b.NotebookCellArrayChange=b.DidOpenNotebookDocumentNotification=b.NotebookDocumentSyncRegistrationType=b.NotebookDocument=b.NotebookCell=b.ExecutionSummary=b.NotebookCellKind=b.DiagnosticRefreshRequest=b.WorkspaceDiagnosticRequest=b.DocumentDiagnosticRequest=b.DocumentDiagnosticReportKind=b.DiagnosticServerCancellationData=b.InlayHintRefreshRequest=b.InlayHintResolveRequest=b.InlayHintRequest=b.InlineValueRefreshRequest=b.InlineValueRequest=b.TypeHierarchySupertypesRequest=b.TypeHierarchySubtypesRequest=b.TypeHierarchyPrepareRequest=void 0;var j=Ke(),Jp=Qs(),pt=Js(),Fw=Rh();Object.defineProperty(b,"ImplementationRequest",{enumerable:!0,get:function(){return Fw.ImplementationRequest}});var Ow=_h();Object.defineProperty(b,"TypeDefinitionRequest",{enumerable:!0,get:function(){return Ow.TypeDefinitionRequest}});var sm=kh();Object.defineProperty(b,"WorkspaceFoldersRequest",{enumerable:!0,get:function(){return sm.WorkspaceFoldersRequest}});Object.defineProperty(b,"DidChangeWorkspaceFoldersNotification",{enumerable:!0,get:function(){return sm.DidChangeWorkspaceFoldersNotification}});var Lw=Ih();Object.defineProperty(b,"ConfigurationRequest",{enumerable:!0,get:function(){return Lw.ConfigurationRequest}});var om=Oh();Object.defineProperty(b,"DocumentColorRequest",{enumerable:!0,get:function(){return om.DocumentColorRequest}});Object.defineProperty(b,"ColorPresentationRequest",{enumerable:!0,get:function(){return om.ColorPresentationRequest}});var am=Nh();Object.defineProperty(b,"FoldingRangeRequest",{enumerable:!0,get:function(){return am.FoldingRangeRequest}});Object.defineProperty(b,"FoldingRangeRefreshRequest",{enumerable:!0,get:function(){return am.FoldingRangeRefreshRequest}});var Mw=jh();Object.defineProperty(b,"DeclarationRequest",{enumerable:!0,get:function(){return Mw.DeclarationRequest}});var Nw=Hh();Object.defineProperty(b,"SelectionRangeRequest",{enumerable:!0,get:function(){return Nw.SelectionRangeRequest}});var du=Bh();Object.defineProperty(b,"WorkDoneProgress",{enumerable:!0,get:function(){return du.WorkDoneProgress}});Object.defineProperty(b,"WorkDoneProgressCreateRequest",{enumerable:!0,get:function(){return du.WorkDoneProgressCreateRequest}});Object.defineProperty(b,"WorkDoneProgressCancelNotification",{enumerable:!0,get:function(){return du.WorkDoneProgressCancelNotification}});var lu=Jh();Object.defineProperty(b,"CallHierarchyIncomingCallsRequest",{enumerable:!0,get:function(){return lu.CallHierarchyIncomingCallsRequest}});Object.defineProperty(b,"CallHierarchyOutgoingCallsRequest",{enumerable:!0,get:function(){return lu.CallHierarchyOutgoingCallsRequest}});Object.defineProperty(b,"CallHierarchyPrepareRequest",{enumerable:!0,get:function(){return lu.CallHierarchyPrepareRequest}});var mi=rp();Object.defineProperty(b,"TokenFormat",{enumerable:!0,get:function(){return mi.TokenFormat}});Object.defineProperty(b,"SemanticTokensRequest",{enumerable:!0,get:function(){return mi.SemanticTokensRequest}});Object.defineProperty(b,"SemanticTokensDeltaRequest",{enumerable:!0,get:function(){return mi.SemanticTokensDeltaRequest}});Object.defineProperty(b,"SemanticTokensRangeRequest",{enumerable:!0,get:function(){return mi.SemanticTokensRangeRequest}});Object.defineProperty(b,"SemanticTokensRefreshRequest",{enumerable:!0,get:function(){return mi.SemanticTokensRefreshRequest}});Object.defineProperty(b,"SemanticTokensRegistrationType",{enumerable:!0,get:function(){return mi.SemanticTokensRegistrationType}});var Aw=op();Object.defineProperty(b,"ShowDocumentRequest",{enumerable:!0,get:function(){return Aw.ShowDocumentRequest}});var $w=up();Object.defineProperty(b,"LinkedEditingRangeRequest",{enumerable:!0,get:function(){return $w.LinkedEditingRangeRequest}});var Ar=vp();Object.defineProperty(b,"FileOperationPatternKind",{enumerable:!0,get:function(){return Ar.FileOperationPatternKind}});Object.defineProperty(b,"DidCreateFilesNotification",{enumerable:!0,get:function(){return Ar.DidCreateFilesNotification}});Object.defineProperty(b,"WillCreateFilesRequest",{enumerable:!0,get:function(){return Ar.WillCreateFilesRequest}});Object.defineProperty(b,"DidRenameFilesNotification",{enumerable:!0,get:function(){return Ar.DidRenameFilesNotification}});Object.defineProperty(b,"WillRenameFilesRequest",{enumerable:!0,get:function(){return Ar.WillRenameFilesRequest}});Object.defineProperty(b,"DidDeleteFilesNotification",{enumerable:!0,get:function(){return Ar.DidDeleteFilesNotification}});Object.defineProperty(b,"WillDeleteFilesRequest",{enumerable:!0,get:function(){return Ar.WillDeleteFilesRequest}});var fu=Rp();Object.defineProperty(b,"UniquenessLevel",{enumerable:!0,get:function(){return fu.UniquenessLevel}});Object.defineProperty(b,"MonikerKind",{enumerable:!0,get:function(){return fu.MonikerKind}});Object.defineProperty(b,"MonikerRequest",{enumerable:!0,get:function(){return fu.MonikerRequest}});var hu=Tp();Object.defineProperty(b,"TypeHierarchyPrepareRequest",{enumerable:!0,get:function(){return hu.TypeHierarchyPrepareRequest}});Object.defineProperty(b,"TypeHierarchySubtypesRequest",{enumerable:!0,get:function(){return hu.TypeHierarchySubtypesRequest}});Object.defineProperty(b,"TypeHierarchySupertypesRequest",{enumerable:!0,get:function(){return hu.TypeHierarchySupertypesRequest}});var cm=Ep();Object.defineProperty(b,"InlineValueRequest",{enumerable:!0,get:function(){return cm.InlineValueRequest}});Object.defineProperty(b,"InlineValueRefreshRequest",{enumerable:!0,get:function(){return cm.InlineValueRefreshRequest}});var pu=Fp();Object.defineProperty(b,"InlayHintRequest",{enumerable:!0,get:function(){return pu.InlayHintRequest}});Object.defineProperty(b,"InlayHintResolveRequest",{enumerable:!0,get:function(){return pu.InlayHintResolveRequest}});Object.defineProperty(b,"InlayHintRefreshRequest",{enumerable:!0,get:function(){return pu.InlayHintRefreshRequest}});var Ki=jp();Object.defineProperty(b,"DiagnosticServerCancellationData",{enumerable:!0,get:function(){return Ki.DiagnosticServerCancellationData}});Object.defineProperty(b,"DocumentDiagnosticReportKind",{enumerable:!0,get:function(){return Ki.DocumentDiagnosticReportKind}});Object.defineProperty(b,"DocumentDiagnosticRequest",{enumerable:!0,get:function(){return Ki.DocumentDiagnosticRequest}});Object.defineProperty(b,"WorkspaceDiagnosticRequest",{enumerable:!0,get:function(){return Ki.WorkspaceDiagnosticRequest}});Object.defineProperty(b,"DiagnosticRefreshRequest",{enumerable:!0,get:function(){return Ki.DiagnosticRefreshRequest}});var Hn=Bp();Object.defineProperty(b,"NotebookCellKind",{enumerable:!0,get:function(){return Hn.NotebookCellKind}});Object.defineProperty(b,"ExecutionSummary",{enumerable:!0,get:function(){return Hn.ExecutionSummary}});Object.defineProperty(b,"NotebookCell",{enumerable:!0,get:function(){return Hn.NotebookCell}});Object.defineProperty(b,"NotebookDocument",{enumerable:!0,get:function(){return Hn.NotebookDocument}});Object.defineProperty(b,"NotebookDocumentSyncRegistrationType",{enumerable:!0,get:function(){return Hn.NotebookDocumentSyncRegistrationType}});Object.defineProperty(b,"DidOpenNotebookDocumentNotification",{enumerable:!0,get:function(){return Hn.DidOpenNotebookDocumentNotification}});Object.defineProperty(b,"NotebookCellArrayChange",{enumerable:!0,get:function(){return Hn.NotebookCellArrayChange}});Object.defineProperty(b,"DidChangeNotebookDocumentNotification",{enumerable:!0,get:function(){return Hn.DidChangeNotebookDocumentNotification}});Object.defineProperty(b,"DidSaveNotebookDocumentNotification",{enumerable:!0,get:function(){return Hn.DidSaveNotebookDocumentNotification}});Object.defineProperty(b,"DidCloseNotebookDocumentNotification",{enumerable:!0,get:function(){return Hn.DidCloseNotebookDocumentNotification}});var jw=Qp();Object.defineProperty(b,"InlineCompletionRequest",{enumerable:!0,get:function(){return jw.InlineCompletionRequest}});var ou;(function(r){function e(t){let n=t;return pt.string(n)||pt.string(n.language)||pt.string(n.scheme)||pt.string(n.pattern)}r.is=e})(ou||(b.TextDocumentFilter=ou={}));var au;(function(r){function e(t){let n=t;return pt.objectLiteral(n)&&(pt.string(n.notebookType)||pt.string(n.scheme)||pt.string(n.pattern))}r.is=e})(au||(b.NotebookDocumentFilter=au={}));var cu;(function(r){function e(t){let n=t;return pt.objectLiteral(n)&&(pt.string(n.notebook)||au.is(n.notebook))&&(n.language===void 0||pt.string(n.language))}r.is=e})(cu||(b.NotebookCellTextDocumentFilter=cu={}));var uu;(function(r){function e(t){if(!Array.isArray(t))return!1;for(let n of t)if(!pt.string(n)&&!ou.is(n)&&!cu.is(n))return!1;return!0}r.is=e})(uu||(b.DocumentSelector=uu={}));var Yp;(function(r){r.method="client/registerCapability",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType(r.method)})(Yp||(b.RegistrationRequest=Yp={}));var Zp;(function(r){r.method="client/unregisterCapability",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType(r.method)})(Zp||(b.UnregistrationRequest=Zp={}));var eg;(function(r){r.Create="create",r.Rename="rename",r.Delete="delete"})(eg||(b.ResourceOperationKind=eg={}));var tg;(function(r){r.Abort="abort",r.Transactional="transactional",r.TextOnlyTransactional="textOnlyTransactional",r.Undo="undo"})(tg||(b.FailureHandlingKind=tg={}));var ng;(function(r){r.UTF8="utf-8",r.UTF16="utf-16",r.UTF32="utf-32"})(ng||(b.PositionEncodingKind=ng={}));var rg;(function(r){function e(t){let n=t;return n&&pt.string(n.id)&&n.id.length>0}r.hasId=e})(rg||(b.StaticRegistrationOptions=rg={}));var ig;(function(r){function e(t){let n=t;return n&&(n.documentSelector===null||uu.is(n.documentSelector))}r.is=e})(ig||(b.TextDocumentRegistrationOptions=ig={}));var sg;(function(r){function e(n){let i=n;return pt.objectLiteral(i)&&(i.workDoneProgress===void 0||pt.boolean(i.workDoneProgress))}r.is=e;function t(n){let i=n;return i&&pt.boolean(i.workDoneProgress)}r.hasWorkDoneProgress=t})(sg||(b.WorkDoneProgressOptions=sg={}));var og;(function(r){r.method="initialize",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(og||(b.InitializeRequest=og={}));var ag;(function(r){r.unknownProtocolVersion=1})(ag||(b.InitializeErrorCodes=ag={}));var cg;(function(r){r.method="initialized",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(cg||(b.InitializedNotification=cg={}));var ug;(function(r){r.method="shutdown",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType0(r.method)})(ug||(b.ShutdownRequest=ug={}));var dg;(function(r){r.method="exit",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType0(r.method)})(dg||(b.ExitNotification=dg={}));var lg;(function(r){r.method="workspace/didChangeConfiguration",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(lg||(b.DidChangeConfigurationNotification=lg={}));var fg;(function(r){r.Error=1,r.Warning=2,r.Info=3,r.Log=4,r.Debug=5})(fg||(b.MessageType=fg={}));var hg;(function(r){r.method="window/showMessage",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(hg||(b.ShowMessageNotification=hg={}));var pg;(function(r){r.method="window/showMessageRequest",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType(r.method)})(pg||(b.ShowMessageRequest=pg={}));var gg;(function(r){r.method="window/logMessage",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(gg||(b.LogMessageNotification=gg={}));var mg;(function(r){r.method="telemetry/event",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(mg||(b.TelemetryEventNotification=mg={}));var vg;(function(r){r.None=0,r.Full=1,r.Incremental=2})(vg||(b.TextDocumentSyncKind=vg={}));var yg;(function(r){r.method="textDocument/didOpen",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(yg||(b.DidOpenTextDocumentNotification=yg={}));var bg;(function(r){function e(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range!==void 0&&(i.rangeLength===void 0||typeof i.rangeLength=="number")}r.isIncremental=e;function t(n){let i=n;return i!=null&&typeof i.text=="string"&&i.range===void 0&&i.rangeLength===void 0}r.isFull=t})(bg||(b.TextDocumentContentChangeEvent=bg={}));var wg;(function(r){r.method="textDocument/didChange",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(wg||(b.DidChangeTextDocumentNotification=wg={}));var Cg;(function(r){r.method="textDocument/didClose",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Cg||(b.DidCloseTextDocumentNotification=Cg={}));var Rg;(function(r){r.method="textDocument/didSave",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Rg||(b.DidSaveTextDocumentNotification=Rg={}));var Sg;(function(r){r.Manual=1,r.AfterDelay=2,r.FocusOut=3})(Sg||(b.TextDocumentSaveReason=Sg={}));var Dg;(function(r){r.method="textDocument/willSave",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Dg||(b.WillSaveTextDocumentNotification=Dg={}));var _g;(function(r){r.method="textDocument/willSaveWaitUntil",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(_g||(b.WillSaveTextDocumentWaitUntilRequest=_g={}));var Tg;(function(r){r.method="workspace/didChangeWatchedFiles",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolNotificationType(r.method)})(Tg||(b.DidChangeWatchedFilesNotification=Tg={}));var Pg;(function(r){r.Created=1,r.Changed=2,r.Deleted=3})(Pg||(b.FileChangeType=Pg={}));var kg;(function(r){function e(t){let n=t;return pt.objectLiteral(n)&&(Jp.URI.is(n.baseUri)||Jp.WorkspaceFolder.is(n.baseUri))&&pt.string(n.pattern)}r.is=e})(kg||(b.RelativePattern=kg={}));var Eg;(function(r){r.Create=1,r.Change=2,r.Delete=4})(Eg||(b.WatchKind=Eg={}));var xg;(function(r){r.method="textDocument/publishDiagnostics",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolNotificationType(r.method)})(xg||(b.PublishDiagnosticsNotification=xg={}));var Ig;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.TriggerForIncompleteCompletions=3})(Ig||(b.CompletionTriggerKind=Ig={}));var qg;(function(r){r.method="textDocument/completion",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(qg||(b.CompletionRequest=qg={}));var Fg;(function(r){r.method="completionItem/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Fg||(b.CompletionResolveRequest=Fg={}));var Og;(function(r){r.method="textDocument/hover",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Og||(b.HoverRequest=Og={}));var Lg;(function(r){r.Invoked=1,r.TriggerCharacter=2,r.ContentChange=3})(Lg||(b.SignatureHelpTriggerKind=Lg={}));var Mg;(function(r){r.method="textDocument/signatureHelp",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Mg||(b.SignatureHelpRequest=Mg={}));var Ng;(function(r){r.method="textDocument/definition",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Ng||(b.DefinitionRequest=Ng={}));var Ag;(function(r){r.method="textDocument/references",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Ag||(b.ReferencesRequest=Ag={}));var $g;(function(r){r.method="textDocument/documentHighlight",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})($g||(b.DocumentHighlightRequest=$g={}));var jg;(function(r){r.method="textDocument/documentSymbol",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(jg||(b.DocumentSymbolRequest=jg={}));var Ug;(function(r){r.method="textDocument/codeAction",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Ug||(b.CodeActionRequest=Ug={}));var Wg;(function(r){r.method="codeAction/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Wg||(b.CodeActionResolveRequest=Wg={}));var Hg;(function(r){r.method="workspace/symbol",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Hg||(b.WorkspaceSymbolRequest=Hg={}));var Kg;(function(r){r.method="workspaceSymbol/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Kg||(b.WorkspaceSymbolResolveRequest=Kg={}));var Vg;(function(r){r.method="textDocument/codeLens",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Vg||(b.CodeLensRequest=Vg={}));var zg;(function(r){r.method="codeLens/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(zg||(b.CodeLensResolveRequest=zg={}));var Bg;(function(r){r.method="workspace/codeLens/refresh",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType0(r.method)})(Bg||(b.CodeLensRefreshRequest=Bg={}));var Gg;(function(r){r.method="textDocument/documentLink",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Gg||(b.DocumentLinkRequest=Gg={}));var Xg;(function(r){r.method="documentLink/resolve",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Xg||(b.DocumentLinkResolveRequest=Xg={}));var Qg;(function(r){r.method="textDocument/formatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Qg||(b.DocumentFormattingRequest=Qg={}));var Jg;(function(r){r.method="textDocument/rangeFormatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Jg||(b.DocumentRangeFormattingRequest=Jg={}));var Yg;(function(r){r.method="textDocument/rangesFormatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Yg||(b.DocumentRangesFormattingRequest=Yg={}));var Zg;(function(r){r.method="textDocument/onTypeFormatting",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(Zg||(b.DocumentOnTypeFormattingRequest=Zg={}));var em;(function(r){r.Identifier=1})(em||(b.PrepareSupportDefaultBehavior=em={}));var tm;(function(r){r.method="textDocument/rename",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(tm||(b.RenameRequest=tm={}));var nm;(function(r){r.method="textDocument/prepareRename",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(nm||(b.PrepareRenameRequest=nm={}));var rm;(function(r){r.method="workspace/executeCommand",r.messageDirection=j.MessageDirection.clientToServer,r.type=new j.ProtocolRequestType(r.method)})(rm||(b.ExecuteCommandRequest=rm={}));var im;(function(r){r.method="workspace/applyEdit",r.messageDirection=j.MessageDirection.serverToClient,r.type=new j.ProtocolRequestType("workspace/applyEdit")})(im||(b.ApplyWorkspaceEditRequest=im={}))});var lm=x(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.createProtocolConnection=void 0;var dm=Nr();function Uw(r,e,t,n){return dm.ConnectionStrategy.is(n)&&(n={connectionStrategy:n}),(0,dm.createMessageConnection)(r,e,t,n)}ho.createProtocolConnection=Uw});var hm=x(Vt=>{"use strict";var Ww=Vt&&Vt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),po=Vt&&Vt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Ww(e,r,t)};Object.defineProperty(Vt,"__esModule",{value:!0});Vt.LSPErrorCodes=Vt.createProtocolConnection=void 0;po(Nr(),Vt);po(Qs(),Vt);po(Ke(),Vt);po(um(),Vt);var Hw=lm();Object.defineProperty(Vt,"createProtocolConnection",{enumerable:!0,get:function(){return Hw.createProtocolConnection}});var fm;(function(r){r.lspReservedErrorRangeStart=-32899,r.RequestFailed=-32803,r.ServerCancelled=-32802,r.ContentModified=-32801,r.RequestCancelled=-32800,r.lspReservedErrorRangeEnd=-32800})(fm||(Vt.LSPErrorCodes=fm={}))});var ie=x(Kn=>{"use strict";var Kw=Kn&&Kn.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),pm=Kn&&Kn.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Kw(e,r,t)};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.createProtocolConnection=void 0;var Vw=Yc();pm(Yc(),Kn);pm(hm(),Kn);function zw(r,e,t,n){return(0,Vw.createMessageConnection)(r,e,t,n)}Kn.createProtocolConnection=zw});var go=x(kt=>{"use strict";Object.defineProperty(kt,"__esModule",{value:!0});kt.forEach=kt.mapAsync=kt.map=kt.clearTestMode=kt.setTestMode=kt.Semaphore=kt.Delayer=void 0;var zi=ie(),gu=class{constructor(e){this.defaultDelay=e,this.timeout=void 0,this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0}trigger(e,t=this.defaultDelay){return this.task=e,t>=0&&this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise(n=>{this.onSuccess=n}).then(()=>{this.completionPromise=void 0,this.onSuccess=void 0;var n=this.task();return this.task=void 0,n})),(t>=0||this.timeout===void 0)&&(this.timeout=(0,zi.RAL)().timer.setTimeout(()=>{this.timeout=void 0,this.onSuccess(void 0)},t>=0?t:this.defaultDelay)),this.completionPromise}forceDelivery(){if(!this.completionPromise)return;this.cancelTimeout();let e=this.task();return this.completionPromise=void 0,this.onSuccess=void 0,this.task=void 0,e}isTriggered(){return this.timeout!==void 0}cancel(){this.cancelTimeout(),this.completionPromise=void 0}cancelTimeout(){this.timeout!==void 0&&(this.timeout.dispose(),this.timeout=void 0)}};kt.Delayer=gu;var mu=class{constructor(e=1){if(e<=0)throw new Error("Capacity must be greater than 0");this._capacity=e,this._active=0,this._waiting=[]}lock(e){return new Promise((t,n)=>{this._waiting.push({thunk:e,resolve:t,reject:n}),this.runNext()})}get active(){return this._active}runNext(){this._waiting.length===0||this._active===this._capacity||(0,zi.RAL)().timer.setImmediate(()=>this.doRunNext())}doRunNext(){if(this._waiting.length===0||this._active===this._capacity)return;let e=this._waiting.shift();if(this._active++,this._active>this._capacity)throw new Error("To many thunks active");try{let t=e.thunk();t instanceof Promise?t.then(n=>{this._active--,e.resolve(n),this.runNext()},n=>{this._active--,e.reject(n),this.runNext()}):(this._active--,e.resolve(t),this.runNext())}catch(t){this._active--,e.reject(t),this.runNext()}}};kt.Semaphore=mu;var vu=!1;function Bw(){vu=!0}kt.setTestMode=Bw;function Gw(){vu=!1}kt.clearTestMode=Gw;var gm=15,Vi=class{constructor(e=gm){this.yieldAfter=vu===!0?Math.max(e,2):Math.max(e,gm),this.startTime=Date.now(),this.counter=0,this.total=0,this.counterInterval=1}start(){this.counter=0,this.total=0,this.counterInterval=1,this.startTime=Date.now()}shouldYield(){if(++this.counter>=this.counterInterval){let e=Date.now()-this.startTime,t=Math.max(0,this.yieldAfter-e);if(this.total+=this.counter,this.counter=0,e>=this.yieldAfter||t<=1)return this.counterInterval=1,this.total=0,!0;switch(e){case 0:case 1:this.counterInterval=this.total*2;break}}return!1}};async function Xw(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new Vi(n?.yieldAfter);function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=e(r[d]),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,zi.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}kt.map=Xw;async function Qw(r,e,t,n){if(r.length===0)return[];let i=new Array(r.length),s=new Vi(n?.yieldAfter);async function o(c){s.start();for(let d=c;d<r.length;d++)if(i[d]=await e(r[d],t),s.shouldYield())return n?.yieldCallback&&n.yieldCallback(),d+1;return-1}let a=await o(0);for(;a!==-1&&!(t!==void 0&&t.isCancellationRequested);)a=await new Promise(c=>{(0,zi.RAL)().timer.setImmediate(()=>{c(o(a))})});return i}kt.mapAsync=Qw;async function Jw(r,e,t,n){if(r.length===0)return;let i=new Vi(n?.yieldAfter);function s(a){i.start();for(let c=a;c<r.length;c++)if(e(r[c]),i.shouldYield())return n?.yieldCallback&&n.yieldCallback(),c+1;return-1}let o=s(0);for(;o!==-1&&!(t!==void 0&&t.isCancellationRequested);)o=await new Promise(a=>{(0,zi.RAL)().timer.setImmediate(()=>{a(s(o))})})}kt.forEach=Jw});var wu=x(bu=>{"use strict";Object.defineProperty(bu,"__esModule",{value:!0});var Yw=require("vscode"),yu=class extends Yw.CompletionItem{constructor(e){super(e)}};bu.default=yu});var Su=x(Ru=>{"use strict";Object.defineProperty(Ru,"__esModule",{value:!0});var Zw=require("vscode"),Cu=class extends Zw.CodeLens{constructor(e){super(e)}};Ru.default=Cu});var Tu=x(_u=>{"use strict";Object.defineProperty(_u,"__esModule",{value:!0});var eC=require("vscode"),Du=class extends eC.DocumentLink{constructor(e,t){super(e,t)}};_u.default=Du});var Eu=x(ku=>{"use strict";Object.defineProperty(ku,"__esModule",{value:!0});var tC=require("vscode"),Pu=class extends tC.CodeAction{constructor(e,t){super(e),this.data=t}};ku.default=Pu});var qu=x(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.ProtocolDiagnostic=vi.DiagnosticCode=void 0;var nC=require("vscode"),xu=hn(),mm;(function(r){function e(t){let n=t;return n!=null&&(xu.number(n.value)||xu.string(n.value))&&xu.string(n.target)}r.is=e})(mm||(vi.DiagnosticCode=mm={}));var Iu=class extends nC.Diagnostic{constructor(e,t,n,i){super(e,t,n),this.data=i,this.hasDiagnosticCode=!1}};vi.ProtocolDiagnostic=Iu});var Lu=x(Ou=>{"use strict";Object.defineProperty(Ou,"__esModule",{value:!0});var rC=require("vscode"),Fu=class extends rC.CallHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Ou.default=Fu});var Au=x(Nu=>{"use strict";Object.defineProperty(Nu,"__esModule",{value:!0});var iC=require("vscode"),Mu=class extends iC.TypeHierarchyItem{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s,o),a!==void 0&&(this.data=a)}};Nu.default=Mu});var Uu=x(ju=>{"use strict";Object.defineProperty(ju,"__esModule",{value:!0});var mo=require("vscode"),$u=class extends mo.SymbolInformation{constructor(e,t,n,i,s){let o=!(i instanceof mo.Uri);super(e,t,n,o?i:new mo.Location(i,new mo.Range(0,0,0,0))),this.hasRange=o,s!==void 0&&(this.data=s)}};ju.default=$u});var Ku=x(Hu=>{"use strict";Object.defineProperty(Hu,"__esModule",{value:!0});var sC=require("vscode"),Wu=class extends sC.InlayHint{constructor(e,t,n){super(e,t,n)}};Hu.default=Wu});var wm=x(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.createConverter=void 0;var dt=require("vscode"),se=ie(),$r=hn(),vm=go(),oC=wu(),aC=Su(),cC=Tu(),ym=Eu(),bm=qu(),uC=Lu(),dC=Au(),lC=Uu(),fC=Ku(),Vu;(function(r){function e(t){let n=t;return n&&!!n.inserting&&!!n.replacing}r.is=e})(Vu||(Vu={}));function hC(r){let t=r||(f=>f.toString());function n(f){return t(f)}function i(f){return{uri:t(f.uri)}}function s(f){return{uri:t(f.uri),languageId:f.languageId,version:f.version,text:f.getText()}}function o(f){return{uri:t(f.uri),version:f.version}}function a(f){return{textDocument:s(f)}}function c(f){let E=f;return!!E.document&&!!E.contentChanges}function d(f){let E=f;return!!E.uri&&!!E.version}function p(f,E,B){if(d(f))return{textDocument:{uri:t(f.uri),version:f.version},contentChanges:[{text:f.getText()}]};if(c(f)){let De=E,_=B;return{textDocument:{uri:t(De),version:_},contentChanges:f.contentChanges.map(C=>{let R=C.range;return{range:{start:{line:R.start.line,character:R.start.character},end:{line:R.end.line,character:R.end.character}},rangeLength:C.rangeLength,text:C.text}})}}else throw Error("Unsupported text document change parameter")}function m(f){return{textDocument:i(f)}}function g(f,E=!1){let B={textDocument:i(f)};return E&&(B.text=f.getText()),B}function S(f){switch(f){case dt.TextDocumentSaveReason.Manual:return se.TextDocumentSaveReason.Manual;case dt.TextDocumentSaveReason.AfterDelay:return se.TextDocumentSaveReason.AfterDelay;case dt.TextDocumentSaveReason.FocusOut:return se.TextDocumentSaveReason.FocusOut}return se.TextDocumentSaveReason.Manual}function y(f){return{textDocument:i(f.document),reason:S(f.reason)}}function P(f){return{files:f.files.map(E=>({uri:t(E)}))}}function k(f){return{files:f.files.map(E=>({oldUri:t(E.oldUri),newUri:t(E.newUri)}))}}function L(f){return{files:f.files.map(E=>({uri:t(E)}))}}function M(f){return{files:f.files.map(E=>({uri:t(E)}))}}function A(f){return{files:f.files.map(E=>({oldUri:t(E.oldUri),newUri:t(E.newUri)}))}}function W(f){return{files:f.files.map(E=>({uri:t(E)}))}}function J(f,E){return{textDocument:i(f),position:yt(E)}}function pe(f){switch(f){case dt.CompletionTriggerKind.TriggerCharacter:return se.CompletionTriggerKind.TriggerCharacter;case dt.CompletionTriggerKind.TriggerForIncompleteCompletions:return se.CompletionTriggerKind.TriggerForIncompleteCompletions;default:return se.CompletionTriggerKind.Invoked}}function G(f,E,B){return{textDocument:i(f),position:yt(E),context:{triggerKind:pe(B.triggerKind),triggerCharacter:B.triggerCharacter}}}function ne(f){switch(f){case dt.SignatureHelpTriggerKind.Invoke:return se.SignatureHelpTriggerKind.Invoked;case dt.SignatureHelpTriggerKind.TriggerCharacter:return se.SignatureHelpTriggerKind.TriggerCharacter;case dt.SignatureHelpTriggerKind.ContentChange:return se.SignatureHelpTriggerKind.ContentChange}}function le(f){return{label:f.label}}function it(f){return f.map(le)}function Ze(f){return{label:f.label,parameters:it(f.parameters)}}function at(f){return f.map(Ze)}function dn(f){return f===void 0?f:{signatures:at(f.signatures),activeSignature:f.activeSignature,activeParameter:f.activeParameter}}function Ft(f,E,B){return{textDocument:i(f),position:yt(E),context:{isRetrigger:B.isRetrigger,triggerCharacter:B.triggerCharacter,triggerKind:ne(B.triggerKind),activeSignatureHelp:dn(B.activeSignatureHelp)}}}function yt(f){return{line:f.line,character:f.character}}function bt(f){return f==null?f:{line:f.line>se.uinteger.MAX_VALUE?se.uinteger.MAX_VALUE:f.line,character:f.character>se.uinteger.MAX_VALUE?se.uinteger.MAX_VALUE:f.character}}function Cn(f,E){return vm.map(f,bt,E)}function Fn(f){return f.map(bt)}function Ae(f){return f==null?f:{start:bt(f.start),end:bt(f.end)}}function $t(f){return f.map(Ae)}function Ot(f){return f==null?f:se.Location.create(n(f.uri),Ae(f.range))}function wt(f){switch(f){case dt.DiagnosticSeverity.Error:return se.DiagnosticSeverity.Error;case dt.DiagnosticSeverity.Warning:return se.DiagnosticSeverity.Warning;case dt.DiagnosticSeverity.Information:return se.DiagnosticSeverity.Information;case dt.DiagnosticSeverity.Hint:return se.DiagnosticSeverity.Hint}}function ur(f){if(!f)return;let E=[];for(let B of f){let De=On(B);De!==void 0&&E.push(De)}return E.length>0?E:void 0}function On(f){switch(f){case dt.DiagnosticTag.Unnecessary:return se.DiagnosticTag.Unnecessary;case dt.DiagnosticTag.Deprecated:return se.DiagnosticTag.Deprecated;default:return}}function Ln(f){return{message:f.message,location:Ot(f.location)}}function Qn(f){return f.map(Ln)}function dr(f){if(f!=null)return $r.number(f)||$r.string(f)?f:{value:f.value,target:n(f.target)}}function Mn(f){let E=se.Diagnostic.create(Ae(f.range),f.message),B=f instanceof bm.ProtocolDiagnostic?f:void 0;B!==void 0&&B.data!==void 0&&(E.data=B.data);let De=dr(f.code);return bm.DiagnosticCode.is(De)?B!==void 0&&B.hasDiagnosticCode?E.code=De:(E.code=De.value,E.codeDescription={href:De.target}):E.code=De,$r.number(f.severity)&&(E.severity=wt(f.severity)),Array.isArray(f.tags)&&(E.tags=ur(f.tags)),f.relatedInformation&&(E.relatedInformation=Qn(f.relatedInformation)),f.source&&(E.source=f.source),E}function Rn(f,E){return f==null?f:vm.map(f,Mn,E)}function Sn(f){return f==null?f:f.map(Mn)}function Nn(f,E){switch(f){case"$string":return E;case se.MarkupKind.PlainText:return{kind:f,value:E};case se.MarkupKind.Markdown:return{kind:f,value:E.value};default:return`Unsupported Markup content received. Kind is: ${f}`}}function ct(f){switch(f){case dt.CompletionItemTag.Deprecated:return se.CompletionItemTag.Deprecated}}function Jn(f){if(f===void 0)return f;let E=[];for(let B of f){let De=ct(B);De!==void 0&&E.push(De)}return E}function Dn(f,E){return E!==void 0?E:f+1}function ln(f,E=!1){let B,De;$r.string(f.label)?B=f.label:(B=f.label.label,E&&(f.label.detail!==void 0||f.label.description!==void 0)&&(De={detail:f.label.detail,description:f.label.description}));let _={label:B};De!==void 0&&(_.labelDetails=De);let h=f instanceof oC.default?f:void 0;f.detail&&(_.detail=f.detail),f.documentation&&(!h||h.documentationFormat==="$string"?_.documentation=f.documentation:_.documentation=Nn(h.documentationFormat,f.documentation)),f.filterText&&(_.filterText=f.filterText),lr(_,f),$r.number(f.kind)&&(_.kind=Dn(f.kind,h&&h.originalItemKind)),f.sortText&&(_.sortText=f.sortText),f.additionalTextEdits&&(_.additionalTextEdits=st(f.additionalTextEdits)),f.commitCharacters&&(_.commitCharacters=f.commitCharacters.slice()),f.command&&(_.command=K(f.command)),(f.preselect===!0||f.preselect===!1)&&(_.preselect=f.preselect);let C=Jn(f.tags);if(h){if(h.data!==void 0&&(_.data=h.data),h.deprecated===!0||h.deprecated===!1){if(h.deprecated===!0&&C!==void 0&&C.length>0){let R=C.indexOf(dt.CompletionItemTag.Deprecated);R!==-1&&C.splice(R,1)}_.deprecated=h.deprecated}h.insertTextMode!==void 0&&(_.insertTextMode=h.insertTextMode)}return C!==void 0&&C.length>0&&(_.tags=C),_.insertTextMode===void 0&&f.keepWhitespace===!0&&(_.insertTextMode=se.InsertTextMode.adjustIndentation),_}function lr(f,E){let B=se.InsertTextFormat.PlainText,De,_;E.textEdit?(De=E.textEdit.newText,_=E.textEdit.range):E.insertText instanceof dt.SnippetString?(B=se.InsertTextFormat.Snippet,De=E.insertText.value):De=E.insertText,E.range&&(_=E.range),f.insertTextFormat=B,E.fromEdit&&De!==void 0&&_!==void 0?f.textEdit=fn(De,_):f.insertText=De}function fn(f,E){return Vu.is(E)?se.InsertReplaceEdit.create(f,Ae(E.inserting),Ae(E.replacing)):{newText:f,range:Ae(E)}}function An(f){return{range:Ae(f.range),newText:f.newText}}function st(f){return f==null?f:f.map(An)}function Dt(f){return f<=dt.SymbolKind.TypeParameter?f+1:se.SymbolKind.Property}function Ct(f){return f}function Zt(f){return f.map(Ct)}function jt(f,E,B){return{textDocument:i(f),position:yt(E),context:{includeDeclaration:B.includeDeclaration}}}async function $n(f,E){let B=se.CodeAction.create(f.title);if(f instanceof ym.default&&f.data!==void 0&&(B.data=f.data),f.kind!==void 0&&(B.kind=w(f.kind)),f.diagnostics!==void 0&&(B.diagnostics=await Rn(f.diagnostics,E)),f.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return f.command!==void 0&&(B.command=K(f.command)),f.isPreferred!==void 0&&(B.isPreferred=f.isPreferred),f.disabled!==void 0&&(B.disabled={reason:f.disabled.reason}),B}function Yn(f){let E=se.CodeAction.create(f.title);if(f instanceof ym.default&&f.data!==void 0&&(E.data=f.data),f.kind!==void 0&&(E.kind=w(f.kind)),f.diagnostics!==void 0&&(E.diagnostics=Sn(f.diagnostics)),f.edit!==void 0)throw new Error("VS Code code actions can only be converted to a protocol code action without an edit.");return f.command!==void 0&&(E.command=K(f.command)),f.isPreferred!==void 0&&(E.isPreferred=f.isPreferred),f.disabled!==void 0&&(E.disabled={reason:f.disabled.reason}),E}async function _n(f,E){if(f==null)return f;let B;return f.only&&$r.string(f.only.value)&&(B=[f.only.value]),se.CodeActionContext.create(await Rn(f.diagnostics,E),B,Lt(f.triggerKind))}function Zn(f){if(f==null)return f;let E;return f.only&&$r.string(f.only.value)&&(E=[f.only.value]),se.CodeActionContext.create(Sn(f.diagnostics),E,Lt(f.triggerKind))}function Lt(f){switch(f){case dt.CodeActionTriggerKind.Invoke:return se.CodeActionTriggerKind.Invoked;case dt.CodeActionTriggerKind.Automatic:return se.CodeActionTriggerKind.Automatic;default:return}}function w(f){if(f!=null)return f.value}function q(f){return f==null?f:se.InlineValueContext.create(f.frameId,Ae(f.stoppedLocation))}function U(f,E,B){return{context:se.InlineCompletionContext.create(B.triggerKind,B.selectedCompletionInfo),textDocument:i(f),position:bt(E)}}function K(f){let E=se.Command.create(f.title,f.command);return f.arguments&&(E.arguments=f.arguments),E}function Ce(f){let E=se.CodeLens.create(Ae(f.range));return f.command&&(E.command=K(f.command)),f instanceof aC.default&&f.data&&(E.data=f.data),E}function be(f,E){let B={tabSize:f.tabSize,insertSpaces:f.insertSpaces};return E.trimTrailingWhitespace&&(B.trimTrailingWhitespace=!0),E.trimFinalNewlines&&(B.trimFinalNewlines=!0),E.insertFinalNewline&&(B.insertFinalNewline=!0),B}function Pe(f){return{textDocument:i(f)}}function qe(f){return{textDocument:i(f)}}function ue(f){let E=se.DocumentLink.create(Ae(f.range));f.target&&(E.target=n(f.target)),f.tooltip!==void 0&&(E.tooltip=f.tooltip);let B=f instanceof cC.default?f:void 0;return B&&B.data&&(E.data=B.data),E}function Se(f){return{textDocument:i(f)}}function ge(f){let E={name:f.name,kind:Dt(f.kind),uri:n(f.uri),range:Ae(f.range),selectionRange:Ae(f.selectionRange)};return f.detail!==void 0&&f.detail.length>0&&(E.detail=f.detail),f.tags!==void 0&&(E.tags=Zt(f.tags)),f instanceof uC.default&&f.data!==void 0&&(E.data=f.data),E}function Fe(f){let E={name:f.name,kind:Dt(f.kind),uri:n(f.uri),range:Ae(f.range),selectionRange:Ae(f.selectionRange)};return f.detail!==void 0&&f.detail.length>0&&(E.detail=f.detail),f.tags!==void 0&&(E.tags=Zt(f.tags)),f instanceof dC.default&&f.data!==void 0&&(E.data=f.data),E}function et(f){let E=f instanceof lC.default?{name:f.name,kind:Dt(f.kind),location:f.hasRange?Ot(f.location):{uri:t(f.location.uri)},data:f.data}:{name:f.name,kind:Dt(f.kind),location:Ot(f.location)};return f.tags!==void 0&&(E.tags=Zt(f.tags)),f.containerName!==""&&(E.containerName=f.containerName),E}function ft(f){let E=typeof f.label=="string"?f.label:f.label.map(fr),B=se.InlayHint.create(bt(f.position),E);return f.kind!==void 0&&(B.kind=f.kind),f.textEdits!==void 0&&(B.textEdits=st(f.textEdits)),f.tooltip!==void 0&&(B.tooltip=hr(f.tooltip)),f.paddingLeft!==void 0&&(B.paddingLeft=f.paddingLeft),f.paddingRight!==void 0&&(B.paddingRight=f.paddingRight),f instanceof fC.default&&f.data!==void 0&&(B.data=f.data),B}function fr(f){let E=se.InlayHintLabelPart.create(f.value);return f.location!==void 0&&(E.location=Ot(f.location)),f.command!==void 0&&(E.command=K(f.command)),f.tooltip!==void 0&&(E.tooltip=hr(f.tooltip)),E}function hr(f){return typeof f=="string"?f:{kind:se.MarkupKind.Markdown,value:f.value}}return{asUri:n,asTextDocumentIdentifier:i,asTextDocumentItem:s,asVersionedTextDocumentIdentifier:o,asOpenTextDocumentParams:a,asChangeTextDocumentParams:p,asCloseTextDocumentParams:m,asSaveTextDocumentParams:g,asWillSaveTextDocumentParams:y,asDidCreateFilesParams:P,asDidRenameFilesParams:k,asDidDeleteFilesParams:L,asWillCreateFilesParams:M,asWillRenameFilesParams:A,asWillDeleteFilesParams:W,asTextDocumentPositionParams:J,asCompletionParams:G,asSignatureHelpParams:Ft,asWorkerPosition:yt,asRange:Ae,asRanges:$t,asPosition:bt,asPositions:Cn,asPositionsSync:Fn,asLocation:Ot,asDiagnosticSeverity:wt,asDiagnosticTag:On,asDiagnostic:Mn,asDiagnostics:Rn,asDiagnosticsSync:Sn,asCompletionItem:ln,asTextEdit:An,asSymbolKind:Dt,asSymbolTag:Ct,asSymbolTags:Zt,asReferenceParams:jt,asCodeAction:$n,asCodeActionSync:Yn,asCodeActionContext:_n,asCodeActionContextSync:Zn,asInlineValueContext:q,asCommand:K,asCodeLens:Ce,asFormattingOptions:be,asDocumentSymbolParams:Pe,asCodeLensParams:qe,asDocumentLink:ue,asDocumentLinkParams:Se,asCallHierarchyItem:ge,asTypeHierarchyItem:Fe,asInlayHint:ft,asWorkspaceSymbol:et,asInlineCompletionParams:U}}vo.createConverter=hC});var Sm=x(bo=>{"use strict";Object.defineProperty(bo,"__esModule",{value:!0});bo.createConverter=void 0;var H=require("vscode"),ee=ie(),mn=hn(),Re=go(),pC=wu(),gC=Su(),mC=Tu(),vC=Eu(),Cm=qu(),yC=Lu(),bC=Au(),wC=Uu(),CC=Ku(),Rm=ie(),yo;(function(r){function e(t){let n=t;return n&&mn.string(n.language)&&mn.string(n.value)}r.is=e})(yo||(yo={}));function RC(r,e,t){let i=r||(u=>H.Uri.parse(u));function s(u){return i(u)}function o(u){let D=[];for(let O of u)if(typeof O=="string")D.push(O);else if(Rm.NotebookCellTextDocumentFilter.is(O))if(typeof O.notebook=="string")D.push({notebookType:O.notebook,language:O.language});else{let Q=O.notebook.notebookType??"*";D.push({notebookType:Q,scheme:O.notebook.scheme,pattern:O.notebook.pattern,language:O.language})}else Rm.TextDocumentFilter.is(O)&&D.push({language:O.language,scheme:O.scheme,pattern:O.pattern});return D}async function a(u,D){return Re.map(u,d,D)}function c(u){let D=new Array(u.length);for(let O=0;O<u.length;O++)D[O]=d(u[O]);return D}function d(u){let D=new Cm.ProtocolDiagnostic(y(u.range),u.message,k(u.severity),u.data);if(u.code!==void 0){if(typeof u.code=="string"||typeof u.code=="number")ee.CodeDescription.is(u.codeDescription)?D.code={value:u.code,target:s(u.codeDescription.href)}:D.code=u.code;else if(Cm.DiagnosticCode.is(u.code)){D.hasDiagnosticCode=!0;let O=u.code;D.code={value:O.value,target:s(O.target)}}}return u.source&&(D.source=u.source),u.relatedInformation&&(D.relatedInformation=p(u.relatedInformation)),Array.isArray(u.tags)&&(D.tags=m(u.tags)),D}function p(u){let D=new Array(u.length);for(let O=0;O<u.length;O++){let Q=u[O];D[O]=new H.DiagnosticRelatedInformation(wt(Q.location),Q.message)}return D}function m(u){if(!u)return;let D=[];for(let O of u){let Q=g(O);Q!==void 0&&D.push(Q)}return D.length>0?D:void 0}function g(u){switch(u){case ee.DiagnosticTag.Unnecessary:return H.DiagnosticTag.Unnecessary;case ee.DiagnosticTag.Deprecated:return H.DiagnosticTag.Deprecated;default:return}}function S(u){return u?new H.Position(u.line,u.character):void 0}function y(u){return u?new H.Range(u.start.line,u.start.character,u.end.line,u.end.character):void 0}async function P(u,D){return Re.map(u,O=>new H.Range(O.start.line,O.start.character,O.end.line,O.end.character),D)}function k(u){if(u==null)return H.DiagnosticSeverity.Error;switch(u){case ee.DiagnosticSeverity.Error:return H.DiagnosticSeverity.Error;case ee.DiagnosticSeverity.Warning:return H.DiagnosticSeverity.Warning;case ee.DiagnosticSeverity.Information:return H.DiagnosticSeverity.Information;case ee.DiagnosticSeverity.Hint:return H.DiagnosticSeverity.Hint}return H.DiagnosticSeverity.Error}function L(u){if(mn.string(u))return A(u);if(yo.is(u))return A().appendCodeblock(u.value,u.language);if(Array.isArray(u)){let D=[];for(let O of u){let Q=A();yo.is(O)?Q.appendCodeblock(O.value,O.language):Q.appendMarkdown(O),D.push(Q)}return D}else return A(u)}function M(u){if(mn.string(u))return u;switch(u.kind){case ee.MarkupKind.Markdown:return A(u.value);case ee.MarkupKind.PlainText:return u.value;default:return`Unsupported Markup content received. Kind is: ${u.kind}`}}function A(u){let D;if(u===void 0||typeof u=="string")D=new H.MarkdownString(u);else switch(u.kind){case ee.MarkupKind.Markdown:D=new H.MarkdownString(u.value);break;case ee.MarkupKind.PlainText:D=new H.MarkdownString,D.appendText(u.value);break;default:D=new H.MarkdownString,D.appendText(`Unsupported Markup content received. Kind is: ${u.kind}`);break}return D.isTrusted=e,D.supportHtml=t,D}function W(u){if(u)return new H.Hover(L(u.contents),y(u.range))}async function J(u,D,O){if(!u)return;if(Array.isArray(u))return Re.map(u,Un=>it(Un,D),O);let Q=u,{defaultRange:ht,commitCharacters:Rt}=pe(Q,D),xe=await Re.map(Q.items,Un=>it(Un,Rt,ht,Q.itemDefaults?.insertTextMode,Q.itemDefaults?.insertTextFormat,Q.itemDefaults?.data),O);return new H.CompletionList(xe,Q.isIncomplete)}function pe(u,D){let O=u.itemDefaults?.editRange,Q=u.itemDefaults?.commitCharacters??D;return ee.Range.is(O)?{defaultRange:y(O),commitCharacters:Q}:O!==void 0?{defaultRange:{inserting:y(O.insert),replacing:y(O.replace)},commitCharacters:Q}:{defaultRange:void 0,commitCharacters:Q}}function G(u){return ee.CompletionItemKind.Text<=u&&u<=ee.CompletionItemKind.TypeParameter?[u-1,void 0]:[H.CompletionItemKind.Text,u]}function ne(u){switch(u){case ee.CompletionItemTag.Deprecated:return H.CompletionItemTag.Deprecated}}function le(u){if(u==null)return[];let D=[];for(let O of u){let Q=ne(O);Q!==void 0&&D.push(Q)}return D}function it(u,D,O,Q,ht,Rt){let xe=le(u.tags),Un=Ze(u),Me=new pC.default(Un);u.detail&&(Me.detail=u.detail),u.documentation&&(Me.documentation=M(u.documentation),Me.documentationFormat=mn.string(u.documentation)?"$string":u.documentation.kind),u.filterText&&(Me.filterText=u.filterText);let Ts=at(u,O,ht);if(Ts&&(Me.insertText=Ts.text,Me.range=Ts.range,Me.fromEdit=Ts.fromEdit),mn.number(u.kind)){let[xb,Of]=G(u.kind);Me.kind=xb,Of&&(Me.originalItemKind=Of)}u.sortText&&(Me.sortText=u.sortText),u.additionalTextEdits&&(Me.additionalTextEdits=bt(u.additionalTextEdits));let qf=u.commitCharacters!==void 0?mn.stringArray(u.commitCharacters)?u.commitCharacters:void 0:D;qf&&(Me.commitCharacters=qf.slice()),u.command&&(Me.command=st(u.command)),(u.deprecated===!0||u.deprecated===!1)&&(Me.deprecated=u.deprecated,u.deprecated===!0&&xe.push(H.CompletionItemTag.Deprecated)),(u.preselect===!0||u.preselect===!1)&&(Me.preselect=u.preselect);let Ff=u.data??Rt;Ff!==void 0&&(Me.data=Ff),xe.length>0&&(Me.tags=xe);let Ua=u.insertTextMode??Q;return Ua!==void 0&&(Me.insertTextMode=Ua,Ua===ee.InsertTextMode.asIs&&(Me.keepWhitespace=!0)),Me}function Ze(u){return ee.CompletionItemLabelDetails.is(u.labelDetails)?{label:u.label,detail:u.labelDetails.detail,description:u.labelDetails.description}:u.label}function at(u,D,O){let Q=u.insertTextFormat??O;if(u.textEdit!==void 0||D!==void 0){let[ht,Rt]=u.textEdit!==void 0?dn(u.textEdit):[D,u.textEditText??u.label];return Q===ee.InsertTextFormat.Snippet?{text:new H.SnippetString(Rt),range:ht,fromEdit:!0}:{text:Rt,range:ht,fromEdit:!0}}else return u.insertText?Q===ee.InsertTextFormat.Snippet?{text:new H.SnippetString(u.insertText),fromEdit:!1}:{text:u.insertText,fromEdit:!1}:void 0}function dn(u){return ee.InsertReplaceEdit.is(u)?[{inserting:y(u.insert),replacing:y(u.replace)},u.newText]:[y(u.range),u.newText]}function Ft(u){if(u)return new H.TextEdit(y(u.range),u.newText)}async function yt(u,D){if(u)return Re.map(u,Ft,D)}function bt(u){if(!u)return;let D=new Array(u.length);for(let O=0;O<u.length;O++)D[O]=Ft(u[O]);return D}async function Cn(u,D){if(!u)return;let O=new H.SignatureHelp;return mn.number(u.activeSignature)?O.activeSignature=u.activeSignature:O.activeSignature=0,mn.number(u.activeParameter)?O.activeParameter=u.activeParameter:O.activeParameter=0,u.signatures&&(O.signatures=await Fn(u.signatures,D)),O}async function Fn(u,D){return Re.mapAsync(u,Ae,D)}async function Ae(u,D){let O=new H.SignatureInformation(u.label);return u.documentation!==void 0&&(O.documentation=M(u.documentation)),u.parameters!==void 0&&(O.parameters=await $t(u.parameters,D)),u.activeParameter!==void 0&&(O.activeParameter=u.activeParameter),O}function $t(u,D){return Re.map(u,Ot,D)}function Ot(u){let D=new H.ParameterInformation(u.label);return u.documentation&&(D.documentation=M(u.documentation)),D}function wt(u){return u?new H.Location(i(u.uri),y(u.range)):void 0}async function ur(u,D){if(u)return Qn(u,D)}async function On(u,D){if(u)return Qn(u,D)}function Ln(u){if(!u)return;let D={targetUri:i(u.targetUri),targetRange:y(u.targetRange),originSelectionRange:y(u.originSelectionRange),targetSelectionRange:y(u.targetSelectionRange)};if(!D.targetSelectionRange)throw new Error("targetSelectionRange must not be undefined or null");return D}async function Qn(u,D){if(u)if(mn.array(u)){if(u.length===0)return[];if(ee.LocationLink.is(u[0])){let O=u;return Re.map(O,Ln,D)}else{let O=u;return Re.map(O,wt,D)}}else return ee.LocationLink.is(u)?[Ln(u)]:wt(u)}async function dr(u,D){if(u)return Re.map(u,wt,D)}async function Mn(u,D){if(u)return Re.map(u,Rn,D)}function Rn(u){let D=new H.DocumentHighlight(y(u.range));return mn.number(u.kind)&&(D.kind=Sn(u.kind)),D}function Sn(u){switch(u){case ee.DocumentHighlightKind.Text:return H.DocumentHighlightKind.Text;case ee.DocumentHighlightKind.Read:return H.DocumentHighlightKind.Read;case ee.DocumentHighlightKind.Write:return H.DocumentHighlightKind.Write}return H.DocumentHighlightKind.Text}async function Nn(u,D){if(u)return Re.map(u,ln,D)}function ct(u){return u<=ee.SymbolKind.TypeParameter?u-1:H.SymbolKind.Property}function Jn(u){switch(u){case ee.SymbolTag.Deprecated:return H.SymbolTag.Deprecated;default:return}}function Dn(u){if(u==null)return;let D=[];for(let O of u){let Q=Jn(O);Q!==void 0&&D.push(Q)}return D.length===0?void 0:D}function ln(u){let D=u.data,O=u.location,Q=O.range===void 0||D!==void 0?new wC.default(u.name,ct(u.kind),u.containerName??"",O.range===void 0?i(O.uri):new H.Location(i(u.location.uri),y(O.range)),D):new H.SymbolInformation(u.name,ct(u.kind),u.containerName??"",new H.Location(i(u.location.uri),y(O.range)));return An(Q,u),Q}async function lr(u,D){if(u!=null)return Re.map(u,fn,D)}function fn(u){let D=new H.DocumentSymbol(u.name,u.detail||"",ct(u.kind),y(u.range),y(u.selectionRange));if(An(D,u),u.children!==void 0&&u.children.length>0){let O=[];for(let Q of u.children)O.push(fn(Q));D.children=O}return D}function An(u,D){u.tags=Dn(D.tags),D.deprecated&&(u.tags?u.tags.includes(H.SymbolTag.Deprecated)||(u.tags=u.tags.concat(H.SymbolTag.Deprecated)):u.tags=[H.SymbolTag.Deprecated])}function st(u){let D={title:u.title,command:u.command};return u.arguments&&(D.arguments=u.arguments),D}async function Dt(u,D){if(u)return Re.map(u,st,D)}let Ct=new Map;Ct.set(ee.CodeActionKind.Empty,H.CodeActionKind.Empty),Ct.set(ee.CodeActionKind.QuickFix,H.CodeActionKind.QuickFix),Ct.set(ee.CodeActionKind.Refactor,H.CodeActionKind.Refactor),Ct.set(ee.CodeActionKind.RefactorExtract,H.CodeActionKind.RefactorExtract),Ct.set(ee.CodeActionKind.RefactorInline,H.CodeActionKind.RefactorInline),Ct.set(ee.CodeActionKind.RefactorRewrite,H.CodeActionKind.RefactorRewrite),Ct.set(ee.CodeActionKind.Source,H.CodeActionKind.Source),Ct.set(ee.CodeActionKind.SourceOrganizeImports,H.CodeActionKind.SourceOrganizeImports);function Zt(u){if(u==null)return;let D=Ct.get(u);if(D)return D;let O=u.split(".");D=H.CodeActionKind.Empty;for(let Q of O)D=D.append(Q);return D}function jt(u){if(u!=null)return u.map(D=>Zt(D))}async function $n(u,D){if(u==null)return;let O=new vC.default(u.title,u.data);return u.kind!==void 0&&(O.kind=Zt(u.kind)),u.diagnostics!==void 0&&(O.diagnostics=c(u.diagnostics)),u.edit!==void 0&&(O.edit=await Lt(u.edit,D)),u.command!==void 0&&(O.command=st(u.command)),u.isPreferred!==void 0&&(O.isPreferred=u.isPreferred),u.disabled!==void 0&&(O.disabled={reason:u.disabled.reason}),O}function Yn(u,D){return Re.mapAsync(u,async O=>ee.Command.is(O)?st(O):$n(O,D),D)}function _n(u){if(!u)return;let D=new gC.default(y(u.range));return u.command&&(D.command=st(u.command)),u.data!==void 0&&u.data!==null&&(D.data=u.data),D}async function Zn(u,D){if(u)return Re.map(u,_n,D)}async function Lt(u,D){if(!u)return;let O=new Map;if(u.changeAnnotations!==void 0){let Rt=u.changeAnnotations;await Re.forEach(Object.keys(Rt),xe=>{let Un=w(Rt[xe]);O.set(xe,Un)},D)}let Q=Rt=>{if(Rt!==void 0)return O.get(Rt)},ht=new H.WorkspaceEdit;if(u.documentChanges){let Rt=u.documentChanges;await Re.forEach(Rt,xe=>{if(ee.CreateFile.is(xe))ht.createFile(i(xe.uri),xe.options,Q(xe.annotationId));else if(ee.RenameFile.is(xe))ht.renameFile(i(xe.oldUri),i(xe.newUri),xe.options,Q(xe.annotationId));else if(ee.DeleteFile.is(xe))ht.deleteFile(i(xe.uri),xe.options,Q(xe.annotationId));else if(ee.TextDocumentEdit.is(xe)){let Un=i(xe.textDocument.uri);for(let Me of xe.edits)ee.AnnotatedTextEdit.is(Me)?ht.replace(Un,y(Me.range),Me.newText,Q(Me.annotationId)):ht.replace(Un,y(Me.range),Me.newText)}else throw new Error(`Unknown workspace edit change received:
${JSON.stringify(xe,void 0,4)}`)},D)}else if(u.changes){let Rt=u.changes;await Re.forEach(Object.keys(Rt),xe=>{ht.set(i(xe),bt(Rt[xe]))},D)}return ht}function w(u){if(u!==void 0)return{label:u.label,needsConfirmation:!!u.needsConfirmation,description:u.description}}function q(u){let D=y(u.range),O=u.target?s(u.target):void 0,Q=new mC.default(D,O);return u.tooltip!==void 0&&(Q.tooltip=u.tooltip),u.data!==void 0&&u.data!==null&&(Q.data=u.data),Q}async function U(u,D){if(u)return Re.map(u,q,D)}function K(u){return new H.Color(u.red,u.green,u.blue,u.alpha)}function Ce(u){return new H.ColorInformation(y(u.range),K(u.color))}async function be(u,D){if(u)return Re.map(u,Ce,D)}function Pe(u){let D=new H.ColorPresentation(u.label);return D.additionalTextEdits=bt(u.additionalTextEdits),u.textEdit&&(D.textEdit=Ft(u.textEdit)),D}async function qe(u,D){if(u)return Re.map(u,Pe,D)}function ue(u){if(u)switch(u){case ee.FoldingRangeKind.Comment:return H.FoldingRangeKind.Comment;case ee.FoldingRangeKind.Imports:return H.FoldingRangeKind.Imports;case ee.FoldingRangeKind.Region:return H.FoldingRangeKind.Region}}function Se(u){return new H.FoldingRange(u.startLine,u.endLine,ue(u.kind))}async function ge(u,D){if(u)return Re.map(u,Se,D)}function Fe(u){return new H.SelectionRange(y(u.range),u.parent?Fe(u.parent):void 0)}async function et(u,D){return Array.isArray(u)?Re.map(u,Fe,D):[]}function ft(u){return ee.InlineValueText.is(u)?new H.InlineValueText(y(u.range),u.text):ee.InlineValueVariableLookup.is(u)?new H.InlineValueVariableLookup(y(u.range),u.variableName,u.caseSensitiveLookup):new H.InlineValueEvaluatableExpression(y(u.range),u.expression)}async function fr(u,D){return Array.isArray(u)?Re.map(u,ft,D):[]}async function hr(u,D){let O=typeof u.label=="string"?u.label:await Re.map(u.label,f,D),Q=new CC.default(S(u.position),O);return u.kind!==void 0&&(Q.kind=u.kind),u.textEdits!==void 0&&(Q.textEdits=await yt(u.textEdits,D)),u.tooltip!==void 0&&(Q.tooltip=E(u.tooltip)),u.paddingLeft!==void 0&&(Q.paddingLeft=u.paddingLeft),u.paddingRight!==void 0&&(Q.paddingRight=u.paddingRight),u.data!==void 0&&(Q.data=u.data),Q}function f(u){let D=new H.InlayHintLabelPart(u.value);return u.location!==void 0&&(D.location=wt(u.location)),u.tooltip!==void 0&&(D.tooltip=E(u.tooltip)),u.command!==void 0&&(D.command=st(u.command)),D}function E(u){return typeof u=="string"?u:A(u)}async function B(u,D){if(Array.isArray(u))return Re.mapAsync(u,hr,D)}function De(u){if(u===null)return;let D=new yC.default(ct(u.kind),u.name,u.detail||"",s(u.uri),y(u.range),y(u.selectionRange),u.data);return u.tags!==void 0&&(D.tags=Dn(u.tags)),D}async function _(u,D){if(u!==null)return Re.map(u,De,D)}async function h(u,D){return new H.CallHierarchyIncomingCall(De(u.from),await P(u.fromRanges,D))}async function C(u,D){if(u!==null)return Re.mapAsync(u,h,D)}async function R(u,D){return new H.CallHierarchyOutgoingCall(De(u.to),await P(u.fromRanges,D))}async function v(u,D){if(u!==null)return Re.mapAsync(u,R,D)}async function l(u,D){if(u!=null)return new H.SemanticTokens(new Uint32Array(u.data),u.resultId)}function T(u){return new H.SemanticTokensEdit(u.start,u.deleteCount,u.data!==void 0?new Uint32Array(u.data):void 0)}async function F(u,D){if(u!=null)return new H.SemanticTokensEdits(u.edits.map(T),u.resultId)}function re(u){return u}async function He(u,D){if(u!=null)return new H.LinkedEditingRanges(await P(u.ranges,D),Oe(u.wordPattern))}function Oe(u){if(u!=null)return new RegExp(u)}function Ut(u){if(u===null)return;let D=new bC.default(ct(u.kind),u.name,u.detail||"",s(u.uri),y(u.range),y(u.selectionRange),u.data);return u.tags!==void 0&&(D.tags=Dn(u.tags)),D}async function en(u,D){if(u!==null)return Re.map(u,Ut,D)}function Tn(u){if(mn.string(u))return u;if(ee.RelativePattern.is(u)){if(ee.URI.is(u.baseUri))return new H.RelativePattern(s(u.baseUri),u.pattern);if(ee.WorkspaceFolder.is(u.baseUri)){let D=H.workspace.getWorkspaceFolder(s(u.baseUri.uri));return D!==void 0?new H.RelativePattern(D,u.pattern):void 0}}}async function he(u,D){if(!u)return;if(Array.isArray(u))return Re.map(u,ht=>jn(ht),D);let O=u,Q=await Re.map(O.items,ht=>jn(ht),D);return new H.InlineCompletionList(Q)}function jn(u){let D;typeof u.insertText=="string"?D=u.insertText:D=new H.SnippetString(u.insertText.value);let O;u.command&&(O=st(u.command));let Q=new H.InlineCompletionItem(D,y(u.range),O);return u.filterText&&(Q.filterText=u.filterText),Q}return{asUri:s,asDocumentSelector:o,asDiagnostics:a,asDiagnostic:d,asRange:y,asRanges:P,asPosition:S,asDiagnosticSeverity:k,asDiagnosticTag:g,asHover:W,asCompletionResult:J,asCompletionItem:it,asTextEdit:Ft,asTextEdits:yt,asSignatureHelp:Cn,asSignatureInformations:Fn,asSignatureInformation:Ae,asParameterInformations:$t,asParameterInformation:Ot,asDeclarationResult:ur,asDefinitionResult:On,asLocation:wt,asReferences:dr,asDocumentHighlights:Mn,asDocumentHighlight:Rn,asDocumentHighlightKind:Sn,asSymbolKind:ct,asSymbolTag:Jn,asSymbolTags:Dn,asSymbolInformations:Nn,asSymbolInformation:ln,asDocumentSymbols:lr,asDocumentSymbol:fn,asCommand:st,asCommands:Dt,asCodeAction:$n,asCodeActionKind:Zt,asCodeActionKinds:jt,asCodeActionResult:Yn,asCodeLens:_n,asCodeLenses:Zn,asWorkspaceEdit:Lt,asDocumentLink:q,asDocumentLinks:U,asFoldingRangeKind:ue,asFoldingRange:Se,asFoldingRanges:ge,asColor:K,asColorInformation:Ce,asColorInformations:be,asColorPresentation:Pe,asColorPresentations:qe,asSelectionRange:Fe,asSelectionRanges:et,asInlineValue:ft,asInlineValues:fr,asInlayHint:hr,asInlayHints:B,asSemanticTokensLegend:re,asSemanticTokens:l,asSemanticTokensEdit:T,asSemanticTokensEdits:F,asCallHierarchyItem:De,asCallHierarchyItems:_,asCallHierarchyIncomingCall:h,asCallHierarchyIncomingCalls:C,asCallHierarchyOutgoingCall:R,asCallHierarchyOutgoingCalls:v,asLinkedEditingRanges:He,asTypeHierarchyItem:Ut,asTypeHierarchyItems:en,asGlobPattern:Tn,asInlineCompletionResult:he,asInlineCompletionItem:jn}}bo.createConverter=RC});var Ve=x(vn=>{"use strict";Object.defineProperty(vn,"__esModule",{value:!0});vn.generateUuid=vn.parse=vn.isUUID=vn.v4=vn.empty=void 0;var Bi=class{constructor(e){this._value=e}asHex(){return this._value}equals(e){return this.asHex()===e.asHex()}},Gi=class r extends Bi{static _oneOf(e){return e[Math.floor(e.length*Math.random())]}static _randomHex(){return r._oneOf(r._chars)}constructor(){super([r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),"-","4",r._randomHex(),r._randomHex(),r._randomHex(),"-",r._oneOf(r._timeHighBits),r._randomHex(),r._randomHex(),r._randomHex(),"-",r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex(),r._randomHex()].join(""))}};Gi._chars=["0","1","2","3","4","5","6","6","7","8","9","a","b","c","d","e","f"];Gi._timeHighBits=["8","9","a","b"];vn.empty=new Bi("00000000-0000-0000-0000-000000000000");function Dm(){return new Gi}vn.v4=Dm;var SC=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function _m(r){return SC.test(r)}vn.isUUID=_m;function DC(r){if(!_m(r))throw new Error("invalid uuid");return new Bi(r)}vn.parse=DC;function _C(){return Dm().asHex()}vn.generateUuid=_C});var Bu=x(wo=>{"use strict";Object.defineProperty(wo,"__esModule",{value:!0});wo.ProgressPart=void 0;var Tm=require("vscode"),Pm=ie(),km=hn(),zu=class{constructor(e,t,n){this._client=e,this._token=t,this._reported=0,this._infinite=!1,this._lspProgressDisposable=this._client.onProgress(Pm.WorkDoneProgress.type,this._token,i=>{switch(i.kind){case"begin":this.begin(i);break;case"report":this.report(i);break;case"end":this.done(),n&&n(this);break}})}begin(e){this._infinite=e.percentage===void 0,this._lspProgressDisposable!==void 0&&Tm.window.withProgress({location:Tm.ProgressLocation.Window,cancellable:e.cancellable,title:e.title},async(t,n)=>{if(this._lspProgressDisposable!==void 0)return this._progress=t,this._cancellationToken=n,this._tokenDisposable=this._cancellationToken.onCancellationRequested(()=>{this._client.sendNotification(Pm.WorkDoneProgressCancelNotification.type,{token:this._token})}),this.report(e),new Promise((i,s)=>{this._resolve=i,this._reject=s})})}report(e){if(this._infinite&&km.string(e.message))this._progress!==void 0&&this._progress.report({message:e.message});else if(km.number(e.percentage)){let t=Math.max(0,Math.min(e.percentage,100)),n=Math.max(0,t-this._reported);this._reported+=n,this._progress!==void 0&&this._progress.report({message:e.message,increment:n})}}cancel(){this.cleanup(),this._reject!==void 0&&(this._reject(),this._resolve=void 0,this._reject=void 0)}done(){this.cleanup(),this._resolve!==void 0&&(this._resolve(),this._resolve=void 0,this._reject=void 0)}cleanup(){this._lspProgressDisposable!==void 0&&(this._lspProgressDisposable.dispose(),this._lspProgressDisposable=void 0),this._tokenDisposable!==void 0&&(this._tokenDisposable.dispose(),this._tokenDisposable=void 0),this._progress=void 0,this._cancellationToken=void 0}};wo.ProgressPart=zu});var we=x(gt=>{"use strict";Object.defineProperty(gt,"__esModule",{value:!0});gt.WorkspaceFeature=gt.TextDocumentLanguageFeature=gt.TextDocumentEventFeature=gt.DynamicDocumentFeature=gt.DynamicFeature=gt.StaticFeature=gt.ensure=gt.LSPCancellationError=void 0;var jr=require("vscode"),Gu=ie(),Mt=hn(),Em=Ve(),Xu=class extends jr.CancellationError{constructor(e){super(),this.data=e}};gt.LSPCancellationError=Xu;function TC(r,e){return r[e]===void 0&&(r[e]={}),r[e]}gt.ensure=TC;var xm;(function(r){function e(t){let n=t;return n!=null&&Mt.func(n.fillClientCapabilities)&&Mt.func(n.initialize)&&Mt.func(n.getState)&&Mt.func(n.clear)&&(n.fillInitializeParams===void 0||Mt.func(n.fillInitializeParams))}r.is=e})(xm||(gt.StaticFeature=xm={}));var Im;(function(r){function e(t){let n=t;return n!=null&&Mt.func(n.fillClientCapabilities)&&Mt.func(n.initialize)&&Mt.func(n.getState)&&Mt.func(n.clear)&&(n.fillInitializeParams===void 0||Mt.func(n.fillInitializeParams))&&Mt.func(n.register)&&Mt.func(n.unregister)&&n.registrationType!==void 0}r.is=e})(Im||(gt.DynamicFeature=Im={}));var Xi=class{constructor(e){this._client=e}getState(){let e=this.getDocumentSelectors(),t=0;for(let i of e){t++;for(let s of jr.workspace.textDocuments)if(jr.languages.match(i,s)>0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}let n=t>0;return{kind:"document",id:this.registrationType.method,registrations:n,matches:!1}}};gt.DynamicDocumentFeature=Xi;var Qu=class extends Xi{static textDocumentFilter(e,t){for(let n of e)if(jr.languages.match(n,t)>0)return!0;return!1}constructor(e,t,n,i,s,o,a){super(e),this._event=t,this._type=n,this._middleware=i,this._createParams=s,this._textDocument=o,this._selectorFilter=a,this._selectors=new Map,this._onNotificationSent=new jr.EventEmitter}getStateInfo(){return[this._selectors.values(),!1]}getDocumentSelectors(){return this._selectors.values()}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=this._event(t=>{this.callback(t).catch(n=>{this._client.error(`Sending document notification ${this._type.method} failed.`,n)})})),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}async callback(e){let t=async n=>{let i=this._createParams(n);await this._client.sendNotification(this._type,i),this.notificationSent(this.getTextDocument(n),this._type,i)};if(this.matches(e)){let n=this._middleware();return n?n(e,i=>t(i)):t(e)}}matches(e){return this._client.hasDedicatedTextSynchronizationFeature(this._textDocument(e))?!1:!this._selectorFilter||this._selectorFilter(this._selectors.values(),e)}get onNotificationSent(){return this._onNotificationSent.event}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._onNotificationSent.dispose(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getProvider(e){for(let t of this._selectors.values())if(jr.languages.match(t,e)>0)return{send:n=>this.callback(n)}}};gt.TextDocumentEventFeature=Qu;var Ju=class extends Xi{constructor(e,t){super(e),this._registrationType=t,this._registrations=new Map}*getDocumentSelectors(){for(let e of this._registrations.values()){let t=e.data.registerOptions.documentSelector;t!==null&&(yield this._client.protocol2CodeConverter.asDocumentSelector(t))}}get registrationType(){return this._registrationType}register(e){if(!e.registerOptions.documentSelector)return;let t=this.registerLanguageProvider(e.registerOptions,e.id);this._registrations.set(e.id,{disposable:t[0],data:e,provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getRegistration(e,t){if(t){if(Gu.TextDocumentRegistrationOptions.is(t)){let n=Gu.StaticRegistrationOptions.hasId(t)?t.id:Em.generateUuid(),i=t.documentSelector??e;if(i)return[n,Object.assign({},t,{documentSelector:i})]}else if(Mt.boolean(t)&&t===!0||Gu.WorkDoneProgressOptions.is(t)){if(!e)return[void 0,void 0];let n=Mt.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e});return[Em.generateUuid(),n]}}else return[void 0,void 0];return[void 0,void 0]}getRegistrationOptions(e,t){if(!(!e||!t))return Mt.boolean(t)&&t===!0?{documentSelector:e}:Object.assign({},t,{documentSelector:e})}getProvider(e){for(let t of this._registrations.values()){let n=t.data.registerOptions.documentSelector;if(n!==null&&jr.languages.match(this._client.protocol2CodeConverter.asDocumentSelector(n),e)>0)return t.provider}}getAllProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};gt.TextDocumentLanguageFeature=Ju;var Yu=class{constructor(e,t){this._client=e,this._registrationType=t,this._registrations=new Map}getState(){let e=this._registrations.size>0;return{kind:"workspace",id:this._registrationType.method,registrations:e}}get registrationType(){return this._registrationType}register(e){let t=this.registerLanguageProvider(e.registerOptions);this._registrations.set(e.id,{disposable:t[0],provider:t[1]})}unregister(e){let t=this._registrations.get(e);t!==void 0&&t.disposable.dispose()}clear(){this._registrations.forEach(e=>{e.disposable.dispose()}),this._registrations.clear()}getProviders(){let e=[];for(let t of this._registrations.values())e.push(t.provider);return e}};gt.WorkspaceFeature=Yu});var Fm=x((aT,qm)=>{var PC=typeof process=="object"&&process&&process.platform==="win32";qm.exports=PC?{sep:"\\"}:{sep:"/"}});var Am=x((cT,Nm)=>{"use strict";Nm.exports=Lm;function Lm(r,e,t){r instanceof RegExp&&(r=Om(r,t)),e instanceof RegExp&&(e=Om(e,t));var n=Mm(r,e,t);return n&&{start:n[0],end:n[1],pre:t.slice(0,n[0]),body:t.slice(n[0]+r.length,n[1]),post:t.slice(n[1]+e.length)}}function Om(r,e){var t=e.match(r);return t?t[0]:null}Lm.range=Mm;function Mm(r,e,t){var n,i,s,o,a,c=t.indexOf(r),d=t.indexOf(e,c+1),p=c;if(c>=0&&d>0){if(r===e)return[c,d];for(n=[],s=t.length;p>=0&&!a;)p==c?(n.push(p),c=t.indexOf(r,p+1)):n.length==1?a=[n.pop(),d]:(i=n.pop(),i<s&&(s=i,o=d),d=t.indexOf(e,p+1)),p=c<d&&c>=0?c:d;n.length&&(a=[s,o])}return a}});var zm=x((uT,Vm)=>{var $m=Am();Vm.exports=xC;var jm="\0SLASH"+Math.random()+"\0",Um="\0OPEN"+Math.random()+"\0",ed="\0CLOSE"+Math.random()+"\0",Wm="\0COMMA"+Math.random()+"\0",Hm="\0PERIOD"+Math.random()+"\0";function Zu(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function kC(r){return r.split("\\\\").join(jm).split("\\{").join(Um).split("\\}").join(ed).split("\\,").join(Wm).split("\\.").join(Hm)}function EC(r){return r.split(jm).join("\\").split(Um).join("{").split(ed).join("}").split(Wm).join(",").split(Hm).join(".")}function Km(r){if(!r)return[""];var e=[],t=$m("{","}",r);if(!t)return r.split(",");var n=t.pre,i=t.body,s=t.post,o=n.split(",");o[o.length-1]+="{"+i+"}";var a=Km(s);return s.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),e.push.apply(e,o),e}function xC(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),Qi(kC(r),!0).map(EC)):[]}function IC(r){return"{"+r+"}"}function qC(r){return/^-?0\d/.test(r)}function FC(r,e){return r<=e}function OC(r,e){return r>=e}function Qi(r,e){var t=[],n=$m("{","}",r);if(!n)return[r];var i=n.pre,s=n.post.length?Qi(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<s.length;o++){var a=i+"{"+n.body+"}"+s[o];t.push(a)}else{var c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),d=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),p=c||d,m=n.body.indexOf(",")>=0;if(!p&&!m)return n.post.match(/,.*\}/)?(r=n.pre+"{"+n.body+ed+n.post,Qi(r)):[r];var g;if(p)g=n.body.split(/\.\./);else if(g=Km(n.body),g.length===1&&(g=Qi(g[0],!1).map(IC),g.length===1))return s.map(function(it){return n.pre+g[0]+it});var S;if(p){var y=Zu(g[0]),P=Zu(g[1]),k=Math.max(g[0].length,g[1].length),L=g.length==3?Math.abs(Zu(g[2])):1,M=FC,A=P<y;A&&(L*=-1,M=OC);var W=g.some(qC);S=[];for(var J=y;M(J,P);J+=L){var pe;if(d)pe=String.fromCharCode(J),pe==="\\"&&(pe="");else if(pe=String(J),W){var G=k-pe.length;if(G>0){var ne=new Array(G+1).join("0");J<0?pe="-"+ne+pe.slice(1):pe=ne+pe}}S.push(pe)}}else{S=[];for(var le=0;le<g.length;le++)S.push.apply(S,Qi(g[le],!1))}for(var le=0;le<S.length;le++)for(var o=0;o<s.length;o++){var a=i+S[le]+s[o];(!e||p||a)&&t.push(a)}}return t}});var Ro=x((lT,sd)=>{var rn=sd.exports=(r,e,t={})=>(Co(e),!t.nocomment&&e.charAt(0)==="#"?!1:new yi(e,t).match(r));sd.exports=rn;var rd=Fm();rn.sep=rd.sep;var En=Symbol("globstar **");rn.GLOBSTAR=En;var LC=zm(),Bm={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},id="[^/]",td=id+"*?",MC="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",NC="(?:(?!(?:\\/|^)\\.).)*?",Qm=r=>r.split("").reduce((e,t)=>(e[t]=!0,e),{}),Gm=Qm("().*{}+?[]^$\\!"),AC=Qm("[.("),Xm=/\/+/;rn.filter=(r,e={})=>(t,n,i)=>rn(t,r,e);var Sr=(r,e={})=>{let t={};return Object.keys(r).forEach(n=>t[n]=r[n]),Object.keys(e).forEach(n=>t[n]=e[n]),t};rn.defaults=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return rn;let e=rn,t=(n,i,s)=>e(n,i,Sr(r,s));return t.Minimatch=class extends e.Minimatch{constructor(i,s){super(i,Sr(r,s))}},t.Minimatch.defaults=n=>e.defaults(Sr(r,n)).Minimatch,t.filter=(n,i)=>e.filter(n,Sr(r,i)),t.defaults=n=>e.defaults(Sr(r,n)),t.makeRe=(n,i)=>e.makeRe(n,Sr(r,i)),t.braceExpand=(n,i)=>e.braceExpand(n,Sr(r,i)),t.match=(n,i,s)=>e.match(n,i,Sr(r,s)),t};rn.braceExpand=(r,e)=>Jm(r,e);var Jm=(r,e={})=>(Co(r),e.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:LC(r)),$C=1024*64,Co=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>$C)throw new TypeError("pattern is too long")},nd=Symbol("subparse");rn.makeRe=(r,e)=>new yi(r,e||{}).makeRe();rn.match=(r,e,t={})=>{let n=new yi(e,t);return r=r.filter(i=>n.match(i)),n.options.nonull&&!r.length&&r.push(e),r};var jC=r=>r.replace(/\\(.)/g,"$1"),UC=r=>r.replace(/\\([^-\]])/g,"$1"),WC=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),HC=r=>r.replace(/[[\]\\]/g,"\\$&"),yi=class{constructor(e,t){Co(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.windowsPathsNoEscape=!!t.windowsPathsNoEscape||t.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){let e=this.pattern,t=this.options;if(!t.nocomment&&e.charAt(0)==="#"){this.comment=!0;return}if(!e){this.empty=!0;return}this.parseNegate();let n=this.globSet=this.braceExpand();t.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,n),n=this.globParts=n.map(i=>i.split(Xm)),this.debug(this.pattern,n),n=n.map((i,s,o)=>i.map(this.parse,this)),this.debug(this.pattern,n),n=n.filter(i=>i.indexOf(!1)===-1),this.debug(this.pattern,n),this.set=n}parseNegate(){if(this.options.nonegate)return;let e=this.pattern,t=!1,n=0;for(let i=0;i<e.length&&e.charAt(i)==="!";i++)t=!t,n++;n&&(this.pattern=e.slice(n)),this.negate=t}matchOne(e,t,n){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,o=0,a=e.length,c=t.length;s<a&&o<c;s++,o++){this.debug("matchOne loop");var d=t[o],p=e[s];if(this.debug(t,d,p),d===!1)return!1;if(d===En){this.debug("GLOBSTAR",[t,d,p]);var m=s,g=o+1;if(g===c){for(this.debug("** at the end");s<a;s++)if(e[s]==="."||e[s]===".."||!i.dot&&e[s].charAt(0)===".")return!1;return!0}for(;m<a;){var S=e[m];if(this.debug(`
globstar while`,e,m,t,g,S),this.matchOne(e.slice(m),t.slice(g),n))return this.debug("globstar found match!",m,a,S),!0;if(S==="."||S===".."||!i.dot&&S.charAt(0)==="."){this.debug("dot detected!",e,m,t,g);break}this.debug("globstar swallow a segment, and continue"),m++}return!!(n&&(this.debug(`
>>> no match, partial?`,e,m,t,g),m===a))}var y;if(typeof d=="string"?(y=p===d,this.debug("string match",d,p,y)):(y=p.match(d),this.debug("pattern match",d,p,y)),!y)return!1}if(s===a&&o===c)return!0;if(s===a)return n;if(o===c)return s===a-1&&e[s]==="";throw new Error("wtf?")}braceExpand(){return Jm(this.pattern,this.options)}parse(e,t){Co(e);let n=this.options;if(e==="**")if(n.noglobstar)e="*";else return En;if(e==="")return"";let i="",s=!1,o=!1,a=[],c=[],d,p=!1,m=-1,g=-1,S,y,P,k=e.charAt(0)===".",L=n.dot||k,M=()=>k?"":L?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",A=G=>G.charAt(0)==="."?"":n.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",W=()=>{if(d){switch(d){case"*":i+=td,s=!0;break;case"?":i+=id,s=!0;break;default:i+="\\"+d;break}this.debug("clearStateChar %j %j",d,i),d=!1}};for(let G=0,ne;G<e.length&&(ne=e.charAt(G));G++){if(this.debug("%s	%s %s %j",e,G,i,ne),o){if(ne==="/")return!1;Gm[ne]&&(i+="\\"),i+=ne,o=!1;continue}switch(ne){case"/":return!1;case"\\":if(p&&e.charAt(G+1)==="-"){i+=ne;continue}W(),o=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",e,G,i,ne),p){this.debug("  in class"),ne==="!"&&G===g+1&&(ne="^"),i+=ne;continue}this.debug("call clearStateChar %j",d),W(),d=ne,n.noext&&W();continue;case"(":{if(p){i+="(";continue}if(!d){i+="\\(";continue}let le={type:d,start:G-1,reStart:i.length,open:Bm[d].open,close:Bm[d].close};this.debug(this.pattern,"	",le),a.push(le),i+=le.open,le.start===0&&le.type!=="!"&&(k=!0,i+=A(e.slice(G+1))),this.debug("plType %j %j",d,i),d=!1;continue}case")":{let le=a[a.length-1];if(p||!le){i+="\\)";continue}a.pop(),W(),s=!0,y=le,i+=y.close,y.type==="!"&&c.push(Object.assign(y,{reEnd:i.length}));continue}case"|":{let le=a[a.length-1];if(p||!le){i+="\\|";continue}W(),i+="|",le.start===0&&le.type!=="!"&&(k=!0,i+=A(e.slice(G+1)));continue}case"[":if(W(),p){i+="\\"+ne;continue}p=!0,g=G,m=i.length,i+=ne;continue;case"]":if(G===g+1||!p){i+="\\"+ne;continue}S=e.substring(g+1,G);try{RegExp("["+HC(UC(S))+"]"),i+=ne}catch{i=i.substring(0,m)+"(?:$.)"}s=!0,p=!1;continue;default:W(),Gm[ne]&&!(ne==="^"&&p)&&(i+="\\"),i+=ne;break}}for(p&&(S=e.slice(g+1),P=this.parse(S,nd),i=i.substring(0,m)+"\\["+P[0],s=s||P[1]),y=a.pop();y;y=a.pop()){let G;G=i.slice(y.reStart+y.open.length),this.debug("setting tail",i,y),G=G.replace(/((?:\\{2}){0,64})(\\?)\|/g,(le,it,Ze)=>(Ze||(Ze="\\"),it+it+Ze+"|")),this.debug(`tail=%j
   %s`,G,G,y,i);let ne=y.type==="*"?td:y.type==="?"?id:"\\"+y.type;s=!0,i=i.slice(0,y.reStart)+ne+"\\("+G}W(),o&&(i+="\\\\");let J=AC[i.charAt(0)];for(let G=c.length-1;G>-1;G--){let ne=c[G],le=i.slice(0,ne.reStart),it=i.slice(ne.reStart,ne.reEnd-8),Ze=i.slice(ne.reEnd),at=i.slice(ne.reEnd-8,ne.reEnd)+Ze,dn=le.split(")").length,Ft=le.split("(").length-dn,yt=Ze;for(let Cn=0;Cn<Ft;Cn++)yt=yt.replace(/\)[+*?]?/,"");Ze=yt;let bt=Ze===""&&t!==nd?"(?:$|\\/)":"";i=le+it+Ze+bt+at}if(i!==""&&s&&(i="(?=.)"+i),J&&(i=M()+i),t===nd)return[i,s];if(n.nocase&&!s&&(s=e.toUpperCase()!==e.toLowerCase()),!s)return jC(e);let pe=n.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",pe),{_glob:e,_src:i})}catch{return new RegExp("$.")}}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let e=this.set;if(!e.length)return this.regexp=!1,this.regexp;let t=this.options,n=t.noglobstar?td:t.dot?MC:NC,i=t.nocase?"i":"",s=e.map(o=>(o=o.map(a=>typeof a=="string"?WC(a):a===En?En:a._src).reduce((a,c)=>(a[a.length-1]===En&&c===En||a.push(c),a),[]),o.forEach((a,c)=>{a!==En||o[c-1]===En||(c===0?o.length>1?o[c+1]="(?:\\/|"+n+"\\/)?"+o[c+1]:o[c]=n:c===o.length-1?o[c-1]+="(?:\\/|"+n+")?":(o[c-1]+="(?:\\/|\\/"+n+"\\/)"+o[c+1],o[c+1]=En))}),o.filter(a=>a!==En).join("/"))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,i)}catch{this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return e==="";if(e==="/"&&t)return!0;let n=this.options;rd.sep!=="/"&&(e=e.split(rd.sep).join("/")),e=e.split(Xm),this.debug(this.pattern,"split",e);let i=this.set;this.debug(this.pattern,"set",i);let s;for(let o=e.length-1;o>=0&&(s=e[o],!s);o--);for(let o=0;o<i.length;o++){let a=i[o],c=e;if(n.matchBase&&a.length===1&&(c=[s]),this.matchOne(c,a,t))return n.flipNegate?!0:!this.negate}return n.flipNegate?!1:this.negate}static defaults(e){return rn.defaults(e).Minimatch}};rn.Minimatch=yi});var hd=x(Dr=>{"use strict";Object.defineProperty(Dr,"__esModule",{value:!0});Dr.DiagnosticFeature=Dr.DiagnosticPullMode=Dr.vsdiag=void 0;var KC=Ro(),me=require("vscode"),rt=ie(),VC=Ve(),od=we();function So(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var yn;(function(r){let e;(function(t){t.full="full",t.unChanged="unChanged"})(e=r.DocumentDiagnosticReportKind||(r.DocumentDiagnosticReportKind={}))})(yn||(Dr.vsdiag=yn={}));var Do;(function(r){r.onType="onType",r.onSave="onSave"})(Do||(Dr.DiagnosticPullMode=Do={}));var Et;(function(r){r.active="open",r.reschedule="reschedule",r.outDated="drop"})(Et||(Et={}));var ad=class r{constructor(){this.open=new Set,this._onOpen=new me.EventEmitter,this._onClose=new me.EventEmitter,r.fillTabResources(this.open);let e=t=>{if(t.closed.length===0&&t.opened.length===0)return;let n=this.open,i=new Set;r.fillTabResources(i);let s=new Set,o=new Set(i);for(let a of n.values())i.has(a)?o.delete(a):s.add(a);if(this.open=i,s.size>0){let a=new Set;for(let c of s)a.add(me.Uri.parse(c));this._onClose.fire(a)}if(o.size>0){let a=new Set;for(let c of o)a.add(me.Uri.parse(c));this._onOpen.fire(a)}};me.window.tabGroups.onDidChangeTabs!==void 0?this.disposable=me.window.tabGroups.onDidChangeTabs(e):this.disposable={dispose:()=>{}}}get onClose(){return this._onClose.event}get onOpen(){return this._onOpen.event}dispose(){this.disposable.dispose()}isActive(e){return e instanceof me.Uri?me.window.activeTextEditor?.document.uri===e:me.window.activeTextEditor?.document===e}isVisible(e){let t=e instanceof me.Uri?e:e.uri;return this.open.has(t.toString())}getTabResources(){let e=new Set;return r.fillTabResources(new Set,e),e}static fillTabResources(e,t){let n=e??new Set;for(let i of me.window.tabGroups.all)for(let s of i.tabs){let o=s.input,a;o instanceof me.TabInputText?a=o.uri:o instanceof me.TabInputTextDiff?a=o.modified:o instanceof me.TabInputCustom&&(a=o.uri),a!==void 0&&!n.has(a.toString())&&(n.add(a.toString()),t!==void 0&&t.add(a))}}},lt;(function(r){r[r.document=1]="document",r[r.workspace=2]="workspace"})(lt||(lt={}));var nr;(function(r){function e(t){return t instanceof me.Uri?t.toString():t.uri.toString()}r.asKey=e})(nr||(nr={}));var cd=class{constructor(){this.documentPullStates=new Map,this.workspacePullStates=new Map}track(e,t,n){let i=e===lt.document?this.documentPullStates:this.workspacePullStates,[s,o,a]=t instanceof me.Uri?[t.toString(),t,n]:[t.uri.toString(),t.uri,t.version],c=i.get(s);return c===void 0&&(c={document:o,pulledVersion:a,resultId:void 0},i.set(s,c)),c}update(e,t,n,i){let s=e===lt.document?this.documentPullStates:this.workspacePullStates,[o,a,c,d]=t instanceof me.Uri?[t.toString(),t,n,i]:[t.uri.toString(),t.uri,t.version,n],p=s.get(o);p===void 0?(p={document:a,pulledVersion:c,resultId:d},s.set(o,p)):(p.pulledVersion=c,p.resultId=d)}unTrack(e,t){let n=nr.asKey(t);(e===lt.document?this.documentPullStates:this.workspacePullStates).delete(n)}tracks(e,t){let n=nr.asKey(t);return(e===lt.document?this.documentPullStates:this.workspacePullStates).has(n)}getResultId(e,t){let n=nr.asKey(t);return(e===lt.document?this.documentPullStates:this.workspacePullStates).get(n)?.resultId}getAllResultIds(){let e=[];for(let[t,n]of this.workspacePullStates)this.documentPullStates.has(t)&&(n=this.documentPullStates.get(t)),n.resultId!==void 0&&e.push({uri:t,value:n.resultId});return e}},ud=class{constructor(e,t,n){this.client=e,this.tabs=t,this.options=n,this.isDisposed=!1,this.onDidChangeDiagnosticsEmitter=new me.EventEmitter,this.provider=this.createProvider(),this.diagnostics=me.languages.createDiagnosticCollection(n.identifier),this.openRequests=new Map,this.documentStates=new cd,this.workspaceErrorCounter=0}knows(e,t){let n=t instanceof me.Uri?t:t.uri;return this.documentStates.tracks(e,t)||this.openRequests.has(n.toString())}forget(e,t){this.documentStates.unTrack(e,t)}pull(e,t){if(this.isDisposed)return;let n=e instanceof me.Uri?e:e.uri;this.pullAsync(e).then(()=>{t&&t()},i=>{this.client.error(`Document pull failed for text document ${n.toString()}`,i,!1)})}async pullAsync(e,t){if(this.isDisposed)return;let n=e instanceof me.Uri,i=n?e:e.uri,s=i.toString();t=n?t:e.version;let o=this.openRequests.get(s),a=n?this.documentStates.track(lt.document,e,t):this.documentStates.track(lt.document,e);if(o===void 0){let c=new me.CancellationTokenSource;this.openRequests.set(s,{state:Et.active,document:e,version:t,tokenSource:c});let d,p;try{d=await this.provider.provideDiagnostics(e,a.resultId,c.token)??{kind:yn.DocumentDiagnosticReportKind.full,items:[]}}catch(m){if(m instanceof od.LSPCancellationError&&rt.DiagnosticServerCancellationData.is(m.data)&&m.data.retriggerRequest===!1&&(p={state:Et.outDated,document:e}),p===void 0&&m instanceof me.CancellationError)p={state:Et.reschedule,document:e};else throw m}if(p=p??this.openRequests.get(s),p===void 0){this.client.error(`Lost request state in diagnostic pull model. Clearing diagnostics for ${s}`),this.diagnostics.delete(i);return}if(this.openRequests.delete(s),!this.tabs.isVisible(e)){this.documentStates.unTrack(lt.document,e);return}if(p.state===Et.outDated)return;d!==void 0&&(d.kind===yn.DocumentDiagnosticReportKind.full&&this.diagnostics.set(i,d.items),a.pulledVersion=t,a.resultId=d.resultId),p.state===Et.reschedule&&this.pull(e)}else o.state===Et.active?(o.tokenSource.cancel(),this.openRequests.set(s,{state:Et.reschedule,document:o.document})):o.state===Et.outDated&&this.openRequests.set(s,{state:Et.reschedule,document:o.document})}forgetDocument(e){let t=e instanceof me.Uri?e:e.uri,n=t.toString(),i=this.openRequests.get(n);this.options.workspaceDiagnostics?i!==void 0?this.openRequests.set(n,{state:Et.reschedule,document:e}):this.pull(e,()=>{this.forget(lt.document,e)}):(i!==void 0&&(i.state===Et.active&&i.tokenSource.cancel(),this.openRequests.set(n,{state:Et.outDated,document:e})),this.diagnostics.delete(t),this.forget(lt.document,e))}pullWorkspace(){this.isDisposed||this.pullWorkspaceAsync().then(()=>{this.workspaceTimeout=(0,rt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3)},e=>{!(e instanceof od.LSPCancellationError)&&!rt.DiagnosticServerCancellationData.is(e.data)&&(this.client.error("Workspace diagnostic pull failed.",e,!1),this.workspaceErrorCounter++),this.workspaceErrorCounter<=5&&(this.workspaceTimeout=(0,rt.RAL)().timer.setTimeout(()=>{this.pullWorkspace()},2e3))})}async pullWorkspaceAsync(){if(!this.provider.provideWorkspaceDiagnostics||this.isDisposed)return;this.workspaceCancellation!==void 0&&(this.workspaceCancellation.cancel(),this.workspaceCancellation=void 0),this.workspaceCancellation=new me.CancellationTokenSource;let e=this.documentStates.getAllResultIds().map(t=>({uri:this.client.protocol2CodeConverter.asUri(t.uri),value:t.value}));await this.provider.provideWorkspaceDiagnostics(e,this.workspaceCancellation.token,t=>{if(!(!t||this.isDisposed))for(let n of t.items)n.kind===yn.DocumentDiagnosticReportKind.full&&(this.documentStates.tracks(lt.document,n.uri)||this.diagnostics.set(n.uri,n.items)),this.documentStates.update(lt.workspace,n.uri,n.version??void 0,n.resultId)})}createProvider(){let e={onDidChangeDiagnostics:this.onDidChangeDiagnosticsEmitter.event,provideDiagnostics:(t,n,i)=>{let s=(a,c,d)=>{let p={identifier:this.options.identifier,textDocument:{uri:this.client.code2ProtocolConverter.asUri(a instanceof me.Uri?a:a.uri)},previousResultId:c};return this.isDisposed===!0||!this.client.isRunning()?{kind:yn.DocumentDiagnosticReportKind.full,items:[]}:this.client.sendRequest(rt.DocumentDiagnosticRequest.type,p,d).then(async m=>m==null||this.isDisposed||d.isCancellationRequested?{kind:yn.DocumentDiagnosticReportKind.full,items:[]}:m.kind===rt.DocumentDiagnosticReportKind.Full?{kind:yn.DocumentDiagnosticReportKind.full,resultId:m.resultId,items:await this.client.protocol2CodeConverter.asDiagnostics(m.items,d)}:{kind:yn.DocumentDiagnosticReportKind.unChanged,resultId:m.resultId},m=>this.client.handleFailedRequest(rt.DocumentDiagnosticRequest.type,d,m,{kind:yn.DocumentDiagnosticReportKind.full,items:[]}))},o=this.client.middleware;return o.provideDiagnostics?o.provideDiagnostics(t,n,i,s):s(t,n,i)}};return this.options.workspaceDiagnostics&&(e.provideWorkspaceDiagnostics=(t,n,i)=>{let s=async d=>d.kind===rt.DocumentDiagnosticReportKind.Full?{kind:yn.DocumentDiagnosticReportKind.full,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version,items:await this.client.protocol2CodeConverter.asDiagnostics(d.items,n)}:{kind:yn.DocumentDiagnosticReportKind.unChanged,uri:this.client.protocol2CodeConverter.asUri(d.uri),resultId:d.resultId,version:d.version},o=d=>{let p=[];for(let m of d)p.push({uri:this.client.code2ProtocolConverter.asUri(m.uri),value:m.value});return p},a=(d,p)=>{let m=(0,VC.generateUuid)(),g=this.client.onProgress(rt.WorkspaceDiagnosticRequest.partialResult,m,async y=>{if(y==null){i(null);return}let P={items:[]};for(let k of y.items)try{P.items.push(await s(k))}catch(L){this.client.error("Converting workspace diagnostics failed.",L)}i(P)}),S={identifier:this.options.identifier,previousResultIds:o(d),partialResultToken:m};return this.isDisposed===!0||!this.client.isRunning()?{items:[]}:this.client.sendRequest(rt.WorkspaceDiagnosticRequest.type,S,p).then(async y=>{if(p.isCancellationRequested)return{items:[]};let P={items:[]};for(let k of y.items)P.items.push(await s(k));return g.dispose(),i(P),{items:[]}},y=>(g.dispose(),this.client.handleFailedRequest(rt.DocumentDiagnosticRequest.type,p,y,{items:[]})))},c=this.client.middleware;return c.provideWorkspaceDiagnostics?c.provideWorkspaceDiagnostics(t,n,i,a):a(t,n,i)}),e}dispose(){this.isDisposed=!0,this.workspaceCancellation?.cancel(),this.workspaceTimeout?.dispose();for(let[e,t]of this.openRequests)t.state===Et.active&&t.tokenSource.cancel(),this.openRequests.set(e,{state:Et.outDated,document:t.document});this.diagnostics.dispose()}},dd=class{constructor(e){this.diagnosticRequestor=e,this.documents=new rt.LinkedMap,this.isDisposed=!1}add(e){if(this.isDisposed===!0)return;let t=nr.asKey(e);this.documents.has(t)||(this.documents.set(t,e,rt.Touch.Last),this.trigger())}remove(e){let t=nr.asKey(e);this.documents.delete(t),this.documents.size===0?this.stop():t===this.endDocumentKey()&&(this.endDocument=this.documents.last)}trigger(){if(this.isDisposed!==!0){if(this.intervalHandle!==void 0){this.endDocument=this.documents.last;return}this.endDocument=this.documents.last,this.intervalHandle=(0,rt.RAL)().timer.setInterval(()=>{let e=this.documents.first;if(e!==void 0){let t=nr.asKey(e);this.diagnosticRequestor.pull(e),this.documents.set(t,e,rt.Touch.Last),t===this.endDocumentKey()&&this.stop()}},200)}}dispose(){this.isDisposed=!0,this.stop(),this.documents.clear()}stop(){this.intervalHandle?.dispose(),this.intervalHandle=void 0,this.endDocument=void 0}endDocumentKey(){return this.endDocument!==void 0?nr.asKey(this.endDocument):void 0}},ld=class{constructor(e,t,n){let i=e.clientOptions.diagnosticPullOptions??{onChange:!0,onSave:!1},s=e.protocol2CodeConverter.asDocumentSelector(n.documentSelector),o=[],a=y=>{let P=n.documentSelector;if(i.match!==void 0)return i.match(P,y);for(let k of P)if(rt.TextDocumentFilter.is(k)){if(typeof k=="string"||k.language!==void 0&&k.language!=="*"||k.scheme!==void 0&&k.scheme!=="*"&&k.scheme!==y.scheme)return!1;if(k.pattern!==void 0){let L=new KC.Minimatch(k.pattern,{noext:!0});if(!L.makeRe()||!L.match(y.fsPath))return!1}}return!0},c=y=>y instanceof me.Uri?a(y):me.languages.match(s,y)>0&&t.isVisible(y),d=y=>y instanceof me.Uri?this.activeTextDocument?.uri.toString()===y.toString():this.activeTextDocument===y;this.diagnosticRequestor=new ud(e,t,n),this.backgroundScheduler=new dd(this.diagnosticRequestor);let p=y=>{!c(y)||!n.interFileDependencies||d(y)||this.backgroundScheduler.add(y)};this.activeTextDocument=me.window.activeTextEditor?.document,me.window.onDidChangeActiveTextEditor(y=>{let P=this.activeTextDocument;this.activeTextDocument=y?.document,P!==void 0&&p(P),this.activeTextDocument!==void 0&&this.backgroundScheduler.remove(this.activeTextDocument)});let m=e.getFeature(rt.DidOpenTextDocumentNotification.method);o.push(m.onNotificationSent(y=>{let P=y.textDocument;this.diagnosticRequestor.knows(lt.document,P)||c(P)&&this.diagnosticRequestor.pull(P,()=>{p(P)})})),o.push(t.onOpen(y=>{for(let P of y){if(this.diagnosticRequestor.knows(lt.document,P))continue;let k=P.toString(),L;for(let M of me.workspace.textDocuments)if(k===M.uri.toString()){L=M;break}L!==void 0&&c(L)&&this.diagnosticRequestor.pull(L,()=>{p(L)})}}));let g=new Set;for(let y of me.workspace.textDocuments)c(y)&&(this.diagnosticRequestor.pull(y,()=>{p(y)}),g.add(y.uri.toString()));if(i.onTabs===!0)for(let y of t.getTabResources())!g.has(y.toString())&&c(y)&&this.diagnosticRequestor.pull(y,()=>{p(y)});if(i.onChange===!0){let y=e.getFeature(rt.DidChangeTextDocumentNotification.method);o.push(y.onNotificationSent(async P=>{let k=P.textDocument;(i.filter===void 0||!i.filter(k,Do.onType))&&this.diagnosticRequestor.knows(lt.document,k)&&this.diagnosticRequestor.pull(k,()=>{this.backgroundScheduler.trigger()})}))}if(i.onSave===!0){let y=e.getFeature(rt.DidSaveTextDocumentNotification.method);o.push(y.onNotificationSent(P=>{let k=P.textDocument;(i.filter===void 0||!i.filter(k,Do.onSave))&&this.diagnosticRequestor.knows(lt.document,k)&&this.diagnosticRequestor.pull(P.textDocument,()=>{this.backgroundScheduler.trigger()})}))}let S=e.getFeature(rt.DidCloseTextDocumentNotification.method);o.push(S.onNotificationSent(y=>{this.cleanUpDocument(y.textDocument)})),t.onClose(y=>{for(let P of y)this.cleanUpDocument(P)}),this.diagnosticRequestor.onDidChangeDiagnosticsEmitter.event(()=>{for(let y of me.workspace.textDocuments)c(y)&&this.diagnosticRequestor.pull(y)}),n.workspaceDiagnostics===!0&&n.identifier!=="da348dc5-c30a-4515-9d98-31ff3be38d14"&&this.diagnosticRequestor.pullWorkspace(),this.disposable=me.Disposable.from(...o,this.backgroundScheduler,this.diagnosticRequestor)}get onDidChangeDiagnosticsEmitter(){return this.diagnosticRequestor.onDidChangeDiagnosticsEmitter}get diagnostics(){return this.diagnosticRequestor.provider}cleanUpDocument(e){this.diagnosticRequestor.knows(lt.document,e)&&(this.diagnosticRequestor.forgetDocument(e),this.backgroundScheduler.remove(e))}},fd=class extends od.TextDocumentLanguageFeature{constructor(e){super(e,rt.DocumentDiagnosticRequest.type)}fillClientCapabilities(e){let t=So(So(e,"textDocument"),"diagnostic");t.dynamicRegistration=!0,t.relatedDocumentSupport=!1,So(So(e,"workspace"),"diagnostics").refreshSupport=!0}initialize(e,t){this._client.onRequest(rt.DiagnosticRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeDiagnosticsEmitter.fire()});let[i,s]=this.getRegistration(t,e.diagnosticProvider);!i||!s||this.register({id:i,registerOptions:s})}clear(){this.tabs!==void 0&&(this.tabs.dispose(),this.tabs=void 0),super.clear()}registerLanguageProvider(e){this.tabs===void 0&&(this.tabs=new ad);let t=new ld(this._client,this.tabs,e);return[t.disposable,t]}};Dr.DiagnosticFeature=fd});var ev=x(ko=>{"use strict";Object.defineProperty(ko,"__esModule",{value:!0});ko.NotebookDocumentSyncFeature=void 0;var xt=require("vscode"),zC=Ro(),rr=ie(),BC=Ve(),Ym=hn();function Zm(r,e){return r[e]===void 0&&(r[e]={}),r[e]}var bi;(function(r){let e;(function(t){function n(g,S){return{version:g.version,uri:S.asUri(g.uri)}}t.asVersionedNotebookDocumentIdentifier=n;function i(g,S,y){let P=rr.NotebookDocument.create(y.asUri(g.uri),g.notebookType,g.version,s(S,y));return Object.keys(g.metadata).length>0&&(P.metadata=o(g.metadata)),P}t.asNotebookDocument=i;function s(g,S){return g.map(y=>a(y,S))}t.asNotebookCells=s;function o(g){return d(new Set,g)}t.asMetadata=o;function a(g,S){let y=rr.NotebookCell.create(c(g.kind),S.asUri(g.document.uri));return Object.keys(g.metadata).length>0&&(y.metadata=o(g.metadata)),g.executionSummary!==void 0&&Ym.number(g.executionSummary.executionOrder)&&Ym.boolean(g.executionSummary.success)&&(y.executionSummary={executionOrder:g.executionSummary.executionOrder,success:g.executionSummary.success}),y}t.asNotebookCell=a;function c(g){switch(g){case xt.NotebookCellKind.Markup:return rr.NotebookCellKind.Markup;case xt.NotebookCellKind.Code:return rr.NotebookCellKind.Code}}function d(g,S){if(g.has(S))throw new Error("Can't deep copy cyclic structures.");if(Array.isArray(S)){let y=[];for(let P of S)if(P!==null&&typeof P=="object"||Array.isArray(P))y.push(d(g,P));else{if(P instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");y.push(P)}return y}else{let y=Object.keys(S),P=Object.create(null);for(let k of y){let L=S[k];if(L!==null&&typeof L=="object"||Array.isArray(L))P[k]=d(g,L);else{if(L instanceof RegExp)throw new Error("Can't transfer regular expressions to the server");P[k]=L}}return P}}function p(g,S){let y=S.asChangeTextDocumentParams(g,g.document.uri,g.document.version);return{document:y.textDocument,changes:y.contentChanges}}t.asTextContentChange=p;function m(g,S){let y=Object.create(null);if(g.metadata&&(y.metadata=r.c2p.asMetadata(g.metadata)),g.cells!==void 0){let P=Object.create(null),k=g.cells;k.structure&&(P.structure={array:{start:k.structure.array.start,deleteCount:k.structure.array.deleteCount,cells:k.structure.array.cells!==void 0?k.structure.array.cells.map(L=>r.c2p.asNotebookCell(L,S)):void 0},didOpen:k.structure.didOpen!==void 0?k.structure.didOpen.map(L=>S.asOpenTextDocumentParams(L.document).textDocument):void 0,didClose:k.structure.didClose!==void 0?k.structure.didClose.map(L=>S.asCloseTextDocumentParams(L.document).textDocument):void 0}),k.data!==void 0&&(P.data=k.data.map(L=>r.c2p.asNotebookCell(L,S))),k.textContent!==void 0&&(P.textContent=k.textContent.map(L=>r.c2p.asTextContentChange(L,S))),Object.keys(P).length>0&&(y.cells=P)}return y}t.asNotebookDocumentChangeEvent=m})(e=r.c2p||(r.c2p={}))})(bi||(bi={}));var pd;(function(r){function e(a,c,d){let p=a.length,m=c.length,g=0;for(;g<m&&g<p&&t(a[g],c[g],d);)g++;if(g<m&&g<p){let S=p-1,y=m-1;for(;S>=0&&y>=0&&t(a[S],c[y],d);)S--,y--;let P=S+1-g,k=g===y+1?void 0:c.slice(g,y+1);return k!==void 0?{start:g,deleteCount:P,cells:k}:{start:g,deleteCount:P}}else return g<m?{start:g,deleteCount:0,cells:c.slice(g)}:g<p?{start:g,deleteCount:p-g}:void 0}r.computeDiff=e;function t(a,c,d=!0){return a.kind!==c.kind||a.document.uri.toString()!==c.document.uri.toString()||a.document.languageId!==c.document.languageId||!n(a.executionSummary,c.executionSummary)?!1:!d||d&&s(a.metadata,c.metadata)}function n(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.executionOrder===c.executionOrder&&a.success===c.success&&i(a.timing,c.timing)}function i(a,c){return a===c?!0:a===void 0||c===void 0?!1:a.startTime===c.startTime&&a.endTime===c.endTime}function s(a,c){if(a===c)return!0;if(a==null||c===null||c===void 0||typeof a!=typeof c||typeof a!="object")return!1;let d=Array.isArray(a),p=Array.isArray(c);if(d!==p)return!1;if(d&&p){if(a.length!==c.length)return!1;for(let m=0;m<a.length;m++)if(!s(a[m],c[m]))return!1}if(o(a)&&o(c)){let m=Object.keys(a),g=Object.keys(c);if(m.length!==g.length||(m.sort(),g.sort(),!s(m,g)))return!1;for(let S=0;S<m.length;S++){let y=m[S];if(!s(a[y],c[y]))return!1}return!0}return!1}function o(a){return a!==null&&typeof a=="object"}r.isObjectLiteral=o})(pd||(pd={}));var gd;(function(r){function e(t,n){if(typeof t=="string")return t==="*"||n.notebookType===t;if(t.notebookType!==void 0&&t.notebookType!=="*"&&n.notebookType!==t.notebookType)return!1;let i=n.uri;if(t.scheme!==void 0&&t.scheme!=="*"&&i.scheme!==t.scheme)return!1;if(t.pattern!==void 0){let s=new zC.Minimatch(t.pattern,{noext:!0});if(!s.makeRe()||!s.match(i.fsPath))return!1}return!0}r.matchNotebook=e})(gd||(gd={}));var _o;(function(r){function e(n){let i=n.notebookSelector,s=[];for(let o of i){let a=(typeof o.notebook=="string"?o.notebook:o.notebook?.notebookType)??"*",c=typeof o.notebook=="string"?void 0:o.notebook?.scheme,d=typeof o.notebook=="string"?void 0:o.notebook?.pattern;if(o.cells!==void 0)for(let p of o.cells)s.push(t(a,c,d,p.language));else s.push(t(a,c,d,void 0))}return s}r.asDocumentSelector=e;function t(n,i,s,o){return i===void 0&&s===void 0?{notebook:n,language:o}:{notebook:{notebookType:n,scheme:i,pattern:s},language:o}}})(_o||(_o={}));var To;(function(r){function e(t){return{cells:t,uris:new Set(t.map(n=>n.document.uri.toString()))}}r.create=e})(To||(To={}));var wi=class{constructor(e,t){this.client=e,this.options=t,this.notebookSyncInfo=new Map,this.notebookDidOpen=new Set,this.disposables=[],this.selector=e.protocol2CodeConverter.asDocumentSelector(_o.asDocumentSelector(t)),xt.workspace.onDidOpenNotebookDocument(n=>{this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n)},void 0,this.disposables);for(let n of xt.workspace.notebookDocuments)this.notebookDidOpen.add(n.uri.toString()),this.didOpen(n);xt.workspace.onDidChangeNotebookDocument(n=>this.didChangeNotebookDocument(n),void 0,this.disposables),this.options.save===!0&&xt.workspace.onDidSaveNotebookDocument(n=>this.didSave(n),void 0,this.disposables),xt.workspace.onDidCloseNotebookDocument(n=>{this.didClose(n),this.notebookDidOpen.delete(n.uri.toString())},void 0,this.disposables)}getState(){for(let e of xt.workspace.notebookDocuments)if(this.getMatchingCells(e)!==void 0)return{kind:"document",id:"$internal",registrations:!0,matches:!0};return{kind:"document",id:"$internal",registrations:!0,matches:!1}}get mode(){return"notebook"}handles(e){return xt.languages.match(this.selector,e)>0}didOpenNotebookCellTextDocument(e,t){if(xt.languages.match(this.selector,t.document)===0||!this.notebookDidOpen.has(e.uri.toString()))return;let n=this.notebookSyncInfo.get(e.uri.toString()),i=this.cellMatches(e,t);if(n!==void 0){let s=n.uris.has(t.document.uri.toString());if(i&&s||!i&&!s)return;if(i){let o=this.getMatchingCells(e);if(o!==void 0){let a=this.asNotebookDocumentChangeEvent(e,void 0,n,o);a!==void 0&&this.doSendChange(a,o).catch(()=>{})}}}else i&&this.doSendOpen(e,[t]).catch(()=>{})}didChangeNotebookCellTextDocument(e,t){xt.languages.match(this.selector,t.document)!==0&&this.doSendChange({notebook:e,cells:{textContent:[t]}},void 0).catch(()=>{})}didCloseNotebookCellTextDocument(e,t){let n=this.notebookSyncInfo.get(e.uri.toString());if(n===void 0)return;let i=t.document.uri,s=n.cells.findIndex(o=>o.document.uri.toString()===i.toString());if(s!==-1)if(s===0&&n.cells.length===1)this.doSendClose(e,n.cells).catch(()=>{});else{let o=n.cells.slice(),a=o.splice(s,1);this.doSendChange({notebook:e,cells:{structure:{array:{start:s,deleteCount:1},didClose:a}}},o).catch(()=>{})}}dispose(){for(let e of this.disposables)e.dispose()}didOpen(e,t=this.getMatchingCells(e),n=this.notebookSyncInfo.get(e.uri.toString())){if(n!==void 0)if(t!==void 0){let i=this.asNotebookDocumentChangeEvent(e,void 0,n,t);i!==void 0&&this.doSendChange(i,t).catch(()=>{})}else this.doSendClose(e,[]).catch(()=>{});else{if(t===void 0)return;this.doSendOpen(e,t).catch(()=>{})}}didChangeNotebookDocument(e){let t=e.notebook,n=this.notebookSyncInfo.get(t.uri.toString());if(n===void 0){if(e.contentChanges.length===0)return;let i=this.getMatchingCells(t);if(i===void 0)return;this.didOpen(t,i,n)}else{let i=this.getMatchingCells(t);if(i===void 0){this.didClose(t,n);return}let s=this.asNotebookDocumentChangeEvent(e.notebook,e,n,i);s!==void 0&&this.doSendChange(s,i).catch(()=>{})}}didSave(e){this.notebookSyncInfo.get(e.uri.toString())!==void 0&&this.doSendSave(e).catch(()=>{})}didClose(e,t=this.notebookSyncInfo.get(e.uri.toString())){if(t===void 0)return;let n=e.getCells().filter(i=>t.uris.has(i.document.uri.toString()));this.doSendClose(e,n).catch(()=>{})}async sendDidOpenNotebookDocument(e){let t=this.getMatchingCells(e);if(t!==void 0)return this.doSendOpen(e,t)}async doSendOpen(e,t){let n=async(s,o)=>{let a=bi.c2p.asNotebookDocument(s,o,this.client.code2ProtocolConverter),c=o.map(d=>this.client.code2ProtocolConverter.asTextDocumentItem(d.document));try{await this.client.sendNotification(rr.DidOpenNotebookDocumentNotification.type,{notebookDocument:a,cellTextDocuments:c})}catch(d){throw this.client.error("Sending DidOpenNotebookDocumentNotification failed",d),d}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.set(e.uri.toString(),To.create(t)),i?.didOpen!==void 0?i.didOpen(e,t,n):n(e,t)}async sendDidChangeNotebookDocument(e){return this.doSendChange(e,void 0)}async doSendChange(e,t=this.getMatchingCells(e.notebook)){let n=async s=>{try{await this.client.sendNotification(rr.DidChangeNotebookDocumentNotification.type,{notebookDocument:bi.c2p.asVersionedNotebookDocumentIdentifier(s.notebook,this.client.code2ProtocolConverter),change:bi.c2p.asNotebookDocumentChangeEvent(s,this.client.code2ProtocolConverter)})}catch(o){throw this.client.error("Sending DidChangeNotebookDocumentNotification failed",o),o}},i=this.client.middleware?.notebooks;return e.cells?.structure!==void 0&&this.notebookSyncInfo.set(e.notebook.uri.toString(),To.create(t??[])),i?.didChange!==void 0?i?.didChange(e,n):n(e)}async sendDidSaveNotebookDocument(e){return this.doSendSave(e)}async doSendSave(e){let t=async i=>{try{await this.client.sendNotification(rr.DidSaveNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(i.uri)}})}catch(s){throw this.client.error("Sending DidSaveNotebookDocumentNotification failed",s),s}},n=this.client.middleware?.notebooks;return n?.didSave!==void 0?n.didSave(e,t):t(e)}async sendDidCloseNotebookDocument(e){return this.doSendClose(e,this.getMatchingCells(e)??[])}async doSendClose(e,t){let n=async(s,o)=>{try{await this.client.sendNotification(rr.DidCloseNotebookDocumentNotification.type,{notebookDocument:{uri:this.client.code2ProtocolConverter.asUri(s.uri)},cellTextDocuments:o.map(a=>this.client.code2ProtocolConverter.asTextDocumentIdentifier(a.document))})}catch(a){throw this.client.error("Sending DidCloseNotebookDocumentNotification failed",a),a}},i=this.client.middleware?.notebooks;return this.notebookSyncInfo.delete(e.uri.toString()),i?.didClose!==void 0?i.didClose(e,t,n):n(e,t)}asNotebookDocumentChangeEvent(e,t,n,i){if(t!==void 0&&t.notebook!==e)throw new Error("Notebook must be identical");let s={notebook:e};t?.metadata!==void 0&&(s.metadata=bi.c2p.asMetadata(t.metadata));let o;if(t?.cellChanges!==void 0&&t.cellChanges.length>0){let a=[];o=new Set(i.map(c=>c.document.uri.toString()));for(let c of t.cellChanges)o.has(c.cell.document.uri.toString())&&(c.executionSummary!==void 0||c.metadata!==void 0)&&a.push(c.cell);a.length>0&&(s.cells=s.cells??{},s.cells.data=a)}if((t?.contentChanges!==void 0&&t.contentChanges.length>0||t===void 0)&&n!==void 0&&i!==void 0){let a=n.cells,c=i,d=pd.computeDiff(a,c,!1),p,m;if(d!==void 0){p=d.cells===void 0?new Map:new Map(d.cells.map(y=>[y.document.uri.toString(),y])),m=d.deleteCount===0?new Map:new Map(a.slice(d.start,d.start+d.deleteCount).map(y=>[y.document.uri.toString(),y]));for(let y of Array.from(m.keys()))p.has(y)&&(m.delete(y),p.delete(y));s.cells=s.cells??{};let g=[],S=[];if(p.size>0||m.size>0){for(let y of p.values())g.push(y);for(let y of m.values())S.push(y)}s.cells.structure={array:d,didOpen:g,didClose:S}}}return Object.keys(s).length>1?s:void 0}getMatchingCells(e,t=e.getCells()){if(this.options.notebookSelector!==void 0){for(let n of this.options.notebookSelector)if(n.notebook===void 0||gd.matchNotebook(n.notebook,e)){let i=this.filterCells(e,t,n.cells);return i.length===0?void 0:i}}}cellMatches(e,t){let n=this.getMatchingCells(e,[t]);return n!==void 0&&n[0]===t}filterCells(e,t,n){let i=n!==void 0?t.filter(s=>{let o=s.document.languageId;return n.some(a=>a.language==="*"||o===a.language)}):t;return typeof this.client.clientOptions.notebookDocumentOptions?.filterCells=="function"?this.client.clientOptions.notebookDocumentOptions.filterCells(e,i):i}},Po=class r{constructor(e){this.client=e,this.registrations=new Map,this.registrationType=rr.NotebookDocumentSyncRegistrationType.type,xt.workspace.onDidOpenTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof wi&&s.didOpenNotebookCellTextDocument(n,i)}),xt.workspace.onDidChangeTextDocument(t=>{if(t.contentChanges.length===0)return;let n=t.document;if(n.uri.scheme!==r.CellScheme)return;let[i]=this.findNotebookDocumentAndCell(n);if(i!==void 0)for(let s of this.registrations.values())s instanceof wi&&s.didChangeNotebookCellTextDocument(i,t)}),xt.workspace.onDidCloseTextDocument(t=>{if(t.uri.scheme!==r.CellScheme)return;let[n,i]=this.findNotebookDocumentAndCell(t);if(!(n===void 0||i===void 0))for(let s of this.registrations.values())s instanceof wi&&s.didCloseNotebookCellTextDocument(n,i)})}getState(){if(this.registrations.size===0)return{kind:"document",id:this.registrationType.method,registrations:!1,matches:!1};for(let e of this.registrations.values()){let t=e.getState();if(t.kind==="document"&&t.registrations===!0&&t.matches===!0)return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!0}}return{kind:"document",id:this.registrationType.method,registrations:!0,matches:!1}}fillClientCapabilities(e){let t=Zm(Zm(e,"notebookDocument"),"synchronization");t.dynamicRegistration=!0,t.executionSummarySupport=!0}preInitialize(e){let t=e.notebookDocumentSync;t!==void 0&&(this.dedicatedChannel=this.client.protocol2CodeConverter.asDocumentSelector(_o.asDocumentSelector(t)))}initialize(e){let t=e.notebookDocumentSync;if(t===void 0)return;let n=t.id??BC.generateUuid();this.register({id:n,registerOptions:t})}register(e){let t=new wi(this.client,e.registerOptions);this.registrations.set(e.id,t)}unregister(e){let t=this.registrations.get(e);t&&t.dispose()}clear(){for(let e of this.registrations.values())e.dispose();this.registrations.clear()}handles(e){if(e.uri.scheme!==r.CellScheme)return!1;if(this.dedicatedChannel!==void 0&&xt.languages.match(this.dedicatedChannel,e)>0)return!0;for(let t of this.registrations.values())if(t.handles(e))return!0;return!1}getProvider(e){for(let t of this.registrations.values())if(t.handles(e.document))return t}findNotebookDocumentAndCell(e){let t=e.uri.toString();for(let n of xt.workspace.notebookDocuments)for(let i of n.getCells())if(i.document.uri.toString()===t)return[n,i];return[void 0,void 0]}};ko.NotebookDocumentSyncFeature=Po;Po.CellScheme="vscode-notebook-cell"});var nv=x(_r=>{"use strict";Object.defineProperty(_r,"__esModule",{value:!0});_r.SyncConfigurationFeature=_r.toJSONObject=_r.ConfigurationFeature=void 0;var Ci=require("vscode"),Ji=ie(),GC=hn(),XC=Ve(),tv=we(),md=class{constructor(e){this._client=e}getState(){return{kind:"static"}}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.configuration=!0}initialize(){let e=this._client;e.onRequest(Ji.ConfigurationRequest.type,(t,n)=>{let i=o=>{let a=[];for(let c of o.items){let d=c.scopeUri!==void 0&&c.scopeUri!==null?this._client.protocol2CodeConverter.asUri(c.scopeUri):void 0;a.push(this.getConfiguration(d,c.section!==null?c.section:void 0))}return a},s=e.middleware.workspace;return s&&s.configuration?s.configuration(t,n,i):i(t,n)})}getConfiguration(e,t){let n=null;if(t){let i=t.lastIndexOf(".");if(i===-1)n=Ur(Ci.workspace.getConfiguration(void 0,e).get(t));else{let s=Ci.workspace.getConfiguration(t.substr(0,i),e);s&&(n=Ur(s.get(t.substr(i+1))))}}else{let i=Ci.workspace.getConfiguration(void 0,e);n={};for(let s of Object.keys(i))i.has(s)&&(n[s]=Ur(i.get(s)))}return n===void 0&&(n=null),n}clear(){}};_r.ConfigurationFeature=md;function Ur(r){if(r){if(Array.isArray(r))return r.map(Ur);if(typeof r=="object"){let e=Object.create(null);for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=Ur(r[t]));return e}}return r}_r.toJSONObject=Ur;var vd=class{constructor(e){this._client=e,this.isCleared=!1,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return Ji.DidChangeConfigurationNotification.type}fillClientCapabilities(e){(0,tv.ensure)((0,tv.ensure)(e,"workspace"),"didChangeConfiguration").dynamicRegistration=!0}initialize(){this.isCleared=!1;let e=this._client.clientOptions.synchronize?.configurationSection;e!==void 0&&this.register({id:XC.generateUuid(),registerOptions:{section:e}})}register(e){let t=Ci.workspace.onDidChangeConfiguration(n=>{this.onDidChangeConfiguration(e.registerOptions.section,n)});this._listeners.set(e.id,t),e.registerOptions.section!==void 0&&this.onDidChangeConfiguration(e.registerOptions.section,void 0)}unregister(e){let t=this._listeners.get(e);t&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear(),this.isCleared=!0}onDidChangeConfiguration(e,t){if(this.isCleared)return;let n;if(GC.string(e)?n=[e]:n=e,n!==void 0&&t!==void 0&&!n.some(a=>t.affectsConfiguration(a)))return;let i=async o=>o===void 0?this._client.sendNotification(Ji.DidChangeConfigurationNotification.type,{settings:null}):this._client.sendNotification(Ji.DidChangeConfigurationNotification.type,{settings:this.extractSettingsInformation(o)}),s=this._client.middleware.workspace?.didChangeConfiguration;(s?s(n,i):i(n)).catch(o=>{this._client.error(`Sending notification ${Ji.DidChangeConfigurationNotification.type.method} failed`,o)})}extractSettingsInformation(e){function t(s,o){let a=s;for(let c=0;c<o.length-1;c++){let d=a[o[c]];d||(d=Object.create(null),a[o[c]]=d),a=d}return a}let n=this._client.clientOptions.workspaceFolder?this._client.clientOptions.workspaceFolder.uri:void 0,i=Object.create(null);for(let s=0;s<e.length;s++){let o=e[s],a=o.indexOf("."),c=null;if(a>=0?c=Ci.workspace.getConfiguration(o.substr(0,a),n).get(o.substr(a+1)):c=Ci.workspace.getConfiguration(void 0,n).get(o),c){let d=e[s].split(".");t(i,d)[d[d.length-1]]=Ur(c)}}return i}};_r.SyncConfigurationFeature=vd});var rv=x(zt=>{"use strict";Object.defineProperty(zt,"__esModule",{value:!0});zt.DidSaveTextDocumentFeature=zt.WillSaveWaitUntilFeature=zt.WillSaveFeature=zt.DidChangeTextDocumentFeature=zt.DidCloseTextDocumentFeature=zt.DidOpenTextDocumentFeature=void 0;var sn=require("vscode"),Ne=ie(),Xe=we(),Ri=Ve(),yd=class extends Xe.TextDocumentEventFeature{constructor(e,t){super(e,sn.workspace.onDidOpenTextDocument,Ne.DidOpenTextDocumentNotification.type,()=>e.middleware.didOpen,n=>e.code2ProtocolConverter.asOpenTextDocumentParams(n),n=>n,Xe.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t}get openDocuments(){return this._syncedDocuments.values()}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Ri.generateUuid(),registerOptions:{documentSelector:t}})}get registrationType(){return Ne.DidOpenTextDocumentNotification.type}register(e){if(super.register(e),!e.registerOptions.documentSelector)return;let t=this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector);sn.workspace.textDocuments.forEach(n=>{let i=n.uri.toString();if(!this._syncedDocuments.has(i)&&sn.languages.match(t,n)>0&&!this._client.hasDedicatedTextSynchronizationFeature(n)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));(s.didOpen?s.didOpen(n,o):o(n)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)}),this._syncedDocuments.set(i,n)}})}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.set(e.uri.toString(),e),super.notificationSent(e,t,n)}};zt.DidOpenTextDocumentFeature=yd;var bd=class extends Xe.TextDocumentEventFeature{constructor(e,t,n){super(e,sn.workspace.onDidCloseTextDocument,Ne.DidCloseTextDocumentNotification.type,()=>e.middleware.didClose,i=>e.code2ProtocolConverter.asCloseTextDocumentParams(i),i=>i,Xe.TextDocumentEventFeature.textDocumentFilter),this._syncedDocuments=t,this._pendingTextDocumentChanges=n}get registrationType(){return Ne.DidCloseTextDocumentNotification.type}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.openClose&&this.register({id:Ri.generateUuid(),registerOptions:{documentSelector:t}})}async callback(e){await super.callback(e),this._pendingTextDocumentChanges.delete(e.uri.toString())}getTextDocument(e){return e}notificationSent(e,t,n){this._syncedDocuments.delete(e.uri.toString()),super.notificationSent(e,t,n)}unregister(e){let t=this._selectors.get(e);super.unregister(e);let n=this._selectors.values();this._syncedDocuments.forEach(i=>{if(sn.languages.match(t,i)>0&&!this._selectorFilter(n,i)&&!this._client.hasDedicatedTextSynchronizationFeature(i)){let s=this._client.middleware,o=a=>this._client.sendNotification(this._type,this._createParams(a));this._syncedDocuments.delete(i.uri.toString()),(s.didClose?s.didClose(i,o):o(i)).catch(a=>{this._client.error(`Sending document notification ${this._type.method} failed`,a)})}})}};zt.DidCloseTextDocumentFeature=bd;var wd=class extends Xe.DynamicDocumentFeature{constructor(e,t){super(e),this._changeData=new Map,this._onNotificationSent=new sn.EventEmitter,this._onPendingChangeAdded=new sn.EventEmitter,this._pendingTextDocumentChanges=t,this._syncKind=Ne.TextDocumentSyncKind.None}get onNotificationSent(){return this._onNotificationSent.event}get onPendingChangeAdded(){return this._onPendingChangeAdded.event}get syncKind(){return this._syncKind}get registrationType(){return Ne.DidChangeTextDocumentNotification.type}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").dynamicRegistration=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.change!==void 0&&n.change!==Ne.TextDocumentSyncKind.None&&this.register({id:Ri.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},{syncKind:n.change})})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=sn.workspace.onDidChangeTextDocument(this.callback,this)),this._changeData.set(e.id,{syncKind:e.registerOptions.syncKind,documentSelector:this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)}),this.updateSyncKind(e.registerOptions.syncKind))}*getDocumentSelectors(){for(let e of this._changeData.values())yield e.documentSelector}async callback(e){if(e.contentChanges.length===0)return;let t=e.document.uri,n=e.document.version,i=[];for(let s of this._changeData.values())if(sn.languages.match(s.documentSelector,e.document)>0&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let o=this._client.middleware;if(s.syncKind===Ne.TextDocumentSyncKind.Incremental){let a=async c=>{let d=this._client.code2ProtocolConverter.asChangeTextDocumentParams(c,t,n);await this._client.sendNotification(Ne.DidChangeTextDocumentNotification.type,d),this.notificationSent(c.document,Ne.DidChangeTextDocumentNotification.type,d)};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}else if(s.syncKind===Ne.TextDocumentSyncKind.Full){let a=async c=>{let d=c.document.uri.toString();this._pendingTextDocumentChanges.set(d,c.document),this._onPendingChangeAdded.fire()};i.push(o.didChange?o.didChange(e,c=>a(c)):a(e))}}return Promise.all(i).then(void 0,s=>{throw this._client.error(`Sending document notification ${Ne.DidChangeTextDocumentNotification.type.method} failed`,s),s})}notificationSent(e,t,n){this._onNotificationSent.fire({textDocument:e,type:t,params:n})}unregister(e){if(this._changeData.delete(e),this._changeData.size===0)this._listener&&(this._listener.dispose(),this._listener=void 0),this._syncKind=Ne.TextDocumentSyncKind.None;else{this._syncKind=Ne.TextDocumentSyncKind.None;for(let t of this._changeData.values())if(this.updateSyncKind(t.syncKind),this._syncKind===Ne.TextDocumentSyncKind.Full)break}}clear(){this._pendingTextDocumentChanges.clear(),this._changeData.clear(),this._syncKind=Ne.TextDocumentSyncKind.None,this._listener&&(this._listener.dispose(),this._listener=void 0)}getPendingDocumentChanges(e){if(this._pendingTextDocumentChanges.size===0)return[];let t;if(e.size===0)t=Array.from(this._pendingTextDocumentChanges.values()),this._pendingTextDocumentChanges.clear();else{t=[];for(let n of this._pendingTextDocumentChanges)e.has(n[0])||(t.push(n[1]),this._pendingTextDocumentChanges.delete(n[0]))}return t}getProvider(e){for(let t of this._changeData.values())if(sn.languages.match(t.documentSelector,e)>0)return{send:n=>this.callback(n)}}updateSyncKind(e){if(this._syncKind!==Ne.TextDocumentSyncKind.Full)switch(e){case Ne.TextDocumentSyncKind.Full:this._syncKind=e;break;case Ne.TextDocumentSyncKind.Incremental:this._syncKind===Ne.TextDocumentSyncKind.None&&(this._syncKind=Ne.TextDocumentSyncKind.Incremental);break}}};zt.DidChangeTextDocumentFeature=wd;var Cd=class extends Xe.TextDocumentEventFeature{constructor(e){super(e,sn.workspace.onWillSaveTextDocument,Ne.WillSaveTextDocumentNotification.type,()=>e.middleware.willSave,t=>e.code2ProtocolConverter.asWillSaveTextDocumentParams(t),t=>t.document,(t,n)=>Xe.TextDocumentEventFeature.textDocumentFilter(t,n.document))}get registrationType(){return Ne.WillSaveTextDocumentNotification.type}fillClientCapabilities(e){let t=(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization");t.willSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSave&&this.register({id:Ri.generateUuid(),registerOptions:{documentSelector:t}})}getTextDocument(e){return e.document}};zt.WillSaveFeature=Cd;var Rd=class extends Xe.DynamicDocumentFeature{constructor(e){super(e),this._selectors=new Map}getDocumentSelectors(){return this._selectors.values()}get registrationType(){return Ne.WillSaveTextDocumentWaitUntilRequest.type}fillClientCapabilities(e){let t=(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization");t.willSaveWaitUntil=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;t&&n&&n.willSaveWaitUntil&&this.register({id:Ri.generateUuid(),registerOptions:{documentSelector:t}})}register(e){e.registerOptions.documentSelector&&(this._listener||(this._listener=sn.workspace.onWillSaveTextDocument(this.callback,this)),this._selectors.set(e.id,this._client.protocol2CodeConverter.asDocumentSelector(e.registerOptions.documentSelector)))}callback(e){if(Xe.TextDocumentEventFeature.textDocumentFilter(this._selectors.values(),e.document)&&!this._client.hasDedicatedTextSynchronizationFeature(e.document)){let t=this._client.middleware,n=i=>this._client.sendRequest(Ne.WillSaveTextDocumentWaitUntilRequest.type,this._client.code2ProtocolConverter.asWillSaveTextDocumentParams(i)).then(async s=>{let o=await this._client.protocol2CodeConverter.asTextEdits(s);return o===void 0?[]:o});e.waitUntil(t.willSaveWaitUntil?t.willSaveWaitUntil(e,n):n(e))}}unregister(e){this._selectors.delete(e),this._selectors.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._selectors.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}};zt.WillSaveWaitUntilFeature=Rd;var Sd=class extends Xe.TextDocumentEventFeature{constructor(e){super(e,sn.workspace.onDidSaveTextDocument,Ne.DidSaveTextDocumentNotification.type,()=>e.middleware.didSave,t=>e.code2ProtocolConverter.asSaveTextDocumentParams(t,this._includeText),t=>t,Xe.TextDocumentEventFeature.textDocumentFilter),this._includeText=!1}get registrationType(){return Ne.DidSaveTextDocumentNotification.type}fillClientCapabilities(e){(0,Xe.ensure)((0,Xe.ensure)(e,"textDocument"),"synchronization").didSave=!0}initialize(e,t){let n=e.resolvedTextDocumentSync;if(t&&n&&n.save){let i=typeof n.save=="boolean"?{includeText:!1}:{includeText:!!n.save.includeText};this.register({id:Ri.generateUuid(),registerOptions:Object.assign({},{documentSelector:t},i)})}}register(e){this._includeText=!!e.registerOptions.includeText,super.register(e)}getTextDocument(e){return e}};zt.DidSaveTextDocumentFeature=Sd});var iv=x(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.CompletionItemFeature=void 0;var QC=require("vscode"),ve=ie(),Dd=we(),JC=Ve(),YC=[ve.CompletionItemKind.Text,ve.CompletionItemKind.Method,ve.CompletionItemKind.Function,ve.CompletionItemKind.Constructor,ve.CompletionItemKind.Field,ve.CompletionItemKind.Variable,ve.CompletionItemKind.Class,ve.CompletionItemKind.Interface,ve.CompletionItemKind.Module,ve.CompletionItemKind.Property,ve.CompletionItemKind.Unit,ve.CompletionItemKind.Value,ve.CompletionItemKind.Enum,ve.CompletionItemKind.Keyword,ve.CompletionItemKind.Snippet,ve.CompletionItemKind.Color,ve.CompletionItemKind.File,ve.CompletionItemKind.Reference,ve.CompletionItemKind.Folder,ve.CompletionItemKind.EnumMember,ve.CompletionItemKind.Constant,ve.CompletionItemKind.Struct,ve.CompletionItemKind.Event,ve.CompletionItemKind.Operator,ve.CompletionItemKind.TypeParameter],_d=class extends Dd.TextDocumentLanguageFeature{constructor(e){super(e,ve.CompletionRequest.type),this.labelDetailsSupport=new Map}fillClientCapabilities(e){let t=(0,Dd.ensure)((0,Dd.ensure)(e,"textDocument"),"completion");t.dynamicRegistration=!0,t.contextSupport=!0,t.completionItem={snippetSupport:!0,commitCharactersSupport:!0,documentationFormat:[ve.MarkupKind.Markdown,ve.MarkupKind.PlainText],deprecatedSupport:!0,preselectSupport:!0,tagSupport:{valueSet:[ve.CompletionItemTag.Deprecated]},insertReplaceSupport:!0,resolveSupport:{properties:["documentation","detail","additionalTextEdits"]},insertTextModeSupport:{valueSet:[ve.InsertTextMode.asIs,ve.InsertTextMode.adjustIndentation]},labelDetailsSupport:!0},t.insertTextMode=ve.InsertTextMode.adjustIndentation,t.completionItemKind={valueSet:YC},t.completionList={itemDefaults:["commitCharacters","editRange","insertTextFormat","insertTextMode","data"]}}initialize(e,t){let n=this.getRegistrationOptions(t,e.completionProvider);n&&this.register({id:JC.generateUuid(),registerOptions:n})}registerLanguageProvider(e,t){this.labelDetailsSupport.set(t,!!e.completionItem?.labelDetailsSupport);let n=e.triggerCharacters??[],i=e.allCommitCharacters,s=e.documentSelector,o={provideCompletionItems:(a,c,d,p)=>{let m=this._client,g=this._client.middleware,S=(y,P,k,L)=>m.sendRequest(ve.CompletionRequest.type,m.code2ProtocolConverter.asCompletionParams(y,P,k),L).then(M=>L.isCancellationRequested?null:m.protocol2CodeConverter.asCompletionResult(M,i,L),M=>m.handleFailedRequest(ve.CompletionRequest.type,L,M,null));return g.provideCompletionItem?g.provideCompletionItem(a,c,p,d,S):S(a,c,p,d)},resolveCompletionItem:e.resolveProvider?(a,c)=>{let d=this._client,p=this._client.middleware,m=(g,S)=>d.sendRequest(ve.CompletionResolveRequest.type,d.code2ProtocolConverter.asCompletionItem(g,!!this.labelDetailsSupport.get(t)),S).then(y=>S.isCancellationRequested?null:d.protocol2CodeConverter.asCompletionItem(y),y=>d.handleFailedRequest(ve.CompletionResolveRequest.type,S,y,g));return p.resolveCompletionItem?p.resolveCompletionItem(a,c,m):m(a,c)}:void 0};return[QC.languages.registerCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(s),o,...n),o]}};Eo.CompletionItemFeature=_d});var sv=x(xo=>{"use strict";Object.defineProperty(xo,"__esModule",{value:!0});xo.HoverFeature=void 0;var ZC=require("vscode"),Yi=ie(),Td=we(),eR=Ve(),Pd=class extends Td.TextDocumentLanguageFeature{constructor(e){super(e,Yi.HoverRequest.type)}fillClientCapabilities(e){let t=(0,Td.ensure)((0,Td.ensure)(e,"textDocument"),"hover");t.dynamicRegistration=!0,t.contentFormat=[Yi.MarkupKind.Markdown,Yi.MarkupKind.PlainText]}initialize(e,t){let n=this.getRegistrationOptions(t,e.hoverProvider);n&&this.register({id:eR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideHover:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Yi.HoverRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asHover(S),S=>a.handleFailedRequest(Yi.HoverRequest.type,g,S,null)),d=a.middleware;return d.provideHover?d.provideHover(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return ZC.languages.registerHoverProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};xo.HoverFeature=Pd});var ov=x(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.DefinitionFeature=void 0;var tR=require("vscode"),kd=ie(),Ed=we(),nR=Ve(),xd=class extends Ed.TextDocumentLanguageFeature{constructor(e){super(e,kd.DefinitionRequest.type)}fillClientCapabilities(e){let t=(0,Ed.ensure)((0,Ed.ensure)(e,"textDocument"),"definition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.definitionProvider);n&&this.register({id:nR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDefinition:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(kd.DefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,g),S=>a.handleFailedRequest(kd.DefinitionRequest.type,g,S,null)),d=a.middleware;return d.provideDefinition?d.provideDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return tR.languages.registerDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Io.DefinitionFeature=xd});var cv=x(qo=>{"use strict";Object.defineProperty(qo,"__esModule",{value:!0});qo.SignatureHelpFeature=void 0;var av=require("vscode"),Zi=ie(),Id=we(),rR=Ve(),qd=class extends Id.TextDocumentLanguageFeature{constructor(e){super(e,Zi.SignatureHelpRequest.type)}fillClientCapabilities(e){let t=(0,Id.ensure)((0,Id.ensure)(e,"textDocument"),"signatureHelp");t.dynamicRegistration=!0,t.signatureInformation={documentationFormat:[Zi.MarkupKind.Markdown,Zi.MarkupKind.PlainText]},t.signatureInformation.parameterInformation={labelOffsetSupport:!0},t.signatureInformation.activeParameterSupport=!0,t.contextSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.signatureHelpProvider);n&&this.register({id:rR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t={provideSignatureHelp:(n,i,s,o)=>{let a=this._client,c=(p,m,g,S)=>a.sendRequest(Zi.SignatureHelpRequest.type,a.code2ProtocolConverter.asSignatureHelpParams(p,m,g),S).then(y=>S.isCancellationRequested?null:a.protocol2CodeConverter.asSignatureHelp(y,S),y=>a.handleFailedRequest(Zi.SignatureHelpRequest.type,S,y,null)),d=a.middleware;return d.provideSignatureHelp?d.provideSignatureHelp(n,i,o,s,c):c(n,i,o,s)}};return[this.registerProvider(e,t),t]}registerProvider(e,t){let n=this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector);if(e.retriggerCharacters===void 0){let i=e.triggerCharacters||[];return av.languages.registerSignatureHelpProvider(n,t,...i)}else{let i={triggerCharacters:e.triggerCharacters||[],retriggerCharacters:e.retriggerCharacters||[]};return av.languages.registerSignatureHelpProvider(n,t,i)}}};qo.SignatureHelpFeature=qd});var uv=x(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.DocumentHighlightFeature=void 0;var iR=require("vscode"),Fd=ie(),Od=we(),sR=Ve(),Ld=class extends Od.TextDocumentLanguageFeature{constructor(e){super(e,Fd.DocumentHighlightRequest.type)}fillClientCapabilities(e){(0,Od.ensure)((0,Od.ensure)(e,"textDocument"),"documentHighlight").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentHighlightProvider);n&&this.register({id:sR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentHighlights:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(Fd.DocumentHighlightRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDocumentHighlights(S,g),S=>a.handleFailedRequest(Fd.DocumentHighlightRequest.type,g,S,null)),d=a.middleware;return d.provideDocumentHighlights?d.provideDocumentHighlights(i,s,o,c):c(i,s,o)}};return[iR.languages.registerDocumentHighlightProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Fo.DocumentHighlightFeature=Ld});var Ad=x(Vn=>{"use strict";Object.defineProperty(Vn,"__esModule",{value:!0});Vn.DocumentSymbolFeature=Vn.SupportedSymbolTags=Vn.SupportedSymbolKinds=void 0;var oR=require("vscode"),Te=ie(),Md=we(),aR=Ve();Vn.SupportedSymbolKinds=[Te.SymbolKind.File,Te.SymbolKind.Module,Te.SymbolKind.Namespace,Te.SymbolKind.Package,Te.SymbolKind.Class,Te.SymbolKind.Method,Te.SymbolKind.Property,Te.SymbolKind.Field,Te.SymbolKind.Constructor,Te.SymbolKind.Enum,Te.SymbolKind.Interface,Te.SymbolKind.Function,Te.SymbolKind.Variable,Te.SymbolKind.Constant,Te.SymbolKind.String,Te.SymbolKind.Number,Te.SymbolKind.Boolean,Te.SymbolKind.Array,Te.SymbolKind.Object,Te.SymbolKind.Key,Te.SymbolKind.Null,Te.SymbolKind.EnumMember,Te.SymbolKind.Struct,Te.SymbolKind.Event,Te.SymbolKind.Operator,Te.SymbolKind.TypeParameter];Vn.SupportedSymbolTags=[Te.SymbolTag.Deprecated];var Nd=class extends Md.TextDocumentLanguageFeature{constructor(e){super(e,Te.DocumentSymbolRequest.type)}fillClientCapabilities(e){let t=(0,Md.ensure)((0,Md.ensure)(e,"textDocument"),"documentSymbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:Vn.SupportedSymbolKinds},t.hierarchicalDocumentSymbolSupport=!0,t.tagSupport={valueSet:Vn.SupportedSymbolTags},t.labelSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentSymbolProvider);n&&this.register({id:aR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentSymbols:(s,o)=>{let a=this._client,c=async(p,m)=>{try{let g=await a.sendRequest(Te.DocumentSymbolRequest.type,a.code2ProtocolConverter.asDocumentSymbolParams(p),m);if(m.isCancellationRequested||g===void 0||g===null)return null;if(g.length===0)return[];{let S=g[0];return Te.DocumentSymbol.is(S)?await a.protocol2CodeConverter.asDocumentSymbols(g,m):await a.protocol2CodeConverter.asSymbolInformations(g,m)}}catch(g){return a.handleFailedRequest(Te.DocumentSymbolRequest.type,m,g,null)}},d=a.middleware;return d.provideDocumentSymbols?d.provideDocumentSymbols(s,o,c):c(s,o)}},i=e.label!==void 0?{label:e.label}:void 0;return[oR.languages.registerDocumentSymbolProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,i),n]}};Vn.DocumentSymbolFeature=Nd});var lv=x(Oo=>{"use strict";Object.defineProperty(Oo,"__esModule",{value:!0});Oo.WorkspaceSymbolFeature=void 0;var cR=require("vscode"),es=ie(),$d=we(),dv=Ad(),uR=Ve(),jd=class extends $d.WorkspaceFeature{constructor(e){super(e,es.WorkspaceSymbolRequest.type)}fillClientCapabilities(e){let t=(0,$d.ensure)((0,$d.ensure)(e,"workspace"),"symbol");t.dynamicRegistration=!0,t.symbolKind={valueSet:dv.SupportedSymbolKinds},t.tagSupport={valueSet:dv.SupportedSymbolTags},t.resolveSupport={properties:["location.range"]}}initialize(e){e.workspaceSymbolProvider&&this.register({id:uR.generateUuid(),registerOptions:e.workspaceSymbolProvider===!0?{workDoneProgress:!1}:e.workspaceSymbolProvider})}registerLanguageProvider(e){let t={provideWorkspaceSymbols:(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(es.WorkspaceSymbolRequest.type,{query:c},d).then(p=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformations(p,d),p=>s.handleFailedRequest(es.WorkspaceSymbolRequest.type,d,p,null)),a=s.middleware;return a.provideWorkspaceSymbols?a.provideWorkspaceSymbols(n,i,o):o(n,i)},resolveWorkspaceSymbol:e.resolveProvider===!0?(n,i)=>{let s=this._client,o=(c,d)=>s.sendRequest(es.WorkspaceSymbolResolveRequest.type,s.code2ProtocolConverter.asWorkspaceSymbol(c),d).then(p=>d.isCancellationRequested?null:s.protocol2CodeConverter.asSymbolInformation(p),p=>s.handleFailedRequest(es.WorkspaceSymbolResolveRequest.type,d,p,null)),a=s.middleware;return a.resolveWorkspaceSymbol?a.resolveWorkspaceSymbol(n,i,o):o(n,i)}:void 0};return[cR.languages.registerWorkspaceSymbolProvider(t),t]}};Oo.WorkspaceSymbolFeature=jd});var fv=x(Lo=>{"use strict";Object.defineProperty(Lo,"__esModule",{value:!0});Lo.ReferencesFeature=void 0;var dR=require("vscode"),Ud=ie(),Wd=we(),lR=Ve(),Hd=class extends Wd.TextDocumentLanguageFeature{constructor(e){super(e,Ud.ReferencesRequest.type)}fillClientCapabilities(e){(0,Wd.ensure)((0,Wd.ensure)(e,"textDocument"),"references").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.referencesProvider);n&&this.register({id:lR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideReferences:(i,s,o,a)=>{let c=this._client,d=(m,g,S,y)=>c.sendRequest(Ud.ReferencesRequest.type,c.code2ProtocolConverter.asReferenceParams(m,g,S),y).then(P=>y.isCancellationRequested?null:c.protocol2CodeConverter.asReferences(P,y),P=>c.handleFailedRequest(Ud.ReferencesRequest.type,y,P,null)),p=c.middleware;return p.provideReferences?p.provideReferences(i,s,o,a,d):d(i,s,o,a)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return dR.languages.registerReferenceProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Lo.ReferencesFeature=Hd});var hv=x(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.CodeActionFeature=void 0;var fR=require("vscode"),on=ie(),hR=Ve(),Kd=we(),Vd=class extends Kd.TextDocumentLanguageFeature{constructor(e){super(e,on.CodeActionRequest.type)}fillClientCapabilities(e){let t=(0,Kd.ensure)((0,Kd.ensure)(e,"textDocument"),"codeAction");t.dynamicRegistration=!0,t.isPreferredSupport=!0,t.disabledSupport=!0,t.dataSupport=!0,t.resolveSupport={properties:["edit"]},t.codeActionLiteralSupport={codeActionKind:{valueSet:[on.CodeActionKind.Empty,on.CodeActionKind.QuickFix,on.CodeActionKind.Refactor,on.CodeActionKind.RefactorExtract,on.CodeActionKind.RefactorInline,on.CodeActionKind.RefactorRewrite,on.CodeActionKind.Source,on.CodeActionKind.SourceOrganizeImports]}},t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.codeActionProvider);n&&this.register({id:hR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideCodeActions:(i,s,o,a)=>{let c=this._client,d=async(m,g,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g),context:c.code2ProtocolConverter.asCodeActionContextSync(S)};return c.sendRequest(on.CodeActionRequest.type,P,y).then(k=>y.isCancellationRequested||k===null||k===void 0?null:c.protocol2CodeConverter.asCodeActionResult(k,y),k=>c.handleFailedRequest(on.CodeActionRequest.type,y,k,null))},p=c.middleware;return p.provideCodeActions?p.provideCodeActions(i,s,o,a,d):d(i,s,o,a)},resolveCodeAction:e.resolveProvider?(i,s)=>{let o=this._client,a=this._client.middleware,c=async(d,p)=>o.sendRequest(on.CodeActionResolveRequest.type,o.code2ProtocolConverter.asCodeActionSync(d),p).then(m=>p.isCancellationRequested?d:o.protocol2CodeConverter.asCodeAction(m,p),m=>o.handleFailedRequest(on.CodeActionResolveRequest.type,p,m,d));return a.resolveCodeAction?a.resolveCodeAction(i,s,c):c(i,s)}:void 0};return[fR.languages.registerCodeActionsProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.codeActionKinds?{providedCodeActionKinds:this._client.protocol2CodeConverter.asCodeActionKinds(e.codeActionKinds)}:void 0),n]}};Mo.CodeActionFeature=Vd});var gv=x(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.CodeLensFeature=void 0;var pv=require("vscode"),Si=ie(),pR=Ve(),ts=we(),zd=class extends ts.TextDocumentLanguageFeature{constructor(e){super(e,Si.CodeLensRequest.type)}fillClientCapabilities(e){(0,ts.ensure)((0,ts.ensure)(e,"textDocument"),"codeLens").dynamicRegistration=!0,(0,ts.ensure)((0,ts.ensure)(e,"workspace"),"codeLens").refreshSupport=!0}initialize(e,t){this._client.onRequest(Si.CodeLensRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeCodeLensEmitter.fire()});let i=this.getRegistrationOptions(t,e.codeLensProvider);i&&this.register({id:pR.generateUuid(),registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new pv.EventEmitter,i={onDidChangeCodeLenses:n.event,provideCodeLenses:(s,o)=>{let a=this._client,c=(p,m)=>a.sendRequest(Si.CodeLensRequest.type,a.code2ProtocolConverter.asCodeLensParams(p),m).then(g=>m.isCancellationRequested?null:a.protocol2CodeConverter.asCodeLenses(g,m),g=>a.handleFailedRequest(Si.CodeLensRequest.type,m,g,null)),d=a.middleware;return d.provideCodeLenses?d.provideCodeLenses(s,o,c):c(s,o)},resolveCodeLens:e.resolveProvider?(s,o)=>{let a=this._client,c=(p,m)=>a.sendRequest(Si.CodeLensResolveRequest.type,a.code2ProtocolConverter.asCodeLens(p),m).then(g=>m.isCancellationRequested?p:a.protocol2CodeConverter.asCodeLens(g),g=>a.handleFailedRequest(Si.CodeLensResolveRequest.type,m,g,p)),d=a.middleware;return d.resolveCodeLens?d.resolveCodeLens(s,o,c):c(s,o)}:void 0};return[pv.languages.registerCodeLensProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeCodeLensEmitter:n}]}};No.CodeLensFeature=zd});var mv=x(Tr=>{"use strict";Object.defineProperty(Tr,"__esModule",{value:!0});Tr.DocumentOnTypeFormattingFeature=Tr.DocumentRangeFormattingFeature=Tr.DocumentFormattingFeature=void 0;var Ao=require("vscode"),xn=ie(),Qd=Ve(),ir=we(),Di;(function(r){function e(t){let n=Ao.workspace.getConfiguration("files",t);return{trimTrailingWhitespace:n.get("trimTrailingWhitespace"),trimFinalNewlines:n.get("trimFinalNewlines"),insertFinalNewline:n.get("insertFinalNewline")}}r.fromConfiguration=e})(Di||(Di={}));var Bd=class extends ir.TextDocumentLanguageFeature{constructor(e){super(e,xn.DocumentFormattingRequest.type)}fillClientCapabilities(e){(0,ir.ensure)((0,ir.ensure)(e,"textDocument"),"formatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentFormattingProvider);n&&this.register({id:Qd.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentFormattingEdits:(i,s,o)=>{let a=this._client,c=(p,m,g)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),options:a.code2ProtocolConverter.asFormattingOptions(m,Di.fromConfiguration(p))};return a.sendRequest(xn.DocumentFormattingRequest.type,S,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asTextEdits(y,g),y=>a.handleFailedRequest(xn.DocumentFormattingRequest.type,g,y,null))},d=a.middleware;return d.provideDocumentFormattingEdits?d.provideDocumentFormattingEdits(i,s,o,c):c(i,s,o)}};return[Ao.languages.registerDocumentFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Tr.DocumentFormattingFeature=Bd;var Gd=class extends ir.TextDocumentLanguageFeature{constructor(e){super(e,xn.DocumentRangeFormattingRequest.type)}fillClientCapabilities(e){let t=(0,ir.ensure)((0,ir.ensure)(e,"textDocument"),"rangeFormatting");t.dynamicRegistration=!0,t.rangesSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentRangeFormattingProvider);n&&this.register({id:Qd.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentRangeFormattingEdits:(i,s,o,a)=>{let c=this._client,d=(m,g,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g),options:c.code2ProtocolConverter.asFormattingOptions(S,Di.fromConfiguration(m))};return c.sendRequest(xn.DocumentRangeFormattingRequest.type,P,y).then(k=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(k,y),k=>c.handleFailedRequest(xn.DocumentRangeFormattingRequest.type,y,k,null))},p=c.middleware;return p.provideDocumentRangeFormattingEdits?p.provideDocumentRangeFormattingEdits(i,s,o,a,d):d(i,s,o,a)}};return e.rangesSupport&&(n.provideDocumentRangesFormattingEdits=(i,s,o,a)=>{let c=this._client,d=(m,g,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),ranges:c.code2ProtocolConverter.asRanges(g),options:c.code2ProtocolConverter.asFormattingOptions(S,Di.fromConfiguration(m))};return c.sendRequest(xn.DocumentRangesFormattingRequest.type,P,y).then(k=>y.isCancellationRequested?null:c.protocol2CodeConverter.asTextEdits(k,y),k=>c.handleFailedRequest(xn.DocumentRangesFormattingRequest.type,y,k,null))},p=c.middleware;return p.provideDocumentRangesFormattingEdits?p.provideDocumentRangesFormattingEdits(i,s,o,a,d):d(i,s,o,a)}),[Ao.languages.registerDocumentRangeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Tr.DocumentRangeFormattingFeature=Gd;var Xd=class extends ir.TextDocumentLanguageFeature{constructor(e){super(e,xn.DocumentOnTypeFormattingRequest.type)}fillClientCapabilities(e){(0,ir.ensure)((0,ir.ensure)(e,"textDocument"),"onTypeFormatting").dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentOnTypeFormattingProvider);n&&this.register({id:Qd.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideOnTypeFormattingEdits:(s,o,a,c,d)=>{let p=this._client,m=(S,y,P,k,L)=>{let M={textDocument:p.code2ProtocolConverter.asTextDocumentIdentifier(S),position:p.code2ProtocolConverter.asPosition(y),ch:P,options:p.code2ProtocolConverter.asFormattingOptions(k,Di.fromConfiguration(S))};return p.sendRequest(xn.DocumentOnTypeFormattingRequest.type,M,L).then(A=>L.isCancellationRequested?null:p.protocol2CodeConverter.asTextEdits(A,L),A=>p.handleFailedRequest(xn.DocumentOnTypeFormattingRequest.type,L,A,null))},g=p.middleware;return g.provideOnTypeFormattingEdits?g.provideOnTypeFormattingEdits(s,o,a,c,d,m):m(s,o,a,c,d)}},i=e.moreTriggerCharacter||[];return[Ao.languages.registerOnTypeFormattingEditProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n,e.firstTriggerCharacter,...i),n]}};Tr.DocumentOnTypeFormattingFeature=Xd});var yv=x($o=>{"use strict";Object.defineProperty($o,"__esModule",{value:!0});$o.RenameFeature=void 0;var gR=require("vscode"),Wr=ie(),mR=Ve(),vv=hn(),Jd=we(),Yd=class extends Jd.TextDocumentLanguageFeature{constructor(e){super(e,Wr.RenameRequest.type)}fillClientCapabilities(e){let t=(0,Jd.ensure)((0,Jd.ensure)(e,"textDocument"),"rename");t.dynamicRegistration=!0,t.prepareSupport=!0,t.prepareSupportDefaultBehavior=Wr.PrepareSupportDefaultBehavior.Identifier,t.honorsChangeAnnotations=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.renameProvider);n&&(vv.boolean(e.renameProvider)&&(n.prepareProvider=!1),this.register({id:mR.generateUuid(),registerOptions:n}))}registerLanguageProvider(e){let t=e.documentSelector,n={provideRenameEdits:(i,s,o,a)=>{let c=this._client,d=(m,g,S,y)=>{let P={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),position:c.code2ProtocolConverter.asPosition(g),newName:S};return c.sendRequest(Wr.RenameRequest.type,P,y).then(k=>y.isCancellationRequested?null:c.protocol2CodeConverter.asWorkspaceEdit(k,y),k=>c.handleFailedRequest(Wr.RenameRequest.type,y,k,null,!1))},p=c.middleware;return p.provideRenameEdits?p.provideRenameEdits(i,s,o,a,d):d(i,s,o,a)},prepareRename:e.prepareProvider?(i,s,o)=>{let a=this._client,c=(p,m,g)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),position:a.code2ProtocolConverter.asPosition(m)};return a.sendRequest(Wr.PrepareRenameRequest.type,S,g).then(y=>g.isCancellationRequested?null:Wr.Range.is(y)?a.protocol2CodeConverter.asRange(y):this.isDefaultBehavior(y)?y.defaultBehavior===!0?null:Promise.reject(new Error("The element can't be renamed.")):y&&Wr.Range.is(y.range)?{range:a.protocol2CodeConverter.asRange(y.range),placeholder:y.placeholder}:Promise.reject(new Error("The element can't be renamed.")),y=>{throw typeof y.message=="string"?new Error(y.message):new Error("The element can't be renamed.")})},d=a.middleware;return d.prepareRename?d.prepareRename(i,s,o,c):c(i,s,o)}:void 0};return[this.registerProvider(t,n),n]}registerProvider(e,t){return gR.languages.registerRenameProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}isDefaultBehavior(e){let t=e;return t&&vv.boolean(t.defaultBehavior)}};$o.RenameFeature=Yd});var bv=x(jo=>{"use strict";Object.defineProperty(jo,"__esModule",{value:!0});jo.DocumentLinkFeature=void 0;var vR=require("vscode"),ns=ie(),Zd=we(),yR=Ve(),el=class extends Zd.TextDocumentLanguageFeature{constructor(e){super(e,ns.DocumentLinkRequest.type)}fillClientCapabilities(e){let t=(0,Zd.ensure)((0,Zd.ensure)(e,"textDocument"),"documentLink");t.dynamicRegistration=!0,t.tooltipSupport=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.documentLinkProvider);n&&this.register({id:yR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDocumentLinks:(i,s)=>{let o=this._client,a=(d,p)=>o.sendRequest(ns.DocumentLinkRequest.type,o.code2ProtocolConverter.asDocumentLinkParams(d),p).then(m=>p.isCancellationRequested?null:o.protocol2CodeConverter.asDocumentLinks(m,p),m=>o.handleFailedRequest(ns.DocumentLinkRequest.type,p,m,null)),c=o.middleware;return c.provideDocumentLinks?c.provideDocumentLinks(i,s,a):a(i,s)},resolveDocumentLink:e.resolveProvider?(i,s)=>{let o=this._client,a=(d,p)=>o.sendRequest(ns.DocumentLinkResolveRequest.type,o.code2ProtocolConverter.asDocumentLink(d),p).then(m=>p.isCancellationRequested?d:o.protocol2CodeConverter.asDocumentLink(m),m=>o.handleFailedRequest(ns.DocumentLinkResolveRequest.type,p,m,d)),c=o.middleware;return c.resolveDocumentLink?c.resolveDocumentLink(i,s,a):a(i,s)}:void 0};return[vR.languages.registerDocumentLinkProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};jo.DocumentLinkFeature=el});var Cv=x(Uo=>{"use strict";Object.defineProperty(Uo,"__esModule",{value:!0});Uo.ExecuteCommandFeature=void 0;var bR=require("vscode"),tl=ie(),wR=Ve(),wv=we(),nl=class{constructor(e){this._client=e,this._commands=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._commands.size>0}}get registrationType(){return tl.ExecuteCommandRequest.type}fillClientCapabilities(e){(0,wv.ensure)((0,wv.ensure)(e,"workspace"),"executeCommand").dynamicRegistration=!0}initialize(e){e.executeCommandProvider&&this.register({id:wR.generateUuid(),registerOptions:Object.assign({},e.executeCommandProvider)})}register(e){let t=this._client,n=t.middleware,i=(s,o)=>{let a={command:s,arguments:o};return t.sendRequest(tl.ExecuteCommandRequest.type,a).then(void 0,c=>t.handleFailedRequest(tl.ExecuteCommandRequest.type,void 0,c,void 0))};if(e.registerOptions.commands){let s=[];for(let o of e.registerOptions.commands)s.push(bR.commands.registerCommand(o,(...a)=>n.executeCommand?n.executeCommand(o,a,i):i(o,a)));this._commands.set(e.id,s)}}unregister(e){let t=this._commands.get(e);t&&t.forEach(n=>n.dispose())}clear(){this._commands.forEach(e=>{e.forEach(t=>t.dispose())}),this._commands.clear()}};Uo.ExecuteCommandFeature=nl});var Rv=x(Ho=>{"use strict";Object.defineProperty(Ho,"__esModule",{value:!0});Ho.FileSystemWatcherFeature=void 0;var CR=require("vscode"),Hr=ie(),Wo=we(),rl=class{constructor(e,t){this._client=e,this._notifyFileEvent=t,this._watchers=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._watchers.size>0}}get registrationType(){return Hr.DidChangeWatchedFilesNotification.type}fillClientCapabilities(e){(0,Wo.ensure)((0,Wo.ensure)(e,"workspace"),"didChangeWatchedFiles").dynamicRegistration=!0,(0,Wo.ensure)((0,Wo.ensure)(e,"workspace"),"didChangeWatchedFiles").relativePatternSupport=!0}initialize(e,t){}register(e){if(!Array.isArray(e.registerOptions.watchers))return;let t=[];for(let n of e.registerOptions.watchers){let i=this._client.protocol2CodeConverter.asGlobPattern(n.globPattern);if(i===void 0)continue;let s=!0,o=!0,a=!0;n.kind!==void 0&&n.kind!==null&&(s=(n.kind&Hr.WatchKind.Create)!==0,o=(n.kind&Hr.WatchKind.Change)!==0,a=(n.kind&Hr.WatchKind.Delete)!==0);let c=CR.workspace.createFileSystemWatcher(i,!s,!o,!a);this.hookListeners(c,s,o,a,t),t.push(c)}this._watchers.set(e.id,t)}registerRaw(e,t){let n=[];for(let i of t)this.hookListeners(i,!0,!0,!0,n);this._watchers.set(e,n)}hookListeners(e,t,n,i,s){t&&e.onDidCreate(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Hr.FileChangeType.Created}),null,s),n&&e.onDidChange(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Hr.FileChangeType.Changed}),null,s),i&&e.onDidDelete(o=>this._notifyFileEvent({uri:this._client.code2ProtocolConverter.asUri(o),type:Hr.FileChangeType.Deleted}),null,s)}unregister(e){let t=this._watchers.get(e);if(t)for(let n of t)n.dispose()}clear(){this._watchers.forEach(e=>{for(let t of e)t.dispose()}),this._watchers.clear()}};Ho.FileSystemWatcherFeature=rl});var Sv=x(Ko=>{"use strict";Object.defineProperty(Ko,"__esModule",{value:!0});Ko.ColorProviderFeature=void 0;var RR=require("vscode"),rs=ie(),il=we(),sl=class extends il.TextDocumentLanguageFeature{constructor(e){super(e,rs.DocumentColorRequest.type)}fillClientCapabilities(e){(0,il.ensure)((0,il.ensure)(e,"textDocument"),"colorProvider").dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.colorProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideColorPresentations:(i,s,o)=>{let a=this._client,c=(p,m,g)=>{let S={color:p,textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(m.document),range:a.code2ProtocolConverter.asRange(m.range)};return a.sendRequest(rs.ColorPresentationRequest.type,S,g).then(y=>g.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorPresentations(y,g),y=>a.handleFailedRequest(rs.ColorPresentationRequest.type,g,y,null))},d=a.middleware;return d.provideColorPresentations?d.provideColorPresentations(i,s,o,c):c(i,s,o)},provideDocumentColors:(i,s)=>{let o=this._client,a=(d,p)=>{let m={textDocument:o.code2ProtocolConverter.asTextDocumentIdentifier(d)};return o.sendRequest(rs.DocumentColorRequest.type,m,p).then(g=>p.isCancellationRequested?null:this._client.protocol2CodeConverter.asColorInformations(g,p),g=>o.handleFailedRequest(rs.DocumentColorRequest.type,p,g,null))},c=o.middleware;return c.provideDocumentColors?c.provideDocumentColors(i,s,a):a(i,s)}};return[RR.languages.registerColorProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};Ko.ColorProviderFeature=sl});var Dv=x(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.ImplementationFeature=void 0;var SR=require("vscode"),ol=ie(),al=we(),cl=class extends al.TextDocumentLanguageFeature{constructor(e){super(e,ol.ImplementationRequest.type)}fillClientCapabilities(e){let t=(0,al.ensure)((0,al.ensure)(e,"textDocument"),"implementation");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.implementationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideImplementation:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(ol.ImplementationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,g),S=>a.handleFailedRequest(ol.ImplementationRequest.type,g,S,null)),d=a.middleware;return d.provideImplementation?d.provideImplementation(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return SR.languages.registerImplementationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Vo.ImplementationFeature=cl});var _v=x(zo=>{"use strict";Object.defineProperty(zo,"__esModule",{value:!0});zo.TypeDefinitionFeature=void 0;var DR=require("vscode"),ul=ie(),is=we(),dl=class extends is.TextDocumentLanguageFeature{constructor(e){super(e,ul.TypeDefinitionRequest.type)}fillClientCapabilities(e){(0,is.ensure)((0,is.ensure)(e,"textDocument"),"typeDefinition").dynamicRegistration=!0;let t=(0,is.ensure)((0,is.ensure)(e,"textDocument"),"typeDefinition");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeDefinitionProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideTypeDefinition:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(ul.TypeDefinitionRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDefinitionResult(S,g),S=>a.handleFailedRequest(ul.TypeDefinitionRequest.type,g,S,null)),d=a.middleware;return d.provideTypeDefinition?d.provideTypeDefinition(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return DR.languages.registerTypeDefinitionProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};zo.TypeDefinitionFeature=dl});var Tv=x(_i=>{"use strict";Object.defineProperty(_i,"__esModule",{value:!0});_i.WorkspaceFoldersFeature=_i.arrayDiff=void 0;var _R=Ve(),Bo=require("vscode"),ss=ie();function ll(r,e){if(r!=null)return r[e]}function fl(r,e){return r.filter(t=>e.indexOf(t)<0)}_i.arrayDiff=fl;var hl=class{constructor(e){this._client=e,this._listeners=new Map}getState(){return{kind:"workspace",id:this.registrationType.method,registrations:this._listeners.size>0}}get registrationType(){return ss.DidChangeWorkspaceFoldersNotification.type}fillInitializeParams(e){let t=Bo.workspace.workspaceFolders;this.initializeWithFolders(t),t===void 0?e.workspaceFolders=null:e.workspaceFolders=t.map(n=>this.asProtocol(n))}initializeWithFolders(e){this._initialFolders=e}fillClientCapabilities(e){e.workspace=e.workspace||{},e.workspace.workspaceFolders=!0}initialize(e){let t=this._client;t.onRequest(ss.WorkspaceFoldersRequest.type,s=>{let o=()=>{let c=Bo.workspace.workspaceFolders;return c===void 0?null:c.map(p=>this.asProtocol(p))},a=t.middleware.workspace;return a&&a.workspaceFolders?a.workspaceFolders(s,o):o(s)});let n=ll(ll(ll(e,"workspace"),"workspaceFolders"),"changeNotifications"),i;typeof n=="string"?i=n:n===!0&&(i=_R.generateUuid()),i&&this.register({id:i,registerOptions:void 0})}sendInitialEvent(e){let t;if(this._initialFolders&&e){let n=fl(this._initialFolders,e),i=fl(e,this._initialFolders);(i.length>0||n.length>0)&&(t=this.doSendEvent(i,n))}else this._initialFolders?t=this.doSendEvent([],this._initialFolders):e&&(t=this.doSendEvent(e,[]));t!==void 0&&t.catch(n=>{this._client.error(`Sending notification ${ss.DidChangeWorkspaceFoldersNotification.type.method} failed`,n)})}doSendEvent(e,t){let n={event:{added:e.map(i=>this.asProtocol(i)),removed:t.map(i=>this.asProtocol(i))}};return this._client.sendNotification(ss.DidChangeWorkspaceFoldersNotification.type,n)}register(e){let t=e.id,n=this._client,i=Bo.workspace.onDidChangeWorkspaceFolders(s=>{let o=d=>this.doSendEvent(d.added,d.removed),a=n.middleware.workspace;(a&&a.didChangeWorkspaceFolders?a.didChangeWorkspaceFolders(s,o):o(s)).catch(d=>{this._client.error(`Sending notification ${ss.DidChangeWorkspaceFoldersNotification.type.method} failed`,d)})});this._listeners.set(t,i),this.sendInitialEvent(Bo.workspace.workspaceFolders)}unregister(e){let t=this._listeners.get(e);t!==void 0&&(this._listeners.delete(e),t.dispose())}clear(){for(let e of this._listeners.values())e.dispose();this._listeners.clear()}asProtocol(e){return e===void 0?null:{uri:this._client.code2ProtocolConverter.asUri(e.uri),name:e.name}}};_i.WorkspaceFoldersFeature=hl});var kv=x(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.FoldingRangeFeature=void 0;var Pv=require("vscode"),Kr=ie(),os=we(),pl=class extends os.TextDocumentLanguageFeature{constructor(e){super(e,Kr.FoldingRangeRequest.type)}fillClientCapabilities(e){let t=(0,os.ensure)((0,os.ensure)(e,"textDocument"),"foldingRange");t.dynamicRegistration=!0,t.rangeLimit=5e3,t.lineFoldingOnly=!0,t.foldingRangeKind={valueSet:[Kr.FoldingRangeKind.Comment,Kr.FoldingRangeKind.Imports,Kr.FoldingRangeKind.Region]},t.foldingRange={collapsedText:!1},(0,os.ensure)((0,os.ensure)(e,"workspace"),"foldingRange").refreshSupport=!0}initialize(e,t){this._client.onRequest(Kr.FoldingRangeRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeFoldingRange.fire()});let[n,i]=this.getRegistration(t,e.foldingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Pv.EventEmitter,i={onDidChangeFoldingRanges:n.event,provideFoldingRanges:(s,o,a)=>{let c=this._client,d=(m,g,S)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m)};return c.sendRequest(Kr.FoldingRangeRequest.type,y,S).then(P=>S.isCancellationRequested?null:c.protocol2CodeConverter.asFoldingRanges(P,S),P=>c.handleFailedRequest(Kr.FoldingRangeRequest.type,S,P,null))},p=c.middleware;return p.provideFoldingRanges?p.provideFoldingRanges(s,o,a,d):d(s,o,a)}};return[Pv.languages.registerFoldingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),i),{provider:i,onDidChangeFoldingRange:n}]}};Go.FoldingRangeFeature=pl});var Ev=x(Xo=>{"use strict";Object.defineProperty(Xo,"__esModule",{value:!0});Xo.DeclarationFeature=void 0;var TR=require("vscode"),gl=ie(),ml=we(),vl=class extends ml.TextDocumentLanguageFeature{constructor(e){super(e,gl.DeclarationRequest.type)}fillClientCapabilities(e){let t=(0,ml.ensure)((0,ml.ensure)(e,"textDocument"),"declaration");t.dynamicRegistration=!0,t.linkSupport=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.declarationProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideDeclaration:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(gl.DeclarationRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asDeclarationResult(S,g),S=>a.handleFailedRequest(gl.DeclarationRequest.type,g,S,null)),d=a.middleware;return d.provideDeclaration?d.provideDeclaration(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return TR.languages.registerDeclarationProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Xo.DeclarationFeature=vl});var xv=x(Qo=>{"use strict";Object.defineProperty(Qo,"__esModule",{value:!0});Qo.SelectionRangeFeature=void 0;var PR=require("vscode"),yl=ie(),bl=we(),wl=class extends bl.TextDocumentLanguageFeature{constructor(e){super(e,yl.SelectionRangeRequest.type)}fillClientCapabilities(e){let t=(0,bl.ensure)((0,bl.ensure)(e,"textDocument"),"selectionRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.selectionRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideSelectionRanges:(i,s,o)=>{let a=this._client,c=async(p,m,g)=>{let S={textDocument:a.code2ProtocolConverter.asTextDocumentIdentifier(p),positions:a.code2ProtocolConverter.asPositionsSync(m,g)};return a.sendRequest(yl.SelectionRangeRequest.type,S,g).then(y=>g.isCancellationRequested?null:a.protocol2CodeConverter.asSelectionRanges(y,g),y=>a.handleFailedRequest(yl.SelectionRangeRequest.type,g,y,null))},d=a.middleware;return d.provideSelectionRanges?d.provideSelectionRanges(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return PR.languages.registerSelectionRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};Qo.SelectionRangeFeature=wl});var qv=x(Jo=>{"use strict";Object.defineProperty(Jo,"__esModule",{value:!0});Jo.ProgressFeature=void 0;var Iv=ie(),kR=Bu();function ER(r,e){return r[e]===void 0&&(r[e]=Object.create(null)),r[e]}var Cl=class{constructor(e){this._client=e,this.activeParts=new Set}getState(){return{kind:"window",id:Iv.WorkDoneProgressCreateRequest.method,registrations:this.activeParts.size>0}}fillClientCapabilities(e){ER(e,"window").workDoneProgress=!0}initialize(){let e=this._client,t=i=>{this.activeParts.delete(i)},n=i=>{this.activeParts.add(new kR.ProgressPart(this._client,i.token,t))};e.onRequest(Iv.WorkDoneProgressCreateRequest.type,n)}clear(){for(let e of this.activeParts)e.done();this.activeParts.clear()}};Jo.ProgressFeature=Cl});var Fv=x(Yo=>{"use strict";Object.defineProperty(Yo,"__esModule",{value:!0});Yo.CallHierarchyFeature=void 0;var xR=require("vscode"),Vr=ie(),Rl=we(),Sl=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareCallHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let p=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(Vr.CallHierarchyPrepareRequest.type,p,d).then(m=>d.isCancellationRequested?null:i.protocol2CodeConverter.asCallHierarchyItems(m,d),m=>i.handleFailedRequest(Vr.CallHierarchyPrepareRequest.type,d,m,null))};return s.prepareCallHierarchy?s.prepareCallHierarchy(e,t,n,o):o(e,t,n)}provideCallHierarchyIncomingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(Vr.CallHierarchyIncomingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyIncomingCalls(d,a),d=>n.handleFailedRequest(Vr.CallHierarchyIncomingCallsRequest.type,a,d,null))};return i.provideCallHierarchyIncomingCalls?i.provideCallHierarchyIncomingCalls(e,t,s):s(e,t)}provideCallHierarchyOutgoingCalls(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asCallHierarchyItem(o)};return n.sendRequest(Vr.CallHierarchyOutgoingCallsRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asCallHierarchyOutgoingCalls(d,a),d=>n.handleFailedRequest(Vr.CallHierarchyOutgoingCallsRequest.type,a,d,null))};return i.provideCallHierarchyOutgoingCalls?i.provideCallHierarchyOutgoingCalls(e,t,s):s(e,t)}},Dl=class extends Rl.TextDocumentLanguageFeature{constructor(e){super(e,Vr.CallHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=e,n=(0,Rl.ensure)((0,Rl.ensure)(t,"textDocument"),"callHierarchy");n.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.callHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Sl(t);return[xR.languages.registerCallHierarchyProvider(this._client.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};Yo.CallHierarchyFeature=Dl});var Ov=x(ea=>{"use strict";Object.defineProperty(ea,"__esModule",{value:!0});ea.SemanticTokensFeature=void 0;var Zo=require("vscode"),ae=ie(),as=we(),IR=hn(),_l=class extends as.TextDocumentLanguageFeature{constructor(e){super(e,ae.SemanticTokensRegistrationType.type)}fillClientCapabilities(e){let t=(0,as.ensure)((0,as.ensure)(e,"textDocument"),"semanticTokens");t.dynamicRegistration=!0,t.tokenTypes=[ae.SemanticTokenTypes.namespace,ae.SemanticTokenTypes.type,ae.SemanticTokenTypes.class,ae.SemanticTokenTypes.enum,ae.SemanticTokenTypes.interface,ae.SemanticTokenTypes.struct,ae.SemanticTokenTypes.typeParameter,ae.SemanticTokenTypes.parameter,ae.SemanticTokenTypes.variable,ae.SemanticTokenTypes.property,ae.SemanticTokenTypes.enumMember,ae.SemanticTokenTypes.event,ae.SemanticTokenTypes.function,ae.SemanticTokenTypes.method,ae.SemanticTokenTypes.macro,ae.SemanticTokenTypes.keyword,ae.SemanticTokenTypes.modifier,ae.SemanticTokenTypes.comment,ae.SemanticTokenTypes.string,ae.SemanticTokenTypes.number,ae.SemanticTokenTypes.regexp,ae.SemanticTokenTypes.operator,ae.SemanticTokenTypes.decorator],t.tokenModifiers=[ae.SemanticTokenModifiers.declaration,ae.SemanticTokenModifiers.definition,ae.SemanticTokenModifiers.readonly,ae.SemanticTokenModifiers.static,ae.SemanticTokenModifiers.deprecated,ae.SemanticTokenModifiers.abstract,ae.SemanticTokenModifiers.async,ae.SemanticTokenModifiers.modification,ae.SemanticTokenModifiers.documentation,ae.SemanticTokenModifiers.defaultLibrary],t.formats=[ae.TokenFormat.Relative],t.requests={range:!0,full:{delta:!0}},t.multilineTokenSupport=!1,t.overlappingTokenSupport=!1,t.serverCancelSupport=!0,t.augmentsSyntaxTokens=!0,(0,as.ensure)((0,as.ensure)(e,"workspace"),"semanticTokens").refreshSupport=!0}initialize(e,t){this._client.onRequest(ae.SemanticTokensRefreshRequest.type,async()=>{for(let o of this.getAllProviders())o.onDidChangeSemanticTokensEmitter.fire()});let[i,s]=this.getRegistration(t,e.semanticTokensProvider);!i||!s||this.register({id:i,registerOptions:s})}registerLanguageProvider(e){let t=e.documentSelector,n=IR.boolean(e.full)?e.full:e.full!==void 0,i=e.full!==void 0&&typeof e.full!="boolean"&&e.full.delta===!0,s=new Zo.EventEmitter,o=n?{onDidChangeSemanticTokens:s.event,provideDocumentSemanticTokens:(S,y)=>{let P=this._client,k=P.middleware,L=(M,A)=>{let W={textDocument:P.code2ProtocolConverter.asTextDocumentIdentifier(M)};return P.sendRequest(ae.SemanticTokensRequest.type,W,A).then(J=>A.isCancellationRequested?null:P.protocol2CodeConverter.asSemanticTokens(J,A),J=>P.handleFailedRequest(ae.SemanticTokensRequest.type,A,J,null))};return k.provideDocumentSemanticTokens?k.provideDocumentSemanticTokens(S,y,L):L(S,y)},provideDocumentSemanticTokensEdits:i?(S,y,P)=>{let k=this._client,L=k.middleware,M=(A,W,J)=>{let pe={textDocument:k.code2ProtocolConverter.asTextDocumentIdentifier(A),previousResultId:W};return k.sendRequest(ae.SemanticTokensDeltaRequest.type,pe,J).then(async G=>J.isCancellationRequested?null:ae.SemanticTokens.is(G)?await k.protocol2CodeConverter.asSemanticTokens(G,J):await k.protocol2CodeConverter.asSemanticTokensEdits(G,J),G=>k.handleFailedRequest(ae.SemanticTokensDeltaRequest.type,J,G,null))};return L.provideDocumentSemanticTokensEdits?L.provideDocumentSemanticTokensEdits(S,y,P,M):M(S,y,P)}:void 0}:void 0,c=e.range===!0?{provideDocumentRangeSemanticTokens:(S,y,P)=>{let k=this._client,L=k.middleware,M=(A,W,J)=>{let pe={textDocument:k.code2ProtocolConverter.asTextDocumentIdentifier(A),range:k.code2ProtocolConverter.asRange(W)};return k.sendRequest(ae.SemanticTokensRangeRequest.type,pe,J).then(G=>J.isCancellationRequested?null:k.protocol2CodeConverter.asSemanticTokens(G,J),G=>k.handleFailedRequest(ae.SemanticTokensRangeRequest.type,J,G,null))};return L.provideDocumentRangeSemanticTokens?L.provideDocumentRangeSemanticTokens(S,y,P,M):M(S,y,P)}}:void 0,d=[],p=this._client,m=p.protocol2CodeConverter.asSemanticTokensLegend(e.legend),g=p.protocol2CodeConverter.asDocumentSelector(t);return o!==void 0&&d.push(Zo.languages.registerDocumentSemanticTokensProvider(g,o,m)),c!==void 0&&d.push(Zo.languages.registerDocumentRangeSemanticTokensProvider(g,c,m)),[new Zo.Disposable(()=>d.forEach(S=>S.dispose())),{range:c,full:o,onDidChangeSemanticTokensEmitter:s}]}};ea.SemanticTokensFeature=_l});var Nv=x(Bt=>{"use strict";Object.defineProperty(Bt,"__esModule",{value:!0});Bt.WillDeleteFilesFeature=Bt.WillRenameFilesFeature=Bt.WillCreateFilesFeature=Bt.DidDeleteFilesFeature=Bt.DidRenameFilesFeature=Bt.DidCreateFilesFeature=void 0;var bn=require("vscode"),qR=Ro(),sr=ie(),FR=Ve();function Lv(r,e){return r[e]===void 0&&(r[e]={}),r[e]}function OR(r,e){return r[e]}function Mv(r,e,t){r[e]=t}var cs=class r{constructor(e,t,n,i,s){this._client=e,this._event=t,this._registrationType=n,this._clientCapability=i,this._serverCapability=s,this._filters=new Map}getState(){return{kind:"workspace",id:this._registrationType.method,registrations:this._filters.size>0}}filterSize(){return this._filters.size}get registrationType(){return this._registrationType}fillClientCapabilities(e){let t=Lv(Lv(e,"workspace"),"fileOperations");Mv(t,"dynamicRegistration",!0),Mv(t,this._clientCapability,!0)}initialize(e){let t=e.workspace?.fileOperations,n=t!==void 0?OR(t,this._serverCapability):void 0;if(n?.filters!==void 0)try{this.register({id:FR.generateUuid(),registerOptions:{filters:n.filters}})}catch(i){this._client.warn(`Ignoring invalid glob pattern for ${this._serverCapability} registration: ${i}`)}}register(e){this._listener||(this._listener=this._event(this.send,this));let t=e.registerOptions.filters.map(n=>{let i=new qR.Minimatch(n.pattern.glob,r.asMinimatchOptions(n.pattern.options));if(!i.makeRe())throw new Error(`Invalid pattern ${n.pattern.glob}!`);return{scheme:n.scheme,matcher:i,kind:n.pattern.matches}});this._filters.set(e.id,t)}unregister(e){this._filters.delete(e),this._filters.size===0&&this._listener&&(this._listener.dispose(),this._listener=void 0)}clear(){this._filters.clear(),this._listener&&(this._listener.dispose(),this._listener=void 0)}getFileType(e){return r.getFileType(e)}async filter(e,t){let n=await Promise.all(e.files.map(async s=>{let o=t(s),a=o.fsPath.replace(/\\/g,"/");for(let c of this._filters.values())for(let d of c)if(!(d.scheme!==void 0&&d.scheme!==o.scheme)){if(d.matcher.match(a)){if(d.kind===void 0)return!0;let p=await this.getFileType(o);if(p===void 0)return this._client.error(`Failed to determine file type for ${o.toString()}.`),!0;if(p===bn.FileType.File&&d.kind===sr.FileOperationPatternKind.file||p===bn.FileType.Directory&&d.kind===sr.FileOperationPatternKind.folder)return!0}else if(d.kind===sr.FileOperationPatternKind.folder&&await r.getFileType(o)===bn.FileType.Directory&&d.matcher.match(`${a}/`))return!0}return!1})),i=e.files.filter((s,o)=>n[o]);return{...e,files:i}}static async getFileType(e){try{return(await bn.workspace.fs.stat(e)).type}catch{return}}static asMinimatchOptions(e){let t={dot:!0};return e?.ignoreCase===!0&&(t.nocase=!0),t}},ta=class extends cs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._notificationType=n,this._accessUri=o,this._createParams=a}async send(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=async i=>this._client.sendNotification(this._notificationType,this._createParams(i));return this.doSend(t,n)}}},na=class extends ta{constructor(){super(...arguments),this._fsPathFileTypes=new Map}async getFileType(e){let t=e.fsPath;if(this._fsPathFileTypes.has(t))return this._fsPathFileTypes.get(t);let n=await cs.getFileType(e);return n&&this._fsPathFileTypes.set(t,n),n}async cacheFileTypes(e,t){await this.filter(e,t)}clearFileTypeCache(){this._fsPathFileTypes.clear()}unregister(e){super.unregister(e),this.filterSize()===0&&this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}clear(){super.clear(),this._willListener&&(this._willListener.dispose(),this._willListener=void 0)}},Tl=class extends ta{constructor(e){super(e,bn.workspace.onDidCreateFiles,sr.DidCreateFilesNotification.type,"didCreate","didCreate",t=>t,e.code2ProtocolConverter.asDidCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.didCreateFiles?n.didCreateFiles(e,t):t(e)}};Bt.DidCreateFilesFeature=Tl;var Pl=class extends na{constructor(e){super(e,bn.workspace.onDidRenameFiles,sr.DidRenameFilesNotification.type,"didRename","didRename",t=>t.oldUri,e.code2ProtocolConverter.asDidRenameFilesParams)}register(e){this._willListener||(this._willListener=bn.workspace.onWillRenameFiles(this.willRename,this)),super.register(e)}willRename(e){e.waitUntil(this.cacheFileTypes(e,t=>t.oldUri))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didRenameFiles?n.didRenameFiles(e,t):t(e)}};Bt.DidRenameFilesFeature=Pl;var kl=class extends na{constructor(e){super(e,bn.workspace.onDidDeleteFiles,sr.DidDeleteFilesNotification.type,"didDelete","didDelete",t=>t,e.code2ProtocolConverter.asDidDeleteFilesParams)}register(e){this._willListener||(this._willListener=bn.workspace.onWillDeleteFiles(this.willDelete,this)),super.register(e)}willDelete(e){e.waitUntil(this.cacheFileTypes(e,t=>t))}doSend(e,t){this.clearFileTypeCache();let n=this._client.middleware.workspace;return n?.didDeleteFiles?n.didDeleteFiles(e,t):t(e)}};Bt.DidDeleteFilesFeature=kl;var us=class extends cs{constructor(e,t,n,i,s,o,a){super(e,t,n,i,s),this._requestType=n,this._accessUri=o,this._createParams=a}async send(e){let t=this.waitUntil(e);e.waitUntil(t)}async waitUntil(e){let t=await this.filter(e,this._accessUri);if(t.files.length){let n=i=>this._client.sendRequest(this._requestType,this._createParams(i),i.token).then(this._client.protocol2CodeConverter.asWorkspaceEdit);return this.doSend(t,n)}else return}},El=class extends us{constructor(e){super(e,bn.workspace.onWillCreateFiles,sr.WillCreateFilesRequest.type,"willCreate","willCreate",t=>t,e.code2ProtocolConverter.asWillCreateFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willCreateFiles?n.willCreateFiles(e,t):t(e)}};Bt.WillCreateFilesFeature=El;var xl=class extends us{constructor(e){super(e,bn.workspace.onWillRenameFiles,sr.WillRenameFilesRequest.type,"willRename","willRename",t=>t.oldUri,e.code2ProtocolConverter.asWillRenameFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willRenameFiles?n.willRenameFiles(e,t):t(e)}};Bt.WillRenameFilesFeature=xl;var Il=class extends us{constructor(e){super(e,bn.workspace.onWillDeleteFiles,sr.WillDeleteFilesRequest.type,"willDelete","willDelete",t=>t,e.code2ProtocolConverter.asWillDeleteFilesParams)}doSend(e,t){let n=this._client.middleware.workspace;return n?.willDeleteFiles?n.willDeleteFiles(e,t):t(e)}};Bt.WillDeleteFilesFeature=Il});var Av=x(ra=>{"use strict";Object.defineProperty(ra,"__esModule",{value:!0});ra.LinkedEditingFeature=void 0;var LR=require("vscode"),ql=ie(),Fl=we(),Ol=class extends Fl.TextDocumentLanguageFeature{constructor(e){super(e,ql.LinkedEditingRangeRequest.type)}fillClientCapabilities(e){let t=(0,Fl.ensure)((0,Fl.ensure)(e,"textDocument"),"linkedEditingRange");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.linkedEditingRangeProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n={provideLinkedEditingRanges:(i,s,o)=>{let a=this._client,c=(p,m,g)=>a.sendRequest(ql.LinkedEditingRangeRequest.type,a.code2ProtocolConverter.asTextDocumentPositionParams(p,m),g).then(S=>g.isCancellationRequested?null:a.protocol2CodeConverter.asLinkedEditingRanges(S,g),S=>a.handleFailedRequest(ql.LinkedEditingRangeRequest.type,g,S,null)),d=a.middleware;return d.provideLinkedEditingRange?d.provideLinkedEditingRange(i,s,o,c):c(i,s,o)}};return[this.registerProvider(t,n),n]}registerProvider(e,t){return LR.languages.registerLinkedEditingRangeProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};ra.LinkedEditingFeature=Ol});var $v=x(ia=>{"use strict";Object.defineProperty(ia,"__esModule",{value:!0});ia.TypeHierarchyFeature=void 0;var MR=require("vscode"),zr=ie(),Ll=we(),Ml=class{constructor(e){this.client=e,this.middleware=e.middleware}prepareTypeHierarchy(e,t,n){let i=this.client,s=this.middleware,o=(a,c,d)=>{let p=i.code2ProtocolConverter.asTextDocumentPositionParams(a,c);return i.sendRequest(zr.TypeHierarchyPrepareRequest.type,p,d).then(m=>d.isCancellationRequested?null:i.protocol2CodeConverter.asTypeHierarchyItems(m,d),m=>i.handleFailedRequest(zr.TypeHierarchyPrepareRequest.type,d,m,null))};return s.prepareTypeHierarchy?s.prepareTypeHierarchy(e,t,n,o):o(e,t,n)}provideTypeHierarchySupertypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(zr.TypeHierarchySupertypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(zr.TypeHierarchySupertypesRequest.type,a,d,null))};return i.provideTypeHierarchySupertypes?i.provideTypeHierarchySupertypes(e,t,s):s(e,t)}provideTypeHierarchySubtypes(e,t){let n=this.client,i=this.middleware,s=(o,a)=>{let c={item:n.code2ProtocolConverter.asTypeHierarchyItem(o)};return n.sendRequest(zr.TypeHierarchySubtypesRequest.type,c,a).then(d=>a.isCancellationRequested?null:n.protocol2CodeConverter.asTypeHierarchyItems(d,a),d=>n.handleFailedRequest(zr.TypeHierarchySubtypesRequest.type,a,d,null))};return i.provideTypeHierarchySubtypes?i.provideTypeHierarchySubtypes(e,t,s):s(e,t)}},Nl=class extends Ll.TextDocumentLanguageFeature{constructor(e){super(e,zr.TypeHierarchyPrepareRequest.type)}fillClientCapabilities(e){let t=(0,Ll.ensure)((0,Ll.ensure)(e,"textDocument"),"typeHierarchy");t.dynamicRegistration=!0}initialize(e,t){let[n,i]=this.getRegistration(t,e.typeHierarchyProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=this._client,n=new Ml(t);return[MR.languages.registerTypeHierarchyProvider(t.protocol2CodeConverter.asDocumentSelector(e.documentSelector),n),n]}};ia.TypeHierarchyFeature=Nl});var Uv=x(oa=>{"use strict";Object.defineProperty(oa,"__esModule",{value:!0});oa.InlineValueFeature=void 0;var jv=require("vscode"),sa=ie(),ds=we(),Al=class extends ds.TextDocumentLanguageFeature{constructor(e){super(e,sa.InlineValueRequest.type)}fillClientCapabilities(e){(0,ds.ensure)((0,ds.ensure)(e,"textDocument"),"inlineValue").dynamicRegistration=!0,(0,ds.ensure)((0,ds.ensure)(e,"workspace"),"inlineValue").refreshSupport=!0}initialize(e,t){this._client.onRequest(sa.InlineValueRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlineValues.fire()});let[n,i]=this.getRegistration(t,e.inlineValueProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new jv.EventEmitter,i={onDidChangeInlineValues:n.event,provideInlineValues:(s,o,a,c)=>{let d=this._client,p=(g,S,y,P)=>{let k={textDocument:d.code2ProtocolConverter.asTextDocumentIdentifier(g),range:d.code2ProtocolConverter.asRange(S),context:d.code2ProtocolConverter.asInlineValueContext(y)};return d.sendRequest(sa.InlineValueRequest.type,k,P).then(L=>P.isCancellationRequested?null:d.protocol2CodeConverter.asInlineValues(L,P),L=>d.handleFailedRequest(sa.InlineValueRequest.type,P,L,null))},m=d.middleware;return m.provideInlineValues?m.provideInlineValues(s,o,a,c,p):p(s,o,a,c)}};return[this.registerProvider(t,i),{provider:i,onDidChangeInlineValues:n}]}registerProvider(e,t){return jv.languages.registerInlineValuesProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};oa.InlineValueFeature=Al});var Hv=x(aa=>{"use strict";Object.defineProperty(aa,"__esModule",{value:!0});aa.InlayHintsFeature=void 0;var Wv=require("vscode"),Ti=ie(),ls=we(),$l=class extends ls.TextDocumentLanguageFeature{constructor(e){super(e,Ti.InlayHintRequest.type)}fillClientCapabilities(e){let t=(0,ls.ensure)((0,ls.ensure)(e,"textDocument"),"inlayHint");t.dynamicRegistration=!0,t.resolveSupport={properties:["tooltip","textEdits","label.tooltip","label.location","label.command"]},(0,ls.ensure)((0,ls.ensure)(e,"workspace"),"inlayHint").refreshSupport=!0}initialize(e,t){this._client.onRequest(Ti.InlayHintRefreshRequest.type,async()=>{for(let s of this.getAllProviders())s.onDidChangeInlayHints.fire()});let[n,i]=this.getRegistration(t,e.inlayHintProvider);!n||!i||this.register({id:n,registerOptions:i})}registerLanguageProvider(e){let t=e.documentSelector,n=new Wv.EventEmitter,i={onDidChangeInlayHints:n.event,provideInlayHints:(s,o,a)=>{let c=this._client,d=async(m,g,S)=>{let y={textDocument:c.code2ProtocolConverter.asTextDocumentIdentifier(m),range:c.code2ProtocolConverter.asRange(g)};try{let P=await c.sendRequest(Ti.InlayHintRequest.type,y,S);return S.isCancellationRequested?null:c.protocol2CodeConverter.asInlayHints(P,S)}catch(P){return c.handleFailedRequest(Ti.InlayHintRequest.type,S,P,null)}},p=c.middleware;return p.provideInlayHints?p.provideInlayHints(s,o,a,d):d(s,o,a)}};return i.resolveInlayHint=e.resolveProvider===!0?(s,o)=>{let a=this._client,c=async(p,m)=>{try{let g=await a.sendRequest(Ti.InlayHintResolveRequest.type,a.code2ProtocolConverter.asInlayHint(p),m);if(m.isCancellationRequested)return null;let S=a.protocol2CodeConverter.asInlayHint(g,m);return m.isCancellationRequested?null:S}catch(g){return a.handleFailedRequest(Ti.InlayHintResolveRequest.type,m,g,null)}},d=a.middleware;return d.resolveInlayHint?d.resolveInlayHint(s,o,c):c(s,o)}:void 0,[this.registerProvider(t,i),{provider:i,onDidChangeInlayHints:n}]}registerProvider(e,t){return Wv.languages.registerInlayHintsProvider(this._client.protocol2CodeConverter.asDocumentSelector(e),t)}};aa.InlayHintsFeature=$l});var Kv=x(ca=>{"use strict";Object.defineProperty(ca,"__esModule",{value:!0});ca.InlineCompletionItemFeature=void 0;var NR=require("vscode"),jl=ie(),Ul=we(),AR=Ve(),Wl=class extends Ul.TextDocumentLanguageFeature{constructor(e){super(e,jl.InlineCompletionRequest.type)}fillClientCapabilities(e){let t=(0,Ul.ensure)((0,Ul.ensure)(e,"textDocument"),"inlineCompletion");t.dynamicRegistration=!0}initialize(e,t){let n=this.getRegistrationOptions(t,e.inlineCompletionProvider);n&&this.register({id:AR.generateUuid(),registerOptions:n})}registerLanguageProvider(e){let t=e.documentSelector,n={provideInlineCompletionItems:(i,s,o,a)=>{let c=this._client,d=this._client.middleware,p=(m,g,S,y)=>c.sendRequest(jl.InlineCompletionRequest.type,c.code2ProtocolConverter.asInlineCompletionParams(m,g,S),y).then(P=>y.isCancellationRequested?null:c.protocol2CodeConverter.asInlineCompletionResult(P,y),P=>c.handleFailedRequest(jl.InlineCompletionRequest.type,y,P,null));return d.provideInlineCompletionItems?d.provideInlineCompletionItems(i,s,o,a,p):p(i,s,o,a)}};return[NR.languages.registerInlineCompletionItemProvider(this._client.protocol2CodeConverter.asDocumentSelector(t),n),n]}};ca.InlineCompletionItemFeature=Wl});var Gl=x(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.ProposedFeatures=mt.BaseLanguageClient=mt.MessageTransports=mt.SuspendMode=mt.State=mt.CloseAction=mt.ErrorAction=mt.RevealOutputChannelOn=void 0;var ke=require("vscode"),$=ie(),$R=wm(),jR=Sm(),qn=hn(),ua=go(),Vv=Ve(),UR=Bu(),In=we(),WR=hd(),zv=ev(),Bv=nv(),Pi=rv(),HR=iv(),KR=sv(),VR=ov(),zR=cv(),BR=uv(),GR=Ad(),XR=lv(),QR=fv(),JR=hv(),YR=gv(),Hl=mv(),ZR=yv(),eS=bv(),tS=Cv(),nS=Rv(),rS=Sv(),iS=Dv(),sS=_v(),oS=Tv(),aS=kv(),cS=Ev(),uS=xv(),dS=qv(),lS=Fv(),fS=Ov(),ki=Nv(),hS=Av(),pS=$v(),gS=Uv(),mS=Hv(),vS=Kv(),Br;(function(r){r[r.Debug=0]="Debug",r[r.Info=1]="Info",r[r.Warn=2]="Warn",r[r.Error=3]="Error",r[r.Never=4]="Never"})(Br||(mt.RevealOutputChannelOn=Br={}));var hs;(function(r){r[r.Continue=1]="Continue",r[r.Shutdown=2]="Shutdown"})(hs||(mt.ErrorAction=hs={}));var Pr;(function(r){r[r.DoNotRestart=1]="DoNotRestart",r[r.Restart=2]="Restart"})(Pr||(mt.CloseAction=Pr={}));var fs;(function(r){r[r.Stopped=1]="Stopped",r[r.Starting=3]="Starting",r[r.Running=2]="Running"})(fs||(mt.State=fs={}));var Gv;(function(r){r.off="off",r.on="on"})(Gv||(mt.SuspendMode=Gv={}));var Kl;(function(r){function e(t){return t==null?!1:typeof t=="boolean"||typeof t=="object"&&t!==null&&qn.stringArray(t.enabledCommands)?t:!1}r.sanitizeIsTrusted=e})(Kl||(Kl={}));var Vl=class{constructor(e,t){this.client=e,this.maxRestartCount=t,this.restarts=[]}error(e,t,n){return n&&n<=3?{action:hs.Continue}:{action:hs.Shutdown}}closed(){return this.restarts.push(Date.now()),this.restarts.length<=this.maxRestartCount?{action:Pr.Restart}:this.restarts[this.restarts.length-1]-this.restarts[0]<=3*60*1e3?{action:Pr.DoNotRestart,message:`The ${this.client.name} server crashed ${this.maxRestartCount+1} times in the last 3 minutes. The server will not be restarted. See the output for more information.`}:(this.restarts.shift(),{action:Pr.Restart})}},fe;(function(r){r.Initial="initial",r.Starting="starting",r.StartFailed="startFailed",r.Running="running",r.Stopping="stopping",r.Stopped="stopped"})(fe||(fe={}));var Xv;(function(r){function e(t){return t&&$.MessageReader.is(t.reader)&&$.MessageWriter.is(t.writer)}r.is=e})(Xv||(mt.MessageTransports=Xv={}));var ps=class r{constructor(e,t,n){this._traceFormat=$.TraceFormat.Text,this._diagnosticQueue=new Map,this._diagnosticQueueState={state:"idle"},this._features=[],this._dynamicFeatures=new Map,this.workspaceEditLock=new ua.Semaphore(1),this._id=e,this._name=t,n=n||{};let i={isTrusted:!1,supportHtml:!1};n.markdown!==void 0&&(i.isTrusted=Kl.sanitizeIsTrusted(n.markdown.isTrusted),i.supportHtml=n.markdown.supportHtml===!0),this._clientOptions={documentSelector:n.documentSelector??[],synchronize:n.synchronize??{},diagnosticCollectionName:n.diagnosticCollectionName,outputChannelName:n.outputChannelName??this._name,revealOutputChannelOn:n.revealOutputChannelOn??Br.Error,stdioEncoding:n.stdioEncoding??"utf8",initializationOptions:n.initializationOptions,initializationFailedHandler:n.initializationFailedHandler,progressOnInitialization:!!n.progressOnInitialization,errorHandler:n.errorHandler??this.createDefaultErrorHandler(n.connectionOptions?.maxRestartCount),middleware:n.middleware??{},uriConverters:n.uriConverters,workspaceFolder:n.workspaceFolder,connectionOptions:n.connectionOptions,markdown:i,diagnosticPullOptions:n.diagnosticPullOptions??{onChange:!0,onSave:!1},notebookDocumentOptions:n.notebookDocumentOptions??{}},this._clientOptions.synchronize=this._clientOptions.synchronize||{},this._state=fe.Initial,this._ignoredRegistrations=new Set,this._listeners=[],this._notificationHandlers=new Map,this._pendingNotificationHandlers=new Map,this._notificationDisposables=new Map,this._requestHandlers=new Map,this._pendingRequestHandlers=new Map,this._requestDisposables=new Map,this._progressHandlers=new Map,this._pendingProgressHandlers=new Map,this._progressDisposables=new Map,this._connection=void 0,this._initializeResult=void 0,n.outputChannel?(this._outputChannel=n.outputChannel,this._disposeOutputChannel=!1):(this._outputChannel=void 0,this._disposeOutputChannel=!0),this._traceOutputChannel=n.traceOutputChannel,this._diagnostics=void 0,this._pendingOpenNotifications=new Set,this._pendingChangeSemaphore=new ua.Semaphore(1),this._pendingChangeDelayer=new ua.Delayer(250),this._fileEvents=[],this._fileEventDelayer=new ua.Delayer(250),this._onStop=void 0,this._telemetryEmitter=new $.Emitter,this._stateChangeEmitter=new $.Emitter,this._trace=$.Trace.Off,this._tracer={log:(s,o)=>{qn.string(s)?this.logTrace(s,o):this.logObjectTrace(s)}},this._c2p=$R.createConverter(n.uriConverters?n.uriConverters.code2Protocol:void 0),this._p2c=jR.createConverter(n.uriConverters?n.uriConverters.protocol2Code:void 0,this._clientOptions.markdown.isTrusted,this._clientOptions.markdown.supportHtml),this._syncedDocuments=new Map,this.registerBuiltinFeatures()}get name(){return this._name}get middleware(){return this._clientOptions.middleware??Object.create(null)}get clientOptions(){return this._clientOptions}get protocol2CodeConverter(){return this._p2c}get code2ProtocolConverter(){return this._c2p}get onTelemetry(){return this._telemetryEmitter.event}get onDidChangeState(){return this._stateChangeEmitter.event}get outputChannel(){return this._outputChannel||(this._outputChannel=ke.window.createOutputChannel(this._clientOptions.outputChannelName?this._clientOptions.outputChannelName:this._name)),this._outputChannel}get traceOutputChannel(){return this._traceOutputChannel?this._traceOutputChannel:this.outputChannel}get diagnostics(){return this._diagnostics}get state(){return this.getPublicState()}get $state(){return this._state}set $state(e){let t=this.getPublicState();this._state=e;let n=this.getPublicState();n!==t&&this._stateChangeEmitter.fire({oldState:t,newState:n})}getPublicState(){switch(this.$state){case fe.Starting:return fs.Starting;case fe.Running:return fs.Running;default:return fs.Stopped}}get initializeResult(){return this._initializeResult}async sendRequest(e,...t){if(this.$state===fe.StartFailed||this.$state===fe.Stopping||this.$state===fe.Stopped)return Promise.reject(new $.ResponseError($.ErrorCodes.ConnectionInactive,"Client is not running"));let n=await this.$start();this._didChangeTextDocumentFeature.syncKind===$.TextDocumentSyncKind.Full&&await this.sendPendingFullTextDocumentChanges(n);let i=this._clientOptions.middleware?.sendRequest;if(i!==void 0){let s,o;return t.length===1?$.CancellationToken.is(t[0])?o=t[0]:s=t[0]:t.length===2&&(s=t[0],o=t[1]),i(e,s,o,(a,c,d)=>{let p=[];return c!==void 0&&p.push(c),d!==void 0&&p.push(d),n.sendRequest(a,...p)})}else return n.sendRequest(e,...t)}onRequest(e,t){let n=typeof e=="string"?e:e.method;this._requestHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._requestDisposables.set(n,i.onRequest(e,t)),s={dispose:()=>{let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}):(this._pendingRequestHandlers.set(n,t),s={dispose:()=>{this._pendingRequestHandlers.delete(n);let o=this._requestDisposables.get(n);o!==void 0&&(o.dispose(),this._requestDisposables.delete(n))}}),{dispose:()=>{this._requestHandlers.delete(n),s.dispose()}}}async sendNotification(e,t){if(this.$state===fe.StartFailed||this.$state===fe.Stopping||this.$state===fe.Stopped)return Promise.reject(new $.ResponseError($.ErrorCodes.ConnectionInactive,"Client is not running"));let n=this._didChangeTextDocumentFeature.syncKind===$.TextDocumentSyncKind.Full,i;n&&typeof e!="string"&&e.method===$.DidOpenTextDocumentNotification.method&&(i=t?.textDocument.uri,this._pendingOpenNotifications.add(i));let s=await this.$start();n&&await this.sendPendingFullTextDocumentChanges(s),i!==void 0&&this._pendingOpenNotifications.delete(i);let o=this._clientOptions.middleware?.sendNotification;return o?o(e,s.sendNotification.bind(s),t):s.sendNotification(e,t)}onNotification(e,t){let n=typeof e=="string"?e:e.method;this._notificationHandlers.set(n,t);let i=this.activeConnection(),s;return i!==void 0?(this._notificationDisposables.set(n,i.onNotification(e,t)),s={dispose:()=>{let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}):(this._pendingNotificationHandlers.set(n,t),s={dispose:()=>{this._pendingNotificationHandlers.delete(n);let o=this._notificationDisposables.get(n);o!==void 0&&(o.dispose(),this._notificationDisposables.delete(n))}}),{dispose:()=>{this._notificationHandlers.delete(n),s.dispose()}}}async sendProgress(e,t,n){if(this.$state===fe.StartFailed||this.$state===fe.Stopping||this.$state===fe.Stopped)return Promise.reject(new $.ResponseError($.ErrorCodes.ConnectionInactive,"Client is not running"));try{return(await this.$start()).sendProgress(e,t,n)}catch(i){throw this.error(`Sending progress for token ${t} failed.`,i),i}}onProgress(e,t,n){this._progressHandlers.set(t,{type:e,handler:n});let i=this.activeConnection(),s,o=this._clientOptions.middleware?.handleWorkDoneProgress,a=$.WorkDoneProgress.is(e)&&o!==void 0?c=>{o(t,c,()=>n(c))}:n;return i!==void 0?(this._progressDisposables.set(t,i.onProgress(e,t,a)),s={dispose:()=>{let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}):(this._pendingProgressHandlers.set(t,{type:e,handler:n}),s={dispose:()=>{this._pendingProgressHandlers.delete(t);let c=this._progressDisposables.get(t);c!==void 0&&(c.dispose(),this._progressDisposables.delete(t))}}),{dispose:()=>{this._progressHandlers.delete(t),s.dispose()}}}createDefaultErrorHandler(e){if(e!==void 0&&e<0)throw new Error(`Invalid maxRestartCount: ${e}`);return new Vl(this,e??4)}async setTrace(e){this._trace=e;let t=this.activeConnection();t!==void 0&&await t.trace(this._trace,this._tracer,{sendNotification:!1,traceFormat:this._traceFormat})}data2String(e){if(e instanceof $.ResponseError){let t=e;return`  Message: ${t.message}
  Code: ${t.code} ${t.data?`
`+t.data.toString():""}`}return e instanceof Error?qn.string(e.stack)?e.stack:e.message:qn.string(e)?e:e.toString()}debug(e,t,n=!0){this.logOutputMessage($.MessageType.Debug,Br.Debug,"Debug",e,t,n)}info(e,t,n=!0){this.logOutputMessage($.MessageType.Info,Br.Info,"Info",e,t,n)}warn(e,t,n=!0){this.logOutputMessage($.MessageType.Warning,Br.Warn,"Warn",e,t,n)}error(e,t,n=!0){this.logOutputMessage($.MessageType.Error,Br.Error,"Error",e,t,n)}logOutputMessage(e,t,n,i,s,o){this.outputChannel.appendLine(`[${n.padEnd(5)} - ${new Date().toLocaleTimeString()}] ${i}`),s!=null&&this.outputChannel.appendLine(this.data2String(s)),(o==="force"||o&&this._clientOptions.revealOutputChannelOn<=t)&&this.showNotificationMessage(e,i)}showNotificationMessage(e,t){t=t??"A request has failed. See the output for more information.",(e===$.MessageType.Error?ke.window.showErrorMessage:e===$.MessageType.Warning?ke.window.showWarningMessage:ke.window.showInformationMessage)(t,"Go to output").then(i=>{i!==void 0&&this.outputChannel.show(!0)})}logTrace(e,t){this.traceOutputChannel.appendLine(`[Trace - ${new Date().toLocaleTimeString()}] ${e}`),t&&this.traceOutputChannel.appendLine(this.data2String(t))}logObjectTrace(e){e.isLSPMessage&&e.type?this.traceOutputChannel.append(`[LSP   - ${new Date().toLocaleTimeString()}] `):this.traceOutputChannel.append(`[Trace - ${new Date().toLocaleTimeString()}] `),e&&this.traceOutputChannel.appendLine(`${JSON.stringify(e)}`)}needsStart(){return this.$state===fe.Initial||this.$state===fe.Stopping||this.$state===fe.Stopped}needsStop(){return this.$state===fe.Starting||this.$state===fe.Running}activeConnection(){return this.$state===fe.Running&&this._connection!==void 0?this._connection:void 0}isRunning(){return this.$state===fe.Running}async start(){if(this._disposed==="disposing"||this._disposed==="disposed")throw new Error("Client got disposed and can't be restarted.");if(this.$state===fe.Stopping)throw new Error("Client is currently stopping. Can only restart a full stopped client");if(this._onStart!==void 0)return this._onStart;let[e,t,n]=this.createOnStartPromise();this._onStart=e,this._diagnostics===void 0&&(this._diagnostics=this._clientOptions.diagnosticCollectionName?ke.languages.createDiagnosticCollection(this._clientOptions.diagnosticCollectionName):ke.languages.createDiagnosticCollection());for(let[i,s]of this._notificationHandlers)this._pendingNotificationHandlers.has(i)||this._pendingNotificationHandlers.set(i,s);for(let[i,s]of this._requestHandlers)this._pendingRequestHandlers.has(i)||this._pendingRequestHandlers.set(i,s);for(let[i,s]of this._progressHandlers)this._pendingProgressHandlers.has(i)||this._pendingProgressHandlers.set(i,s);this.$state=fe.Starting;try{let i=await this.createConnection();i.onNotification($.LogMessageNotification.type,s=>{switch(s.type){case $.MessageType.Error:this.error(s.message,void 0,!1);break;case $.MessageType.Warning:this.warn(s.message,void 0,!1);break;case $.MessageType.Info:this.info(s.message,void 0,!1);break;case $.MessageType.Debug:this.debug(s.message,void 0,!1);break;default:this.outputChannel.appendLine(s.message)}}),i.onNotification($.ShowMessageNotification.type,s=>{switch(s.type){case $.MessageType.Error:ke.window.showErrorMessage(s.message);break;case $.MessageType.Warning:ke.window.showWarningMessage(s.message);break;case $.MessageType.Info:ke.window.showInformationMessage(s.message);break;default:ke.window.showInformationMessage(s.message)}}),i.onRequest($.ShowMessageRequest.type,s=>{let o;switch(s.type){case $.MessageType.Error:o=ke.window.showErrorMessage;break;case $.MessageType.Warning:o=ke.window.showWarningMessage;break;case $.MessageType.Info:o=ke.window.showInformationMessage;break;default:o=ke.window.showInformationMessage}let a=s.actions||[];return o(s.message,...a)}),i.onNotification($.TelemetryEventNotification.type,s=>{this._telemetryEmitter.fire(s)}),i.onRequest($.ShowDocumentRequest.type,async s=>{let o=async c=>{let d=this.protocol2CodeConverter.asUri(c.uri);try{if(c.external===!0)return{success:await ke.env.openExternal(d)};{let p={};return c.selection!==void 0&&(p.selection=this.protocol2CodeConverter.asRange(c.selection)),c.takeFocus===void 0||c.takeFocus===!1?p.preserveFocus=!0:c.takeFocus===!0&&(p.preserveFocus=!1),await ke.window.showTextDocument(d,p),{success:!0}}}catch{return{success:!1}}},a=this._clientOptions.middleware.window?.showDocument;return a!==void 0?a(s,o):o(s)}),i.listen(),await this.initialize(i),t()}catch(i){this.$state=fe.StartFailed,this.error(`${this._name} client: couldn't create connection to server.`,i,"force"),n(i)}return this._onStart}createOnStartPromise(){let e,t;return[new Promise((i,s)=>{e=i,t=s}),e,t]}async initialize(e){this.refreshTrace(e,!1);let t=this._clientOptions.initializationOptions,[n,i]=this._clientOptions.workspaceFolder!==void 0?[this._clientOptions.workspaceFolder.uri.fsPath,[{uri:this._c2p.asUri(this._clientOptions.workspaceFolder.uri),name:this._clientOptions.workspaceFolder.name}]]:[this._clientGetRootPath(),null],s={processId:null,clientInfo:{name:ke.env.appName,version:ke.version},locale:this.getLocale(),rootPath:n||null,rootUri:n?this._c2p.asUri(ke.Uri.file(n)):null,capabilities:this.computeClientCapabilities(),initializationOptions:qn.func(t)?t():t,trace:$.Trace.toString(this._trace),workspaceFolders:i};if(this.fillInitializeParams(s),this._clientOptions.progressOnInitialization){let o=Vv.generateUuid(),a=new UR.ProgressPart(e,o);s.workDoneToken=o;try{let c=await this.doInitialize(e,s);return a.done(),c}catch(c){throw a.cancel(),c}}else return this.doInitialize(e,s)}async doInitialize(e,t){try{let n=await e.initialize(t);if(n.capabilities.positionEncoding!==void 0&&n.capabilities.positionEncoding!==$.PositionEncodingKind.UTF16)throw new Error(`Unsupported position encoding (${n.capabilities.positionEncoding}) received from server ${this.name}`);this._initializeResult=n,this.$state=fe.Running;let i;qn.number(n.capabilities.textDocumentSync)?n.capabilities.textDocumentSync===$.TextDocumentSyncKind.None?i={openClose:!1,change:$.TextDocumentSyncKind.None,save:void 0}:i={openClose:!0,change:n.capabilities.textDocumentSync,save:{includeText:!1}}:n.capabilities.textDocumentSync!==void 0&&n.capabilities.textDocumentSync!==null&&(i=n.capabilities.textDocumentSync),this._capabilities=Object.assign({},n.capabilities,{resolvedTextDocumentSync:i}),e.onNotification($.PublishDiagnosticsNotification.type,s=>this.handleDiagnostics(s)),e.onRequest($.RegistrationRequest.type,s=>this.handleRegistrationRequest(s)),e.onRequest("client/registerFeature",s=>this.handleRegistrationRequest(s)),e.onRequest($.UnregistrationRequest.type,s=>this.handleUnregistrationRequest(s)),e.onRequest("client/unregisterFeature",s=>this.handleUnregistrationRequest(s)),e.onRequest($.ApplyWorkspaceEditRequest.type,s=>this.handleApplyWorkspaceEdit(s));for(let[s,o]of this._pendingNotificationHandlers)this._notificationDisposables.set(s,e.onNotification(s,o));this._pendingNotificationHandlers.clear();for(let[s,o]of this._pendingRequestHandlers)this._requestDisposables.set(s,e.onRequest(s,o));this._pendingRequestHandlers.clear();for(let[s,o]of this._pendingProgressHandlers)this._progressDisposables.set(s,e.onProgress(o.type,s,o.handler));return this._pendingProgressHandlers.clear(),await e.sendNotification($.InitializedNotification.type,{}),this.hookFileEvents(e),this.hookConfigurationChanged(e),this.initializeFeatures(e),n}catch(n){throw this._clientOptions.initializationFailedHandler?this._clientOptions.initializationFailedHandler(n)?this.initialize(e):this.stop():n instanceof $.ResponseError&&n.data&&n.data.retry?ke.window.showErrorMessage(n.message,{title:"Retry",id:"retry"}).then(i=>{i&&i.id==="retry"?this.initialize(e):this.stop()}):(n&&n.message&&ke.window.showErrorMessage(n.message),this.error("Server initialization failed.",n),this.stop()),n}}_clientGetRootPath(){let e=ke.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}stop(e=2e3){return this.shutdown("stop",e)}dispose(e=2e3){try{return this._disposed="disposing",this.stop(e)}finally{this._disposed="disposed"}}async shutdown(e,t){if(this.$state===fe.Stopped||this.$state===fe.Initial)return;if(this.$state===fe.Stopping){if(this._onStop!==void 0)return this._onStop;throw new Error("Client is stopping but no stop promise available.")}let n=this.activeConnection();if(n===void 0||this.$state!==fe.Running)throw new Error(`Client is not running and can't be stopped. It's current state is: ${this.$state}`);this._initializeResult=void 0,this.$state=fe.Stopping,this.cleanUp(e);let i=new Promise(o=>{(0,$.RAL)().timer.setTimeout(o,t)}),s=(async o=>(await o.shutdown(),await o.exit(),o))(n);return this._onStop=Promise.race([i,s]).then(o=>{if(o!==void 0)o.end(),o.dispose();else throw this.error("Stopping server timed out",void 0,!1),new Error("Stopping the server timed out")},o=>{throw this.error("Stopping server failed",o,!1),o}).finally(()=>{this.$state=fe.Stopped,e==="stop"&&this.cleanUpChannel(),this._onStart=void 0,this._onStop=void 0,this._connection=void 0,this._ignoredRegistrations.clear()})}cleanUp(e){this._fileEvents=[],this._fileEventDelayer.cancel();let t=this._listeners.splice(0,this._listeners.length);for(let n of t)n.dispose();this._syncedDocuments&&this._syncedDocuments.clear();for(let n of Array.from(this._features.entries()).map(i=>i[1]).reverse())n.clear();e==="stop"&&this._diagnostics!==void 0&&(this._diagnostics.dispose(),this._diagnostics=void 0),this._idleInterval!==void 0&&(this._idleInterval.dispose(),this._idleInterval=void 0)}cleanUpChannel(){this._outputChannel!==void 0&&this._disposeOutputChannel&&(this._outputChannel.dispose(),this._outputChannel=void 0)}notifyFileEvent(e){let t=this;async function n(s){return t._fileEvents.push(s),t._fileEventDelayer.trigger(async()=>{await t.sendNotification($.DidChangeWatchedFilesNotification.type,{changes:t._fileEvents}),t._fileEvents=[]})}let i=this.clientOptions.middleware?.workspace;(i?.didChangeWatchedFile?i.didChangeWatchedFile(e,n):n(e)).catch(s=>{t.error("Notify file events failed.",s)})}async sendPendingFullTextDocumentChanges(e){return this._pendingChangeSemaphore.lock(async()=>{try{let t=this._didChangeTextDocumentFeature.getPendingDocumentChanges(this._pendingOpenNotifications);if(t.length===0)return;for(let n of t){let i=this.code2ProtocolConverter.asChangeTextDocumentParams(n);await e.sendNotification($.DidChangeTextDocumentNotification.type,i),this._didChangeTextDocumentFeature.notificationSent(n,$.DidChangeTextDocumentNotification.type,i)}}catch(t){throw this.error("Sending pending changes failed",t,!1),t}})}triggerPendingChangeDelivery(){this._pendingChangeDelayer.trigger(async()=>{let e=this.activeConnection();if(e===void 0){this.triggerPendingChangeDelivery();return}await this.sendPendingFullTextDocumentChanges(e)}).catch(e=>this.error("Delivering pending changes failed",e,!1))}handleDiagnostics(e){if(!this._diagnostics)return;let t=e.uri;this._diagnosticQueueState.state==="busy"&&this._diagnosticQueueState.document===t&&this._diagnosticQueueState.tokenSource.cancel(),this._diagnosticQueue.set(e.uri,e.diagnostics),this.triggerDiagnosticQueue()}triggerDiagnosticQueue(){(0,$.RAL)().timer.setImmediate(()=>{this.workDiagnosticQueue()})}workDiagnosticQueue(){if(this._diagnosticQueueState.state==="busy")return;let e=this._diagnosticQueue.entries().next();if(e.done===!0)return;let[t,n]=e.value;this._diagnosticQueue.delete(t);let i=new ke.CancellationTokenSource;this._diagnosticQueueState={state:"busy",document:t,tokenSource:i},this._p2c.asDiagnostics(n,i.token).then(s=>{if(!i.token.isCancellationRequested){let o=this._p2c.asUri(t),a=this.clientOptions.middleware;a.handleDiagnostics?a.handleDiagnostics(o,s,(c,d)=>this.setDiagnostics(c,d)):this.setDiagnostics(o,s)}}).finally(()=>{this._diagnosticQueueState={state:"idle"},this.triggerDiagnosticQueue()})}setDiagnostics(e,t){this._diagnostics&&this._diagnostics.set(e,t)}getLocale(){return ke.env.language}async $start(){if(this.$state===fe.StartFailed)throw new Error("Previous start failed. Can't restart server.");await this.start();let e=this.activeConnection();if(e===void 0)throw new Error("Starting server failed");return e}async createConnection(){let e=(i,s,o)=>{this.handleConnectionError(i,s,o).catch(a=>this.error("Handling connection error failed",a))},t=()=>{this.handleConnectionClosed().catch(i=>this.error("Handling connection close failed",i))},n=await this.createMessageTransports(this._clientOptions.stdioEncoding||"utf8");return this._connection=yS(n.reader,n.writer,e,t,this._clientOptions.connectionOptions),this._connection}async handleConnectionClosed(){if(this.$state===fe.Stopped)return;try{this._connection!==void 0&&this._connection.dispose()}catch{}let e={action:Pr.DoNotRestart};if(this.$state!==fe.Stopping)try{e=await this._clientOptions.errorHandler.closed()}catch{}this._connection=void 0,e.action===Pr.DoNotRestart?(this.error(e.message??"Connection to server got closed. Server will not be restarted.",void 0,e.handled===!0?!1:"force"),this.cleanUp("stop"),this.$state===fe.Starting?this.$state=fe.StartFailed:this.$state=fe.Stopped,this._onStop=Promise.resolve(),this._onStart=void 0):e.action===Pr.Restart&&(this.info(e.message??"Connection to server got closed. Server will restart.",!e.handled),this.cleanUp("restart"),this.$state=fe.Initial,this._onStop=Promise.resolve(),this._onStart=void 0,this.start().catch(t=>this.error("Restarting server failed",t,"force")))}async handleConnectionError(e,t,n){let i=await this._clientOptions.errorHandler.error(e,t,n);i.action===hs.Shutdown?(this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}
Shutting down server.`,void 0,i.handled===!0?!1:"force"),this.stop().catch(s=>{this.error("Stopping server failed",s,!1)})):this.error(i.message??`Client ${this._name}: connection to server is erroring.
${e.message}`,void 0,i.handled===!0?!1:"force")}hookConfigurationChanged(e){this._listeners.push(ke.workspace.onDidChangeConfiguration(()=>{this.refreshTrace(e,!0)}))}refreshTrace(e,t=!1){let n=ke.workspace.getConfiguration(this._id),i=$.Trace.Off,s=$.TraceFormat.Text;if(n){let o=n.get("trace.server","off");typeof o=="string"?i=$.Trace.fromString(o):(i=$.Trace.fromString(n.get("trace.server.verbosity","off")),s=$.TraceFormat.fromString(n.get("trace.server.format","text")))}this._trace=i,this._traceFormat=s,e.trace(this._trace,this._tracer,{sendNotification:t,traceFormat:this._traceFormat}).catch(o=>{this.error("Updating trace failed with error",o,!1)})}hookFileEvents(e){let t=this._clientOptions.synchronize.fileEvents;if(!t)return;let n;qn.array(t)?n=t:n=[t],n&&this._dynamicFeatures.get($.DidChangeWatchedFilesNotification.type.method).registerRaw(Vv.generateUuid(),n)}registerFeatures(e){for(let t of e)this.registerFeature(t)}registerFeature(e){if(this._features.push(e),In.DynamicFeature.is(e)){let t=e.registrationType;this._dynamicFeatures.set(t.method,e)}}getFeature(e){return this._dynamicFeatures.get(e)}hasDedicatedTextSynchronizationFeature(e){let t=this.getFeature($.NotebookDocumentSyncRegistrationType.method);return t===void 0||!(t instanceof zv.NotebookDocumentSyncFeature)?!1:t.handles(e)}registerBuiltinFeatures(){let e=new Map;this.registerFeature(new Bv.ConfigurationFeature(this)),this.registerFeature(new Pi.DidOpenTextDocumentFeature(this,this._syncedDocuments)),this._didChangeTextDocumentFeature=new Pi.DidChangeTextDocumentFeature(this,e),this._didChangeTextDocumentFeature.onPendingChangeAdded(()=>{this.triggerPendingChangeDelivery()}),this.registerFeature(this._didChangeTextDocumentFeature),this.registerFeature(new Pi.WillSaveFeature(this)),this.registerFeature(new Pi.WillSaveWaitUntilFeature(this)),this.registerFeature(new Pi.DidSaveTextDocumentFeature(this)),this.registerFeature(new Pi.DidCloseTextDocumentFeature(this,this._syncedDocuments,e)),this.registerFeature(new nS.FileSystemWatcherFeature(this,t=>this.notifyFileEvent(t))),this.registerFeature(new HR.CompletionItemFeature(this)),this.registerFeature(new KR.HoverFeature(this)),this.registerFeature(new zR.SignatureHelpFeature(this)),this.registerFeature(new VR.DefinitionFeature(this)),this.registerFeature(new QR.ReferencesFeature(this)),this.registerFeature(new BR.DocumentHighlightFeature(this)),this.registerFeature(new GR.DocumentSymbolFeature(this)),this.registerFeature(new XR.WorkspaceSymbolFeature(this)),this.registerFeature(new JR.CodeActionFeature(this)),this.registerFeature(new YR.CodeLensFeature(this)),this.registerFeature(new Hl.DocumentFormattingFeature(this)),this.registerFeature(new Hl.DocumentRangeFormattingFeature(this)),this.registerFeature(new Hl.DocumentOnTypeFormattingFeature(this)),this.registerFeature(new ZR.RenameFeature(this)),this.registerFeature(new eS.DocumentLinkFeature(this)),this.registerFeature(new tS.ExecuteCommandFeature(this)),this.registerFeature(new Bv.SyncConfigurationFeature(this)),this.registerFeature(new sS.TypeDefinitionFeature(this)),this.registerFeature(new iS.ImplementationFeature(this)),this.registerFeature(new rS.ColorProviderFeature(this)),this.clientOptions.workspaceFolder===void 0&&this.registerFeature(new oS.WorkspaceFoldersFeature(this)),this.registerFeature(new aS.FoldingRangeFeature(this)),this.registerFeature(new cS.DeclarationFeature(this)),this.registerFeature(new uS.SelectionRangeFeature(this)),this.registerFeature(new dS.ProgressFeature(this)),this.registerFeature(new lS.CallHierarchyFeature(this)),this.registerFeature(new fS.SemanticTokensFeature(this)),this.registerFeature(new hS.LinkedEditingFeature(this)),this.registerFeature(new ki.DidCreateFilesFeature(this)),this.registerFeature(new ki.DidRenameFilesFeature(this)),this.registerFeature(new ki.DidDeleteFilesFeature(this)),this.registerFeature(new ki.WillCreateFilesFeature(this)),this.registerFeature(new ki.WillRenameFilesFeature(this)),this.registerFeature(new ki.WillDeleteFilesFeature(this)),this.registerFeature(new pS.TypeHierarchyFeature(this)),this.registerFeature(new gS.InlineValueFeature(this)),this.registerFeature(new mS.InlayHintsFeature(this)),this.registerFeature(new WR.DiagnosticFeature(this)),this.registerFeature(new zv.NotebookDocumentSyncFeature(this))}registerProposedFeatures(){this.registerFeatures(Bl.createAll(this))}fillInitializeParams(e){for(let t of this._features)qn.func(t.fillInitializeParams)&&t.fillInitializeParams(e)}computeClientCapabilities(){let e={};(0,In.ensure)(e,"workspace").applyEdit=!0;let t=(0,In.ensure)((0,In.ensure)(e,"workspace"),"workspaceEdit");t.documentChanges=!0,t.resourceOperations=[$.ResourceOperationKind.Create,$.ResourceOperationKind.Rename,$.ResourceOperationKind.Delete],t.failureHandling=$.FailureHandlingKind.TextOnlyTransactional,t.normalizesLineEndings=!0,t.changeAnnotationSupport={groupsOnLabel:!0};let n=(0,In.ensure)((0,In.ensure)(e,"textDocument"),"publishDiagnostics");n.relatedInformation=!0,n.versionSupport=!1,n.tagSupport={valueSet:[$.DiagnosticTag.Unnecessary,$.DiagnosticTag.Deprecated]},n.codeDescriptionSupport=!0,n.dataSupport=!0;let i=(0,In.ensure)(e,"window"),s=(0,In.ensure)(i,"showMessage");s.messageActionItem={additionalPropertiesSupport:!0};let o=(0,In.ensure)(i,"showDocument");o.support=!0;let a=(0,In.ensure)(e,"general");a.staleRequestSupport={cancel:!0,retryOnContentModified:Array.from(r.RequestsToCancelOnContentModified)},a.regularExpressions={engine:"ECMAScript",version:"ES2020"},a.markdown={parser:"marked",version:"1.1.0"},a.positionEncodings=["utf-16"],this._clientOptions.markdown.supportHtml&&(a.markdown.allowedTags=["ul","li","p","code","blockquote","ol","h1","h2","h3","h4","h5","h6","hr","em","pre","table","thead","tbody","tr","th","td","div","del","a","strong","br","img","span"]);for(let c of this._features)c.fillClientCapabilities(e);return e}initializeFeatures(e){let t=this._clientOptions.documentSelector;for(let n of this._features)qn.func(n.preInitialize)&&n.preInitialize(this._capabilities,t);for(let n of this._features)n.initialize(this._capabilities,t)}async handleRegistrationRequest(e){let t=this.clientOptions.middleware?.handleRegisterCapability;return t?t(e,n=>this.doRegisterCapability(n)):this.doRegisterCapability(e)}async doRegisterCapability(e){if(!this.isRunning()){for(let t of e.registrations)this._ignoredRegistrations.add(t.id);return}for(let t of e.registrations){let n=this._dynamicFeatures.get(t.method);if(n===void 0)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Registration failed.`));let i=t.registerOptions??{};i.documentSelector=i.documentSelector??this._clientOptions.documentSelector;let s={id:t.id,registerOptions:i};try{n.register(s)}catch(o){return Promise.reject(o)}}}async handleUnregistrationRequest(e){let t=this.clientOptions.middleware?.handleUnregisterCapability;return t?t(e,n=>this.doUnregisterCapability(n)):this.doUnregisterCapability(e)}async doUnregisterCapability(e){for(let t of e.unregisterations){if(this._ignoredRegistrations.has(t.id))continue;let n=this._dynamicFeatures.get(t.method);if(!n)return Promise.reject(new Error(`No feature implementation for ${t.method} found. Unregistration failed.`));n.unregister(t.id)}}async handleApplyWorkspaceEdit(e){let t=e.edit,n=await this.workspaceEditLock.lock(()=>this._p2c.asWorkspaceEdit(t)),i=new Map;ke.workspace.textDocuments.forEach(o=>i.set(o.uri.toString(),o));let s=!1;if(t.documentChanges){for(let o of t.documentChanges)if($.TextDocumentEdit.is(o)&&o.textDocument.version&&o.textDocument.version>=0){let a=this._p2c.asUri(o.textDocument.uri).toString(),c=i.get(a);if(c&&c.version!==o.textDocument.version){s=!0;break}}}return s?Promise.resolve({applied:!1}):qn.asPromise(ke.workspace.applyEdit(n).then(o=>({applied:o})))}handleFailedRequest(e,t,n,i,s=!0){if(n instanceof $.ResponseError){if(n.code===$.ErrorCodes.PendingResponseRejected||n.code===$.ErrorCodes.ConnectionInactive)return i;if(n.code===$.LSPErrorCodes.RequestCancelled||n.code===$.LSPErrorCodes.ServerCancelled){if(t!==void 0&&t.isCancellationRequested)return i;throw n.data!==void 0?new In.LSPCancellationError(n.data):new ke.CancellationError}else if(n.code===$.LSPErrorCodes.ContentModified){if(r.RequestsToCancelOnContentModified.has(e.method)||r.CancellableResolveCalls.has(e.method))throw new ke.CancellationError;return i}}throw this.error(`Request ${e.method} failed.`,n,s),n}};mt.BaseLanguageClient=ps;ps.RequestsToCancelOnContentModified=new Set([$.SemanticTokensRequest.method,$.SemanticTokensRangeRequest.method,$.SemanticTokensDeltaRequest.method]);ps.CancellableResolveCalls=new Set([$.CompletionResolveRequest.method,$.CodeLensResolveRequest.method,$.CodeActionResolveRequest.method,$.InlayHintResolveRequest.method,$.DocumentLinkResolveRequest.method,$.WorkspaceSymbolResolveRequest.method]);var zl=class{error(e){(0,$.RAL)().console.error(e)}warn(e){(0,$.RAL)().console.warn(e)}info(e){(0,$.RAL)().console.info(e)}log(e){(0,$.RAL)().console.log(e)}};function yS(r,e,t,n,i){let s=new zl,o=(0,$.createProtocolConnection)(r,e,s,i);return o.onError(c=>{t(c[0],c[1],c[2])}),o.onClose(n),{listen:()=>o.listen(),sendRequest:o.sendRequest,onRequest:o.onRequest,hasPendingResponse:o.hasPendingResponse,sendNotification:o.sendNotification,onNotification:o.onNotification,onProgress:o.onProgress,sendProgress:o.sendProgress,trace:(c,d,p)=>{let m={sendNotification:!1,traceFormat:$.TraceFormat.Text};return p===void 0?o.trace(c,d,m):(qn.boolean(p),o.trace(c,d,p))},initialize:c=>o.sendRequest($.InitializeRequest.type,c),shutdown:()=>o.sendRequest($.ShutdownRequest.type,void 0),exit:()=>o.sendNotification($.ExitNotification.type),end:()=>o.end(),dispose:()=>o.dispose()}}var Bl;(function(r){function e(t){return[new vS.InlineCompletionItemFeature(t)]}r.createAll=e})(Bl||(mt.ProposedFeatures=Bl={}))});var Jv=x(da=>{"use strict";Object.defineProperty(da,"__esModule",{value:!0});da.terminate=void 0;var Qv=require("child_process"),bS=require("path"),wS=process.platform==="win32",CS=process.platform==="darwin",RS=process.platform==="linux";function SS(r,e){if(wS)try{let i={stdio:["pipe","pipe","ignore"]};return e&&(i.cwd=e),Qv.execFileSync("taskkill",["/T","/F","/PID",r.pid.toString()],i),!0}catch{return!1}else if(RS||CS)try{var t=(0,bS.join)(__dirname,"terminateProcess.sh"),n=Qv.spawnSync(t,[r.pid.toString()]);return!n.error}catch{return!1}else return r.kill("SIGKILL"),!0}da.terminate=SS});var Xl=x((XT,Yv)=>{"use strict";Yv.exports=ie()});var gs=x((QT,Zv)=>{var DS=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...r)=>console.error("SEMVER",...r):()=>{};Zv.exports=DS});var la=x((JT,ey)=>{var _S="2.0.0",TS=Number.MAX_SAFE_INTEGER||9007199254740991,PS=16,kS=250,ES=["major","premajor","minor","preminor","patch","prepatch","prerelease"];ey.exports={MAX_LENGTH:256,MAX_SAFE_COMPONENT_LENGTH:PS,MAX_SAFE_BUILD_LENGTH:kS,MAX_SAFE_INTEGER:TS,RELEASE_TYPES:ES,SEMVER_SPEC_VERSION:_S,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2}});var fa=x((or,ty)=>{var{MAX_SAFE_COMPONENT_LENGTH:Ql,MAX_SAFE_BUILD_LENGTH:xS,MAX_LENGTH:IS}=la(),qS=gs();or=ty.exports={};var FS=or.re=[],OS=or.safeRe=[],V=or.src=[],z=or.t={},LS=0,Jl="[a-zA-Z0-9-]",MS=[["\\s",1],["\\d",IS],[Jl,xS]],NS=r=>{for(let[e,t]of MS)r=r.split(`${e}*`).join(`${e}{0,${t}}`).split(`${e}+`).join(`${e}{1,${t}}`);return r},ce=(r,e,t)=>{let n=NS(e),i=LS++;qS(r,i,e),z[r]=i,V[i]=e,FS[i]=new RegExp(e,t?"g":void 0),OS[i]=new RegExp(n,t?"g":void 0)};ce("NUMERICIDENTIFIER","0|[1-9]\\d*");ce("NUMERICIDENTIFIERLOOSE","\\d+");ce("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${Jl}*`);ce("MAINVERSION",`(${V[z.NUMERICIDENTIFIER]})\\.(${V[z.NUMERICIDENTIFIER]})\\.(${V[z.NUMERICIDENTIFIER]})`);ce("MAINVERSIONLOOSE",`(${V[z.NUMERICIDENTIFIERLOOSE]})\\.(${V[z.NUMERICIDENTIFIERLOOSE]})\\.(${V[z.NUMERICIDENTIFIERLOOSE]})`);ce("PRERELEASEIDENTIFIER",`(?:${V[z.NUMERICIDENTIFIER]}|${V[z.NONNUMERICIDENTIFIER]})`);ce("PRERELEASEIDENTIFIERLOOSE",`(?:${V[z.NUMERICIDENTIFIERLOOSE]}|${V[z.NONNUMERICIDENTIFIER]})`);ce("PRERELEASE",`(?:-(${V[z.PRERELEASEIDENTIFIER]}(?:\\.${V[z.PRERELEASEIDENTIFIER]})*))`);ce("PRERELEASELOOSE",`(?:-?(${V[z.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${V[z.PRERELEASEIDENTIFIERLOOSE]})*))`);ce("BUILDIDENTIFIER",`${Jl}+`);ce("BUILD",`(?:\\+(${V[z.BUILDIDENTIFIER]}(?:\\.${V[z.BUILDIDENTIFIER]})*))`);ce("FULLPLAIN",`v?${V[z.MAINVERSION]}${V[z.PRERELEASE]}?${V[z.BUILD]}?`);ce("FULL",`^${V[z.FULLPLAIN]}$`);ce("LOOSEPLAIN",`[v=\\s]*${V[z.MAINVERSIONLOOSE]}${V[z.PRERELEASELOOSE]}?${V[z.BUILD]}?`);ce("LOOSE",`^${V[z.LOOSEPLAIN]}$`);ce("GTLT","((?:<|>)?=?)");ce("XRANGEIDENTIFIERLOOSE",`${V[z.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`);ce("XRANGEIDENTIFIER",`${V[z.NUMERICIDENTIFIER]}|x|X|\\*`);ce("XRANGEPLAIN",`[v=\\s]*(${V[z.XRANGEIDENTIFIER]})(?:\\.(${V[z.XRANGEIDENTIFIER]})(?:\\.(${V[z.XRANGEIDENTIFIER]})(?:${V[z.PRERELEASE]})?${V[z.BUILD]}?)?)?`);ce("XRANGEPLAINLOOSE",`[v=\\s]*(${V[z.XRANGEIDENTIFIERLOOSE]})(?:\\.(${V[z.XRANGEIDENTIFIERLOOSE]})(?:\\.(${V[z.XRANGEIDENTIFIERLOOSE]})(?:${V[z.PRERELEASELOOSE]})?${V[z.BUILD]}?)?)?`);ce("XRANGE",`^${V[z.GTLT]}\\s*${V[z.XRANGEPLAIN]}$`);ce("XRANGELOOSE",`^${V[z.GTLT]}\\s*${V[z.XRANGEPLAINLOOSE]}$`);ce("COERCEPLAIN",`(^|[^\\d])(\\d{1,${Ql}})(?:\\.(\\d{1,${Ql}}))?(?:\\.(\\d{1,${Ql}}))?`);ce("COERCE",`${V[z.COERCEPLAIN]}(?:$|[^\\d])`);ce("COERCEFULL",V[z.COERCEPLAIN]+`(?:${V[z.PRERELEASE]})?(?:${V[z.BUILD]})?(?:$|[^\\d])`);ce("COERCERTL",V[z.COERCE],!0);ce("COERCERTLFULL",V[z.COERCEFULL],!0);ce("LONETILDE","(?:~>?)");ce("TILDETRIM",`(\\s*)${V[z.LONETILDE]}\\s+`,!0);or.tildeTrimReplace="$1~";ce("TILDE",`^${V[z.LONETILDE]}${V[z.XRANGEPLAIN]}$`);ce("TILDELOOSE",`^${V[z.LONETILDE]}${V[z.XRANGEPLAINLOOSE]}$`);ce("LONECARET","(?:\\^)");ce("CARETTRIM",`(\\s*)${V[z.LONECARET]}\\s+`,!0);or.caretTrimReplace="$1^";ce("CARET",`^${V[z.LONECARET]}${V[z.XRANGEPLAIN]}$`);ce("CARETLOOSE",`^${V[z.LONECARET]}${V[z.XRANGEPLAINLOOSE]}$`);ce("COMPARATORLOOSE",`^${V[z.GTLT]}\\s*(${V[z.LOOSEPLAIN]})$|^$`);ce("COMPARATOR",`^${V[z.GTLT]}\\s*(${V[z.FULLPLAIN]})$|^$`);ce("COMPARATORTRIM",`(\\s*)${V[z.GTLT]}\\s*(${V[z.LOOSEPLAIN]}|${V[z.XRANGEPLAIN]})`,!0);or.comparatorTrimReplace="$1$2$3";ce("HYPHENRANGE",`^\\s*(${V[z.XRANGEPLAIN]})\\s+-\\s+(${V[z.XRANGEPLAIN]})\\s*$`);ce("HYPHENRANGELOOSE",`^\\s*(${V[z.XRANGEPLAINLOOSE]})\\s+-\\s+(${V[z.XRANGEPLAINLOOSE]})\\s*$`);ce("STAR","(<|>)?=?\\s*\\*");ce("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$");ce("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")});var ha=x((YT,ny)=>{var AS=Object.freeze({loose:!0}),$S=Object.freeze({}),jS=r=>r?typeof r!="object"?AS:r:$S;ny.exports=jS});var oy=x((ZT,sy)=>{var ry=/^[0-9]+$/,iy=(r,e)=>{let t=ry.test(r),n=ry.test(e);return t&&n&&(r=+r,e=+e),r===e?0:t&&!n?-1:n&&!t?1:r<e?-1:1},US=(r,e)=>iy(e,r);sy.exports={compareIdentifiers:iy,rcompareIdentifiers:US}});var ms=x((eP,dy)=>{var pa=gs(),{MAX_LENGTH:ay,MAX_SAFE_INTEGER:ga}=la(),{safeRe:cy,t:uy}=fa(),WS=ha(),{compareIdentifiers:Ei}=oy(),Yl=class r{constructor(e,t){if(t=WS(t),e instanceof r){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>ay)throw new TypeError(`version is longer than ${ay} characters`);pa("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;let n=e.trim().match(t.loose?cy[uy.LOOSE]:cy[uy.FULL]);if(!n)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+n[1],this.minor=+n[2],this.patch=+n[3],this.major>ga||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ga||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ga||this.patch<0)throw new TypeError("Invalid patch version");n[4]?this.prerelease=n[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){let s=+i;if(s>=0&&s<ga)return s}return i}):this.prerelease=[],this.build=n[5]?n[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(pa("SemVer.compare",this.version,this.options,e),!(e instanceof r)){if(typeof e=="string"&&e===this.version)return 0;e=new r(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof r||(e=new r(e,this.options)),Ei(this.major,e.major)||Ei(this.minor,e.minor)||Ei(this.patch,e.patch)}comparePre(e){if(e instanceof r||(e=new r(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{let n=this.prerelease[t],i=e.prerelease[t];if(pa("prerelease compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ei(n,i)}while(++t)}compareBuild(e){e instanceof r||(e=new r(e,this.options));let t=0;do{let n=this.build[t],i=e.build[t];if(pa("build compare",t,n,i),n===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(n===void 0)return-1;if(n===i)continue;return Ei(n,i)}while(++t)}inc(e,t,n){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,n);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,n);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,n),this.inc("pre",t,n);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,n),this.inc("pre",t,n);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{let i=Number(n)?1:0;if(!t&&n===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&n===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];n===!1&&(s=[t]),Ei(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};dy.exports=Yl});var hy=x((tP,fy)=>{var ly=ms(),HS=(r,e,t=!1)=>{if(r instanceof ly)return r;try{return new ly(r,e)}catch(n){if(!t)return null;throw n}};fy.exports=HS});var gy=x((nP,py)=>{var Zl=class{constructor(){this.max=1e3,this.map=new Map}get(e){let t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){let i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}};py.exports=Zl});var Gr=x((rP,vy)=>{var my=ms(),KS=(r,e,t)=>new my(r,t).compare(new my(e,t));vy.exports=KS});var by=x((iP,yy)=>{var VS=Gr(),zS=(r,e,t)=>VS(r,e,t)===0;yy.exports=zS});var Cy=x((sP,wy)=>{var BS=Gr(),GS=(r,e,t)=>BS(r,e,t)!==0;wy.exports=GS});var Sy=x((oP,Ry)=>{var XS=Gr(),QS=(r,e,t)=>XS(r,e,t)>0;Ry.exports=QS});var _y=x((aP,Dy)=>{var JS=Gr(),YS=(r,e,t)=>JS(r,e,t)>=0;Dy.exports=YS});var Py=x((cP,Ty)=>{var ZS=Gr(),eD=(r,e,t)=>ZS(r,e,t)<0;Ty.exports=eD});var Ey=x((uP,ky)=>{var tD=Gr(),nD=(r,e,t)=>tD(r,e,t)<=0;ky.exports=nD});var Iy=x((dP,xy)=>{var rD=by(),iD=Cy(),sD=Sy(),oD=_y(),aD=Py(),cD=Ey(),uD=(r,e,t,n)=>{switch(e){case"===":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r===t;case"!==":return typeof r=="object"&&(r=r.version),typeof t=="object"&&(t=t.version),r!==t;case"":case"=":case"==":return rD(r,t,n);case"!=":return iD(r,t,n);case">":return sD(r,t,n);case">=":return oD(r,t,n);case"<":return aD(r,t,n);case"<=":return cD(r,t,n);default:throw new TypeError(`Invalid operator: ${e}`)}};xy.exports=uD});var Ay=x((lP,Ny)=>{var vs=Symbol("SemVer ANY"),nf=class r{static get ANY(){return vs}constructor(e,t){if(t=qy(t),e instanceof r){if(e.loose===!!t.loose)return e;e=e.value}e=e.trim().split(/\s+/).join(" "),tf("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===vs?this.value="":this.value=this.operator+this.semver.version,tf("comp",this)}parse(e){let t=this.options.loose?Fy[Oy.COMPARATORLOOSE]:Fy[Oy.COMPARATOR],n=e.match(t);if(!n)throw new TypeError(`Invalid comparator: ${e}`);this.operator=n[1]!==void 0?n[1]:"",this.operator==="="&&(this.operator=""),n[2]?this.semver=new Ly(n[2],this.options.loose):this.semver=vs}toString(){return this.value}test(e){if(tf("Comparator.test",e,this.options.loose),this.semver===vs||e===vs)return!0;if(typeof e=="string")try{e=new Ly(e,this.options)}catch{return!1}return ef(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new My(e.value,t).test(this.value):e.operator===""?e.value===""?!0:new My(this.value,t).test(e.semver):(t=qy(t),t.includePrerelease&&(this.value==="<0.0.0-0"||e.value==="<0.0.0-0")||!t.includePrerelease&&(this.value.startsWith("<0.0.0")||e.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&e.operator.startsWith(">")||this.operator.startsWith("<")&&e.operator.startsWith("<")||this.semver.version===e.semver.version&&this.operator.includes("=")&&e.operator.includes("=")||ef(this.semver,"<",e.semver,t)&&this.operator.startsWith(">")&&e.operator.startsWith("<")||ef(this.semver,">",e.semver,t)&&this.operator.startsWith("<")&&e.operator.startsWith(">")))}};Ny.exports=nf;var qy=ha(),{safeRe:Fy,t:Oy}=fa(),ef=Iy(),tf=gs(),Ly=ms(),My=rf()});var rf=x((fP,Wy)=>{var dD=/\s+/g,sf=class r{constructor(e,t){if(t=fD(t),e instanceof r)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new r(e.raw,t);if(e instanceof of)return this.raw=e.value,this.set=[[e]],this.formatted=void 0,this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e.trim().replace(dD," "),this.set=this.raw.split("||").map(n=>this.parseRange(n.trim())).filter(n=>n.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){let n=this.set[0];if(this.set=this.set.filter(i=>!jy(i[0])),this.set.length===0)this.set=[n];else if(this.set.length>1){for(let i of this.set)if(i.length===1&&bD(i[0])){this.set=[i];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let e=0;e<this.set.length;e++){e>0&&(this.formatted+="||");let t=this.set[e];for(let n=0;n<t.length;n++)n>0&&(this.formatted+=" "),this.formatted+=t[n].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(e){let n=((this.options.includePrerelease&&vD)|(this.options.loose&&yD))+":"+e,i=$y.get(n);if(i)return i;let s=this.options.loose,o=s?Gt[Nt.HYPHENRANGELOOSE]:Gt[Nt.HYPHENRANGE];e=e.replace(o,ED(this.options.includePrerelease)),We("hyphen replace",e),e=e.replace(Gt[Nt.COMPARATORTRIM],pD),We("comparator trim",e),e=e.replace(Gt[Nt.TILDETRIM],gD),We("tilde trim",e),e=e.replace(Gt[Nt.CARETTRIM],mD),We("caret trim",e);let a=e.split(" ").map(m=>wD(m,this.options)).join(" ").split(/\s+/).map(m=>kD(m,this.options));s&&(a=a.filter(m=>(We("loose invalid filter",m,this.options),!!m.match(Gt[Nt.COMPARATORLOOSE])))),We("range list",a);let c=new Map,d=a.map(m=>new of(m,this.options));for(let m of d){if(jy(m))return[m];c.set(m.value,m)}c.size>1&&c.has("")&&c.delete("");let p=[...c.values()];return $y.set(n,p),p}intersects(e,t){if(!(e instanceof r))throw new TypeError("a Range is required");return this.set.some(n=>Uy(n,t)&&e.set.some(i=>Uy(i,t)&&n.every(s=>i.every(o=>s.intersects(o,t)))))}test(e){if(!e)return!1;if(typeof e=="string")try{e=new hD(e,this.options)}catch{return!1}for(let t=0;t<this.set.length;t++)if(xD(this.set[t],e,this.options))return!0;return!1}};Wy.exports=sf;var lD=gy(),$y=new lD,fD=ha(),of=Ay(),We=gs(),hD=ms(),{safeRe:Gt,t:Nt,comparatorTrimReplace:pD,tildeTrimReplace:gD,caretTrimReplace:mD}=fa(),{FLAG_INCLUDE_PRERELEASE:vD,FLAG_LOOSE:yD}=la(),jy=r=>r.value==="<0.0.0-0",bD=r=>r.value==="",Uy=(r,e)=>{let t=!0,n=r.slice(),i=n.pop();for(;t&&n.length;)t=n.every(s=>i.intersects(s,e)),i=n.pop();return t},wD=(r,e)=>(We("comp",r,e),r=SD(r,e),We("caret",r),r=CD(r,e),We("tildes",r),r=_D(r,e),We("xrange",r),r=PD(r,e),We("stars",r),r),At=r=>!r||r.toLowerCase()==="x"||r==="*",CD=(r,e)=>r.trim().split(/\s+/).map(t=>RD(t,e)).join(" "),RD=(r,e)=>{let t=e.loose?Gt[Nt.TILDELOOSE]:Gt[Nt.TILDE];return r.replace(t,(n,i,s,o,a)=>{We("tilde",r,n,i,s,o,a);let c;return At(i)?c="":At(s)?c=`>=${i}.0.0 <${+i+1}.0.0-0`:At(o)?c=`>=${i}.${s}.0 <${i}.${+s+1}.0-0`:a?(We("replaceTilde pr",a),c=`>=${i}.${s}.${o}-${a} <${i}.${+s+1}.0-0`):c=`>=${i}.${s}.${o} <${i}.${+s+1}.0-0`,We("tilde return",c),c})},SD=(r,e)=>r.trim().split(/\s+/).map(t=>DD(t,e)).join(" "),DD=(r,e)=>{We("caret",r,e);let t=e.loose?Gt[Nt.CARETLOOSE]:Gt[Nt.CARET],n=e.includePrerelease?"-0":"";return r.replace(t,(i,s,o,a,c)=>{We("caret",r,i,s,o,a,c);let d;return At(s)?d="":At(o)?d=`>=${s}.0.0${n} <${+s+1}.0.0-0`:At(a)?s==="0"?d=`>=${s}.${o}.0${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.0${n} <${+s+1}.0.0-0`:c?(We("replaceCaret pr",c),s==="0"?o==="0"?d=`>=${s}.${o}.${a}-${c} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}-${c} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a}-${c} <${+s+1}.0.0-0`):(We("no pr"),s==="0"?o==="0"?d=`>=${s}.${o}.${a}${n} <${s}.${o}.${+a+1}-0`:d=`>=${s}.${o}.${a}${n} <${s}.${+o+1}.0-0`:d=`>=${s}.${o}.${a} <${+s+1}.0.0-0`),We("caret return",d),d})},_D=(r,e)=>(We("replaceXRanges",r,e),r.split(/\s+/).map(t=>TD(t,e)).join(" ")),TD=(r,e)=>{r=r.trim();let t=e.loose?Gt[Nt.XRANGELOOSE]:Gt[Nt.XRANGE];return r.replace(t,(n,i,s,o,a,c)=>{We("xRange",r,n,i,s,o,a,c);let d=At(s),p=d||At(o),m=p||At(a),g=m;return i==="="&&g&&(i=""),c=e.includePrerelease?"-0":"",d?i===">"||i==="<"?n="<0.0.0-0":n="*":i&&g?(p&&(o=0),a=0,i===">"?(i=">=",p?(s=+s+1,o=0,a=0):(o=+o+1,a=0)):i==="<="&&(i="<",p?s=+s+1:o=+o+1),i==="<"&&(c="-0"),n=`${i+s}.${o}.${a}${c}`):p?n=`>=${s}.0.0${c} <${+s+1}.0.0-0`:m&&(n=`>=${s}.${o}.0${c} <${s}.${+o+1}.0-0`),We("xRange return",n),n})},PD=(r,e)=>(We("replaceStars",r,e),r.trim().replace(Gt[Nt.STAR],"")),kD=(r,e)=>(We("replaceGTE0",r,e),r.trim().replace(Gt[e.includePrerelease?Nt.GTE0PRE:Nt.GTE0],"")),ED=r=>(e,t,n,i,s,o,a,c,d,p,m,g)=>(At(n)?t="":At(i)?t=`>=${n}.0.0${r?"-0":""}`:At(s)?t=`>=${n}.${i}.0${r?"-0":""}`:o?t=`>=${t}`:t=`>=${t}${r?"-0":""}`,At(d)?c="":At(p)?c=`<${+d+1}.0.0-0`:At(m)?c=`<${d}.${+p+1}.0-0`:g?c=`<=${d}.${p}.${m}-${g}`:r?c=`<${d}.${p}.${+m+1}-0`:c=`<=${c}`,`${t} ${c}`.trim()),xD=(r,e,t)=>{for(let n=0;n<r.length;n++)if(!r[n].test(e))return!1;if(e.prerelease.length&&!t.includePrerelease){for(let n=0;n<r.length;n++)if(We(r[n].semver),r[n].semver!==of.ANY&&r[n].semver.prerelease.length>0){let i=r[n].semver;if(i.major===e.major&&i.minor===e.minor&&i.patch===e.patch)return!0}return!1}return!0}});var Ky=x((hP,Hy)=>{var ID=rf(),qD=(r,e,t)=>{try{e=new ID(e,t)}catch{return!1}return e.test(r)};Hy.exports=qD});var zy=x(an=>{"use strict";var FD=an&&an.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),af=an&&an.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&FD(e,r,t)};Object.defineProperty(an,"__esModule",{value:!0});an.DiagnosticPullMode=an.vsdiag=void 0;af(ie(),an);af(we(),an);var Vy=hd();Object.defineProperty(an,"vsdiag",{enumerable:!0,get:function(){return Vy.vsdiag}});Object.defineProperty(an,"DiagnosticPullMode",{enumerable:!0,get:function(){return Vy.DiagnosticPullMode}});af(Gl(),an)});var ma=x(Xt=>{"use strict";var OD=Xt&&Xt.__createBinding||(Object.create?function(r,e,t,n){n===void 0&&(n=t);var i=Object.getOwnPropertyDescriptor(e,t);(!i||("get"in i?!e.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,n,i)}:function(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}),Xy=Xt&&Xt.__exportStar||function(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&OD(e,r,t)};Object.defineProperty(Xt,"__esModule",{value:!0});Xt.SettingMonitor=Xt.LanguageClient=Xt.TransportKind=void 0;var ar=require("child_process"),cf=require("fs"),uf=require("path"),Er=require("vscode"),ze=hn(),By=Gl(),LD=Jv(),Qe=Xl(),MD=hy(),ND=Ky();Xy(Xl(),Xt);Xy(zy(),Xt);var Gy="^1.82.0",Je;(function(r){r[r.stdio=0]="stdio",r[r.ipc=1]="ipc",r[r.pipe=2]="pipe",r[r.socket=3]="socket"})(Je||(Xt.TransportKind=Je={}));var kr;(function(r){function e(t){let n=t;return n&&n.kind===Je.socket&&ze.number(n.port)}r.isSocket=e})(kr||(kr={}));var df;(function(r){function e(t){return ze.string(t.command)}r.is=e})(df||(df={}));var lf;(function(r){function e(t){return ze.string(t.module)}r.is=e})(lf||(lf={}));var ff;(function(r){function e(t){let n=t;return n&&n.writer!==void 0&&n.reader!==void 0}r.is=e})(ff||(ff={}));var hf;(function(r){function e(t){let n=t;return n&&n.process!==void 0&&typeof n.detached=="boolean"}r.is=e})(hf||(hf={}));var pf=class extends By.BaseLanguageClient{constructor(e,t,n,i,s){let o,a,c,d,p;ze.string(t)?(o=e,a=t,c=n,d=i,p=!!s):(o=e.toLowerCase(),a=e,c=t,d=n,p=i),p===void 0&&(p=!1),super(o,a,d),this._serverOptions=c,this._forceDebug=p,this._isInDebugMode=p;try{this.checkVersion()}catch(m){throw ze.string(m.message)&&this.outputChannel.appendLine(m.message),m}}checkVersion(){let e=MD(Er.version);if(!e)throw new Error(`No valid VS Code version detected. Version string is: ${Er.version}`);if(e.prerelease&&e.prerelease.length>0&&(e.prerelease=[]),!ND(e,Gy))throw new Error(`The language client requires VS Code version ${Gy} but received version ${Er.version}`)}get isInDebugMode(){return this._isInDebugMode}async restart(){await this.stop(),this.isInDebugMode?(await new Promise(e=>setTimeout(e,1e3)),await this.start()):await this.start()}stop(e=2e3){return super.stop(e).finally(()=>{if(this._serverProcess){let t=this._serverProcess;this._serverProcess=void 0,(this._isDetached===void 0||!this._isDetached)&&this.checkProcessDied(t),this._isDetached=void 0}})}checkProcessDied(e){!e||e.pid===void 0||setTimeout(()=>{try{e.pid!==void 0&&(process.kill(e.pid,0),(0,LD.terminate)(e))}catch{}},2e3)}handleConnectionClosed(){return this._serverProcess=void 0,super.handleConnectionClosed()}fillInitializeParams(e){super.fillInitializeParams(e),e.processId===null&&(e.processId=process.pid)}createMessageTransports(e){function t(p,m){if(!p&&!m)return;let g=Object.create(null);return Object.keys(process.env).forEach(S=>g[S]=process.env[S]),m&&(g.ELECTRON_RUN_AS_NODE="1",g.ELECTRON_NO_ASAR="1"),p&&Object.keys(p).forEach(S=>g[S]=p[S]),g}let n=["--debug=","--debug-brk=","--inspect=","--inspect-brk="],i=["--debug","--debug-brk","--inspect","--inspect-brk"];function s(){let p=process.execArgv;return p?p.some(m=>n.some(g=>m.startsWith(g))||i.some(g=>m===g)):!1}function o(p){if(p.stdin===null||p.stdout===null||p.stderr===null)throw new Error("Process created without stdio streams")}let a=this._serverOptions;if(ze.func(a))return a().then(p=>{if(By.MessageTransports.is(p))return this._isDetached=!!p.detached,p;if(ff.is(p))return this._isDetached=!!p.detached,{reader:new Qe.StreamMessageReader(p.reader),writer:new Qe.StreamMessageWriter(p.writer)};{let m;return hf.is(p)?(m=p.process,this._isDetached=p.detached):(m=p,this._isDetached=!1),m.stderr.on("data",g=>this.outputChannel.append(ze.string(g)?g:g.toString(e))),{reader:new Qe.StreamMessageReader(m.stdout),writer:new Qe.StreamMessageWriter(m.stdin)}}});let c,d=a;return d.run||d.debug?this._forceDebug||s()?(c=d.debug,this._isInDebugMode=!0):(c=d.run,this._isInDebugMode=!1):c=a,this._getServerWorkingDir(c.options).then(p=>{if(lf.is(c)&&c.module){let m=c,g=m.transport||Je.stdio;if(m.runtime){let S=[],y=m.options??Object.create(null);y.execArgv&&y.execArgv.forEach(M=>S.push(M)),S.push(m.module),m.args&&m.args.forEach(M=>S.push(M));let P=Object.create(null);P.cwd=p,P.env=t(y.env,!1);let k=this._getRuntimePath(m.runtime,p),L;if(g===Je.ipc?(P.stdio=[null,null,null,"ipc"],S.push("--node-ipc")):g===Je.stdio?S.push("--stdio"):g===Je.pipe?(L=(0,Qe.generateRandomPipeName)(),S.push(`--pipe=${L}`)):kr.isSocket(g)&&S.push(`--socket=${g.port}`),S.push(`--clientProcessId=${process.pid.toString()}`),g===Je.ipc||g===Je.stdio){let M=ar.spawn(k,S,P);return!M||!M.pid?xi(M,`Launching server using runtime ${k} failed.`):(this._serverProcess=M,M.stderr.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),g===Je.ipc?(M.stdout.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),Promise.resolve({reader:new Qe.IPCMessageReader(M),writer:new Qe.IPCMessageWriter(M)})):Promise.resolve({reader:new Qe.StreamMessageReader(M.stdout),writer:new Qe.StreamMessageWriter(M.stdin)}))}else{if(g===Je.pipe)return(0,Qe.createClientPipeTransport)(L).then(M=>{let A=ar.spawn(k,S,P);return!A||!A.pid?xi(A,`Launching server using runtime ${k} failed.`):(this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),M.onConnected().then(W=>({reader:W[0],writer:W[1]})))});if(kr.isSocket(g))return(0,Qe.createClientSocketTransport)(g.port).then(M=>{let A=ar.spawn(k,S,P);return!A||!A.pid?xi(A,`Launching server using runtime ${k} failed.`):(this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),M.onConnected().then(W=>({reader:W[0],writer:W[1]})))})}}else{let S;return new Promise((y,P)=>{let k=(m.args&&m.args.slice())??[];g===Je.ipc?k.push("--node-ipc"):g===Je.stdio?k.push("--stdio"):g===Je.pipe?(S=(0,Qe.generateRandomPipeName)(),k.push(`--pipe=${S}`)):kr.isSocket(g)&&k.push(`--socket=${g.port}`),k.push(`--clientProcessId=${process.pid.toString()}`);let L=m.options??Object.create(null);if(L.env=t(L.env,!0),L.execArgv=L.execArgv||[],L.cwd=p,L.silent=!0,g===Je.ipc||g===Je.stdio){let M=ar.fork(m.module,k||[],L);o(M),this._serverProcess=M,M.stderr.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),g===Je.ipc?(M.stdout.on("data",A=>this.outputChannel.append(ze.string(A)?A:A.toString(e))),y({reader:new Qe.IPCMessageReader(this._serverProcess),writer:new Qe.IPCMessageWriter(this._serverProcess)})):y({reader:new Qe.StreamMessageReader(M.stdout),writer:new Qe.StreamMessageWriter(M.stdin)})}else g===Je.pipe?(0,Qe.createClientPipeTransport)(S).then(M=>{let A=ar.fork(m.module,k||[],L);o(A),this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),M.onConnected().then(W=>{y({reader:W[0],writer:W[1]})},P)},P):kr.isSocket(g)&&(0,Qe.createClientSocketTransport)(g.port).then(M=>{let A=ar.fork(m.module,k||[],L);o(A),this._serverProcess=A,A.stderr.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),A.stdout.on("data",W=>this.outputChannel.append(ze.string(W)?W:W.toString(e))),M.onConnected().then(W=>{y({reader:W[0],writer:W[1]})},P)},P)})}}else if(df.is(c)&&c.command){let m=c,g=c.args!==void 0?c.args.slice(0):[],S,y=c.transport;if(y===Je.stdio)g.push("--stdio");else if(y===Je.pipe)S=(0,Qe.generateRandomPipeName)(),g.push(`--pipe=${S}`);else if(kr.isSocket(y))g.push(`--socket=${y.port}`);else if(y===Je.ipc)throw new Error("Transport kind ipc is not support for command executable");let P=Object.assign({},m.options);if(P.cwd=P.cwd||p,y===void 0||y===Je.stdio){let k=ar.spawn(m.command,g,P);return!k||!k.pid?xi(k,`Launching server using command ${m.command} failed.`):(k.stderr.on("data",L=>this.outputChannel.append(ze.string(L)?L:L.toString(e))),this._serverProcess=k,this._isDetached=!!P.detached,Promise.resolve({reader:new Qe.StreamMessageReader(k.stdout),writer:new Qe.StreamMessageWriter(k.stdin)}))}else{if(y===Je.pipe)return(0,Qe.createClientPipeTransport)(S).then(k=>{let L=ar.spawn(m.command,g,P);return!L||!L.pid?xi(L,`Launching server using command ${m.command} failed.`):(this._serverProcess=L,this._isDetached=!!P.detached,L.stderr.on("data",M=>this.outputChannel.append(ze.string(M)?M:M.toString(e))),L.stdout.on("data",M=>this.outputChannel.append(ze.string(M)?M:M.toString(e))),k.onConnected().then(M=>({reader:M[0],writer:M[1]})))});if(kr.isSocket(y))return(0,Qe.createClientSocketTransport)(y.port).then(k=>{let L=ar.spawn(m.command,g,P);return!L||!L.pid?xi(L,`Launching server using command ${m.command} failed.`):(this._serverProcess=L,this._isDetached=!!P.detached,L.stderr.on("data",M=>this.outputChannel.append(ze.string(M)?M:M.toString(e))),L.stdout.on("data",M=>this.outputChannel.append(ze.string(M)?M:M.toString(e))),k.onConnected().then(M=>({reader:M[0],writer:M[1]})))})}}return Promise.reject(new Error("Unsupported server configuration "+JSON.stringify(a,null,4)))}).finally(()=>{this._serverProcess!==void 0&&this._serverProcess.on("exit",(p,m)=>{p!==null&&this.error(`Server process exited with code ${p}.`,void 0,!1),m!==null&&this.error(`Server process exited with signal ${m}.`,void 0,!1)})})}_getRuntimePath(e,t){if(uf.isAbsolute(e))return e;let n=this._mainGetRootPath();if(n!==void 0){let i=uf.join(n,e);if(cf.existsSync(i))return i}if(t!==void 0){let i=uf.join(t,e);if(cf.existsSync(i))return i}return e}_mainGetRootPath(){let e=Er.workspace.workspaceFolders;if(!e||e.length===0)return;let t=e[0];if(t.uri.scheme==="file")return t.uri.fsPath}_getServerWorkingDir(e){let t=e&&e.cwd;return t||(t=this.clientOptions.workspaceFolder?this.clientOptions.workspaceFolder.uri.fsPath:this._mainGetRootPath()),t?new Promise(n=>{cf.lstat(t,(i,s)=>{n(!i&&s.isDirectory()?t:void 0)})}):Promise.resolve(void 0)}};Xt.LanguageClient=pf;var gf=class{constructor(e,t){this._client=e,this._setting=t,this._listeners=[]}start(){return Er.workspace.onDidChangeConfiguration(this.onDidChangeConfiguration,this,this._listeners),this.onDidChangeConfiguration(),new Er.Disposable(()=>{this._client.needsStop()&&this._client.stop()})}onDidChangeConfiguration(){let e=this._setting.indexOf("."),t=e>=0?this._setting.substr(0,e):this._setting,n=e>=0?this._setting.substr(e+1):void 0,i=n?Er.workspace.getConfiguration(t).get(n,!1):Er.workspace.getConfiguration(t);i&&this._client.needsStart()?this._client.start().catch(s=>this._client.error("Start failed after configuration change",s,"force")):!i&&this._client.needsStop()&&this._client.stop().catch(s=>this._client.error("Stop failed after configuration change",s,"force"))}};Xt.SettingMonitor=gf;function xi(r,e){return r===null?Promise.reject(e):new Promise((t,n)=>{r.on("error",i=>{n(`${e} ${i}`)}),setImmediate(()=>n(e))})}});var va=x((mP,Qy)=>{"use strict";Qy.exports=ma()});var ZD={};Mb(ZD,{activate:()=>XD,deactivate:()=>QD});module.exports=Nb(ZD);var Eb=te(require("os")),Yt=te(require("vscode"));var N=te(require("vscode")),xf=te(va());var ys=class{provideTextDocumentContent(e){let t="Not a valid Ruby LSP document";switch(e.path){case"show-syntax-tree":t=e.query;break}return t}};var ub=require("crypto"),Ye=te(require("vscode")),Ia=te(va());var Fi=te(require("path")),Pa=te(require("os")),Le=te(require("vscode"));var Jy=require("child_process"),Yy=require("crypto"),Zy=require("util"),xr=te(require("vscode"));var wn=new xr.EventEmitter,It=(0,Zy.promisify)(Jy.exec),ya="Ruby LSP",zn=xr.window.createOutputChannel(ya,{log:!0}),Ir=["ruby","erb"],mf={tapiocaAddon:1,launcher:.1,fullTestDiscovery:-1};function eb(r,e){let t=null;return function(...n){return t&&clearTimeout(t),new Promise((i,s)=>{t=setTimeout(()=>{r(...n).then(o=>i(o)).catch(o=>s(o))},e)})}}function bs(r){let e=xr.workspace.getConfiguration("rubyLsp").get("featureFlags");if(e[r]===!1||e.all===!1)return!1;let t=mf[r];if(e.all&&t!==-1||e[r])return!0;let n=xr.env.machineId,i=(0,Yy.createHash)("sha256").update(`${n}-${r}`).digest("hex");return parseInt(i.substring(0,8),16)/4294967295<t}var Xr=te(require("vscode"));var ws=te(require("path")),tb=te(require("os")),Bn=te(require("vscode"));var Cs="RUBY_LSP_ACTIVATION_SEPARATOR",AD="RUBY_LSP_VS",$D="RUBY_LSP_FS",vt=class{constructor(e,t,n,i){this.workspaceFolder=e,this.outputChannel=t,this.context=n,this.manuallySelectRuby=i;let s=Bn.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=ws.default.isAbsolute(s)?s:ws.default.resolve(ws.default.join(this.workspaceFolder.uri.fsPath,s))),this.bundleUri=this.customBundleGemfile?Bn.Uri.file(ws.default.dirname(this.customBundleGemfile)):e.uri}async runEnvActivationScript(e){let t=Bn.Uri.joinPath(this.context.extensionUri,"activation.rb"),n=await this.runScript(`${e} -EUTF-8:UTF-8 '${t.fsPath}'`),i=new RegExp(`${Cs}([^]*)${Cs}`).exec(n.stderr),[s,o,a,...c]=i[1].split($D);return{version:s,gemPath:o.split(","),yjit:a==="true",env:Object.fromEntries(c.map(d=>d.split(AD)))}}runScript(e){let t;return Bn.env.shell.length>0&&tb.default.platform()!=="win32"&&(t=Bn.env.shell),this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath} using shell: ${t}`),It(e,{cwd:this.bundleUri.fsPath,shell:t,env:process.env,encoding:"utf-8"})}async findExec(e,t){for(let n of e)try{let i=Bn.Uri.joinPath(n,t);return await Bn.workspace.fs.stat(i),this.outputChannel.info(`Found ${t} executable at ${n.fsPath}`),i.fsPath}catch{}return t}};var Rs=class extends Error{},ba=class extends vt{async activate(){try{await Xr.workspace.fs.stat(Xr.Uri.joinPath(this.bundleUri,".shadowenv.d"))}catch{throw new Error("The Ruby LSP version manager is configured to be shadowenv,         but no .shadowenv.d directory was found in the workspace")}let e=await this.findExec([Xr.Uri.file("/opt/homebrew/bin")],"shadowenv");try{let t=await this.runEnvActivationScript(`${e} exec -- ruby`);return delete t.env.BUNDLE_GEMFILE,{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}catch(t){if(t.message.includes("untrusted shadowenv program")){if(await Xr.window.showErrorMessage(`Tried to activate Shadowenv, but the workspace is untrusted.
           Workspaces must be trusted to before allowing Shadowenv to load the environment for security reasons.`,"Trust workspace","Shutdown Ruby LSP")==="Trust workspace")return await It("shadowenv trust",{cwd:this.bundleUri.fsPath}),this.activate();throw new Rs("Cannot activate Ruby environment in an untrusted workspace")}try{await It("shadowenv --version")}catch{throw new Error(`Shadowenv executable not found. Ensure it is installed and available in the PATH.
           This error may happen if your shell configuration is failing to be sourced from the editor or if
           another extension is mutating the process PATH.`)}throw new Error(`Failed to activate Ruby environment with Shadowenv: ${t.message}`)}}};var vf=te(require("os")),Gn=te(require("path")),Ee=te(require("vscode"));var Ss=class extends Error{},Ii=class extends vt{constructor(t,n,i,s){super(t,n,i,s);this.rubyInstallationUris=[Ee.Uri.joinPath(Ee.Uri.file(vf.default.homedir()),".rubies"),Ee.Uri.joinPath(Ee.Uri.file("/"),"opt","rubies")];let o=Ee.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.chrubyRubies");o&&this.rubyInstallationUris.push(...o.map(a=>Ee.Uri.file(a)))}async activate(){let t=await this.discoverRubyVersion(),n;try{if(t)n=await this.findRubyUri(t);else{let d=await this.fallbackWithCancellation("No .ruby-version file found. Trying to fall back to latest installed Ruby in 10 seconds","You can create a .ruby-version file in a parent directory to configure a fallback",this.findFallbackRuby.bind(this),this.rubyVersionError.bind(this));t=d.rubyVersion,n=d.uri}}catch(d){if(d instanceof Ss)return this.activate();throw d}try{if(!n){let d={...t},p=await this.fallbackWithCancellation(`Couldn't find installation for ${t.version}. Trying to fall back to other Ruby in 10 seconds`,"You can cancel this fallback and install the required Ruby",async()=>this.findClosestRubyInstallation(d),()=>this.missingRubyError(d.version));t=p.rubyVersion,n=p.uri}}catch(d){if(d instanceof Ss)return this.activate();throw d}this.outputChannel.info(`Discovered Ruby installation at ${n.fsPath}`);let{defaultGems:i,gemHome:s,yjit:o,version:a}=await this.runActivationScript(n,t);this.outputChannel.info(`Activated Ruby environment: defaultGems=${i} gemHome=${s} yjit=${o}`);let c={GEM_HOME:s,GEM_PATH:`${s}${Gn.default.delimiter}${i}`,PATH:`${Gn.default.join(s,"bin")}${Gn.default.delimiter}${Gn.default.join(i,"bin")}${Gn.default.delimiter}${Gn.default.dirname(n.fsPath)}${Gn.default.delimiter}${this.getProcessPath()}`};return{env:{...process.env,...c},yjit:o,version:a,gemPath:[s,i]}}getProcessPath(){return process.env.PATH}async findRubyUri(t){let n=t.engine?[`${t.engine}-${t.version}`,t.version]:[t.version,`ruby-${t.version}`];for(let i of this.rubyInstallationUris){let s;try{s=(await Ee.workspace.fs.readDirectory(i)).sort((o,a)=>a[0].localeCompare(o[0]))}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${i.fsPath} but it doesn't exist`);continue}for(let o of n){let a=s.find(([c])=>c.startsWith(o));if(a)return Ee.Uri.joinPath(i,a[0],"bin","ruby")}}}async runActivationScript(t,n){let i=["user_dir = Gem.user_dir","paths = Gem.path","if paths.length > 2","  paths.delete(Gem.default_dir)","  paths.delete(Gem.user_dir)","  if paths[0]","    user_dir = paths[0] if Dir.exist?(paths[0])","  end","end",`newer_gem_home = File.join(File.dirname(user_dir), "${n.version}")`,"gems = (Dir.exist?(newer_gem_home) ? newer_gem_home : user_dir)",`STDERR.print([Gem.default_dir, gems, !!defined?(RubyVM::YJIT), RUBY_VERSION].join("${Cs}"))`].join(";"),s=await this.runScript(`${t.fsPath} -EUTF-8:UTF-8 -e '${i}'`),[o,a,c,d]=s.stderr.split(Cs);return{defaultGems:o,gemHome:a,yjit:c==="true",version:d}}async findClosestRubyInstallation(t){let[n,i,s]=t.version.split("."),o=[];for(let c of this.rubyInstallationUris)try{(await Ee.workspace.fs.readDirectory(c)).forEach(([d])=>{let p=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(d);p?.groups&&p.groups.version.startsWith(n)&&o.push({uri:Ee.Uri.joinPath(c,d,"bin","ruby"),rubyVersion:{engine:p.groups.engine,version:p.groups.version}})})}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${c.fsPath} but it doesn't exist`);continue}let a=o.sort((c,d)=>{let p=c.rubyVersion.version.split("."),m=d.rubyVersion.version.split("."),g=Math.abs(Number(p[1])-Number(i)),S=Math.abs(Number(m[1])-Number(i));return g===S?Number(m[2]||0)-Number(p[2]||0):g-S})[0];if(a)return a;throw new Error("Cannot find any Ruby installations")}async discoverRubyVersion(){let t=this.bundleUri,n=Gn.default.parse(t.fsPath).root,i,s;for(;t.fsPath!==n;){try{s=Ee.Uri.joinPath(t,".ruby-version"),i=(await Ee.workspace.fs.readFile(s)).toString().trim()}catch{t=Ee.Uri.file(Gn.default.dirname(t.fsPath));continue}if(i==="")throw new Error(`Ruby version file ${s} is empty`);let o=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(i);if(!o?.groups)throw new Error(`Ruby version file ${s} contains invalid format. Expected (engine-)?version, got ${i}`);return this.outputChannel.info(`Discovered Ruby version ${i} from ${s.fsPath}`),{engine:o.groups.engine,version:o.groups.version}}}async fallbackWithCancellation(t,n,i,s){let o;try{o=await Ee.workspace.fs.readFile(Ee.Uri.joinPath(this.workspaceFolder.uri,"Gemfile"))}catch{}if(o&&/^ruby(\s|\()("|')[\d.]+/.test(o.toString()))throw s();return await Ee.window.withProgress({title:t,location:Ee.ProgressLocation.Notification,cancellable:!0},async(c,d)=>{if(c.report({message:n}),await new Promise(p=>{setTimeout(p,1e4),d.onCancellationRequested(()=>{p()})}),d.isCancellationRequested)throw await this.handleCancelledFallback(s),new Ss;return i()})}async handleCancelledFallback(t){let n=await Ee.window.showInformationMessage(`The Ruby LSP requires a Ruby version to launch.
      You can define a fallback for the system or for the Ruby LSP only`,"System","Ruby LSP only");throw n==="System"?await this.createParentRubyVersionFile(t):n==="Ruby LSP only"&&await this.manuallySelectRuby(),t()}async createParentRubyVersionFile(t){let n=[];for(let o of this.rubyInstallationUris){let a;try{a=(await Ee.workspace.fs.readDirectory(o)).sort((c,d)=>d[0].localeCompare(c[0])),a.forEach(c=>{n.push({label:c[0]})})}catch{continue}}let i=await Ee.window.showQuickPick(n,{title:"Select a Ruby version to use as fallback",ignoreFocusOut:!0});if(!i)throw t();let s=await Ee.window.showOpenDialog({defaultUri:Ee.Uri.file(vf.default.homedir()),openLabel:"Add fallback in this directory",canSelectFiles:!1,canSelectFolders:!0,canSelectMany:!1,title:"Select the directory to create the .ruby-version fallback in"});if(!s)throw t();await Ee.workspace.fs.writeFile(Ee.Uri.joinPath(s[0],".ruby-version"),Buffer.from(i.label))}async findFallbackRuby(){for(let t of this.rubyInstallationUris){let n;try{n=(await Ee.workspace.fs.readDirectory(t)).sort((o,a)=>a[0].localeCompare(o[0]));let i,s;for(let o of n){let a=/((?<engine>[A-Za-z]+)-)?(?<version>\d+\.\d+(\.\d+)?(-[A-Za-z0-9]+)?)/.exec(o[0]);if(a?.groups){i=a.groups,s=o;break}}if(s)return{uri:Ee.Uri.joinPath(t,s[0],"bin","ruby"),rubyVersion:{engine:i.engine,version:i.version}}}catch{this.outputChannel.debug(`Tried searching for Ruby installation in ${t.fsPath} but it doesn't exist`);continue}}throw new Error("Cannot find any Ruby installations")}missingRubyError(t){return new Error(`Cannot find Ruby installation for version ${t}`)}rubyVersionError(){return new Error(`Cannot find .ruby-version file. Please specify the Ruby version in a
           .ruby-version either in ${this.bundleUri.fsPath} or in a parent directory`)}};var nb=te(require("os")),Xn=te(require("vscode"));var wa=class extends vt{async activate(){let e=await this.findMiseUri(),t=await this.runEnvActivationScript(`${e.fsPath} x -- ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findMiseUri(){let t=Xn.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.miseExecutablePath");if(t){let i=Xn.Uri.file(t);try{return await Xn.workspace.fs.stat(i),i}catch{throw new Error(`Mise executable configured as ${i}, but that file doesn't exist`)}}let n=[Xn.Uri.joinPath(Xn.Uri.file(nb.default.homedir()),".local","bin","mise"),Xn.Uri.joinPath(Xn.Uri.file("/"),"opt","homebrew","bin","mise")];for(let i of n)try{return await Xn.workspace.fs.stat(i),i}catch{}throw new Error(`The Ruby LSP version manager is configured to be Mise, but could not find Mise installation. Searched in
        ${n.join(", ")}`)}};var Ca=te(require("os")),qr=te(require("vscode"));var Ra=class extends Ii{getProcessPath(){return process.env.Path??process.env.PATH??process.env.path}async findRubyUri(e){let[t,n,i]=e.version.split(".").map(Number),s=[qr.Uri.joinPath(qr.Uri.file("C:"),`Ruby${t}${n}-${Ca.default.arch()}`),qr.Uri.joinPath(qr.Uri.file(Ca.default.homedir()),`Ruby${t}${n}-${Ca.default.arch()}`)];for(let o of s)try{return await qr.workspace.fs.stat(o),qr.Uri.joinPath(o,"bin","ruby")}catch{}throw new Error(`Cannot find installation directory for Ruby version ${e.version}.         Searched in ${s.map(o=>o.fsPath).join(", ")}`)}async runActivationScript(e,t){let n=await super.runActivationScript(e,t);return n.gemHome=n.gemHome.replace(/\//g,"\\"),n.defaultGems=n.defaultGems.replace(/\//g,"\\"),n}runScript(e){return this.outputChannel.info(`Running command: \`${e}\` in ${this.bundleUri.fsPath}`),this.outputChannel.debug(`Environment used for command: ${JSON.stringify(process.env)}`),It(e,{cwd:this.bundleUri.fsPath,env:process.env})}};var Qr=te(require("vscode"));var Sa=class extends vt{async activate(){let e=await this.findRbenv(),t=await this.runEnvActivationScript(`${e} exec ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRbenv(){let t=Qr.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.rbenvExecutablePath");return t?this.ensureRbenvExistsAt(t):this.findExec([Qr.Uri.file("/opt/homebrew/bin"),Qr.Uri.file("/usr/local/bin")],"rbenv")}async ensureRbenvExistsAt(e){try{return await Qr.workspace.fs.stat(Qr.Uri.file(e)),e}catch{throw new Error(`The Ruby LSP version manager is configured to be rbenv, but ${e} does not exist`)}}};var rb=te(require("os")),cr=te(require("vscode"));var Da=class extends vt{async activate(){let e=await this.findRvmInstallation(),t=await this.runEnvActivationScript(e.fsPath),n=Object.entries(t.env).map(([i,s])=>`${i}=${s}`).join(" ");return this.outputChannel.info(`Activated Ruby environment: ${n}`),{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findRvmInstallation(){let e=[cr.Uri.joinPath(cr.Uri.file(rb.default.homedir()),".rvm","bin","rvm-auto-ruby"),cr.Uri.joinPath(cr.Uri.file("/"),"usr","local","rvm","bin","rvm-auto-ruby"),cr.Uri.joinPath(cr.Uri.file("/"),"usr","share","rvm","bin","rvm-auto-ruby")];for(let t of e)try{return await cr.workspace.fs.stat(t),t}catch{}throw new Error(`Cannot find RVM installation directory. Searched in ${e.map(t=>t.fsPath).join(",")}`)}};var qi=class extends vt{constructor(e,t,n,i,s){super(e,t,n,i),this.rubyPath=s??"ruby"}async activate(){let e=await this.runEnvActivationScript(this.rubyPath);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}};var ib=te(require("vscode"));var _a=class extends vt{async activate(){let e=await this.runEnvActivationScript(`${this.customCommand()} && ruby`);return{env:{...process.env,...e.env},yjit:e.yjit,version:e.version,gemPath:e.gemPath}}customCommand(){let t=ib.workspace.getConfiguration("rubyLsp").get("customRubyCommand");if(t===void 0)throw new Error("The customRubyCommand configuration must be set when 'custom' is selected as the version manager.         See the [README](https://shopify.github.io/ruby-lsp/version-managers.html) for instructions.");return t}};var sb=te(require("os")),ob=te(require("path")),qt=te(require("vscode"));var Ta=class extends vt{async activate(){let e=await this.findAsdfInstallation(),t=await this.runEnvActivationScript(`. ${e.fsPath} && asdf exec ruby`);return{env:{...process.env,...t.env},yjit:t.yjit,version:t.version,gemPath:t.gemPath}}async findAsdfInstallation(){let e=ob.default.basename(qt.env.shell)==="fish"?"asdf.fish":"asdf.sh",n=qt.workspace.getConfiguration("rubyLsp").get("rubyVersionManager.asdfExecutablePath");if(n){let s=qt.Uri.file(n);try{return await qt.workspace.fs.stat(s),s}catch{throw new Error(`ASDF executable configured as ${s}, but that file doesn't exist`)}}let i=[qt.Uri.joinPath(qt.Uri.file(sb.default.homedir()),".asdf",e),qt.Uri.joinPath(qt.Uri.file("/"),"opt","asdf-vm",e),qt.Uri.joinPath(qt.Uri.file("/"),"opt","homebrew","opt","asdf","libexec",e),qt.Uri.joinPath(qt.Uri.file("/"),"usr","local","opt","asdf","libexec",e)];for(let s of i)try{return await qt.workspace.fs.stat(s),s}catch{}throw new Error(`Could not find ASDF installation. Searched in ${i.join(", ")}`)}};async function jD(){let r=[Le.Uri.joinPath(Le.Uri.file(Pa.default.homedir()),".local","bin","mise"),Le.Uri.joinPath(Le.Uri.file("/"),"opt","homebrew","bin","mise")];for(let e of r)try{return await Le.workspace.fs.stat(e),!0}catch{}return!1}var yf=(p=>(p.Asdf="asdf",p.Auto="auto",p.Chruby="chruby",p.Rbenv="rbenv",p.Rvm="rvm",p.Shadowenv="shadowenv",p.Mise="mise",p.RubyInstaller="rubyInstaller",p.None="none",p.Custom="custom",p))(yf||{}),ka=class{constructor(e,t,n,i){this.gemPath=[];this.#e=Le.workspace.getConfiguration("rubyLsp").get("rubyVersionManager");this.shell=process.env.SHELL?.replace(/(\s+)/g,"\\$1");this._env={};this._error=!1;this.context=e,this.workspaceFolder=t,this.outputChannel=n,this.telemetry=i;let s=Le.workspace.getConfiguration("rubyLsp").get("bundleGemfile");s.length>0&&(this.customBundleGemfile=Fi.default.isAbsolute(s)?s:Fi.default.resolve(Fi.default.join(this.workspaceFolder.uri.fsPath,s)))}#e;get versionManager(){return this.#e}set versionManager(e){typeof e=="string"?this.#e.identifier=e:this.#e=e}get env(){return this._env}get error(){return this._error}async activateRuby(e=Le.workspace.getConfiguration("rubyLsp").get("rubyVersionManager")){this.versionManager=e,this._error=!1;let t=this.context.workspaceState.get(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`);if(t)await this.runActivation(new qi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),t));else{this.versionManager.identifier==="auto"&&(await this.discoverVersionManager(),this.outputChannel.info(`Discovered version manager ${this.versionManager.identifier}`));try{await this.runManagerActivation()}catch(n){n instanceof Rs||this.telemetry.logError(n,{versionManager:this.versionManager.identifier,workspace:new Le.TelemetryTrustedValue(this.workspaceFolder.name)});let i=Le.workspace.getConfiguration("rubyLsp").get("rubyExecutablePath");if(i)await this.runActivation(new qi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this),i));else{if(this._error=!0,this.context.extensionMode===Le.ExtensionMode.Test)throw n;await this.handleRubyError(n.message)}}}if(!this.error&&(this.fetchRubyVersionInfo(),await this.setupBundlePath(),Fi.default.basename(this.workspaceFolder.uri.fsPath)==="ruby-lsp"&&Pa.default.platform()!=="win32")){let n=Le.Uri.joinPath(this.workspaceFolder.uri,"exe");this._env.PATH=`${n.fsPath}${Fi.default.delimiter}${this._env.PATH}`}}async manuallySelectRuby(){let e=await Le.window.showInformationMessage("Configure global or workspace specific fallback for the Ruby LSP?","global","workspace","clear previous workspace selection");if(!e)return;if(e==="clear previous workspace selection")return await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,void 0),this.activateRuby();let t=await Le.window.showOpenDialog({title:`Select Ruby binary path for ${e} configuration`,openLabel:"Select Ruby binary",canSelectMany:!1});if(!t)return;let n=t[0].fsPath;return e==="global"?await Le.workspace.getConfiguration("rubyLsp").update("rubyExecutablePath",n,!0):await this.context.workspaceState.update(`rubyLsp.workspaceRubyPath.${this.workspaceFolder.name}`,n),this.activateRuby()}mergeComposedEnvironment(e){this._env={...this._env,...e}}async runActivation(e){let{env:t,version:n,yjit:i,gemPath:s}=await e.activate(),[o,a,c]=n.split(".").map(Number);this.sanitizeEnvironment(t),this.context.extensionMode!==Le.ExtensionMode.Test&&(process.env=t),this._env=t,this.rubyVersion=n,this.yjitEnabled=i&&o>3||o===3&&a>=2,this.gemPath.push(...s)}fetchRubyVersionInfo(){let[e,t,n]=this.rubyVersion.split(".").map(Number);if(e<3)throw new Error(`The Ruby LSP requires Ruby 3.0 or newer to run. This project is using ${this.rubyVersion}.         [See alternatives](https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#ruby-version-requirement)`);this.yjitEnabled&&e===3&&t===2&&(this._env.RUBYOPT?this._env.RUBYOPT.concat(" --yjit"):this._env.RUBYOPT="--yjit")}sanitizeEnvironment(e){Object.keys(e).forEach(t=>{t.startsWith("RUBY_GC")&&delete e[t]}),delete e.VERBOSE,delete e.DEBUG}async runManagerActivation(){switch(this.versionManager.identifier){case"asdf":await this.runActivation(new Ta(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"chruby":await this.runActivation(new Ii(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rbenv":await this.runActivation(new Sa(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rvm":await this.runActivation(new Da(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"mise":await this.runActivation(new wa(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"rubyInstaller":await this.runActivation(new Ra(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"custom":await this.runActivation(new _a(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;case"none":await this.runActivation(new qi(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break;default:await this.runActivation(new ba(this.workspaceFolder,this.outputChannel,this.context,this.manuallySelectRuby.bind(this)));break}}async setupBundlePath(){if(this.customBundleGemfile)try{await Le.workspace.fs.stat(Le.Uri.file(this.customBundleGemfile)),this._env.BUNDLE_GEMFILE=this.customBundleGemfile}catch{throw new Error(`The configured bundle gemfile ${this.customBundleGemfile} does not exist`)}}async discoverVersionManager(){try{await Le.workspace.fs.stat(Le.Uri.joinPath(this.workspaceFolder.uri,".shadowenv.d")),this.versionManager.identifier="shadowenv";return}catch{}let e=["chruby","rbenv","rvm","asdf"];for(let t of e)if(await this.toolExists(t)){this.versionManager=t;return}if(await jD()){this.versionManager="mise";return}if(Pa.default.platform()==="win32"){this.versionManager="rubyInstaller";return}this.versionManager="none"}async toolExists(e){try{let t=this.shell?`${this.shell} -i -c '`:"";return t+=`${e} --version`,this.shell&&(t+="'"),this.outputChannel.info(`Checking if ${e} is available on the path with command: ${t}`),await It(t,{cwd:this.workspaceFolder.uri.fsPath,timeout:1e3}),!0}catch{return!1}}async handleRubyError(e){let t=await Le.window.showErrorMessage(`Automatic Ruby environment activation with ${this.versionManager.identifier} failed: ${e}`,"Retry","Select Ruby manually");if(t)return t==="Retry"&&await Le.commands.executeCommand("workbench.action.reloadWindow"),this.manuallySelectRuby()}};var bf=te(require("path")),ab=te(require("os")),Ea=require("perf_hooks"),de=te(require("vscode")),cn=te(va());function UD(){let r=Object.keys(mf);return Object.fromEntries(r.map(e=>[e,bs(e)]))}function WD(r,e){let t,n,i=de.workspace.getConfiguration("rubyLsp"),s=i.get("branch"),o=i.get("bundleGemfile"),a=i.get("useBundlerCompose"),c=i.get("bypassTypechecker"),d={cwd:r.uri.fsPath,env:c?{...e,RUBY_LSP_BYPASS_TYPECHECKER:"true"}:e,shell:!0};if(o.length>0)t={command:"bundle",args:["exec","ruby-lsp"],options:d},n={command:"bundle",args:["exec","ruby-lsp","--debug"],options:d};else if(a)t={command:"bundle",args:["compose","gem","ruby-lsp"],options:d},n={command:"bundle",args:["compose","gem","ruby-lsp","--","--debug"],options:d};else{let p=[];s.length>0&&p.push("--branch",s),bs("launcher")&&p.push("--use-launcher"),t={command:"ruby-lsp",args:p,options:d},n={command:"ruby-lsp",args:p.concat(["--debug"]),options:d}}return{run:t,debug:n}}function HD(r,e,t,n,i,s){let o=r.get("pullDiagnosticsOn"),a={onChange:o==="change"||o==="both",onSave:o==="save"||o==="both"},c=r.get("enabledFeatures"),d=Object.keys(c).filter(S=>c[S]),p=["file","git"],m=e.uri.fsPath.replace(/\/$/,""),g=Ir.flatMap(S=>p.map(y=>({scheme:y,language:S,pattern:`${m}/**/*`})));return i&&Ir.forEach(S=>{g.push({language:S,scheme:"untitled"})}),n.gemPath.forEach(S=>{p.forEach(y=>{let P=S.replace(/\\/g,"/");g.push({scheme:y,language:"ruby",pattern:`${P}/**/*`}),/lib\/ruby\/gems\/(?=\d)/.test(P)&&g.push({scheme:y,language:"ruby",pattern:`${P.replace(/lib\/ruby\/gems\/(?=\d)/,"lib/ruby/")}/**/*`})})}),r.get("erbSupport")||(g=g.filter(S=>S.language!=="erb")),{documentSelector:g,workspaceFolder:e,diagnosticCollectionName:ya,outputChannel:t,revealOutputChannelOn:cn.RevealOutputChannelOn.Never,diagnosticPullOptions:a,errorHandler:new wf(e,s),initializationOptions:{enabledFeatures:d,featuresConfiguration:r.get("featuresConfiguration"),formatter:r.get("formatter"),linters:r.get("linters"),indexing:r.get("indexing"),addonSettings:r.get("addonSettings"),enabledFeatureFlags:UD(),telemetryMachineId:de.env.machineId}}}var wf=class{constructor(e,t){this.workspaceFolder=e,this.telemetry=t}error(e,t,n){return{action:cn.ErrorAction.Shutdown,handled:!0}}async closed(){let e=de.workspace.getConfiguration("rubyLsp").get("useLauncher")?"launcher":"direct";return this.telemetry.logUsage("ruby_lsp.launch_failure",{type:"counter",attributes:{label:e}}),await de.window.showErrorMessage(`Launching the Ruby LSP failed. This typically happens due to an error with version manager
      integration or Bundler issues.

      [Logs](command:workbench.action.output.toggleOutput) |
      [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) |
      [Run bundle install](command:rubyLsp.bundleInstall?"${this.workspaceFolder.uri.toString()}")`,"Retry","Shutdown")==="Retry"?{action:cn.CloseAction.Restart,handled:!0}:{action:cn.CloseAction.DoNotRestart,handled:!0}}},Cf=class{fillClientCapabilities(e){e.experimental={requestDelegation:!0}}initialize(e,t){}getState(){return{kind:"static"}}clear(){}},Ds=class extends cn.LanguageClient{constructor(t,n,i,s,o,a,c,d=!1,p){super(ya,WD(o,i.env),HD(de.workspace.getConfiguration("rubyLsp"),o,a,i,d,n),p);this.degraded=!1;this.virtualDocuments=new Map;this.subscriptions=[];this.registerFeature(new Cf),this.workspaceOutputChannel=a,this.virtualDocuments=c,this.registerMiddleware(),this.workingDirectory=o.uri.fsPath,this.baseFolder=bf.default.basename(this.workingDirectory),this.telemetry=n,this.createTestItems=s,this.#e=t,this.ruby=i,this.#t="",this.subscriptions.push(this.onNotification("delegate/textDocument/virtualState",m=>{this.virtualDocuments.set(m.textDocument.uri,m.textDocument.text)}),this.onTelemetry(m=>{m.type==="error"?this.telemetry.logError({message:m.errorMessage,name:m.errorClass,stack:m.stack},{serverVersion:this.serverVersion}):m.type==="data"&&this.validServerTelemetry(m)&&this.telemetry.logUsage(m.eventName,m.data)}))}#e;#t;async afterStart(){this.#t=this.initializeResult?.formatter,this.serverVersion=this.initializeResult?.serverInfo?.version,this.initializeResult?.degraded_mode&&(this.degraded=this.initializeResult?.degraded_mode),this.initializeResult?.bundle_env&&this.ruby.mergeComposedEnvironment(this.initializeResult.bundle_env),await this.fetchAddons()}async fetchAddons(){if(this.initializeResult?.capabilities.experimental?.addon_detection)try{this.addons=await this.sendRequest("rubyLsp/workspace/addons",{})}catch(t){this.workspaceOutputChannel.error(`Error while fetching addons: ${t.data.errorMessage}`)}}get formatter(){return this.#t}get context(){return this.#e}set context(t){this.#e=t}async sendShowSyntaxTreeRequest(t,n){return this.sendRequest("rubyLsp/textDocument/showSyntaxTree",{textDocument:{uri:t.toString()},range:n})}async dispose(t){return this.subscriptions.forEach(n=>n.dispose()),this.subscriptions=[],super.dispose(t)}async benchmarkMiddleware(t,n,i){if(this.state!==cn.State.Running)return i();let s=typeof t=="string"?t:t.method;try{Ea.performance.mark(`${s}.start`);let o=await i();Ea.performance.mark(`${s}.end`);let a=Ea.performance.measure("benchmarks",`${s}.start`,`${s}.end`);return this.logResponseTime(a.duration,s),o}catch(o){if(o.code===-32900)return this.executeDelegateRequest(t,n);if(o.data)if(this.baseFolder==="ruby-lsp"||this.baseFolder==="ruby-lsp-rails")await de.window.showErrorMessage(`Ruby LSP error ${o.data.errorClass}: ${o.data.errorMessage}

${o.data.backtrace}`);else{let{errorMessage:a,errorClass:c,backtrace:d}=o.data;if(a&&c&&d&&o.code===cn.ErrorCodes.InternalError){let p=new de.TelemetryTrustedValue(d.split(`
`).map(m=>m.replace(ab.default.homedir(),"~")).join(`
`));this.telemetry.logError({message:a,name:c,stack:p},{...o.data,serverVersion:this.serverVersion,workspace:new de.TelemetryTrustedValue(bf.default.basename(this.workingDirectory))})}}throw o}}async executeDelegateRequest(t,n){let i=typeof t=="string"?t:t.method,s=n.textDocument.uri;if(!s)return null;let o=this.virtualDocumentUri(s);switch(i){case"textDocument/completion":return de.commands.executeCommand("vscode.executeCompletionItemProvider",de.Uri.parse(o),n.position,n.context.triggerCharacter).then(a=>(a.items.forEach(c=>{c.documentation&&typeof c.documentation!="string"&&"value"in c.documentation&&(c.documentation.kind="markdown"),c.data={...c.data,delegateCompletion:!0}}),a));case"textDocument/hover":return de.commands.executeCommand("vscode.executeHoverProvider",de.Uri.parse(o),n.position);case"textDocument/definition":return de.commands.executeCommand("vscode.executeDefinitionProvider",de.Uri.parse(o),n.position);case"textDocument/signatureHelp":return de.commands.executeCommand("vscode.executeSignatureHelpProvider",de.Uri.parse(o),n.position,n.context?.triggerCharacter);case"textDocument/documentHighlight":return de.commands.executeCommand("vscode.executeDocumentHighlights",de.Uri.parse(o),n.position);default:return this.workspaceOutputChannel.warn(`Attempted to delegate unsupported request ${i}`),null}}registerMiddleware(){this.clientOptions.middleware={provideCodeLenses:async(t,n,i)=>{let s=await i(t,n);if(s){let o=s.filter(a=>a.data.type==="test");o.length&&this.createTestItems(o)}return s},provideOnTypeFormattingEdits:async(t,n,i,s,o,a)=>{let c=await this.sendRequest("textDocument/onTypeFormatting",{textDocument:{uri:t.uri.toString()},position:n,ch:i,options:s},o);if(!c)return null;let d=c.find(k=>k.newText==="$0");if(!d)return c;c.splice(c.indexOf(d),1);let p=new de.WorkspaceEdit;p.set(t.uri,c);let g=de.window.activeTextEditor.document.lineAt(d.range.start.line).text;await de.workspace.applyEdit(p);let S=de.window.activeTextEditor?.options.insertSpaces?" ":"	",y=0;/^\s*$/.exec(g)&&(y=d.range.end.character);let P=S.repeat(y);return await de.window.activeTextEditor.insertSnippet(new de.SnippetString(`${P}${d.newText}`),new de.Selection(d.range.start,d.range.end)),null},sendRequest:async(t,n,i,s)=>this.benchmarkMiddleware(t,n,()=>s(t,n,i)),sendNotification:async(t,n,i)=>this.benchmarkMiddleware(t,i,()=>n(t,i)),didClose:(t,n)=>(this.virtualDocuments.delete(t.uri.toString(!0)),n(t)),provideFoldingRanges:async(t,n,i,s)=>{if(t.languageId==="erb"){let o=this.virtualDocumentUri(t.uri.toString(!0)),a=await de.commands.executeCommand("vscode.executeFoldingRangeProvider",de.Uri.parse(o)),c=await s(t,n,i);return a.concat(c??[])}return s(t,n,i)},provideDocumentLinks:async(t,n,i)=>{if(t.languageId==="erb"){let s=this.virtualDocumentUri(t.uri.toString(!0)),o=await de.commands.executeCommand("vscode.executeLinkProvider",de.Uri.parse(s)),a=await i(t,n);return o.concat(a??[])}return i(t,n)}}}virtualDocumentUri(t){let n=/\.([^.]+)\.erb$/.exec(t)?.[1]||"html";return`embedded-content://${n}/${encodeURIComponent(t)}.${n}`}logResponseTime(t,n){this.telemetry.logUsage("ruby_lsp.response_time",{type:"histogram",value:t,attributes:{message:new de.TelemetryTrustedValue(n),lspVersion:this.serverVersion,rubyVersion:this.ruby.rubyVersion}})}validServerTelemetry(t){let{eventName:n,data:{type:i,value:s}}=t;return typeof n=="string"&&(i==="histogram"&&typeof s=="number"||i==="counter"&&(typeof s=="number"||!s))}};var xa=class{constructor(e,t){this.prefix=`(${e})`,this.actualChannel=t,this.onDidChangeLogLevel=this.actualChannel.onDidChangeLogLevel}get name(){return this.actualChannel.name}get logLevel(){return this.actualChannel.logLevel}trace(e,...t){this.actualChannel.trace(`${this.prefix} ${e}`,...t)}debug(e,...t){this.actualChannel.debug(`${this.prefix} ${e}`,...t)}info(e,...t){this.actualChannel.info(`${this.prefix} ${e}`,...t)}warn(e,...t){this.actualChannel.warn(`${this.prefix} ${e}`,...t)}error(e,...t){this.actualChannel.error(`${this.prefix} ${e}`,...t)}append(e){this.actualChannel.append(`${this.prefix} ${e}`)}appendLine(e){this.actualChannel.appendLine(`${this.prefix} ${e}`)}replace(e){this.actualChannel.replace(`${this.prefix} ${e}`)}clear(){this.actualChannel.clear()}show(e,t){this.actualChannel.show(t)}hide(){this.actualChannel.hide()}dispose(){this.actualChannel.dispose()}};var cb=["Gemfile.lock","gems.locked"],qa=class{constructor(e,t,n,i,s,o=!1){this.virtualDocuments=new Map;this.restartDocumentShas=new Map;this.needsRestart=!1;this.subscriptions=[];this.#e=!1;this.#t=!1;this.debouncedRestart=eb(async e=>{this.outputChannel.info(`Restarting the Ruby LSP because ${e}`),await this.restart()},5e3);this.context=e,this.workspaceFolder=t,this.outputChannel=new xa(t.name,zn),this.telemetry=n,this.ruby=new ka(e,t,this.outputChannel,n),this.createTestItems=i,this.isMainWorkspace=o,this.virtualDocuments=s}#e;#t;async activate(){let e=Ye.extensions.getExtension("vscode.git"),t=this.workspaceFolder.uri;if(e){let i=await e.exports.getAPI(1).openRepository(this.workspaceFolder.uri);i&&(t=i.rootUri)}this.registerCreateDeleteWatcher(t,".git/{rebase-merge,rebase-apply,BISECT_START,CHERRY_PICK_HEAD}"),this.registerRestarts();for(let n of cb){let i=Ye.Uri.joinPath(this.workspaceFolder.uri,n),s=await this.fileContentsSha(i);s&&this.restartDocumentShas.set(i.fsPath,s)}}async start(e){if(await this.ruby.activateRuby(),this.ruby.error){this.error=!0;return}try{if((await Ye.workspace.fs.stat(this.workspaceFolder.uri)).permissions)throw new Error(`Directory ${this.workspaceFolder.uri.fsPath} is readonly.`)}catch{this.error=!0,await Ye.window.showErrorMessage(`Directory ${this.workspaceFolder.uri.fsPath} is not writable. The Ruby LSP server needs to be able to create a
        .ruby-lsp directory to function appropriately. Consider switching to a directory for which VS Code has write
        permissions`);return}try{await this.installOrUpdateServer(!1)}catch(t){this.error=!0,await Ye.window.showErrorMessage(`Failed to setup the bundle: ${t.message}.         See [Troubleshooting](https://shopify.github.io/ruby-lsp/troubleshooting.html) for help`);return}this.lspClient&&await this.stop(),this.lspClient=new Ds(this.context,this.telemetry,this.ruby,this.createTestItems,this.workspaceFolder,this.outputChannel,this.virtualDocuments,this.isMainWorkspace,e);try{wn.fire(this),await Ye.window.withProgress({location:Ye.ProgressLocation.Window,title:"Initializing Ruby LSP"},async()=>{await this.lspClient.start(),await this.lspClient.afterStart()}),wn.fire(this),this.needsRestart&&(this.needsRestart=!1,await this.debouncedRestart("a restart was requested while the server was still booting"))}catch(t){this.error=!0,this.outputChannel.error(`Error starting the server: ${t.message}`)}}async stop(){await this.lspClient?.dispose()}async restart(){try{if(this.#e)return;if(this.error=!1,!this.lspClient)return this.start();let e=!1;switch(this.lspClient.state){case Ia.State.Starting:this.needsRestart=!0;break;case Ia.State.Running:e=!this.lspClient.initializeResult?.capabilities.experimental.compose_bundle||await this.composingBundleSucceeds(),e&&(await this.stop(),this.lspClient=void 0,await this.start());break;case Ia.State.Stopped:await this.stop(),this.lspClient=void 0,await this.start();break}}catch(e){this.error=!0,this.outputChannel.error(`Error restarting the server: ${e.message}`)}}async dispose(){this.subscriptions.forEach(e=>e.dispose()),await this.lspClient?.dispose()}async installOrUpdateServer(e){if(Ye.workspace.getConfiguration("rubyLsp").get("bundleGemfile").length>0)return;let n=24*60*60*1e3,i=this.context.workspaceState.get("rubyLsp.lastGemUpdate"),s=["ruby-lsp","language_server-protocol","prism","rbs","sorbet-runtime"],{stdout:o}=await It(`gem list ${s.join(" ")}`,{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env});if(!s.every(a=>new RegExp(`${a}\\s`).exec(o))){await It("gem install ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now());return}if(e)try{await Ye.workspace.fs.delete(Ye.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp"),{recursive:!0})}catch{this.outputChannel.info(`Tried deleting ${Ye.Uri.joinPath(this.workspaceFolder.uri,".ruby-lsp")}, but it doesn't exist`)}if(e||i===void 0||Date.now()-i>n)try{await It("gem update ruby-lsp",{cwd:this.workspaceFolder.uri.fsPath,env:this.ruby.env}),await this.context.workspaceState.update("rubyLsp.lastGemUpdate",Date.now())}catch(a){this.outputChannel.error(`Failed to update global ruby-lsp gem: ${a}`)}}get error(){return this.#t}set error(e){wn.fire(this),this.#t=e}get inhibitRestart(){return this.#e}async execute(e,t=!1){t&&(this.outputChannel.show(),this.outputChannel.info(`Running "${e}"`));let n=await It(e,{env:this.ruby.env,cwd:this.workspaceFolder.uri.fsPath});return t&&(n.stderr.length>0?this.outputChannel.error(n.stderr):this.outputChannel.info(n.stdout)),n}registerRestarts(){this.createRestartWatcher(`{${cb.join(",")}}`),this.subscriptions.push(Ye.workspace.onDidChangeConfiguration(async e=>{e.affectsConfiguration("rubyLsp")&&await this.debouncedRestart("configuration changed")}))}createRestartWatcher(e){let t=Ye.workspace.createFileSystemWatcher(new Ye.RelativePattern(this.workspaceFolder,e)),n=async s=>{let o=s.fsPath,a=await this.fileContentsSha(s);a&&this.restartDocumentShas.get(o)!==a&&(this.restartDocumentShas.set(o,a),await this.debouncedRestart(`${o} changed, matching ${e}`))},i=async s=>{this.restartDocumentShas.delete(s.fsPath),await this.debouncedRestart(`${s.fsPath} changed, matching ${e}`)};this.subscriptions.push(t,t.onDidChange(n),t.onDidCreate(n),t.onDidDelete(i))}registerCreateDeleteWatcher(e,t){let n=Ye.workspace.createFileSystemWatcher(new Ye.RelativePattern(e,t)),i=()=>{this.#e=!0},s=async o=>{this.#e=!1,await this.debouncedRestart(`${o.fsPath} changed, matching ${t}`)};this.subscriptions.push(n,n.onDidCreate(i),n.onDidDelete(s))}async fileContentsSha(e){let t;try{t=await Ye.workspace.fs.readFile(e)}catch{return}let n=(0,ub.createHash)("sha256");return n.update(t.toString()),n.digest("hex")}async composingBundleSucceeds(){if(!this.lspClient)return!1;try{return(await this.lspClient.sendRequest("rubyLsp/composeBundle")).success}catch{return!1}}};var Qt=te(require("vscode")),Fa=te(ma());var db=[{label:"Ruby LSP: Start",description:"rubyLsp.start"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"}],Rf=[{label:"Ruby LSP: Stop",description:"rubyLsp.stop"},{label:"Ruby LSP: Restart",description:"rubyLsp.restart"},{label:"Ruby LSP: Open server changelog in browser",description:"rubyLsp.showServerChangelog"}],Jr=class{constructor(e){let t=Ir.map(n=>({language:n}));this.item=Qt.languages.createLanguageStatusItem(e,t)}dispose(){this.item.dispose()}},Sf=class extends Jr{constructor(){super("rubyVersion"),this.item.name="Ruby Version",this.item.command={title:"Configure",command:"rubyLsp.selectRubyVersionManager"},this.item.text="Activating Ruby environment",this.item.severity=Qt.LanguageStatusSeverity.Information}refresh(e){e.ruby.error?(this.item.text="Failed to activate Ruby",this.item.severity=Qt.LanguageStatusSeverity.Error):(this.item.text=`Using Ruby ${e.ruby.rubyVersion} with ${e.ruby.versionManager.identifier}`,this.item.severity=Qt.LanguageStatusSeverity.Information)}},Df=class extends Jr{constructor(){super("server"),this.item.name="Ruby LSP Server Status",this.item.text="Ruby LSP: Starting",this.item.severity=Qt.LanguageStatusSeverity.Information,this.item.command={title:"Configure",command:"rubyLsp.serverOptions",arguments:[Rf]}}refresh(e){if(e.error){this.item.text="Ruby LSP: Error",this.item.command.arguments=[db],this.item.severity=Qt.LanguageStatusSeverity.Error;return}if(e.lspClient)switch(e.lspClient.state){case Fa.State.Running:{this.item.text=e.lspClient.serverVersion?`Ruby LSP v${e.lspClient.serverVersion}: Running`:"Ruby LSP: Running",e.lspClient.degraded?(this.item.text+=" (degraded)",this.item.severity=Qt.LanguageStatusSeverity.Warning):this.item.severity=Qt.LanguageStatusSeverity.Information,this.item.command.arguments=[Rf];break}case Fa.State.Starting:{this.item.text="Ruby LSP: Starting",this.item.command.arguments=[Rf],this.item.severity=Qt.LanguageStatusSeverity.Information;break}case Fa.State.Stopped:{this.item.text="Ruby LSP: Stopped",this.item.command.arguments=[db],this.item.severity=Qt.LanguageStatusSeverity.Information;break}}}},_f=class extends Jr{constructor(){super("features"),this.item.name="Ruby LSP Features",this.item.command={title:"Manage",command:"rubyLsp.toggleFeatures"},this.item.text="Fetching feature information"}refresh(e){let n=Qt.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),i=Object.keys(n).filter(s=>n[s]);this.item.text=`${i.length}/${Object.keys(n).length} features enabled`}},Tf=class extends Jr{constructor(){super("formatter"),this.item.name="Ruby LSP Formatter",this.item.command={title:"Help",command:"rubyLsp.formatterHelp"},this.item.text="Fetching formatter information"}refresh(e){e.lspClient&&(e.lspClient.formatter?this.item.text=`Formatter: ${e.lspClient.formatter}`:this.item.text="Formatter: requires server to be v0.12.4 or higher to display this field")}},Pf=class extends Jr{constructor(){super("addons"),this.item.name="Ruby LSP Add-ons",this.item.text="Fetching add-on information"}refresh(e){e.lspClient&&(e.lspClient.addons===void 0?this.item.text="Addons: requires server to be v0.17.4 or higher to display this field":e.lspClient.addons.length===0?this.item.text="Addons: none":(this.item.text=`Addons: ${e.lspClient.addons.length}`,this.item.command={title:"Details",command:"rubyLsp.displayAddons"}))}},Oa=class{constructor(){this.items=[];this.items=[new Sf,new Df,new _f,new Tf,new Pf],wn.event(e=>{e&&this.items.forEach(t=>t.refresh(e))})}dispose(){this.items.forEach(e=>e.dispose())}};var pb=require("child_process"),gb=require("util"),Fr=te(require("path")),X=te(require("vscode"));var KD=(0,gb.promisify)(pb.exec),fb=new X.TestTag("workspace"),hb=new X.TestTag("test_dir"),Oi=new X.TestTag("debug"),La=class{constructor(e,t,n){this.testTimeout=X.workspace.getConfiguration("rubyLsp").get("testTimeout");this.fullDiscovery=bs("fullTestDiscovery");this.telemetry=t,this.currentWorkspace=n,this.testController=X.tests.createTestController("rubyTests","Ruby Tests"),this.fullDiscovery&&(this.testController.resolveHandler=this.resolveHandler.bind(this)),this.testCommands=new WeakMap,this.testRunProfile=this.testController.createRunProfile("Run",X.TestRunProfileKind.Run,async(i,s)=>{await this.runHandler(i,s)},!0),this.testDebugProfile=this.testController.createRunProfile("Debug",X.TestRunProfileKind.Debug,async(i,s)=>{await this.debugHandler(i,s)},!1,Oi),e.subscriptions.push(this.testController,this.testDebugProfile,this.testRunProfile,X.window.onDidCloseTerminal(i=>{i===this.terminal&&(this.terminal=void 0)}),X.window.onDidChangeActiveTextEditor(async i=>{let s=i?.document.uri;if(!s)return;let o=await this.getTestItem(s);o&&await X.commands.executeCommand("vscode.revealTestInExplorer",o)}))}createTestItems(e){if(this.fullDiscovery)return;this.testController.items.forEach(i=>{this.testController.items.delete(i.id),this.testCommands.delete(i)});let t=new Map,n=X.Uri.from({scheme:"file",path:e[0].command.arguments[0]});e.forEach(i=>{let[s,o,a,c,d]=i.command.arguments,p=this.testController.createTestItem(o,d||o,n),m=i.data;if(p.tags=[new X.TestTag(m.kind)],this.testCommands.set(p,a),p.range=new X.Range(new X.Position(c.start_line,c.start_column),new X.Position(c.end_line,c.end_column)),m.id?(t.set(m.id,p),p.canResolveChildren=!0):p.tags=[...p.tags,Oi],m.group_id){let g=t.get(m.group_id);g?g.children.add(p):this.currentWorkspace()?.outputChannel.error(`Test example "${o}" is attached to group_id ${m.group_id}, but that group does not exist`)}else this.testController.items.add(p)})}runTestInTerminal(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"",this.terminal===void 0&&(this.terminal=this.getTerminal()),this.terminal.show(),this.terminal.sendText(n),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test_in_terminal",vscodemachineid:X.env.machineId}})}async runOnClick(e){let t=this.findTestById(e);if(!t)return;await X.commands.executeCommand("vscode.revealTestInExplorer",t);let n=new X.CancellationTokenSource;n.token.onCancellationRequested(async()=>{n?.dispose(),n=null,await X.window.showInformationMessage("Cancelled the progress")});let i=new X.TestRunRequest([t],[],this.testRunProfile);return this.testRunProfile.runHandler(i,n.token)}debugTest(e,t,n){n??=this.testCommands.get(this.findTestByActiveLine())||"";let i=this.currentWorkspace();if(!i)throw new Error("No workspace found. Debugging requires a workspace to be opened");return X.debug.startDebugging(i.workspaceFolder,{type:"ruby_lsp",name:"Debug",request:"launch",program:n,env:{...i.ruby.env,DISABLE_SPRING:"1"}})}getTerminal(){let e=this.currentWorkspace(),t=e?`${e.workspaceFolder.name}: test`:"Ruby LSP: test",n=X.window.terminals.find(i=>i.name===t);return n||X.window.createTerminal({name:t})}async debugHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=e.include[0],s=Date.now();await this.debugTest("","",this.testCommands.get(i)),n.passed(i,Date.now()-s),n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"debug",vscodemachineid:X.env.machineId}})}async runHandler(e,t){let n=this.testController.createTestRun(e,void 0,!0),i=[],s=a=>{i.push(a),n.enqueued(a)};e.include?e.include.forEach(s):this.testController.items.forEach(s);let o=this.currentWorkspace();for(;i.length>0&&!t.isCancellationRequested;){let a=i.pop();if(e.exclude?.includes(a)){n.skipped(a);continue}if(n.started(a),a.tags.find(c=>c.id==="example")){let c=Date.now();try{if(!o){n.errored(a,new X.TestMessage("No workspace found"));continue}let d=await this.assertTestPasses(a,o.workspaceFolder.uri.fsPath,o.ruby.env);n.appendOutput(d.replace(/\r?\n/g,`\r
`),void 0,a),n.passed(a,Date.now()-c)}catch(d){let p=Date.now()-c;if(d.killed){n.errored(a,new X.TestMessage(`Test timed out after ${this.testTimeout} seconds`),p);continue}let m=d.message.split(`
`),g=m[0]===""?m.slice(10,m.length-2).join(`
`):m.slice(4,m.length-9).join(`
`),S=[new X.TestMessage(d.message),new X.TestMessage(g)];m.find(y=>y==="F")?n.failed(a,S,p):n.errored(a,S,p)}}a.children.forEach(s)}n.end(),this.telemetry.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"test",vscodemachineid:X.env.machineId}})}async assertTestPasses(e,t,n){try{return(await KD(this.testCommands.get(e),{cwd:t,env:n,timeout:this.testTimeout*1e3})).stdout}catch(i){throw i.killed?i:new Error(i.stdout)}}findTestById(e,t=this.testController.items){if(!e)return this.findTestByActiveLine();let n=t.get(e);return n||(t.forEach(i=>{let s=this.findTestById(e,i.children);s&&(n=s)}),n)}findTestByActiveLine(e=X.window.activeTextEditor,t=this.testController.items){if(!e)return;let n=e.selection.active.line,i;return t.forEach(s=>{if(!i&&(s.uri?.toString()===e.document.uri.toString()&&s.range?.start.line<=n&&s.range?.end.line>=n&&(i=s),s.children.size>0)){let o=this.findTestByActiveLine(e,s.children);o&&(i=o)}}),i}async resolveHandler(e){let t=X.workspace.workspaceFolders;if(t)if(e){let n=X.workspace.getWorkspaceFolder(e.uri);e.tags.some(i=>i===fb)&&await this.gatherWorkspaceTests(n,e)}else if(t.length===1)await this.gatherWorkspaceTests(t[0],void 0);else for(let n of t){let i=this.testPattern(n);if((await X.workspace.findFiles(i,void 0,1)).length===0)continue;let o=n.uri,a=this.testController.createTestItem(o.toString(),n.name,o);a.canResolveChildren=!0,a.tags=[fb,Oi],this.testController.items.add(a)}}async gatherWorkspaceTests(e,t){let n=t?t.children:this.testController.items,i=this.testPattern(e);for(let s of await X.workspace.findFiles(i)){let o=Fr.default.basename(s.fsPath);if(o==="test_helper.rb")continue;let c=X.workspace.asRelativePath(s).split(Fr.default.sep),d=this.testDirectoryPosition(c),p=c.slice(0,d+1).join(Fr.default.sep),m=X.Uri.joinPath(e.uri,p),g=n.get(m.toString());g||(g=this.testController.createTestItem(m.toString(),p,m),g.tags=[hb,Oi],n.add(g));let S=c.slice(d+1,d+2).join(Fr.default.sep),y=X.Uri.joinPath(m,S),P=await X.workspace.fs.stat(y),k=g.children;if(P.type===X.FileType.Directory){let M=g.children.get(y.toString());M||(M=this.testController.createTestItem(y.toString(),S,y),M.tags=[hb,Oi],g.children.add(M)),k=M.children}let L=this.testController.createTestItem(s.toString(),o,s);L.canResolveChildren=!0,L.tags=[Oi],k.add(L)}}testPattern(e){return new X.RelativePattern(e,"**/{test,spec,features}/**/{*_test.rb,test_*.rb,*_spec.rb,*.feature}")}testDirectoryPosition(e){let t=e.indexOf("test");return t!==-1||(t=e.indexOf("spec"),t!==-1)?t:e.indexOf("features")}async getTestItem(e){let t=X.workspace.workspaceFolders;if(!t)return;let n=this.testController.items;t.length>1&&(n=n.get(X.workspace.getWorkspaceFolder(e).uri.toString()).children);let{firstLevelUri:i,secondLevelUri:s}=await this.directoryLevelUris(e,t[0]),o=n.get(i.toString());return s&&(o=o?.children.get(s.toString())),o?.children.get(e.toString())}async directoryLevelUris(e,t){let i=X.workspace.asRelativePath(e).split(Fr.default.sep),s=this.testDirectoryPosition(i),o=i.slice(0,s+1).join(Fr.default.sep),a=X.Uri.joinPath(t.uri,o),c=i.slice(s+1,s+2).join(Fr.default.sep),d=X.Uri.joinPath(a,c);return(await X.workspace.fs.stat(d)).type===X.FileType.Directory?{firstLevelUri:a,secondLevelUri:d}:{firstLevelUri:a,secondLevelUri:void 0}}};var mb=te(require("path")),je=te(require("vscode"));async function vb(r,e,t){let{file:n,...i}=t,{line:s,character:o=0,endLine:a=s,endCharacter:c=o}=i,d=new je.Range(s,o,a,c),p=je.Uri.parse(`file://${n}`),m=await je.workspace.openTextDocument(p);await je.window.showTextDocument(m,{selection:d}),e?.lspClient?.serverVersion&&r.logUsage("ruby_lsp.code_lens",{type:"counter",attributes:{label:"open_file",vscodemachineid:je.env.machineId}})}async function yb(r){if(r.length===1){await je.commands.executeCommand("vscode.open",je.Uri.parse(r[0]));return}let e=r.map(n=>{let i=je.Uri.parse(n);return{label:mb.default.basename(i.fsPath),iconPath:new je.ThemeIcon("go-to-file"),uri:i}}),t=await je.window.showQuickPick(e,{title:"Select a file to jump to"});t&&await je.commands.executeCommand("vscode.open",t.uri)}async function bb(){let r=await je.workspace.openTextDocument({language:"ruby"}),e=await je.window.showTextDocument(r,{preview:!1}),t=new je.Position(0,0);await e.insertSnippet(new je.SnippetString(`require "test_helper"

class $1Test < Minitest::Test
  def test_$2
    $3
  end
end
`),new je.Selection(t,t))}var wb=te(require("net")),Cb=te(require("os")),Rb=require("child_process"),ot=te(require("vscode"));var kf=class{append(e){console.log(e)}appendLine(e){console.log(e)}},Ma=class{constructor(e,t){this.console=process.env.CI?new kf:ot.debug.activeDebugConsole;this.workspaceResolver=t,e.subscriptions.push(ot.debug.registerDebugConfigurationProvider("ruby_lsp",this),ot.debug.registerDebugAdapterDescriptorFactory("ruby_lsp",this))}async createDebugAdapterDescriptor(e,t){return e.configuration.request==="launch"?this.spawnDebuggeeForLaunch(e):e.configuration.request==="attach"?this.attachDebuggee(e):new Promise((n,i)=>i(new Error(`Unknown request type: ${e.configuration.request}. Please review your launch configurations`)))}provideDebugConfigurations(e,t){return[{type:"ruby_lsp",name:"Debug script",request:"launch",program:"ruby ${file}"},{type:"ruby_lsp",name:"Debug test",request:"launch",program:"ruby -Itest ${relativeFile}"},{type:"ruby_lsp",name:"Attach debugger",request:"attach"}]}resolveDebugConfiguration(e,t,n){let i=this.workspaceResolver(e?.uri);if(!i)throw new Error(`Couldn't find a workspace for URI: ${e?.uri} or editor: ${ot.window.activeTextEditor}`);t.env?t.env=Object.assign(t.env,i.ruby.env):t.env=i.ruby.env;let s=i.workspaceFolder.uri;if(t.targetFolder={path:s.fsPath,name:i.workspaceFolder.name},t.env.BUNDLE_GEMFILE)return t;let o=ot.Uri.joinPath(s,".ruby-lsp");return ot.workspace.fs.readDirectory(o).then(a=>(a.some(c=>c[0]==="Gemfile")?t.env.BUNDLE_GEMFILE=ot.Uri.joinPath(o,"Gemfile").fsPath:a.some(c=>c[0]==="gems.rb")&&(t.env.BUNDLE_GEMFILE=ot.Uri.joinPath(o,"gems.rb").fsPath),t),()=>t)}dispose(){this.debugProcess&&this.debugProcess.kill("SIGTERM")}async getSockets(e){let t=e.configuration,n=e.configuration.debugSocketPath;if(n)return[n];let i=[];try{i=(await It("bundle exec rdbg --util=list-socks",{cwd:e.workspaceFolder?.uri.fsPath,env:t.env})).stdout.toString().split(`
`).filter(o=>o.length>0)}catch(s){this.console.append(`Error listing sockets: ${s.message}`)}return i}async attachDebuggee(e){let t=e.configuration.debugPort;if(t){let s=e.configuration.debugHost;return s?new ot.DebugAdapterServer(t,s):new ot.DebugAdapterServer(t)}let n=await this.getSockets(e);if(n.length===0)throw new Error("No debuggee processes found. Is the process running?");if(n.length===1)return new ot.DebugAdapterNamedPipeServer(n[0]);let i=await ot.window.showQuickPick(n,{placeHolder:"Select a debuggee",ignoreFocusOut:!0}).then(s=>{if(s===void 0)throw new Error("No debuggee selected");return s});return new ot.DebugAdapterNamedPipeServer(i)}async spawnDebuggeeForLaunch(e){let t="",n=!1,i=e.configuration,o=i.targetFolder.path,a=Cb.default.platform()==="win32"?await this.availablePort():void 0;return new Promise((c,d)=>{let p=["exec","rdbg"];a&&p.push("--port",a.toString()),p.push("--open","--command","--",i.program),this.logDebuggerMessage(`Spawning debugger in directory ${o}`),this.logDebuggerMessage(`   Command bundle ${p.join(" ")}`),this.debugProcess=(0,Rb.spawn)("bundle",p,{shell:!0,env:i.env,cwd:o}),this.debugProcess.stderr.on("data",m=>{let g=m.toString();if(this.logDebuggerMessage(g),n||(t+=g),t.includes("DEBUGGER: wait for debugger connection...")){n=!0;let y=RegExp(/DEBUGGER: Debugger can attach via UNIX domain socket \((.*)\)/).exec(t);a?c(new ot.DebugAdapterServer(a)):y&&y.length===2?c(new ot.DebugAdapterNamedPipeServer(y[1])):d(new Error("Debugger not found on UNIX socket"))}}),this.debugProcess.stdout.on("data",m=>{this.logDebuggerMessage(m.toString())}),this.debugProcess.on("error",m=>{this.logDebuggerMessage(m.message),d(m)}),this.debugProcess.on("close",m=>{if(m){let g=`Debugger exited with status ${m}.
Please make sure \`bundle ${p.join(" ")}\` runs without errors in the terminal.
Check the Ruby LSP output channel for more information.
`;this.logDebuggerMessage(g),d(new Error(g))}})})}async availablePort(){return new Promise((e,t)=>{let n=wb.default.createServer();n.unref(),n.on("error",t),n.listen(0,()=>{let i=n.address(),s=typeof i=="string"?Number(i):i?.port;n.close(()=>{e(s)})})})}logDebuggerMessage(e){zn.info(`[debugger]: ${e.trimEnd()}`),this.console.append(e)}};var Sb=te(require("path")),Ie=te(require("vscode")),Db=te(ma());var Na=class{constructor(){this._onDidChangeTreeData=new Ie.EventEmitter;this.onDidChangeTreeData=this._onDidChangeTreeData.event;this.subscriptions=[];this.gemRootFolders={};this.treeView=Ie.window.createTreeView("dependencies",{treeDataProvider:this,showCollapseAll:!0}),this.subscriptions.push(wn.event(this.workspaceDidChange.bind(this)),Ie.window.onDidChangeActiveTextEditor(this.activeEditorDidChange.bind(this)),this.treeView.onDidChangeVisibility(this.treeVisibilityDidChange.bind(this)))}dispose(){this.subscriptions.forEach(e=>e.dispose()),this.treeView.dispose()}getTreeItem(e){return e}getChildren(e){return e?e.getChildren():this.fetchDependencies()}getParent(e){let t=Ie.Uri.joinPath(e.resourceUri,".."),n=Sb.default.parse(t.path).root;if(t.path!==n)if(e instanceof _s||e instanceof Li){let i=this.gemRootFolders[t.toString()];return i||new _s(t)}else return}async refresh(){await this.fetchDependencies(),this._onDidChangeTreeData.fire(void 0)}async workspaceDidChange(e){if(!(!e||e===this.currentWorkspace))return this.currentWorkspace=e,this.refresh()}async activeEditorDidChange(e){let t=e?.document.uri;t&&(this.currentVisibleItem=new Li(t),this.treeView.visible&&await this.revealElement(this.currentVisibleItem))}async treeVisibilityDidChange(e){this.currentVisibleItem&&e.visible&&await this.revealElement(this.currentVisibleItem)}async revealElement(e){Ie.workspace.getConfiguration("explorer").get("autoReveal")&&await this.treeView.reveal(e,{select:!0,focus:!1,expand:!0}),this.currentVisibleItem=void 0}async fetchDependencies(){if(this.gemRootFolders={},!this.currentWorkspace)return[];let e=this.currentWorkspace.lspClient;if(!e||e.state!==Db.State.Running)return[];let n=(await e.sendRequest("rubyLsp/workspace/dependencies",{})).sort((i,s)=>i.dependency===s.dependency?i.name.localeCompare(s.name):s.dependency?1:-1).map(i=>{let s=Ie.Uri.file(i.path),o=new Ef(i.name,i.version,s);return this.gemRootFolders[s.toString()]=o,o});return n.forEach(i=>{this.gemRootFolders[i.resourceUri.toString()]=i}),n}},Ef=class extends Ie.TreeItem{constructor(t,n,i){super(`${t} (${n})`,Ie.TreeItemCollapsibleState.Collapsed);this.resourceUri=i;this.contextValue="dependency",this.iconPath=new Ie.ThemeIcon("ruby")}async getChildren(){let t=this.resourceUri;return(await Ie.workspace.fs.readDirectory(t)).map(([i,s])=>s===Ie.FileType.Directory?new _s(Ie.Uri.joinPath(t,i)):new Li(Ie.Uri.joinPath(t,i)))}},_s=class r extends Ie.TreeItem{constructor(t){super(t,Ie.TreeItemCollapsibleState.Collapsed);this.resourceUri=t;this.contextValue="gem-directory-path",this.description=!0,this.command={command:"list.toggleExpand",title:"Toggle"}}async getChildren(){let t=this.resourceUri;return(await Ie.workspace.fs.readDirectory(t)).map(([i,s])=>s===Ie.FileType.Directory?new r(Ie.Uri.joinPath(t,i)):new Li(Ie.Uri.joinPath(t,i)))}},Li=class extends Ie.TreeItem{constructor(t){super(t,Ie.TreeItemCollapsibleState.None);this.resourceUri=t;this.contextValue="gem-file-path",this.description=!0,this.command={command:"vscode.open",title:"Open",arguments:[t]}}getChildren(){}};var Tb=te(require("os")),Jt=te(require("vscode")),_b=Tb.default.platform()==="win32"?"ruby bin/rails":"bin/rails",Aa=class{constructor(e){this.showWorkspacePick=e}async generate(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${_b} generate ${e}`;await Jt.window.withProgress({location:Jt.ProgressLocation.Notification,title:"Running Rails generate"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/create\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Revealing generated files"}),await this.revealFormattedFiles(n,i)})}async destroy(e,t){let n=t??await this.showWorkspacePick();if(!n)return;let i=[],s=`${_b} destroy ${e}`;await Jt.window.withProgress({location:Jt.ProgressLocation.Notification,title:"Running Rails destroy"},async o=>{o.report({message:`Running "${s}"`});let{stdout:a}=await n.execute(s,!0);a.split(`
`).forEach(c=>{let d=/remove\s*(.*\..*)/.exec(c);d&&i.push(d[1])}),o.report({message:"Closing deleted files"});for(let c of i)await Jt.commands.executeCommand("workbench.action.closeActiveEditor",Jt.Uri.joinPath(n.workspaceFolder.uri,c))})}async revealFormattedFiles(e,t){for(let n of t){let i=Jt.Uri.joinPath(e.workspaceFolder.uri,n);await Jt.window.showTextDocument(i,{preview:!1}),await Jt.commands.executeCommand("editor.action.formatDocument",i),await Jt.commands.executeCommand("workbench.action.files.save",i)}}};var Be=te(require("vscode"));var Pb="rubyLsp.chatAgent",VD=`
  You are a domain driven design and Ruby on Rails expert.
  The user will provide you with details about their Rails application.
  The user will ask you to help model a single specific concept.

  Analyze the provided concept carefully and think step by step. Consider the following aspects:
  1. The core purpose of the concept
  2. Its relationships with other potential entities in the system
  3. The attributes that would best represent this concept in a database

  Based on your analysis, suggest an appropriate model name and attributes to effectively model the concept.
  Follow these guidelines:

  1. Choose a clear, singular noun for the model name that accurately represents the concept
  2. Select attributes that capture the essential characteristics of the concept
  3. Use appropriate data types for each attribute (e.g. string, integer, datetime, boolean)
  4. Consider adding foreign keys for relationships with other models, if applicable

  After determining the model structure, generate the Rails commands to create the model and any associated resources.
  Include all relevant \`generate\` commands in a single Markdown shell code block at the end of your response.

  The \`generate\` commands should ONLY include the type of generator and arguments, not the \`rails generate\` part
  (e.g.: \`model User name:string\` but not \`rails generate model User name:string\`).
  NEVER include commands to migrate the database as part of the code block.
  NEVER include redundant commands (e.g. including the migration and model generation commands for the same model).
`.trim(),$a=class{constructor(e,t){this.agent=Be.chat.createChatParticipant(Pb,this.handler.bind(this)),this.agent.iconPath=Be.Uri.joinPath(e.extensionUri,"icon.png"),this.showWorkspacePick=t}dispose(){this.agent.dispose()}async handler(e,t,n,i){return this.withinConversation("design",e,t)?this.runDesignCommand(e,t,n,i):(n.markdown("Please indicate which command you would like to use for our chat."),{metadata:{command:""}})}async runDesignCommand(e,t,n,i){let s=this.previousInteractions(t),o=[Be.LanguageModelChatMessage.User(`User prompt: ${e.prompt}`),Be.LanguageModelChatMessage.User(VD),Be.LanguageModelChatMessage.User(`Previous interactions with the user: ${s}`)],a=await this.showWorkspacePick();if(e.command&&a){let c=await this.schema(a);c&&o.push(Be.LanguageModelChatMessage.User(`Existing application schema: ${c}`))}try{let[c]=await Be.lm.selectChatModels({vendor:"copilot",family:"gpt-4o"});n.progress("Designing the models for the requested concept...");let d=await c.sendRequest(o,{},i),p="";for await(let g of d.text)n.markdown(g),p+=g;let m=/(?<=```shell)[^.$]*(?=```)/.exec(p);if(a&&m&&m[0]){let g=m[0].trim().split(`
`).map(S=>S.replace(/\s*(bin\/rails|rails) generate\s*/,""));n.button({command:"rubyLsp.railsGenerate",title:"Generate with Rails",arguments:[g,a]}),n.button({command:"rubyLsp.railsDestroy",title:"Revert previous generation",arguments:[g,a]})}}catch(c){this.handleError(c,n)}return{metadata:{command:"design"}}}async schema(e){try{return(await Be.workspace.fs.readFile(Be.Uri.joinPath(e.workspaceFolder.uri,"db/schema.rb"))).toString()}catch{}try{return(await Be.workspace.fs.readFile(Be.Uri.joinPath(e.workspaceFolder.uri,"db/structure.sql"))).toString()}catch{}}withinConversation(e,t,n){return t.command===e||!t.command&&n.history.some(i=>i instanceof Be.ChatRequestTurn&&i.command===e)}handleError(e,t){if(e instanceof Be.LanguageModelError)e.cause instanceof Error&&e.cause.message.includes("off_topic")&&t.markdown("Sorry, I can only help you with Ruby related questions");else throw e}previousInteractions(e){let t="";return e.history.forEach(n=>{if(n instanceof Be.ChatResponseTurn){if(n.participant===Pb){let i="";n.response.forEach(s=>{s instanceof Be.ChatResponseMarkdownPart&&(i+=s.value.value)}),t+=`Response: ${i}`}}else t+=`Request: ${n.prompt}`}),t}};var un=te(require("vscode"));async function kb(r){if(!r){await un.window.showErrorMessage("No active Ruby workspace found.");return}let e=await zD(r),t=un.window.createWebviewPanel("rubyLspInfo","Ruby LSP Information",un.ViewColumn.One,{enableScripts:!0});t.webview.html=GD(e)}async function zD(r){let e=un.version,n=un.extensions.getExtension("Shopify.ruby-lsp").packageJSON.version,i=r.lspClient?.serverVersion??"Unknown",s=r.lspClient?.addons?.map(p=>p.name)??[],o=await BD(),a=un.workspace.getConfiguration("rubyLsp",r.workspaceFolder),c=un.workspace.getConfiguration("rubyLsp"),d={};for(let p of Object.keys(a))a.inspect(p)?.workspaceValue!==void 0&&(d[p]=a.get(p));return{"VS Code Version":e,"Ruby LSP Extension Version":n,"Ruby LSP Server Version":i,"Ruby LSP Add-ons":s,"Ruby Version":r.ruby.rubyVersion??"Unknown","Ruby Version Manager":r.ruby.versionManager.identifier,"Installed Extensions":o.sort(),"Ruby LSP Settings":{Workspace:d,User:c}}}async function BD(){return un.extensions.all.filter(r=>!(r.packageJSON.isBuiltin||r.packageJSON.license==="UNLICENSED"||!r.packageJSON.license)).map(r=>`${r.packageJSON.name} (${r.packageJSON.version})`)}function GD(r){let e=`
### Ruby LSP Information

`;for(let[n,i]of Object.entries(r)){if(e+=`#### ${n}

`,Array.isArray(i))n==="Installed Extensions"?(e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`,e+=`${i.map(s=>`- ${s}`).join(`
`)}
`,e+=`&lt;/details&gt;
`):e+=`${i.map(s=>`- ${s}`).join(`
`)}
`;else if(typeof i=="object"&&i!==null){e+=`&lt;details&gt;
&lt;summary&gt;Click to expand&lt;/summary&gt;

`;for(let[s,o]of Object.entries(i))e+=`##### ${s}

`,e+=`\`\`\`json
${JSON.stringify(o,null,2)}
\`\`\`

`;e+=`&lt;/details&gt;
`}else e+=`${i}
`;e+=`
`}return`
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ruby LSP Information</title>
      <style>
        body { font-family: var(--vscode-font-family); padding: 20px; }
        h1, h2, h3, p, li { color: var(--vscode-editor-foreground); }
        pre {
          background-color: var(--vscode-textBlockQuote-background);
          padding: 16px;
          overflow-x: auto;
          position: relative;
        }
        code { font-family: var(--vscode-editor-font-family); }
        #copyButton {
          position: absolute;
          top: 5px;
          right: 5px;
          background-color: var(--vscode-button-background);
          color: var(--vscode-button-foreground);
          border: none;
          padding: 5px 10px;
          cursor: pointer;
        }
        #copyButton:hover { background-color: var(--vscode-button-hoverBackground); }
      </style>
    </head>
    <body>
      <h1>Ruby LSP Information</h1>
      <p>Please copy the content below and paste it into the issue you're opening:</p>
      <pre><button id="copyButton">Copy</button><code id="diagnosticContent">${e}</code></pre>
      <script>
        const copyButton = document.getElementById('copyButton');
        const diagnosticContent = document.getElementById('diagnosticContent');

        copyButton.addEventListener('click', () => {
          const range = document.createRange();
          range.selectNode(diagnosticContent);
          window.getSelection().removeAllRanges();
          window.getSelection().addRange(range);
          document.execCommand('copy');
          window.getSelection().removeAllRanges();

          copyButton.textContent = 'Copied!';
          setTimeout(() => {
            copyButton.textContent = 'Copy';
          }, 2000);
        });
      </script>
    </body>
    </html>
  `}var ja=class{constructor(e,t){this.workspaces=new Map;this.virtualDocuments=new Map;this.workspacesBeingLaunched=new Set;this.context=e,this.telemetry=t,this.testController=new La(e,this.telemetry,this.currentActiveWorkspace.bind(this)),this.debug=new Ma(e,this.workspaceResolver.bind(this)),this.rails=new Aa(this.showWorkspacePick.bind(this)),this.statusItems=new Oa;let n=new Na;e.subscriptions.push(this.statusItems,this.debug,n,new $a(e,this.showWorkspacePick.bind(this)),N.window.onDidChangeActiveTextEditor(i=>{wn.fire(this.currentActiveWorkspace(i))}),N.workspace.onDidChangeWorkspaceFolders(async i=>{for(let s of i.removed){let o=this.getWorkspace(s.uri);o&&(await o.stop(),await o.dispose(),this.workspaces.delete(s.uri.toString()))}}),N.workspace.onDidOpenTextDocument(async i=>{if(!Ir.includes(i.languageId))return;let s=N.workspace.getWorkspaceFolder(i.uri);if(!s||this.workspacesBeingLaunched.has(s.index))return;this.getWorkspace(s.uri)||(this.workspacesBeingLaunched.add(s.index),await this.activateWorkspace(s,!1))}),N.workspace.registerTextDocumentContentProvider("embedded-content",{provideTextDocumentContent:i=>{let s=/^\/(.*)\.[^.]+$/.exec(i.path)?.[1];if(!s)return"";let o=decodeURIComponent(s);return this.virtualDocuments.get(o)}}),zn,N.workspace.registerTextDocumentContentProvider("ruby-lsp",new ys),...this.registerCommands())}async activate(){await N.commands.executeCommand("testing.clearTestResults");let e=N.workspace.workspaceFolders?.[0];e&&await this.activateWorkspace(e,!0);let t=N.window.activeTextEditor?.document;if(t&&Ir.includes(t.languageId)){let n=N.workspace.getWorkspaceFolder(t.uri);if(n&&!this.workspacesBeingLaunched.has(n.index)){let i=this.workspaces.get(n.uri.toString());n&&!i&&(this.workspacesBeingLaunched.add(n.index),await this.activateWorkspace(n,!1))}}wn.fire(this.currentActiveWorkspace())}async deactivate(){for(let e of this.workspaces.values())await e.stop(),await e.dispose()}async activateWorkspace(e,t){let n=N.workspace.getConfiguration("rubyLsp").get("bundleGemfile"),i=await this.lockfileExists(e.uri);if(t&&!i)return;n.length===0&&!i&&await this.showStandaloneWarning(e.uri.fsPath);let s=new qa(this.context,e,this.telemetry,this.testController.createTestItems.bind(this.testController),this.virtualDocuments,this.workspaces.size===0);this.workspaces.set(e.uri.toString(),s),await s.activate(),await s.start(),await N.commands.executeCommand("setContext","rubyLsp.activated",!0),await this.showFormatOnSaveModeWarning(s),this.workspacesBeingLaunched.delete(e.index)}registerCommands(){return[N.commands.registerCommand("rubyLsp.update",async()=>{let e=await this.showWorkspacePick();e&&(await e.installOrUpdateServer(!0),await e.restart())}),N.commands.registerCommand("rubyLsp.start",async()=>{await(await this.showWorkspacePick())?.start()}),N.commands.registerCommand("rubyLsp.restart",async()=>{await(await this.showWorkspacePick())?.restart()}),N.commands.registerCommand("rubyLsp.stop",async()=>{await(await this.showWorkspacePick())?.dispose()}),N.commands.registerCommand("rubyLsp.showSyntaxTree",this.showSyntaxTree.bind(this)),N.commands.registerCommand("rubyLsp.showServerChangelog",()=>{let e=this.currentActiveWorkspace()?.lspClient?.serverVersion;if(e)return N.env.openExternal(N.Uri.parse(`https://github.com/Shopify/ruby-lsp/releases/tag/v${e}`))}),N.commands.registerCommand("rubyLsp.formatterHelp",()=>N.env.openExternal(N.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md#formatting"))),N.commands.registerCommand("rubyLsp.displayAddons",async()=>{let e=this.currentActiveWorkspace()?.lspClient;if(!e||!e.addons)return;let t=e.addons.sort(i=>i.errored?1:-1).map(i=>({label:`${i.errored?"$(error)":"$(pass)"} ${i.name} ${i.version?`v${i.version}`:""}`})),n=N.window.createQuickPick();n.items=t,n.placeholder="Addons (click to view output)",n.onDidAccept(()=>{n.selectedItems[0]&&this.currentActiveWorkspace()?.outputChannel.show(),n.hide()}),n.onDidHide(()=>{n.dispose()}),n.show()}),N.commands.registerCommand("rubyLsp.toggleFeatures",async()=>{let e=N.extensions.getExtension("Shopify.ruby-lsp").packageJSON.contributes.configuration.properties["rubyLsp.enabledFeatures"].properties,t={};Object.entries(e).forEach(([c,d])=>{t[c]=d.description});let i=N.workspace.getConfiguration("rubyLsp").get("enabledFeatures"),s=Object.keys(i),o=s.map(c=>({label:c,picked:i[c],description:t[c]})),a=await N.window.showQuickPick(o,{canPickMany:!0,placeHolder:"Select the features you would like to enable"});a!==void 0&&(s.forEach(c=>{i[c]=a.some(d=>d.label===c)}),await N.workspace.getConfiguration("rubyLsp").update("enabledFeatures",i,!0,!0))}),N.commands.registerCommand("rubyLsp.toggleExperimentalFeatures",async()=>{let e=N.workspace.getConfiguration("rubyLsp"),t=e.get("enableExperimentalFeatures");await e.update("enableExperimentalFeatures",!t,!0,!0),wn.fire(this.currentActiveWorkspace())}),N.commands.registerCommand("rubyLsp.serverOptions",async e=>{let t=await N.window.showQuickPick(e,{placeHolder:"Select server action"});t!==void 0&&await N.commands.executeCommand(t.description)}),N.commands.registerCommand("rubyLsp.selectRubyVersionManager",async()=>{let e=await N.window.showQuickPick(["Change version manager","Change manual Ruby configuration"],{placeHolder:"What would you like to do?"});if(!e)return;if(e==="Change version manager"){let n=N.workspace.getConfiguration("rubyLsp"),i=n.get("rubyVersionManager"),s=Object.values(yf),o=await N.window.showQuickPick(s,{placeHolder:`Current: ${i.identifier}`});o!==void 0&&(i.identifier=o,await n.update("rubyVersionManager",i,!0));return}let t=await this.showWorkspacePick();t&&await t.ruby.manuallySelectRuby()}),N.commands.registerCommand("rubyLsp.runTest",(e,t,n)=>this.testController.runOnClick(t)),N.commands.registerCommand("rubyLsp.runTestInTerminal",this.testController.runTestInTerminal.bind(this.testController)),N.commands.registerCommand("rubyLsp.debugTest",this.testController.debugTest.bind(this.testController)),N.commands.registerCommand("rubyLsp.runTask",async e=>{let t=this.currentActiveWorkspace();t||(t=await this.showWorkspacePick()),t&&await t.execute(e,!0)}),N.commands.registerCommand("rubyLsp.bundleInstall",e=>{let t=this.workspaces.get(e);if(!t)return;let n=N.window.createTerminal({name:"Bundle install",cwd:t.workspaceFolder.uri.fsPath,env:t.ruby.env});n.show(),n.sendText("bundle install")}),N.commands.registerCommand("rubyLsp.openFile",e=>{if(typeof e[0]=="string")return yb(e);let[t,n]=e,i=this.currentActiveWorkspace();return vb(this.telemetry,i,{file:t,line:parseInt(n,10)-1})}),N.commands.registerCommand("rubyLsp.railsGenerate",async(e,t)=>{let n=e??await N.window.showInputBox({title:"Rails generate arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.generate(n,t);return}for(let i of n)await this.rails.generate(i,t)}}),N.commands.registerCommand("rubyLsp.railsDestroy",async(e,t)=>{let n=e??await N.window.showInputBox({title:"Rails destroy arguments",placeHolder:"model User name:string | scaffold Post title:string"});if(n){if(typeof n=="string"){await this.rails.destroy(n,t);return}for(let i of n)await this.rails.destroy(i,t)}}),N.commands.registerCommand("rubyLsp.fileOperation",async()=>{let e=await this.showWorkspacePick();if(!e)return;let t=[{label:"Minitest test",description:"Create a new Minitest test",iconPath:new N.ThemeIcon("new-file"),command:"rubyLsp.newMinitestFile",args:[]}];e.lspClient?.addons?.some(i=>i.name==="Ruby LSP Rails")&&t.push({label:"Rails generate",description:"Run Rails generate",iconPath:new N.ThemeIcon("new-file"),command:"rubyLsp.railsGenerate",args:[void 0,e]},{label:"Rails destroy",description:"Run Rails destroy",iconPath:new N.ThemeIcon("trash"),command:"rubyLsp.railsDestroy",args:[void 0,e]});let n=await N.window.showQuickPick(t,{title:"Select a Ruby file operation"});n&&await N.commands.executeCommand(n.command,...n.args)}),N.commands.registerCommand("rubyLsp.newMinitestFile",bb),N.commands.registerCommand("rubyLsp.collectRubyLspInfo",async()=>{let e=await this.showWorkspacePick();await kb(e)}),N.commands.registerCommand("rubyLsp.startServerInDebugMode",async()=>{await(await this.showWorkspacePick())?.start(!0)}),N.commands.registerCommand("rubyLsp.showOutput",async()=>{zn.show()}),N.commands.registerCommand("rubyLsp.migrateLaunchConfiguration",async()=>{if(!await this.showWorkspacePick())return;let n=(N.workspace.getConfiguration("launch")?.get("configurations")||[]).map(i=>{if(i.type==="rdbg"){if(i.request==="launch"){let s={...i};if(s.type="ruby_lsp",s.askParameters!==!0){delete s.rdbgPath,delete s.cwd,delete s.useBundler;let o=(s.command||"").replace("${workspaceRoot}/",""),a=s.script||"",c=(s.args||[]).join(" ");s.program=`${o} ${a} ${c}`.trim(),delete s.command,delete s.script,delete s.args,delete s.askParameters}return s}else if(i.request==="attach"){let s={...i};return s.type="ruby_lsp",s.debugSocketPath=i.debugPort,s}}return i});await N.workspace.getConfiguration("launch").update("configurations",n,N.ConfigurationTarget.Workspace)})]}currentActiveWorkspace(e=N.window.activeTextEditor){let t;if(e?t=N.workspace.getWorkspaceFolder(e.document.uri):t=N.workspace.workspaceFolders?.find(n=>n.name===N.workspace.name),!!t)return this.getWorkspace(t.uri)}getWorkspace(e){return this.workspaces.get(e.toString())}workspaceResolver(e){if(!e)return this.currentActiveWorkspace();let t=this.workspaces.get(e.toString());return t||this.currentActiveWorkspace()}async showWorkspacePick(){if(this.workspaces.size===1)return this.workspaces.values().next().value;let e=await N.window.showWorkspaceFolderPick();if(e)return this.getWorkspace(e.uri)}async showSyntaxTree(){let e=N.window.activeTextEditor;if(e){let t=e.document;if(t.languageId!=="ruby"){await N.window.showErrorMessage("Show syntax tree: not a Ruby file");return}let n=N.workspace.getWorkspaceFolder(t.uri);if(!n)return;let i=this.getWorkspace(n.uri),s=e.selection,o;s.active.isEqual(s.anchor)||(s.isReversed?o=xf.Range.create(s.active.line,s.active.character,s.anchor.line,s.anchor.character):o=xf.Range.create(s.anchor.line,s.anchor.character,s.active.line,s.active.character));let a=await i?.lspClient?.sendShowSyntaxTreeRequest(t.uri,o);if(a){let c=await N.workspace.openTextDocument(N.Uri.from({scheme:"ruby-lsp",path:"show-syntax-tree",query:a.ast}));await N.window.showTextDocument(c,{viewColumn:N.ViewColumn.Beside,preserveFocus:!0})}}}async showFormatOnSaveModeWarning(e){let t=N.workspace.getConfiguration("editor",{languageId:"ruby"}),n=t.get("formatOnSaveMode");if(n==="file")return;await N.window.showWarningMessage(`The "editor.formatOnSaveMode" setting is set to ${n} in workspace ${e.workspaceFolder.name}, which
      is currently unsupported by the Ruby LSP. If you'd like to have formatting enabled, please set it to 'file'`,"Change setting to 'file'","Use without formatting")==="Change setting to 'file'"&&await t.update("formatOnSaveMode","file",N.ConfigurationTarget.Global)}async lockfileExists(e){try{return await N.workspace.fs.stat(N.Uri.joinPath(e,"Gemfile.lock")),!0}catch{}try{return await N.workspace.fs.stat(N.Uri.joinPath(e,"gems.locked")),!0}catch{}return!1}async showStandaloneWarning(e){await N.window.withProgress({location:N.ProgressLocation.Notification,title:"No bundle found. Launching in standalone mode in 5 seconds",cancellable:!0},async(t,n)=>{if(t.report({message:"If working in a monorepo, cancel to see configuration instructions"}),await new Promise(i=>{n.onCancellationRequested(()=>{i()}),setTimeout(i,5e3)}),n.isCancellationRequested&&await N.window.showWarningMessage(`Could not find a lockfile in ${e}. Are you using a monorepo setup?`,"See the multi-root workspace docs","Launch anyway")==="See the multi-root workspace docs"){let s=N.Uri.parse("https://github.com/Shopify/ruby-lsp/blob/main/vscode/README.md?tab=readme-ov-file#multi-root-workspaces");await N.env.openExternal(s)}})}};var If;async function XD(r){if(!Yt.workspace.workspaceFolders){await Yt.window.showWarningMessage(`Using the Ruby LSP without any workspaces opened is currently not supported
      ([learn more](https://github.com/Shopify/ruby-lsp/issues/1780))`,"Open a workspace","Continue anyway")==="Open a workspace"&&await Yt.commands.executeCommand("workbench.action.files.openFolder");return}await JD();let e=await YD(r);r.subscriptions.push(e),If=new ja(r,e),await If.activate()}async function QD(){await If.deactivate()}async function JD(){let r=Yt.workspace.getConfiguration("rubyLsp");r.get("enableExperimentalFeatures")&&(await r.update("enableExperimentalFeatures",void 0,!0),await r.update("featureFlags",{all:!0},!0))}async function YD(r){let e;switch(r.extensionMode){case Yt.ExtensionMode.Development:e={sendEventData:(t,n)=>{zn.debug(t,n)},sendErrorData:(t,n)=>{zn.error(t,n)}};break;case Yt.ExtensionMode.Test:e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}};break;default:try{let t=0;for(;!e&&t<5;)await Yt.commands.executeCommand("getTelemetrySenderObject"),e=await Yt.commands.executeCommand("getTelemetrySenderObject"),t++}catch{e={sendEventData:(n,i)=>{},sendErrorData:(n,i)=>{}}}break}return e||(e={sendEventData:(t,n)=>{},sendErrorData:(t,n)=>{}}),Yt.env.createTelemetryLogger(e,{ignoreBuiltInCommonProperties:!0,ignoreUnhandledErrors:!0,additionalCommonProperties:{extensionVersion:r.extension.packageJSON.version,environment:Eb.default.platform()}})}0&&(module.exports={activate,deactivate});
